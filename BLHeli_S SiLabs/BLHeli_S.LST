AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE     1


MACRO ASSEMBLER AX51 V3.12.0.0
OBJECT MODULE PLACED IN Output\R_H_90_REV16_65.OBJ
ASSEMBLER INVOKED BY: C:\SiliconLabs\SimplicityStudio\v4\developer\toolchains\keil_8051\9.53\BIN\AX51.exe BLHeli_S.asm D
                      EFINE(ESCNO=18) DEFINE(MCU_48MHZ=1) DEFINE(FETON_DELAY=90) OBJECT(Output\R_H_90_REV16_65.OBJ) DEBU
                      G MACRO NOMOD51 COND SYMBOLS PAGEWIDTH(120) PAGELENGTH(65) 

LOC    OBJ             LINE     SOURCE

                          1     $nomod51 
                          2     ;**** **** **** **** ****
                          3     ;
                          4     ; BLHeli program for controlling brushless motors in multirotors
                          5     ;
                          6     ; Copyright 2011, 2012 Steffen Skaug
                          7     ; This program is distributed under the terms of the GNU General Public License
                          8     ;
                          9     ; This file is part of BLHeli.
                         10     ;
                         11     ; BLHeli is free software: you can redistribute it and/or modify
                         12     ; it under the terms of the GNU General Public License as published by
                         13     ; the Free Software Foundation, either version 3 of the License, or
                         14     ; (at your option) any later version.
                         15     ;
                         16     ; BLHeli is distributed in the hope that it will be useful,
                         17     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                         18     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                         19     ; GNU General Public License for more details.
                         20     ;
                         21     ; You should have received a copy of the GNU General Public License
                         22     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                         23     ;
                         24     ;**** **** **** **** ****
                         25     ;
                         26     ; This software was initially designed for use with Eflite mCP X, but is now adapted to 
                               copters/planes in general
                         27     ;
                         28     ; The software was inspired by and started from from Bernard Konze's BLMC: http://home.v
                               ersanet.de/~bkonze/blc_6a/blc_6a.htm
                         29     ; And also Simon Kirby's TGY: https://github.com/sim-/tgy
                         30     ;
                         31     ; This file is best viewed with tab width set to 5
                         32     ;
                         33     ; The code is designed for multirotor applications, running damped light mode
                         34     ;
                         35     ; The input signal can be Normal (1-2ms), OneShot125 (125-250us), OneShot42 (41.7-83.3us
                               ) or Multishot (5-25us) at rates as high as allowed by the format.
                         36     ; Three Dshot signal rates are also supported, Dshot150, Dshot300 and Dshot600. A 48MHz 
                               MCU is required for Dshot600.
                         37     ; The code autodetects normal, OneShot125, Oneshot42, Multishot or Dshot.
                         38     ;
                         39     ; The first lines of the software must be modified according to the chosen environment:
                         40     ; ESCNO EQU "ESC"
                         41     ; MCU_48MHZ EQU "N"
                         42     ; FETON_DELAY EQU "N"
                         43     ; 
                         44     ;**** **** **** **** ****
                         45     ; Revision history:
                         46     ; - Rev16.0 Started. Built upon rev 14.5 of base code
                         47     ;           Using hardware pwm for very smooth throttle response, silent running and sup
                               port of very high rpms
                         48     ;           Implemented reverse bidirectional mode
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE     2

                         49     ;           Implemented separate throttle gains fwd and rev in bidirectional mode
                         50     ;           Implemented support for Oneshot42 and Multishot
                         51     ; - Rev16.1 Made low rpm power limiting programmable through the startup power parameter
                         52     ; - Rev16.2 Fixed bug that prevented temperature protection
                         53     ;           Improved robustness to very high input signal rates
                         54     ;           Beeps can be turned off by programming beep strength to 1
                         55     ;           Throttle cal difference is checked to be above required minimum before stori
                               ng. Throttle cal max is not stored until successful min throttle cal
                         56     ; - Rev16.3 Implemented programmable temperature protection
                         57     ;           Improved protection of bootloader and generally reduced risk of flash corrup
                               tion
                         58     ;           Some small changes for improved sync hold
                         59     ; - Rev16.4 Fixed bug where bootloader operation could be blocked by a defective "eeprom
                               " signature
                         60     ; - Rev16.5 Added support for DShot150, DShot300 and DShot600
                         61     ; -Rev16.51 (cturn) Customized Default Values
                         62     ;                               selectedable startup tones, via the 'Beeper Volume' sett
                               ing
                         63     ;                               custom beacon tone, should be easier to hear & not heat 
                               up motors.
                         64     ; -Rev16.52 Fix for 32khz Multishot Calibration bug (redacted) 
                         65     ; -Rev16.53 Added signal type identification via signal and arming tones.
                         66     ; - Rev16.6 Fixed signal detection issue of multishot at 32kHz
                         67     ;           Improved bidirectional mode for high input signal rates
                         68     ;
                         69     ;
                         70     ;**** **** **** **** ****
                         71     ; Minimum 8K Bytes of In-System Self-Programmable Flash
                         72     ; Minimum 512 Bytes Internal SRAM
                         73     ;
                         74     ;**** **** **** **** ****
                         75     ; Master clock is internal 24MHz oscillator (or 48MHz, for which the times below are hal
                               ved)
                         76     ; Although 24/48 are used in the code, the exact clock frequencies are 24.5MHz or 49.0 M
                               Hz
                         77     ; Timer 0 (41.67ns counts) always counts up and is used for
                         78     ; - RC pulse measurement
                         79     ; Timer 1 (41.67ns counts) always counts up and is used for
                         80     ; - DShot frame sync detection
                         81     ; Timer 2 (500ns counts) always counts up and is used for
                         82     ; - RC pulse timeout counts and commutation times
                         83     ; Timer 3 (500ns counts) always counts up and is used for
                         84     ; - Commutation timeouts
                         85     ; PCA0 (41.67ns counts) always counts up and is used for
                         86     ; - Hardware PWM generation
                         87     ;
                         88     ;**** **** **** **** ****
                         89     ; Interrupt handling
                         90     ; The C8051 does not disable interrupts when entering an interrupt routine.
                         91     ; Also some interrupt flags need to be cleared by software
                         92     ; The code disables interrupts in some interrupt routines
                         93     ; - Interrupts are disabled during beeps, to avoid audible interference from interrupts
                         94     ;
                         95     ;**** **** **** **** ****
                         96     ; Motor control:
                         97     ; - Brushless motor control with 6 states for each electrical 360 degrees
                         98     ; - An advance timing of 0deg has zero cross 30deg after one commutation and 30deg befor
                               e the next
                         99     ; - Timing advance in this implementation is set to 15deg nominally
                        100     ; - Motor pwm is always damped light (aka complementary pwm, regenerative braking)
                        101     ; Motor sequence starting from zero crossing:
                        102     ; - Timer wait: Wt_Comm                 15deg   ; Time to wait from zero cross to actual
                                commutation
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE     3

                        103     ; - Timer wait: Wt_Advance              15deg   ; Time to wait for timing advance. Nomin
                               al commutation point is after this
                        104     ; - Timer wait: Wt_Zc_Scan              7.5deg  ; Time to wait before looking for zero c
                               ross
                        105     ; - Scan for zero cross                 22.5deg ; Nominal, with some motor variations
                        106     ;
                        107     ; Motor startup:
                        108     ; There is a startup phase and an initial run phase, before normal bemf commutation run 
                               begins.
                        109     ;
                        110     ;**** **** **** **** ****
                        111     ; List of enumerated supported ESCs
 0001                   112     A_                      EQU 1   ; X  X  RC X  MC MB MA CC    X  X  Cc Cp Bc Bp Ac Ap
 0002                   113     B_                      EQU 2   ; X  X  RC X  MC MB MA CC    X  X  Ap Ac Bp Bc Cp Cc
 0003                   114     C_                      EQU 3   ; Ac Ap MC MB MA CC X  RC    X  X  X  X  Cc Cp Bc Bp
 0004                   115     D_                      EQU 4   ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    
                               Com fets inverted
 0005                   116     E_                      EQU 5   ; L1 L0 RC X  MC MB MA CC    X  L2 Cc Cp Bc Bp Ac Ap    
                               A with LEDs
 0006                   117     F_                      EQU 6   ; X  X  RC X  MA MB MC CC    X  X  Cc Cp Bc Bp Ac Ap
 0007                   118     G_                      EQU 7   ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    
                               Like D, but noninverted com fets
 0008                   119     H_                      EQU 8   ; RC X  X  X  MA MB CC MC    X  Ap Bp Cp X  Ac Bc Cc
 0009                   120     I_                      EQU 9   ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
 000A                   121     J_                      EQU 10  ; L2 L1 L0 RC CC MB MC MA    X  X  Cc Bc Ac Cp Bp Ap    
                               LEDs
 000B                   122     K_                      EQU 11  ; X  X  MC X  MB CC MA RC    X  X  Ap Bp Cp Cc Bc Ac    
                               Com fets inverted
 000C                   123     L_                      EQU 12  ; X  X  RC X  CC MA MB MC    X  X  Ac Bc Cc Ap Bp Cp
 000D                   124     M_                      EQU 13  ; MA MC CC MB RC L0 X  X     X  Cc Bc Ac Cp Bp Ap X     
                               Inverted LED
 000E                   125     N_                      EQU 14  ; X  X  RC X  MC MB MA CC    X  X  Cp Cc Bp Bc Ap Ac
 000F                   126     O_                      EQU 15  ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    
                               Like D, but low side pwm and 1S flag set.
 0010                   127     P_                      EQU 16  ; X  X  RC MA CC MB MC X     X  Cc Bc Ac Cp Bp Ap X     
                                       
 0011                   128     Q_                      EQU 17  ; Cp Bp Ap L1 L0 X  RC X     X  MA MB MC CC Cc Bc Ac
 0012                   129     R_                      EQU 18  ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                        130     
                        131     ;**** **** **** **** ****
                        132     ; Select the port mapping to use (or unselect all for use with external batch compile fi
                               le)
                        133     ;ESCNO EQU A_
                        134     ;ESCNO EQU B_
                        135     ;ESCNO EQU C_
                        136     ;ESCNO EQU D_
                        137     ;ESCNO EQU E_
                        138     ;ESCNO EQU F_
                        139     ;ESCNO EQU G_
                        140     ;ESCNO EQU H_
                        141     ;ESCNO EQU I_
                        142     ;ESCNO EQU J_
                        143     ;ESCNO EQU K_
                        144     ;ESCNO EQU L_
                        145     ;ESCNO EQU M_
                        146     ;ESCNO EQU N_
                        147     ;ESCNO EQU O_
                        148     ;ESCNO EQU P_
                        149     ;ESCNO EQU Q_
                        150     ;ESCNO EQU R_
                        151     
                        152     ;**** **** **** **** ****
                        153     ; Select the MCU type (or unselect for use with external batch compile file)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE     4

                        154     ;MCU_48MHZ EQU  1
                        155     
                        156     ;**** **** **** **** ****
                        157     ; Select the fet deadtime (or unselect for use with external batch compile file)
                        158     ;FETON_DELAY EQU 10     ; 20.4ns per step
                        159     
                        160     
                        161     ;**** **** **** **** ****
                        162     ; ESC selection statements
                        163     IF 18 == A_
                                ;$include (A.inc) ; Select pinout A
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "A"
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE     5

                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE     6

                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE     7

                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE     8

                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE     9

                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    10

                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    11

                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    12

                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    13

                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    14

                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    15

                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    16

                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    17

                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#A_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#A_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#A_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#A_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#A_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#A_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#A_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#A_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#A_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#A_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#A_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#A_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#A_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#A_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#A_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#A_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#A_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#A_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#A_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#A_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#A_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#A_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    18

                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    19

                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    20

                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    21

                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    22

                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    23

                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    24

                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    25

                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       1475     
                       1476     IF 18 == B_
                                ;$include (B.inc) ; Select pinout B
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "B". Equals "A", but with A and C fets swapped and pwm and co
                               m fets swapped
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Ap Ac Bp Bc Cp Cc
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    26

                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    27

                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    28

                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    29

                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    30

                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    31

                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    32

                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    33

                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    34

                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    35

                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    36

                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    37

                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    38

                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#B_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#B_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#B_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#B_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#B_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#B_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#B_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#B_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#B_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#B_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#B_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#B_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#B_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#B_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#B_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#B_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#B_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#B_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#B_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#B_H_50#        "
                    +1          ELSEIF 90 == 70
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    39

                    +1          Eep_ESC_Layout:         DB      "#B_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#B_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    40

                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    41

                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    42

                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ApwmFET         EQU     5       ;o
                    +1          AcomFET         EQU     4       ;o
                    +1          BpwmFET         EQU     3       ;o
                    +1          BcomFET         EQU     2       ;o
                    +1          CpwmFET         EQU     1       ;o
                    +1          CcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    43

                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    44

                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    45

                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    46

                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       2793     
                       2794     IF 18 == C_
                                ;$include (C.inc) ; Select pinout C
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    47

                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "C"
                    +1          ; Ac Ap MC MB MA CC X  RC    X  X  X  X  Cc Cp Bc Bp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    48

                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    49

                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    50

                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    51

                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    52

                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    53

                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    54

                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    55

                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    56

                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    57

                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    58

                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    59

                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#C_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#C_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#C_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#C_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#C_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#C_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#C_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#C_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#C_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#C_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#C_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    60

                    +1          Eep_ESC_Layout:         DB      "#C_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#C_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#C_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#C_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#C_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#C_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#C_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#C_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#C_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#C_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#C_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     0               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          AcomFET         EQU     7       ;o
                    +1          ApwmFET         EQU     6       ;o
                    +1          Mux_C           EQU     5       ;i
                    +1          Mux_B           EQU     4       ;i
                    +1          Mux_A           EQU     3       ;i
                    +1          Comp_Com                EQU     2       ;i
                    +1          ;                       EQU     1       ;i
                    +1          Rcp_In          EQU     0       ;i
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    61

                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT((1 SHL ApwmFET)+(1 SHL AcomFET))
                    +1          P0_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL AcomFET)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    62

                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    63

                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    64

                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ;                       EQU     5       ;i
                    +1          ;                       EQU     4       ;i
                    +1          CcomFET         EQU     3       ;o
                    +1          CpwmFET         EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          BpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     0Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P0.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P0.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.ApwmFET
                    +1          ELSE
                    +1                  clr     P0.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P0.AcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    65

                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P0.ApwmFET
                    +1          ENDIF
                    +1                  setb    P0.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P0.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P0.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P0.AcomFET
                    +1                  mov     P0SKIP, #0BFh
                    +1                  mov     P1SKIP, #0Fh
                    +1          ELSE
                    +1                  mov     P0SKIP, #03Fh
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Eh
                    +1          ELSE
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Bh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    66

                    +1          ELSE
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #03h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #32h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #42h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #52h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    67

                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       4113     
                       4114     IF 18 == D_
                                ;$include (D.inc) ; Select pinout D
                    +1          ;**** **** **** **** ****
                    +1          ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    68

                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "D". Com fets are active low for H/L_N driver and EN_N/PWM dr
                               iver
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    69

                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    70

                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    71

                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    72

                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    73

                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    74

                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    75

                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    76

                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    77

                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    78

                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    79

                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    80

                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#D_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#D_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#D_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#D_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#D_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#D_L_25#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    81

                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#D_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#D_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#D_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#D_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#D_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#D_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#D_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#D_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#D_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#D_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#D_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#D_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#D_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#D_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#D_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#D_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    82

                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    83

                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    84

                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #00h                           ; Damping noninverted, pwm nonin
                               verted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    85

                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    86

                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    87

                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    88

                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    89

                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       5426     
                       5427     IF 18 == E_
                                ;$include (E.inc) ; Select pinout E
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "E". Equals "A", but with LED control. And with HIP2103/4 dri
                               ver initialization
                    +1          ; L1 L0 RC X  MC MB MA CC    X  L2 Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    90

                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    91

                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    92

                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    93

                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    94

                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    95

                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    96

                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    97

                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    98

                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE    99

                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   100

                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   101

                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   102

                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#E_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#E_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#E_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#E_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#E_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#E_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#E_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#E_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#E_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#E_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#E_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#E_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#E_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#E_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#E_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#E_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#E_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#E_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#E_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#E_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#E_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#E_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   103

                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          LED_1           EQU     7       ;o
                    +1          LED_0           EQU     6       ;o
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT((1 SHL LED_0)+(1 SHL LED_1))
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   104

                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   105

                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   106

                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          LED_2           EQU     6       ;o
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)+(1 SHL LED_2)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)+(1 SHL LED_2)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   107

                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   108

                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #7Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #73h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #6Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #4Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   109

                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1                  All_pwmFETs_off ; For unlocking of HIP2103/4 driver circuits
                    +1                  call wait100ms
                    +1                  AcomFET_on
                    +1                  BcomFET_on
                    +1                  CcomFET_on
                    +1                  call wait1ms
                    +1                  All_comFETs_off
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   110

                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1                  setb    P1.LED_2
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1                  clr     P1.LED_2
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       6752     
                       6753     IF 18 == F_
                                ;$include (F.inc) ; Select pinout F
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   111

                    +1          ; Hardware definition file "F". Equals "A", but with Mux_A and Mux_C swapped
                    +1          ; X  X  RC X  MA MB MC CC    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   112

                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   113

                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   114

                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   115

                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   116

                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   117

                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   118

                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   119

                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   120

                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   121

                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   122

                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   123

                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#F_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#F_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#F_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#F_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#F_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#F_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#F_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#F_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#F_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#F_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#F_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#F_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#F_H_05#        "
                    +1          ELSEIF 90 == 10
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   124

                    +1          Eep_ESC_Layout:         DB      "#F_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#F_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#F_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#F_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#F_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#F_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#F_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#F_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#F_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_A           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   125

                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   126

                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   127

                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   128

                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   129

                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   130

                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   131

                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       8065     
                       8066     IF 18 == G_
                                ;$include (G.inc) ; Select pinout G
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   132

                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "G"
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   133

                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   134

                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   135

                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   136

                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   137

                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   138

                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   139

                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   140

                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   141

                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   142

                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   143

                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   144

                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#G_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#G_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#G_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#G_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#G_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#G_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#G_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#G_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#G_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#G_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#G_L_90#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   145

                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#G_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#G_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#G_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#G_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#G_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#G_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#G_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#G_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#G_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#G_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#G_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   146

                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   147

                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   148

                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   149

                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   150

                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   151

                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   152

                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       9378     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   153

                       9379     IF 18 == H_
                                ;$include (H.inc) ; Select pinout H
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "H". 
                    +1          ; RC X  X  X  MA MB CC MC    X  Ap Bp Cp X  Ac Bc Cc 
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   154

                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   155

                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   156

                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   157

                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   158

                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   159

                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   160

                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   161

                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   162

                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   163

                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   164

                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   165

                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#H_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#H_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#H_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#H_L_15#        "
                    +1          ELSEIF 90 == 20
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   166

                    +1          Eep_ESC_Layout:         DB      "#H_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#H_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#H_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#H_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#H_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#H_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#H_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#H_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#H_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#H_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#H_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#H_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#H_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#H_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#H_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#H_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#H_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#H_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   167

                                               
                    +1          RTX_PIN                         EQU     7               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          Rcp_In          EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ;                       EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_A           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Comp_Com                EQU     1       ;i
                    +1          Mux_C           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   168

                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   169

                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   170

                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ApwmFET         EQU     6       ;o
                    +1          BpwmFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          ;                       EQU     3       ;i
                    +1          AcomFET         EQU     2       ;o 
                    +1          BcomFET         EQU     1       ;o
                    +1          CcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   171

                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   172

                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #5Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #6Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Eh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #31h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #21h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #01h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   173

                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   174

                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      10696     
                      10697     IF 18 == I_
                                ;$include (I.inc) ; Select pinout I
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "I"
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   175

                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   176

                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   177

                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   178

                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   179

                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   180

                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   181

                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   182

                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   183

                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   184

                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   185

                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   186

                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   187

                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#I_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#I_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#I_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#I_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#I_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#I_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#I_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#I_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#I_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#I_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#I_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#I_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#I_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#I_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#I_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#I_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#I_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#I_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#I_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#I_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#I_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#I_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   188

                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   189

                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   190

                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   191

                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          AcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          CcomFET         EQU     3       ;o
                    +1          ApwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          CpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   192

                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   193

                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   194

                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   195

                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      12008     
                      12009     IF 18 == J_
                                ;$include (J.inc) ; Select pinout J
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "J"
                    +1          ; L2 L1 L0 RC CC MB MC MA    X  X  Cc Bc Ac Cp Bp Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   196

                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   197

                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   198

                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   199

                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   200

                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   201

                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   202

                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   203

                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   204

                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   205

                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   206

                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   207

                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   208

                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#J_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#J_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#J_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#J_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#J_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#J_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#J_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#J_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#J_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#J_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#J_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#J_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#J_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#J_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#J_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#J_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#J_H_25#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   209

                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#J_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#J_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#J_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#J_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#J_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     4               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          LED_2           EQU     7       ;o
                    +1          LED_1           EQU     6       ;o
                    +1          LED_0           EQU     5       ;o
                    +1          Rcp_In          EQU     4       ;i
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_A           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL LED_2)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   210

                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   211

                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   212

                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          AcomFET         EQU     3       ;o
                    +1          CpwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   213

                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   214

                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   215

                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   216

                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1                  clr     P0.LED_2
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1                  setb    P0.LED_2
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      13326     
                      13327     IF 18 == K_
                                ;$include (K.inc) ; Select pinout K
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   217

                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "K". Com fets are active low for H/L_N driver and EN_N/PWM dr
                               iver
                    +1          ; X  X  MC X  MB CC MA RC    X  X  Ap Bp Cp Cc Bc Ac    Com fets inverted
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   218

                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   219

                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   220

                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   221

                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   222

                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   223

                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   224

                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   225

                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   226

                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   227

                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   228

                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   229

                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#K_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#K_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#K_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#K_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#K_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#K_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#K_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#K_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#K_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#K_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#K_L_90#        "
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   230

                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#K_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#K_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#K_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#K_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#K_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#K_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#K_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#K_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#K_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#K_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#K_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     0               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   231

                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Mux_C           EQU     5       ;i
                    +1          ;                       EQU     4       ;i
                    +1          Mux_B           EQU     3       ;i
                    +1          Comp_Com                EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Rcp_In          EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   232

                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   233

                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #00h                           ; Damping noninverted, pwm nonin
                               verted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   234

                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ApwmFET         EQU     5       ;o
                    +1          BpwmFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;o
                    +1          CcomFET         EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   235

                    +1          ELSE
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Eh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   236

                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #12h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #32h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #52h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   237

                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      14640     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   238

                      14641     IF 18 == L_
                                ;$include (L.inc) ; Select pinout L
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "L"
                    +1          ; X  X  RC X  CC MA MB MC    X  X  Ac Bc Cc Ap Bp Cp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   239

                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   240

                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   241

                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   242

                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   243

                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   244

                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   245

                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   246

                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   247

                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   248

                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   249

                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   250

                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#L_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#L_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#L_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#L_L_15#        "
                    +1          ELSEIF 90 == 20
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   251

                    +1          Eep_ESC_Layout:         DB      "#L_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#L_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#L_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#L_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#L_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#L_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#L_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#L_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#L_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#L_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#L_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#L_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#L_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#L_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#L_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#L_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#L_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#L_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   252

                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_B           EQU     1       ;i
                    +1          Mux_C           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   253

                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   254

                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   255

                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          AcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          CcomFET         EQU     3       ;o
                    +1          ApwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          CpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   256

                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   257

                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   258

                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   259

                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      15952     
                      15953     IF 18 == M_
                                ;$include (M.inc) ; Select pinout M
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "M".
                    +1          ; MA MC CC MB RC L0 X  X     X  Cc Bc Ac Cp Bp Ap X     
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   260

                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   261

                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   262

                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   263

                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   264

                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   265

                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   266

                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   267

                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   268

                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   269

                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   270

                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   271

                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   272

                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#M_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#M_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#M_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#M_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#M_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#M_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#M_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#M_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#M_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#M_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#M_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#M_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#M_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#M_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#M_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#M_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#M_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#M_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#M_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#M_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#M_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#M_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   273

                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     3               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          Mux_A           EQU     7       ;i
                    +1          Mux_C           EQU     6       ;i
                    +1          Comp_Com        EQU     5       ;i
                    +1          Mux_B           EQU     4       ;i
                    +1          Rcp_In          EQU     3       ;i
                    +1          LED_0           EQU     2       ;i
                    +1          ;                       EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT(1 SHL LED_0)
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   274

                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   275

                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   276

                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          CcomFET         EQU     6       ;o
                    +1          BcomFET         EQU     5       ;o
                    +1          AcomFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;i
                    +1          BpwmFET         EQU     2       ;o 
                    +1          ApwmFET         EQU     1       ;o
                    +1          ;                       EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   277

                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   278

                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #77h
                    +1          ELSE
                    +1                  mov     P1SKIP, #37h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #75h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #45h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #65h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   279

                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   280

                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1               clr        P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      17269     
                      17270     IF 18 == N_
                                ;$include (N.inc) ; Select pinout N
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "N"
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Cp Cc Bp Bc Ap Ac
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   281

                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   282

                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   283

                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   284

                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   285

                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   286

                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   287

                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   288

                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   289

                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   290

                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   291

                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   292

                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   293

                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#N_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#N_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#N_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#N_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#N_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#N_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#N_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#N_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#N_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#N_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#N_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#N_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#N_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#N_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#N_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#N_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#N_H_25#        "
                    +1          ELSEIF 90 == 30
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   294

                    +1          Eep_ESC_Layout:         DB      "#N_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#N_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#N_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#N_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#N_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   295

                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   296

                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   297

                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CpwmFET         EQU     5       ;o
                    +1          CcomFET         EQU     4       ;o
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   298

                    +1          BpwmFET         EQU     3       ;o
                    +1          BcomFET         EQU     2       ;o
                    +1          ApwmFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   299

                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   300

                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   301

                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      18587     
                      18588     IF 18 == O_
                                ;$include (O.inc) ; Select pinout O
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   302

                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "O". Com fets are active low for H/L_N driver and EN_N/PWM dr
                               iver. Low side pwm and 1S flag set
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   303

                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   304

                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   305

                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   306

                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   307

                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   308

                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   309

                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   310

                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   311

                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   312

                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   313

                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   314

                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#O_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#O_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#O_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#O_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#O_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#O_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#O_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#O_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#O_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#O_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#O_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   315

                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#O_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#O_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#O_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#O_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#O_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#O_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#O_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#O_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#O_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#O_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#O_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   316

                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   317

                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   318

                    +1                  mov     PCA0POL, #00h                           ; Damping noninverted, pwm nonin
                               verted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   319

                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.CcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   320

                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   321

                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1                  cpl A
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   322

                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      19901     
                      19902     IF 18 == P_
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   323

                                ;$include (P.inc) ; Select pinout P
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "P".
                    +1          ; X  X  RC MA CC MB MC X     X  Cc Bc Ac Cp Bp Ap X    
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   324

                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   325

                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   326

                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   327

                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   328

                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   329

                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   330

                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   331

                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   332

                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   333

                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   334

                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   335

                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#P_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#P_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#P_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#P_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#P_L_20#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   336

                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#P_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#P_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#P_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#P_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#P_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#P_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#P_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#P_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#P_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#P_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#P_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#P_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#P_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#P_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#P_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#P_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#P_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   337

                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          Mux_A           EQU     4       ;i
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   338

                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   339

                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   340

                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          CcomFET         EQU     6       ;o
                    +1          BcomFET         EQU     5       ;o
                    +1          AcomFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;i
                    +1          BpwmFET         EQU     2       ;o 
                    +1          ApwmFET         EQU     1       ;o
                    +1          ;                       EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   341

                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   342

                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #77h
                    +1          ELSE
                    +1                  mov     P1SKIP, #37h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #43h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   343

                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   344

                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      21216     
                      21217     IF 18 == Q_
                                ;$include (Q.inc) ; Select pinout Q
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "Q"
                    +1          ; Cp Bp Ap L1 L0 X  RC X     X  MA MB MC CC Cc Bc Ac
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   345

                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   346

                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   347

                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   348

                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   349

                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   350

                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   351

                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   352

                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   353

                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   354

                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   355

                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   356

                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   357

                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#Q_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#Q_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#Q_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#Q_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#Q_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#Q_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#Q_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#Q_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#Q_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#Q_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#Q_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#Q_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#Q_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#Q_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#Q_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#Q_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#Q_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#Q_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#Q_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#Q_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#Q_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#Q_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   358

                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     1               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          CpwmFET         EQU     7       ;o
                    +1          BpwmFET         EQU     6       ;o
                    +1          ApwmFET         EQU     5       ;o
                    +1          LED_1           EQU     4       ;i
                    +1          LED_0           EQU     3       ;i
                    +1          ;                       EQU     2       ;i
                    +1          Rcp_In          EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     0FFh
                    +1          P0_INIT         EQU     (1 SHL Rcp_In)
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 S
                               HL CpwmFET)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   359

                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   360

                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   361

                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          Mux_A           EQU     6       ;i
                    +1          Mux_B           EQU     5       ;i
                    +1          Mux_C           EQU     4       ;i
                    +1          Comp_Com                EQU     3       ;o
                    +1          CcomFET         EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     07h
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P0.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.ApwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   362

                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P0.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P0.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.ApwmFET
                    +1                  clr     P0.BpwmFET
                    +1                  clr     P0.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P0.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P0.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P0.CpwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   363

                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P0SKIP, #0DFh
                    +1                  mov     P1SKIP, #07h
                    +1          ELSE
                    +1                  mov     P0SKIP, #0DFh
                    +1                  mov     P1SKIP, #06h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P0SKIP, #0BFh
                    +1                  mov     P1SKIP, #07h
                    +1          ELSE
                    +1                  mov     P0SKIP, #0BFh
                    +1                  mov     P1SKIP, #05h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P0SKIP, #07Fh
                    +1                  mov     P1SKIP, #07h
                    +1          ELSE
                    +1                  mov     P0SKIP, #07Fh
                    +1                  mov     P1SKIP, #03h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #07h
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP1MX, #63h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP1MX, #53h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP1MX, #43h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP1CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   364

                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP1CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP1MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   365

                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      22540     
                      22541     IF 18 == R_
                      22542     ;$include (R.inc) ; Select pinout R
                    +122543     ;**** **** **** **** ****
                    +122544     ;
                    +122545     ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +122546     ;
                    +122547     ; Copyright 2011, 2012 Steffen Skaug
                    +122548     ; This program is distributed under the terms of the GNU General Public License
                    +122549     ;
                    +122550     ; This file is part of BLHeli.
                    +122551     ;
                    +122552     ; BLHeli is free software: you can redistribute it and/or modify
                    +122553     ; it under the terms of the GNU General Public License as published by
                    +122554     ; the Free Software Foundation, either version 3 of the License, or
                    +122555     ; (at your option) any later version.
                    +122556     ;
                    +122557     ; BLHeli is distributed in the hope that it will be useful,
                    +122558     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +122559     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +122560     ; GNU General Public License for more details.
                    +122561     ;
                    +122562     ; You should have received a copy of the GNU General Public License
                    +122563     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +122564     ;
                    +122565     ;**** **** **** **** ****
                    +122566     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   366

                    +122567     ; Hardware definition file "R".
                    +122568     ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                    +122569     ;
                    +122570     ;**** **** **** **** ****
                    +122571     
                    +122572     
                    +122573     
                    +122574     ;*********************
                    +122575     ; Device SiLabs EFM8BB1x/2x
                    +122576     ;*********************
                    +122577     IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   367

                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   368

                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   369

                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   370

                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   371

                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +122904     ;$include (SI_EFM8BB2_Defs.inc)
                    +222905     ;------------------------------------------------------------------------------
                    +222906     ; Copyright 2014 Silicon Laboratories, Inc.
                    +222907     ; All rights reserved. This program and the accompanying materials
                    +222908     ; are made available under the terms of the Silicon Laboratories End User
                    +222909     ; License Agreement which accompanies this distribution, and is available at
                    +222910     ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +222911     ; Original content and implementation provided by Silicon Laboratories.
                    +222912     ;------------------------------------------------------------------------------
                    +222913     ;Supported Devices:
                    +222914     ;  EFM8BB21F16G_QFN20
                    +222915     ;  EFM8BB21F16G_QSOP24
                    +222916     ;  EFM8BB21F16I_QFN20
                    +222917     ;  EFM8BB21F16I_QSOP24
                    +222918     ;  EFM8BB22F16G_QFN28
                    +222919     ;  EFM8BB22F16I_QFN28
                    +222920     
                    +222921     ;-----------------------------------------------------------------------------
                    +222922     ; Register Definitions
                    +222923     ;-----------------------------------------------------------------------------
 00E0               +222924     ACC       DATA 0E0H; Accumulator                            
 00B3               +222925     ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
 00BC               +222926     ADC0CF    DATA 0BCH; ADC0 Configuration                     
 00E8               +222927     ADC0CN0   DATA 0E8H; ADC0 Control 0                         
 00B2               +222928     ADC0CN1   DATA 0B2H; ADC0 Control 1                         
 00C4               +222929     ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
 00C3               +222930     ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
 00BE               +222931     ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
 00BD               +222932     ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
 00C6               +222933     ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
 00C5               +222934     ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
 00BB               +222935     ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
 00DF               +222936     ADC0PWR   DATA 0DFH; ADC0 Power Control                     
 00B9               +222937     ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
 00F0               +222938     B         DATA 0F0H; B Register                             
 008E               +222939     CKCON0    DATA 08EH; Clock Control 0                        
 00A6               +222940     CKCON1    DATA 0A6H; Clock Control 1
 00A9               +222941     CLKSEL    DATA 0A9H; Clock Select                           
 009B               +222942     CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   372

 0099               +222943     CMP0CN1   DATA 099H; Comparator 0 Control 1
 009D               +222944     CMP0MD    DATA 09DH; Comparator 0 Mode                      
 009F               +222945     CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
 00BF               +222946     CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
 00AC               +222947     CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
 00AB               +222948     CMP1MD    DATA 0ABH; Comparator 1 Mode                      
 00AA               +222949     CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
 00CE               +222950     CRC0CN0   DATA 0CEH; CRC0 Control 0                         
 0086               +222951     CRC0CN1   DATA 086H; CRC0 Control 1                         
 00D3               +222952     CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
 00DE               +222953     CRC0DAT   DATA 0DEH; CRC0 Data Output                       
 00CF               +222954     CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
 00DD               +222955     CRC0IN    DATA 0DDH; CRC0 Data Input                        
 00D2               +222956     CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
 00AD               +222957     DERIVID   DATA 0ADH; Derivative Identification              
 00B5               +222958     DEVICEID  DATA 0B5H; Device Identification                  
 0083               +222959     DPH       DATA 083H; Data Pointer High                      
 0082               +222960     DPL       DATA 082H; Data Pointer Low                       
 00E6               +222961     EIE1      DATA 0E6H; Extended Interrupt Enable 1            
 00CE               +222962     EIE2      DATA 0CEH; Extended Interrupt Enable 2            
 00F3               +222963     EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
 00F5               +222964     EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
 00F4               +222965     EIP2      DATA 0F4H; Extended Interrupt Priority 2          
 00F6               +222966     EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
 00E7               +222967     EMI0CN    DATA 0E7H; External Memory Interface Control      
 00B7               +222968     FLKEY     DATA 0B7H; Flash Lock and Key                     
 00C7               +222969     HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
 00D6               +222970     HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
 00EF               +222971     HFOCN     DATA 0EFH; High Frequency Oscillator Control      
 00BA               +222972     I2C0CN0   DATA 0BAH; I2C0 Control                           
 00BC               +222973     I2C0DIN   DATA 0BCH; I2C0 Received Data                     
 00BB               +222974     I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
 00AD               +222975     I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
 00AB               +222976     I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
 00F5               +222977     I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
 00BD               +222978     I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
 00B9               +222979     I2C0STAT  DATA 0B9H; I2C0 Status                            
 00A8               +222980     IE        DATA 0A8H; Interrupt Enable                       
 00B8               +222981     IP        DATA 0B8H; Interrupt Priority                     
 00F2               +222982     IPH       DATA 0F2H; Interrupt Priority High                
 00E4               +222983     IT01CF    DATA 0E4H; INT0/INT1 Configuration                
 00B1               +222984     LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
 0080               +222985     P0        DATA 080H; Port 0 Pin Latch                       
 00FE               +222986     P0MASK    DATA 0FEH; Port 0 Mask                            
 00FD               +222987     P0MAT     DATA 0FDH; Port 0 Match                           
 00F1               +222988     P0MDIN    DATA 0F1H; Port 0 Input Mode                      
 00A4               +222989     P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
 00D4               +222990     P0SKIP    DATA 0D4H; Port 0 Skip                            
 0090               +222991     P1        DATA 090H; Port 1 Pin Latch                       
 00EE               +222992     P1MASK    DATA 0EEH; Port 1 Mask                            
 00ED               +222993     P1MAT     DATA 0EDH; Port 1 Match                           
 00F2               +222994     P1MDIN    DATA 0F2H; Port 1 Input Mode                      
 00A5               +222995     P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
 00D5               +222996     P1SKIP    DATA 0D5H; Port 1 Skip                            
 00A0               +222997     P2        DATA 0A0H; Port 2 Pin Latch                       
 00FC               +222998     P2MASK    DATA 0FCH; Port 2 Mask                            
 00FB               +222999     P2MAT     DATA 0FBH; Port 2 Match                           
 00F3               +223000     P2MDIN    DATA 0F3H; Port 2 Input Mode                      
 00A6               +223001     P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
 00CC               +223002     P2SKIP    DATA 0CCH; Port 2 Skip                            
 00B0               +223003     P3        DATA 0B0H; Port 3 Pin Latch                       
 00F4               +223004     P3MDIN    DATA 0F4H; Port 3 Input Mode                      
 009C               +223005     P3MDOUT   DATA 09CH; Port 3 Output Mode                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   373

 009E               +223006     PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
 009C               +223007     PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
 00D8               +223008     PCA0CN0   DATA 0D8H; PCA Control                            
 00FC               +223009     PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
 00EA               +223010     PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
 00EC               +223011     PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
 00FB               +223012     PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
 00E9               +223013     PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
 00EB               +223014     PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
 00DA               +223015     PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
 00DB               +223016     PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
 00DC               +223017     PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
 00FA               +223018     PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
 00F9               +223019     PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
 00D9               +223020     PCA0MD    DATA 0D9H; PCA Mode                               
 0096               +223021     PCA0POL   DATA 096H; PCA Output Polarity                    
 00F7               +223022     PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
 0087               +223023     PCON0     DATA 087H; Power Control                          
 009A               +223024     PCON1     DATA 09AH; Power Control 1                        
 00C1               +223025     PFE0CN    DATA 0C1H; Prefetch Engine Control                
 00F6               +223026     PRTDRV    DATA 0F6H; Port Drive Strength                    
 008F               +223027     PSCTL     DATA 08FH; Program Store Control                  
 00D0               +223028     PSW       DATA 0D0H; Program Status Word                    
 00D1               +223029     REF0CN    DATA 0D1H; Voltage Reference Control              
 00C9               +223030     REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
 00C6               +223031     REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
 00B6               +223032     REVID     DATA 0B6H; Revision Identifcation                 
 00EF               +223033     RSTSRC    DATA 0EFH; Reset Source                           
 0094               +223034     SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
 0096               +223035     SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
 0095               +223036     SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
 0099               +223037     SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
 0092               +223038     SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
 0098               +223039     SCON0     DATA 098H; UART0 Serial Port Control              
 00C8               +223040     SCON1     DATA 0C8H; UART1 Serial Port Control              
 00A7               +223041     SFRPAGE   DATA 0A7H; SFR Page                               
 00CF               +223042     SFRPGCN   DATA 0CFH; SFR Page Control                       
 00D7               +223043     SFRSTACK  DATA 0D7H; SFR Page Stack                         
 00D6               +223044     SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
 00D7               +223045     SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
 00C1               +223046     SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
 00C0               +223047     SMB0CN0   DATA 0C0H; SMBus 0 Control                        
 00C2               +223048     SMB0DAT   DATA 0C2H; SMBus 0 Data                           
 00C3               +223049     SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
 00C4               +223050     SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
 00EF               +223051     SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
 00C5               +223052     SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
 00AC               +223053     SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
 0093               +223054     SMOD1     DATA 093H; UART1 Mode                             
 0081               +223055     SP        DATA 081H; Stack Pointer                          
 00A1               +223056     SPI0CFG   DATA 0A1H; SPI0 Configuration                     
 00A2               +223057     SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
 00F8               +223058     SPI0CN0   DATA 0F8H; SPI0 Control                           
 00A3               +223059     SPI0DAT   DATA 0A3H; SPI0 Data                              
 009A               +223060     SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
 009B               +223061     SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
 00F7               +223062     SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
 0088               +223063     TCON      DATA 088H; Timer 0/1 Control                      
 008C               +223064     TH0       DATA 08CH; Timer 0 High Byte                      
 008D               +223065     TH1       DATA 08DH; Timer 1 High Byte                      
 008A               +223066     TL0       DATA 08AH; Timer 0 Low Byte                       
 008B               +223067     TL1       DATA 08BH; Timer 1 Low Byte                       
 0089               +223068     TMOD      DATA 089H; Timer 0/1 Mode                         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   374

 00C8               +223069     TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
 00FD               +223070     TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
 00CD               +223071     TMR2H     DATA 0CDH; Timer 2 High Byte                      
 00CC               +223072     TMR2L     DATA 0CCH; Timer 2 Low Byte                       
 00CB               +223073     TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
 00CA               +223074     TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
 0091               +223075     TMR3CN0   DATA 091H; Timer 3 Control 0                      
 00FE               +223076     TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
 0095               +223077     TMR3H     DATA 095H; Timer 3 High Byte                      
 0094               +223078     TMR3L     DATA 094H; Timer 3 Low Byte                       
 0093               +223079     TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
 0092               +223080     TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
 0098               +223081     TMR4CN0   DATA 098H; Timer 4 Control 0                      
 00FF               +223082     TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
 00A5               +223083     TMR4H     DATA 0A5H; Timer 4 High Byte                      
 00A4               +223084     TMR4L     DATA 0A4H; Timer 4 Low Byte                       
 00A3               +223085     TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
 00A2               +223086     TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
 009D               +223087     UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
 00D8               +223088     UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
 00FA               +223089     UART1FCT  DATA 0FAH; UART1 FIFO Count                       
 009E               +223090     UART1LIN  DATA 09EH; UART1 LIN Configuration                
 00FF               +223091     VDM0CN    DATA 0FFH; Supply Monitor Control                 
 0097               +223092     WDTCN     DATA 097H; Watchdog Timer Control                 
 00E1               +223093     XBR0      DATA 0E1H; Port I/O Crossbar 0                    
 00E2               +223094     XBR1      DATA 0E2H; Port I/O Crossbar 1                    
 00E3               +223095     XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +223096     
                    +223097     ;------------------------------------------------------------------------------
                    +223098     ; 16-bit Register Definitions (may not work on all compilers)
                    +223099     ;------------------------------------------------------------------------------
 00C3               +223100     ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
 00BD               +223101     ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
 00C5               +223102     ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
 0082               +223103     DP      DATA 082H ; Data Pointer Low                     
 00FB               +223104     PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
 00E9               +223105     PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
 00EB               +223106     PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
 00F9               +223107     PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
 0095               +223108     SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
 00CC               +223109     TMR2    DATA 0CCH ; Timer 2 Low Byte                     
 00CA               +223110     TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
 0094               +223111     TMR3    DATA 094H ; Timer 3 Low Byte                     
 0092               +223112     TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
 00A4               +223113     TMR4    DATA 0A4H ; Timer 4 Low Byte                     
 00A2               +223114     TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +223115     
                    +223116     ;------------------------------------------------------------------------------
                    +223117     ; Indirect Register Definitions
                    +223118     ;------------------------------------------------------------------------------
                    +223119     
                    +223120     ;------------------------------------------------------------------------------
                    +223121     ; Bit Definitions
                    +223122     ;------------------------------------------------------------------------------
                    +223123     
                    +223124     ; ACC 0xE0 (Accumulator)
 00E0.0             +223125     ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
 00E0.1             +223126     ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
 00E0.2             +223127     ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
 00E0.3             +223128     ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
 00E0.4             +223129     ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
 00E0.5             +223130     ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
 00E0.6             +223131     ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   375

 00E0.7             +223132     ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +223133     
                    +223134     ; ADC0CN0 0xE8 (ADC0 Control 0)
 00E8.0             +223135     ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
 00E8.1             +223136     ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
 00E8.2             +223137     ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
 00E8.3             +223138     ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
 00E8.4             +223139     ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
 00E8.5             +223140     ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
 00E8.6             +223141     ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
 00E8.7             +223142     ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +223143     
                    +223144     ; B 0xF0 (B Register)
 00F0.0             +223145     B_B0 BIT B.0 ; B Register Bit 0
 00F0.1             +223146     B_B1 BIT B.1 ; B Register Bit 1
 00F0.2             +223147     B_B2 BIT B.2 ; B Register Bit 2
 00F0.3             +223148     B_B3 BIT B.3 ; B Register Bit 3
 00F0.4             +223149     B_B4 BIT B.4 ; B Register Bit 4
 00F0.5             +223150     B_B5 BIT B.5 ; B Register Bit 5
 00F0.6             +223151     B_B6 BIT B.6 ; B Register Bit 6
 00F0.7             +223152     B_B7 BIT B.7 ; B Register Bit 7
                    +223153     
                    +223154     ; IE 0xA8 (Interrupt Enable)
 00A8.0             +223155     IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
 00A8.1             +223156     IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
 00A8.2             +223157     IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
 00A8.3             +223158     IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
 00A8.4             +223159     IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
 00A8.5             +223160     IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
 00A8.6             +223161     IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
 00A8.7             +223162     IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +223163     
                    +223164     ; IP 0xB8 (Interrupt Priority)
 00B8.0             +223165     IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
 00B8.1             +223166     IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
 00B8.2             +223167     IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
 00B8.3             +223168     IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
 00B8.4             +223169     IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
 00B8.5             +223170     IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
 00B8.6             +223171     IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +223172     
                    +223173     ; P0 0x80 (Port 0 Pin Latch)
 0080.0             +223174     P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
 0080.1             +223175     P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
 0080.2             +223176     P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
 0080.3             +223177     P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
 0080.4             +223178     P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
 0080.5             +223179     P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
 0080.6             +223180     P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
 0080.7             +223181     P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +223182     
                    +223183     ; P1 0x90 (Port 1 Pin Latch)
 0090.0             +223184     P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
 0090.1             +223185     P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
 0090.2             +223186     P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
 0090.3             +223187     P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
 0090.4             +223188     P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
 0090.5             +223189     P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
 0090.6             +223190     P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
 0090.7             +223191     P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +223192     
                    +223193     ; P2 0xA0 (Port 2 Pin Latch)
 00A0.0             +223194     P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   376

 00A0.1             +223195     P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
 00A0.2             +223196     P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
 00A0.3             +223197     P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +223198     
                    +223199     ; P3 0xB0 (Port 3 Pin Latch)
 00B0.0             +223200     P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
 00B0.1             +223201     P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +223202     
                    +223203     ; PCA0CN0 0xD8 (PCA Control)
 00D8.0             +223204     PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
 00D8.1             +223205     PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
 00D8.2             +223206     PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
 00D8.6             +223207     PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
 00D8.7             +223208     PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +223209     
                    +223210     ; PSW 0xD0 (Program Status Word)
 00D0.0             +223211     PSW_PARITY BIT PSW.0 ; Parity Flag               
 00D0.1             +223212     PSW_F1     BIT PSW.1 ; User Flag 1               
 00D0.2             +223213     PSW_OV     BIT PSW.2 ; Overflow Flag             
 00D0.3             +223214     PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
 00D0.4             +223215     PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
 00D0.5             +223216     PSW_F0     BIT PSW.5 ; User Flag 0               
 00D0.6             +223217     PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
 00D0.7             +223218     PSW_CY     BIT PSW.7 ; Carry Flag                
                    +223219     
                    +223220     ; SCON0 0x98 (UART0 Serial Port Control)
 0098.0             +223221     SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
 0098.1             +223222     SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
 0098.2             +223223     SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
 0098.3             +223224     SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
 0098.4             +223225     SCON0_REN   BIT SCON0.4 ; Receive Enable                     
 0098.5             +223226     SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
 0098.7             +223227     SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +223228     
                    +223229     ; SCON1 0xC8 (UART1 Serial Port Control)
 00C8.0             +223230     SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
 00C8.1             +223231     SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
 00C8.2             +223232     SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
 00C8.3             +223233     SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
 00C8.4             +223234     SCON1_REN  BIT SCON1.4 ; Receive Enable           
 00C8.6             +223235     SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
 00C8.7             +223236     SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +223237     
                    +223238     ; SMB0CN0 0xC0 (SMBus 0 Control)
 00C0.0             +223239     SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
 00C0.1             +223240     SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
 00C0.2             +223241     SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
 00C0.3             +223242     SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
 00C0.4             +223243     SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
 00C0.5             +223244     SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
 00C0.6             +223245     SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
 00C0.7             +223246     SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +223247     
                    +223248     ; SPI0CN0 0xF8 (SPI0 Control)
 00F8.0             +223249     SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
 00F8.1             +223250     SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
 00F8.2             +223251     SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
 00F8.3             +223252     SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
 00F8.4             +223253     SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
 00F8.5             +223254     SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
 00F8.6             +223255     SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
 00F8.7             +223256     SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +223257     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   377

                    +223258     ; TCON 0x88 (Timer 0/1 Control)
 0088.0             +223259     TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
 0088.1             +223260     TCON_IE0 BIT TCON.1 ; External Interrupt 0   
 0088.2             +223261     TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
 0088.3             +223262     TCON_IE1 BIT TCON.3 ; External Interrupt 1   
 0088.4             +223263     TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
 0088.5             +223264     TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
 0088.6             +223265     TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
 0088.7             +223266     TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +223267     
                    +223268     ; TMR2CN0 0xC8 (Timer 2 Control 0)
 00C8.0             +223269     TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
 00C8.1             +223270     TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
 00C8.2             +223271     TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
 00C8.3             +223272     TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
 00C8.4             +223273     TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
 00C8.5             +223274     TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
 00C8.6             +223275     TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
 00C8.7             +223276     TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +223277     
                    +223278     ; TMR4CN0 0x98 (Timer 4 Control 0)
 0098.0             +223279     TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
 0098.1             +223280     TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
 0098.2             +223281     TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
 0098.3             +223282     TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
 0098.4             +223283     TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
 0098.5             +223284     TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
 0098.6             +223285     TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
 0098.7             +223286     TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +223287     
                    +223288     ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
 00D8.0             +223289     UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
 00D8.1             +223290     UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
 00D8.2             +223291     UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
 00D8.3             +223292     UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
 00D8.4             +223293     UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
 00D8.5             +223294     UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
 00D8.6             +223295     UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
 00D8.7             +223296     UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +223297     
                    +223298     ;------------------------------------------------------------------------------
                    +223299     ; Interrupt Definitions
                    +223300     ;------------------------------------------------------------------------------
 0000               +223301     INT0_IRQn    EQU 0  ; External Interrupt 0      
 0001               +223302     TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
 0002               +223303     INT1_IRQn    EQU 2  ; External Interrupt 1      
 0003               +223304     TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
 0004               +223305     UART0_IRQn   EQU 4  ; UART0                     
 0005               +223306     TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
 0006               +223307     SPI0_IRQn    EQU 6  ; SPI0                      
 0007               +223308     SMBUS0_IRQn  EQU 7  ; SMBus 0                   
 0008               +223309     PMATCH_IRQn  EQU 8  ; Port Match                
 0009               +223310     ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
 000A               +223311     ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
 000B               +223312     PCA0_IRQn    EQU 11 ; PCA0                      
 000C               +223313     CMP0_IRQn    EQU 12 ; Comparator 0              
 000D               +223314     CMP1_IRQn    EQU 13 ; Comparator 1              
 000E               +223315     TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
 0011               +223316     UART1_IRQn   EQU 17 ; UART1                     
 0012               +223317     I2C0_IRQn    EQU 18 ; I2C0 Slave                
 0013               +223318     TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +223319     
                    +223320     ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   378

                    +223321     ; SFR Page Definitions
                    +223322     ;------------------------------------------------------------------------------
 0000               +223323     CRC0_PAGE       EQU 000H ; CRC0 Page       
 0000               +223324     LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
 0000               +223325     PCA0_PAGE       EQU 000H ; PCA0 Page       
 0010               +223326     PG2_PAGE        EQU 010H ; Page2           
 0010               +223327     TIMER2_PAGE     EQU 010H ; Timer 2 Page    
 0010               +223328     TIMER3_PAGE     EQU 010H ; Timer 3 Page    
 0010               +223329     TIMER4_PAGE     EQU 010H ; Timer 4 Page    
 0020               +223330     I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
 0020               +223331     PG3_PAGE        EQU 020H ; Page3           
 0020               +223332     SMB0_PAGE       EQU 020H ; SMBus 0 Page    
 0020               +223333     SPI0_PAGE       EQU 020H ; SPI0 Page       
 0020               +223334     UART0_PAGE      EQU 020H ; UART0 Page      
 0020               +223335     UART1_PAGE      EQU 020H ; UART1 Page      
                    +123336     
                    +123337     ENDIF
                    +123338     
                    +123339     
                    +123340     ;**** **** **** **** ****
                    +123341     ; Uses internal calibrated oscillator set to 24/48Mhz
                    +123342     ;**** **** **** **** ****
                    +123343     
                    +123344     ;**** **** **** **** ****
                    +123345     ; Constant definitions
                    +123346     ;**** **** **** **** ****
                    +123347     IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#R_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#R_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#R_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#R_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#R_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#R_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#R_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#R_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#R_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#R_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#R_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +123376     
001A40              +123377     CSEG AT 1A40h
                    +123378     IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#R_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#R_H_05#        "
                    +1          ELSEIF 90 == 10
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   379

                    +1          Eep_ESC_Layout:         DB      "#R_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#R_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#R_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#R_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#R_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#R_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#R_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#R_H_70#        "
                    +1          ELSEIF 90 == 90
001A40 23525F48     +123399     Eep_ESC_Layout:         DB      "#R_H_90#        "
001A44 5F393023                 
001A48 20202020                 
001A4C 20202020                 
                    +123400     ENDIF
001A50              +123401     CSEG AT 1A50h
001A50 23424C48     +123402     Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
001A54 454C4924                 
001A58 45464D38                 
001A5C 42323123                 
                    +123403     ENDIF
                    +123404     
 0031               +123405     TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
 0009               +123406     TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +123407     
                    +123408     ;**** **** **** **** ****
                    +123409     ; Bootloader definitions
                    +123410     ;**** **** **** **** ****
 0080               +123411     RTX_PORT                                EQU     P0              ; Receive/Transmit port
 00A4               +123412     RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
 00F1               +123413     RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
 00D4               +123414     RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
 0005               +123415     RTX_PIN                         EQU     5               ; RTX pin
                    +123416     
 00E8               +123417     SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +123418     IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
 00B2               +123421     SIGNATURE_002                   EQU     0B2h
                    +123422     ENDIF
                    +123423     
                    +123424     ;*********************
                    +123425     ; PORT 0 definitions *
                    +123426     ;*********************  
                    +123427     ;                       EQU     7       ;i
                    +123428     ;                       EQU     6       ;i
 0005               +123429     Rcp_In          EQU     5       ;i
                    +123430     ;                       EQU     4       ;i 
 0003               +123431     Mux_C           EQU     3       ;i
 0002               +123432     Mux_B           EQU     2       ;i
 0001               +123433     Mux_A           EQU     1       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   380

 0000               +123434     Comp_Com                EQU     0       ;i
                    +123435     
 FFF0               +123436     P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
 00FF               +123437     P0_INIT         EQU     0FFh
 0000               +123438     P0_PUSHPULL     EQU     0
 00FF               +123439     P0_SKIP         EQU     0FFh
                    +123440     
                    +123441     Get_Rcp_Capture_Values MACRO
                    +123442             anl     TCON, #0EFh                             ; Disable timer0
                    +123443             mov     Temp1, TL0                              ; Get timer0 values
                    +123444             mov     Temp2, TH0
                    +123445     IF 1 == 1
                    +123446             mov     Temp3, Timer0_X
                    +123447             jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +123448             inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +123449     ENDIF
                    +123450             mov     TL0, #0                                 ; Reset timer0
                    +123451             mov     TH0, #0
                    +123452     IF 1 == 1
                    +123453             mov     Timer0_X, #0
                    +123454     ENDIF
                    +123455             orl     TCON, #10h                              ; Enable timer0 again
                    +123456     IF 1 == 1
                    +123457             mov     A, Clock_Set_At_48MHz
                    +123458             jnz     Get_Rcp_End
                    +123459             clr     C
                    +123460             mov     A, Temp1
                    +123461             rlc     A
                    +123462             mov     Temp1, A
                    +123463             mov     A, Temp2
                    +123464             rlc     A
                    +123465             mov     Temp2, A
                    +123466             mov     A, Temp3
                    +123467             rlc     A
                    +123468             mov     Temp3, A
                    +123469     Get_Rcp_End:
                    +123470     ENDIF
                    +123471     ENDM
                    +123472     Decode_Dshot_2Msb MACRO
                    +123473             movx    A, @DPTR
                    +123474             mov     Temp6, A
                    +123475             clr     C
                    +123476             subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +123477             clr     C
                    +123478             subb    A, Temp1
                    +123479             jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +123480     
                    +123481             subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +123482             mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +123483             rlc     A
                    +123484             mov     Temp4, A
                    +123485             inc     DPL                                             ; Next bit
                    +123486             movx    A, @DPTR
                    +123487             mov     Temp5, A
                    +123488             clr     C
                    +123489             subb    A, Temp6
                    +123490             clr     C
                    +123491             subb    A, Temp1
                    +123492             jc      t1_int_msb_fail
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   381

                    +123493     
                    +123494             subb    A, Temp1
                    +123495             mov     A, Temp4
                    +123496             rlc     A
                    +123497             mov     Temp4, A
                    +123498             inc     DPL
                    +123499     ENDM
                    +123500     Decode_Dshot_2Lsb MACRO
                    +123501             movx    A, @DPTR
                    +123502             mov     Temp6, A
                    +123503             clr     C
                    +123504             subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +123505             clr     C
                    +123506             subb    A, Temp1
                    +123507             jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +123508     
                    +123509             subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +123510             mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +123511             rlc     A
                    +123512             mov     Temp3, A
                    +123513             inc     DPL                                             ; Next bit
                    +123514             movx    A, @DPTR
                    +123515             mov     Temp5, A
                    +123516             clr     C
                    +123517             subb    A, Temp6
                    +123518             clr     C
                    +123519             subb    A, Temp1
                    +123520             jc      t1_int_lsb_fail
                    +123521     
                    +123522             subb    A, Temp1
                    +123523             mov     A, Temp3
                    +123524             rlc     A
                    +123525             mov     Temp3, A
                    +123526             inc     DPL
                    +123527     ENDM
                    +123528     Initialize_PCA MACRO
                    +123529             mov     PCA0CN0, #40h                           ; PCA enabled
                    +123530             mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +123531     IF 90 == 0
                    +123532     IF 1 == 0
                    +123533             mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +123534     ELSE
                    +123535             mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +123536     ENDIF
                    +123537             mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +123538     ELSE
                    +123539     IF 1 == 0
                    +123540             mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +123541     ELSE
                    +123542             mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +123543     ENDIF
                    +123544             mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +123545     ENDIF
                    +123546     ENDM
                    +123547     Set_Pwm_Polarity MACRO
                    +123548             mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +123549     ENDM
                    +123550     Enable_Power_Pwm_Module MACRO
                    +123551     IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   382

                    +123552             mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +123553     ELSE
                    +123554             mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +123555     ENDIF
                    +123556     ENDM
                    +123557     Enable_Damp_Pwm_Module MACRO
                    +123558     IF 90 == 0
                    +123559             mov     PCA0CPM1, #00h                          ; Disable
                    +123560     ELSE
                    +123561             mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +123562     ENDIF
                    +123563     ENDM
                    +123564     Set_Power_Pwm_Regs MACRO
                    +123565     IF 90 == 0
                    +123566             mov     PCA0CPL0, Power_Pwm_Reg_L
                    +123567             mov     PCA0CPH0, Power_Pwm_Reg_H
                    +123568     ELSE
                    +123569             clr     C
                    +123570             mov     A, Power_Pwm_Reg_H
                    +123571             rrc     A
                    +123572             mov     Temp1, A
                    +123573             mov     A, Power_Pwm_Reg_L
                    +123574             rrc     A
                    +123575             mov     PCA0CPL0, A
                    +123576             mov     PCA0CPH0, Temp1
                    +123577     ENDIF
                    +123578     ENDM            
                    +123579     Set_Damp_Pwm_Regs MACRO
                    +123580     IF 90 == 0
                    +123581             mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +123582             mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +123583     ELSE
                    +123584             clr     C
                    +123585             mov     A, Damp_Pwm_Reg_H
                    +123586             rrc     A
                    +123587             mov     Temp1, A
                    +123588             mov     A, Damp_Pwm_Reg_L
                    +123589             rrc     A
                    +123590             mov     PCA0CPL1, A
                    +123591             mov     PCA0CPH1, Temp1
                    +123592     ENDIF
                    +123593     ENDM            
                    +123594     Clear_COVF_Interrupt MACRO
                    +123595             anl     PCA0PWM, #0DFh
                    +123596     ENDM
                    +123597     Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +123598             anl     PCA0CN0, #0FEh
                    +123599     ENDM
                    +123600     Enable_COVF_Interrupt MACRO
                    +123601             orl     PCA0PWM, #40h
                    +123602     ENDM
                    +123603     Enable_CCF_Interrupt MACRO
                    +123604             orl     PCA0CPM0,#01h
                    +123605     ENDM
                    +123606     Disable_COVF_Interrupt MACRO
                    +123607             anl     PCA0PWM, #0BFh
                    +123608     ENDM
                    +123609     Disable_CCF_Interrupt MACRO
                    +123610             anl     PCA0CPM0,#0FEh
                    +123611     ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   383

                    +123612     
                    +123613     ;*********************
                    +123614     ; PORT 1 definitions *
                    +123615     ;*********************
                    +123616     ;                       EQU     7       ;i
                    +123617     ;                       EQU     6       ;i
 0005               +123618     AcomFET         EQU     5       ;o
 0004               +123619     BcomFET         EQU     4       ;o
 0003               +123620     CcomFET         EQU     3       ;o
 0002               +123621     ApwmFET         EQU     2       ;o
 0001               +123622     BpwmFET         EQU     1       ;o
 0000               +123623     CpwmFET         EQU     0       ;o
                    +123624     
 003F               +123625     P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
 0000               +123626     P1_INIT         EQU     00h             
 003F               +123627     P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
 003F               +123628     P1_SKIP         EQU     3Fh
                    +123629     
                    +123630     ApwmFET_on MACRO
                    +123631             setb    P1.ApwmFET
                    +123632     IF 90 == 0
                    +123633             setb    P1.AcomFET
                    +123634     ENDIF
                    +123635     ENDM
                    +123636     ApwmFET_off MACRO
                    +123637     IF 90 != 0
                    +123638             clr     P1.ApwmFET
                    +123639     ELSE
                    +123640             clr     P1.AcomFET
                    +123641     ENDIF
                    +123642     ENDM
                    +123643     BpwmFET_on MACRO
                    +123644             setb    P1.BpwmFET
                    +123645     IF 90 == 0
                    +123646             setb    P1.BcomFET
                    +123647     ENDIF
                    +123648     ENDM
                    +123649     BpwmFET_off MACRO
                    +123650     IF 90 != 0
                    +123651             clr     P1.BpwmFET
                    +123652     ELSE
                    +123653             clr     P1.BcomFET
                    +123654     ENDIF
                    +123655     ENDM
                    +123656     CpwmFET_on MACRO
                    +123657             setb    P1.CpwmFET
                    +123658     IF 90 == 0
                    +123659             setb    P1.CcomFET
                    +123660     ENDIF
                    +123661     ENDM
                    +123662     CpwmFET_off MACRO
                    +123663     IF 90 != 0
                    +123664             clr     P1.CpwmFET
                    +123665     ELSE
                    +123666             clr     P1.CcomFET
                    +123667     ENDIF
                    +123668     ENDM
                    +123669     All_pwmFETs_Off MACRO
                    +123670     IF 90 != 0
                    +123671             clr     P1.ApwmFET
                    +123672             clr     P1.BpwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   384

                    +123673             clr     P1.CpwmFET
                    +123674     ELSE
                    +123675             clr     P1.AcomFET
                    +123676             clr     P1.BcomFET
                    +123677             clr     P1.CcomFET
                    +123678     ENDIF
                    +123679     ENDM
                    +123680     
                    +123681     AcomFET_on MACRO
                    +123682     IF 90 == 0
                    +123683             clr     P1.ApwmFET
                    +123684     ENDIF
                    +123685             setb    P1.AcomFET
                    +123686     ENDM
                    +123687     AcomFET_off MACRO
                    +123688             clr     P1.AcomFET
                    +123689     ENDM
                    +123690     BcomFET_on MACRO
                    +123691     IF 90 == 0
                    +123692             clr     P1.BpwmFET
                    +123693     ENDIF
                    +123694             setb    P1.BcomFET
                    +123695     ENDM
                    +123696     BcomFET_off MACRO
                    +123697             clr     P1.BcomFET
                    +123698     ENDM
                    +123699     CcomFET_on MACRO
                    +123700     IF 90 == 0
                    +123701             clr     P1.CpwmFET
                    +123702     ENDIF
                    +123703             setb    P1.CcomFET
                    +123704     ENDM
                    +123705     CcomFET_off MACRO
                    +123706             clr     P1.CcomFET
                    +123707     ENDM
                    +123708     All_comFETs_Off MACRO
                    +123709             clr     P1.AcomFET
                    +123710             clr     P1.BcomFET
                    +123711             clr     P1.CcomFET
                    +123712     ENDM
                    +123713     
                    +123714     Set_Pwm_A MACRO
                    +123715     IF 90 == 0
                    +123716             setb    P1.AcomFET
                    +123717             mov     P1SKIP, #3Bh
                    +123718     ELSE
                    +123719             mov     P1SKIP, #1Bh
                    +123720     ENDIF
                    +123721     ENDM
                    +123722     Set_Pwm_B MACRO
                    +123723     IF 90 == 0
                    +123724             setb    P1.BcomFET
                    +123725             mov     P1SKIP, #3Dh
                    +123726     ELSE
                    +123727             mov     P1SKIP, #2Dh
                    +123728     ENDIF
                    +123729     ENDM
                    +123730     Set_Pwm_C MACRO
                    +123731     IF 90 == 0
                    +123732             setb    P1.CcomFET
                    +123733             mov     P1SKIP, #3Eh
                    +123734     ELSE
                    +123735             mov     P1SKIP, #36h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   385

                    +123736     ENDIF
                    +123737     ENDM
                    +123738     Set_Pwms_Off MACRO
                    +123739             mov     P1SKIP, #3Fh
                    +123740     ENDM
                    +123741     
                    +123742     Set_Comp_Phase_A MACRO
                    +123743             mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +123744     ENDM
                    +123745     Set_Comp_Phase_B MACRO
                    +123746             mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +123747     ENDM
                    +123748     Set_Comp_Phase_C MACRO
                    +123749             mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +123750     ENDM
                    +123751     Read_Comp_Out MACRO
                    +123752             mov     A, CMP0CN0      ; Read comparator output
                    +123753     ENDM
                    +123754     
                    +123755     
                    +123756     ;*********************
                    +123757     ; PORT 2 definitions *
                    +123758     ;*********************
 0000               +123759     DebugPin                EQU     0       ;o
                    +123760     
 0001               +123761     P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +123762     
                    +123763     
                    +123764     ;**********************
                    +123765     ; MCU specific macros *
                    +123766     ;**********************
                    +123767     Interrupt_Table_Definition MACRO
                    +123768     CSEG AT 0                               ; Code segment start
                    +123769             jmp reset
                    +123770     CSEG AT 03h                     ; Int0 interrupt        
                    +123771             jmp     int0_int        
                    +123772     IF 1 == 1
                    +123773     CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +123774             jmp     t0_int
                    +123775     ENDIF
                    +123776     CSEG AT 13h                     ; Int1 interrupt
                    +123777             jmp     int1_int
                    +123778     CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +123779             jmp     t1_int
                    +123780     CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +123781             jmp     t2_int  
                    +123782     CSEG AT 5Bh                     ; Pca interrupt
                    +123783             jmp     pca_int
                    +123784     CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +123785             jmp     t3_int  
                    +123786     ENDM
                    +123787     
                    +123788     Initialize_Xbar MACRO
                    +123789             mov     XBR2, #40h      ; Xbar enabled                  
                    +123790             mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +123791     ENDM
                    +123792     
                    +123793     Initialize_Comparator MACRO
                    +123794             mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +123795             mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +123796     ENDM
                    +123797     Initialize_Adc MACRO
                    +123798             mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   386

                               as
                    +123799     IF 1 == 0
                    +123800             mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +123801     ELSE
                    +123802             mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +123803     ENDIF
                    +123804             mov     ADC0MX, #10h    ; Select temp sensor input
                    +123805             mov     ADC0CN0, #80h   ; ADC enabled 
                    +123806             mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +123807     ENDM
                    +123808     Start_Adc MACRO
                    +123809             mov     ADC0CN0, #90h   ; ADC start
                    +123810     ENDM
                    +123811     Read_Adc_Result MACRO
                    +123812             mov     Temp1, ADC0L
                    +123813             mov     Temp2, ADC0H
                    +123814     ENDM
                    +123815     Stop_Adc MACRO
                    +123816     ENDM
                    +123817     Set_RPM_Out MACRO
                    +123818     ENDM
                    +123819     Clear_RPM_Out MACRO
                    +123820     ENDM
                    +123821     Set_MCU_Clk_24MHz MACRO
                    +123822             mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +123823             mov     SFRPAGE, #10h
                    +123824             mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +123825             mov     SFRPAGE, #00h
                    +123826             mov     Clock_Set_At_48MHz, #0
                    +123827     ENDM
                    +123828     Set_MCU_Clk_48MHz MACRO
                    +123829             mov     SFRPAGE, #10h
                    +123830             mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +123831             mov     SFRPAGE, #00h
                    +123832             mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +123833             mov     Clock_Set_At_48MHz, #1
                    +123834     ENDM
                    +123835     Set_LED_0 MACRO
                    +123836     ENDM
                    +123837     Clear_LED_0 MACRO
                    +123838     ENDM
                    +123839     Set_LED_1 MACRO
                    +123840     ENDM
                    +123841     Clear_LED_1 MACRO
                    +123842     ENDM
                    +123843     Set_LED_2 MACRO
                    +123844     ENDM
                    +123845     Clear_LED_2 MACRO
                    +123846     ENDM
                    +123847     Set_LED_3 MACRO
                    +123848     ENDM
                    +123849     Clear_LED_3 MACRO
                    +123850     ENDM
                      23851     ENDIF
                      23852     
                      23853     
                      23854     ;**** **** **** **** ****
                      23855     ; Programming defaults
                      23856     ;
 0005                 23857     DEFAULT_PGM_STARTUP_PWR                                 EQU 5   ; 1=0.031 2=0.047 3=0.06
                               3 4=0.094 5=0.125 6=0.188       7=0.25  8=0.38  9=0.50  10=0.75 11=1.00 12=1.25 13=1.50
 0003                 23858     DEFAULT_PGM_COMM_TIMING                         EQU 3   ; 1=Low                 2=Medium
                               Low     3=Medium                4=MediumHigh    5=High
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   387

 0003                 23859     DEFAULT_PGM_DEMAG_COMP                          EQU 3   ; 1=Disabled    2=Low           
                               3=High
 0001                 23860     DEFAULT_PGM_DIRECTION                           EQU 1   ; 1=Normal      2=Reversed      
                               3=Bidir         4=Bidir rev
 005B                 23861     DEFAULT_PGM_BEEP_STRENGTH                       EQU 91  ; Beep strength
 0050                 23862     DEFAULT_PGM_BEACON_STRENGTH                     EQU 80  ; Beacon strength
 0003                 23863     DEFAULT_PGM_BEACON_DELAY                                EQU 3   ; 1=1m          2=2m    
                                               3=5m                    4=10m           5=Infinite
                      23864     
                      23865     ; COMMON
 0001                 23866     DEFAULT_PGM_ENABLE_TX_PROGRAM           EQU 1   ; 1=Enabled     0=Disabled
 000A                 23867     DEFAULT_PGM_MIN_THROTTLE                                EQU 10  ; 4*10+1000=1040
 00F0                 23868     DEFAULT_PGM_MAX_THROTTLE                                EQU 240 ; 4*240+1000=1960
 007D                 23869     DEFAULT_PGM_CENTER_THROTTLE                     EQU 125 ; 4*125+1000=1500 (used in bidir
                               ectional mode)
 0006                 23870     DEFAULT_PGM_ENABLE_TEMP_PROT                    EQU 6   ; 0=Disabled    1=80C   2=90C   
                               3=100C  4=110C  5=120C  6=130C  7=140C
 0001                 23871     DEFAULT_PGM_ENABLE_POWER_PROT           EQU 1   ; 1=Enabled     0=Disabled
 0001                 23872     DEFAULT_PGM_BRAKE_ON_STOP                       EQU 1   ; 1=Enabled     0=Disabled
 0001                 23873     DEFAULT_PGM_LED_CONTROL                         EQU 1   ; Byte for LED control. 2bits pe
                               r LED, 0=Off, 1=On
                      23874     
                      23875     ;**** **** **** **** ****
                      23876     ; Temporary register definitions
  REG                 23877     Temp1           EQU     R0
  REG                 23878     Temp2           EQU     R1
  REG                 23879     Temp3           EQU     R2
  REG                 23880     Temp4           EQU     R3
  REG                 23881     Temp5           EQU     R4
  REG                 23882     Temp6           EQU     R5
  REG                 23883     Temp7           EQU     R6
  REG                 23884     Temp8           EQU     R7
                      23885     
                      23886     ;**** **** **** **** ****
                      23887     ; Register definitions
000020                23888     DSEG AT 20h                                     ; Variables segment 
                      23889     
000020                23890     Bit_Access:                             DS      1               ; MUST BE AT THIS ADDRES
                               S. Variable at bit accessible address (for non interrupt routines)
000021                23891     Bit_Access_Int:                 DS      1               ; Variable at bit accessible add
                               ress (for interrupts)
                      23892     
000022                23893     Rcp_Outside_Range_Cnt:          DS      1               ; RC pulse outside range counter
                                (incrementing) 
000023                23894     Rcp_Timeout_Cntd:                       DS      1               ; RC pulse timeout count
                               er (decrementing) 
                      23895     
                      23896     
000024                23897     Flags0:                                 DS      1       ; State flags. Reset upon init_s
                               tart
 0000                 23898     T3_PENDING                              EQU     0               ; Timer 3 pending flag
 0001                 23899     DEMAG_DETECTED                          EQU     1               ; Set when excessive dem
                               ag time is detected
 0002                 23900     DEMAG_CUT_POWER                 EQU     2               ; Set when demag compensation cu
                               ts power
 0003                 23901     COMP_TIMED_OUT                          EQU     3               ; Set when comparator re
                               ading timed out
                      23902     ;                                               EQU     4
                      23903     ;                                               EQU     5       
                      23904     ;                                               EQU     6       
                      23905     ;                                               EQU     7       
                      23906     
                      23907     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   388

000025                23908     Flags1:                                 DS      1       ; State flags. Reset upon init_s
                               tart 
 0000                 23909     STARTUP_PHASE                           EQU     0               ; Set when in startup ph
                               ase
 0001                 23910     INITIAL_RUN_PHASE                       EQU     1               ; Set when in initial ru
                               n phase, before synchronized run is achieved
 0002                 23911     MOTOR_STARTED                           EQU     2               ; Set when motor is star
                               ted
 0003                 23912     DIR_CHANGE_BRAKE                        EQU     3               ; Set when braking befor
                               e direction change
 0004                 23913     HIGH_RPM                                        EQU     4               ; Set when motor
                                rpm is high (Comm_Period4x_H less than 2)
                      23914     ;                                               EQU     5
                      23915     ;                                               EQU     6       
                      23916     ;                                               EQU     7       
                      23917     
000026                23918     Flags2:                                 DS      1               ; State flags. NOT reset
                                upon init_start
 0000                 23919     RCP_UPDATED                             EQU     0               ; New RC pulse length va
                               lue available
 0001                 23920     RCP_ONESHOT125                          EQU     1               ; RC pulse input is OneS
                               hot125 (125-250us)
 0002                 23921     RCP_ONESHOT42                           EQU     2               ; RC pulse input is OneS
                               hot42 (41.67-83us)
 0003                 23922     RCP_MULTISHOT                           EQU     3               ; RC pulse input is Mult
                               ishot (5-25us)
 0004                 23923     RCP_DSHOT                                       EQU     4               ; RC pulse input
                                is digital shot
 0005                 23924     RCP_DIR_REV                             EQU     5               ; RC pulse direction in 
                               bidirectional mode
 0006                 23925     RCP_FULL_RANGE                          EQU     6               ; When set full input si
                               gnal range is used (1000-2000us) and stored calibration values are ignored
                      23926     ;                                               EQU     7       
                      23927     
000027                23928     Flags3:                                 DS      1                       ; State flags. N
                               OT reset upon init_start
 0000                 23929     PGM_DIR_REV                     EQU     0               ; Programmed direction. 0=normal
                               , 1=reversed
 0001                 23930     PGM_BIDIR_REV           EQU     1               ; Programmed bidirectional direction. 0=
                               normal, 1=reversed
 0002                 23931     PGM_BIDIR                               EQU     2               ; Programmed bidirection
                               al operation. 0=normal, 1=bidirectional
 0003                 23932     FET_SWAP                                EQU     3               ; Flipped on/off during 
                               Beep Routine.           
 0004                 23933     TONE_WAVE                               EQU     4                       
 0005                 23934     TONE_DIR                                EQU     5                       
 0006                 23935     CZ_TONES                                EQU     6       
 0007                 23936     MUTE                                            EQU     7       
                      23937     
                      23938     
                      23939     ;**** **** **** **** ****
                      23940     ; RAM definitions
000030                23941     DSEG AT 30h                                             ; Ram data segment, direct addre
                               ssing
000030                23942     Initial_Arm:                            DS      1               ; Variable that is set d
                               uring the first arm sequence after power on
                      23943     
000031                23944     Min_Throttle_L:                 DS      1               ; Minimum throttle scaled (lo by
                               te)
000032                23945     Min_Throttle_H:                 DS      1               ; Minimum throttle scaled (hi by
                               te)
000033                23946     Center_Throttle_L:                      DS      1               ; Center throttle scaled
                                (lo byte)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   389

000034                23947     Center_Throttle_H:                      DS      1               ; Center throttle scaled
                                (hi byte)
000035                23948     Max_Throttle_L:                 DS      1               ; Maximum throttle scaled (lo by
                               te)
000036                23949     Max_Throttle_H:                 DS      1               ; Maximum throttle scaled (hi by
                               te)
                      23950     
000037                23951     Power_On_Wait_Cnt_L:            DS      1               ; Power on wait counter (lo byte
                               )
000038                23952     Power_On_Wait_Cnt_H:            DS      1               ; Power on wait counter (hi byte
                               )
                      23953     
000039                23954     Startup_Cnt:                            DS      1               ; Startup phase commutat
                               ions counter (incrementing)
00003A                23955     Startup_Zc_Timeout_Cntd:                DS      1               ; Startup zero cross tim
                               eout counter (decrementing)
00003B                23956     Initial_Run_Rot_Cntd:           DS      1               ; Initial run rotations counter 
                               (decrementing)
00003C                23957     Stall_Cnt:                              DS      1               ; Counts start/run attem
                               pts that resulted in stall. Reset upon a proper stop
00003D                23958     Demag_Detected_Metric:          DS      1               ; Metric used to gauge demag eve
                               nt frequency
00003E                23959     Demag_Pwr_Off_Thresh:           DS      1               ; Metric threshold above which p
                               ower is cut
00003F                23960     Low_Rpm_Pwr_Slope:                      DS      1               ; Sets the slope of powe
                               r increase for low rpms
                      23961     
000040                23962     Timer0_X:                                       DS      1               ; Timer 0 extend
                               ed byte
000041                23963     Timer2_X:                                       DS      1               ; Timer 2 extend
                               ed byte
000042                23964     Prev_Comm_L:                            DS      1               ; Previous commutation t
                               imer 3 timestamp (lo byte)
000043                23965     Prev_Comm_H:                            DS      1               ; Previous commutation t
                               imer 3 timestamp (hi byte)
000044                23966     Prev_Comm_X:                            DS      1               ; Previous commutation t
                               imer 3 timestamp (ext byte)
000045                23967     Prev_Prev_Comm_L:                       DS      1               ; Pre-previous commutati
                               on timer 3 timestamp (lo byte)
000046                23968     Prev_Prev_Comm_H:                       DS      1               ; Pre-previous commutati
                               on timer 3 timestamp (hi byte)
000047                23969     Comm_Period4x_L:                        DS      1               ; Timer 3 counts between
                                the last 4 commutations (lo byte)
000048                23970     Comm_Period4x_H:                        DS      1               ; Timer 3 counts between
                                the last 4 commutations (hi byte)
000049                23971     Comparator_Read_Cnt:            DS      1               ; Number of comparator reads don
                               e
                      23972     
00004A                23973     Wt_Adv_Start_L:                 DS      1               ; Timer 3 start point for commut
                               ation advance timing (lo byte)
00004B                23974     Wt_Adv_Start_H:                 DS      1               ; Timer 3 start point for commut
                               ation advance timing (hi byte)
00004C                23975     Wt_Zc_Scan_Start_L:                     DS      1               ; Timer 3 start point fr
                               om commutation to zero cross scan (lo byte)
00004D                23976     Wt_Zc_Scan_Start_H:                     DS      1               ; Timer 3 start point fr
                               om commutation to zero cross scan (hi byte)
00004E                23977     Wt_Zc_Tout_Start_L:                     DS      1               ; Timer 3 start point fo
                               r zero cross scan timeout (lo byte)
00004F                23978     Wt_Zc_Tout_Start_H:                     DS      1               ; Timer 3 start point fo
                               r zero cross scan timeout (hi byte)
000050                23979     Wt_Comm_Start_L:                        DS      1               ; Timer 3 start point fr
                               om zero cross to commutation (lo byte)
000051                23980     Wt_Comm_Start_H:                        DS      1               ; Timer 3 start point fr
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   390

                               om zero cross to commutation (hi byte)
                      23981     
000052                23982     New_Rcp:                                        DS      1               ; New RC pulse v
                               alue in pca counts
000053                23983     Rcp_Stop_Cnt:                           DS      1               ; Counter for RC pulses 
                               below stop value
                      23984     
000054                23985     Power_Pwm_Reg_L:                        DS      1               ; Power pwm register set
                               ting (lo byte)
000055                23986     Power_Pwm_Reg_H:                        DS      1               ; Power pwm register set
                               ting (hi byte). 0x3F is minimum power
000056                23987     Damp_Pwm_Reg_L:                 DS      1               ; Damping pwm register setting (
                               lo byte)
000057                23988     Damp_Pwm_Reg_H:                 DS      1               ; Damping pwm register setting (
                               hi byte)
000058                23989     Current_Power_Pwm_Reg_H:                DS      1               ; Current power pwm regi
                               ster setting that is loaded in the PCA register (hi byte)
                      23990     
000059                23991     Pwm_Limit:                              DS      1               ; Maximum allowed pwm 
00005A                23992     Pwm_Limit_By_Rpm:                       DS      1               ; Maximum allowed pwm fo
                               r low or high rpms
00005B                23993     Pwm_Limit_Beg:                          DS      1               ; Initial pwm limit
                      23994     
00005C                23995     Adc_Conversion_Cnt:                     DS      1               ; Adc conversion counter
                      23996     
00005D                23997     Current_Average_Temp:           DS      1               ; Current average temperature (l
                               o byte ADC reading, assuming hi byte is 1)
                      23998     
00005E                23999     Throttle_Gain:                          DS      1               ; Gain to be applied to 
                               RCP value
00005F                24000     Throttle_Gain_M:                        DS      1               ; Gain to be applied to 
                               RCP value (multiplier 0=1x, 1=2x, 2=4x etc))
000060                24001     Throttle_Gain_BD_Rev:           DS      1               ; Gain to be applied to RCP valu
                               e for reverse direction in bidirectional mode
000061                24002     Throttle_Gain_BD_Rev_M:         DS      1               ; Gain to be applied to RCP valu
                               e for reverse direction in bidirectional mode (multiplier 0=1x, 1=2x, 2=4x etc)
000062                24003     Beep_Strength:                          DS      1               ; Strength of beeps
                      24004     
000063                24005     Skip_T2_Int:                            DS      1               ; Set for 48MHz MCUs whe
                               n timer 2 interrupt shall be ignored
000064                24006     Clock_Set_At_48MHz:                     DS      1               ; Variable set if 48MHz 
                               MCUs run at 48MHz
                      24007     
000065                24008     Flash_Key_1:                            DS      1               ; Flash key one
000066                24009     Flash_Key_2:                            DS      1               ; Flash key two
                      24010     
000067                24011     Temp_Prot_Limit:                        DS      1               ; Temperature protection
                                limit
                      24012     
000068                24013     DShot_Pwm_Thr:                          DS      1               ; DShot pulse width thre
                               shold value
000069                24014     DShot_Timer_Preset:                     DS      1               ; DShot timer preset for
                                frame sync detection
00006A                24015     DShot_Frame_Start_L:            DS      1               ; DShot frame start timestamp (l
                               o byte)
00006B                24016     DShot_Frame_Start_H:            DS      1               ; DShot frame start timestamp (h
                               i byte)
00006C                24017     DShot_Frame_Length_Thr:         DS      1               ; DShot frame length criteria (i
                               n units of 4 timer 2 ticks)
                      24018     
                      24019     ; Indirect addressing data segment. The variables below must be in this sequence
000080                24020     ISEG AT 080h                                    
000080                24021     _Pgm_Gov_P_Gain:                        DS      1               ; Programmed governor P 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   391

                               gain
000081                24022     _Pgm_Gov_I_Gain:                        DS      1               ; Programmed governor I 
                               gain
000082                24023     _Pgm_Gov_Mode:                          DS      1               ; Programmed governor mo
                               de
000083                24024     _Pgm_Low_Voltage_Lim:           DS      1               ; Programmed low voltage limit
000084                24025     _Pgm_Motor_Gain:                        DS      1               ; Programmed motor gain
000085                24026     _Pgm_Motor_Idle:                        DS      1               ; Programmed motor idle 
                               speed
000086                24027     Pgm_Startup_Pwr:                        DS      1               ; Programmed startup pow
                               er
000087                24028     _Pgm_Pwm_Freq:                          DS      1               ; Programmed pwm frequen
                               cy
000088                24029     Pgm_Direction:                          DS      1               ; Programmed rotation di
                               rection
000089                24030     Pgm_Input_Pol:                          DS      1               ; Programmed input pwm p
                               olarity
00008A                24031     Initialized_L_Dummy:            DS      1               ; Place holder
00008B                24032     Initialized_H_Dummy:            DS      1               ; Place holder
00008C                24033     Pgm_Enable_TX_Program:          DS      1               ; Programmed enable/disable valu
                               e for TX programming
00008D                24034     _Pgm_Main_Rearm_Start:          DS      1               ; Programmed enable/disable re-a
                               rming main every start 
00008E                24035     _Pgm_Gov_Setup_Target:          DS      1               ; Programmed main governor setup
                                target
00008F                24036     _Pgm_Startup_Rpm:                       DS      1               ; Programmed startup rpm
                                (unused - place holder)
000090                24037     _Pgm_Startup_Accel:                     DS      1               ; Programmed startup acc
                               eleration (unused - place holder)
000091                24038     _Pgm_Volt_Comp:                 DS      1               ; Place holder
000092                24039     Pgm_Comm_Timing:                        DS      1               ; Programmed commutation
                                timing
000093                24040     _Pgm_Damping_Force:                     DS      1               ; Programmed damping for
                               ce (unused - place holder)
000094                24041     _Pgm_Gov_Range:                 DS      1               ; Programmed governor range
000095                24042     _Pgm_Startup_Method:            DS      1               ; Programmed startup method (unu
                               sed - place holder)
000096                24043     Pgm_Min_Throttle:                       DS      1               ; Programmed throttle mi
                               nimum
000097                24044     Pgm_Max_Throttle:                       DS      1               ; Programmed throttle ma
                               ximum
000098                24045     Pgm_Beep_Strength:                      DS      1               ; Programmed beep streng
                               th
000099                24046     Pgm_Beacon_Strength:            DS      1               ; Programmed beacon strength
00009A                24047     Pgm_Beacon_Delay:                       DS      1               ; Programmed beacon dela
                               y
00009B                24048     _Pgm_Throttle_Rate:                     DS      1               ; Programmed throttle ra
                               te (unused - place holder)
00009C                24049     Pgm_Demag_Comp:                 DS      1               ; Programmed demag compensation
00009D                24050     _Pgm_BEC_Voltage_High:          DS      1               ; Programmed BEC voltage
00009E                24051     Pgm_Center_Throttle:            DS      1               ; Programmed throttle center (in
                                bidirectional mode)
00009F                24052     _Pgm_Main_Spoolup_Time:         DS      1               ; Programmed main spoolup time
0000A0                24053     Pgm_Enable_Temp_Prot:           DS      1               ; Programmed temperature protect
                               ion enable
0000A1                24054     Pgm_Enable_Power_Prot:          DS      1               ; Programmed low rpm power prote
                               ction enable
0000A2                24055     _Pgm_Enable_Pwm_Input:          DS      1               ; Programmed PWM input signal en
                               able
0000A3                24056     _Pgm_Pwm_Dither:                        DS      1               ; Programmed output PWM 
                               dither
0000A4                24057     Pgm_Brake_On_Stop:                      DS      1               ; Programmed braking whe
                               n throttle is zero
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   392

0000A5                24058     Pgm_LED_Control:                        DS      1               ; Programmed LED control
                      24059     
                      24060     ; The sequence of the variables below is no longer of importance
0000A6                24061     Pgm_Startup_Pwr_Decoded:                DS      1               ; Programmed startup pow
                               er decoded
                      24062     
                      24063     
                      24064     ; Indirect addressing data segment
0000D0                24065     ISEG AT 0D0h                                    
0000D0                24066     Temp_Storage:                           DS      48              ; Temporary storage
                      24067     
                      24068     ;**** **** **** **** ****
001A00                24069     CSEG AT 1A00h            ; "Eeprom" segment
 0010                 24070     EEPROM_FW_MAIN_REVISION         EQU     16              ; Main revision of the firmware
 0041                 24071     EEPROM_FW_SUB_REVISION          EQU     65              ; Sub revision of the firmware
 0021                 24072     EEPROM_LAYOUT_REVISION          EQU     33              ; Revision of the EEPROM layout
                      24073     
001A00 10             24074     Eep_FW_Main_Revision:           DB      EEPROM_FW_MAIN_REVISION                 ; EEPROM
                                firmware main revision number
001A01 41             24075     Eep_FW_Sub_Revision:            DB      EEPROM_FW_SUB_REVISION                  ; EEPROM
                                firmware sub revision number
001A02 21             24076     Eep_Layout_Revision:            DB      EEPROM_LAYOUT_REVISION                  ; EEPROM
                                layout revision number
                      24077     
001A03 FF             24078     _Eep_Pgm_Gov_P_Gain:            DB      0FFh    
001A04 FF             24079     _Eep_Pgm_Gov_I_Gain:            DB      0FFh    
001A05 FF             24080     _Eep_Pgm_Gov_Mode:                      DB      0FFh    
001A06 FF             24081     _Eep_Pgm_Low_Voltage_Lim:       DB      0FFh                                            
                                       
001A07 FF             24082     _Eep_Pgm_Motor_Gain:            DB      0FFh    
001A08 FF             24083     _Eep_Pgm_Motor_Idle:            DB      0FFh                                            
001A09 05             24084     Eep_Pgm_Startup_Pwr:            DB      DEFAULT_PGM_STARTUP_PWR                 ; EEPROM
                                copy of programmed startup power
001A0A FF             24085     _Eep_Pgm_Pwm_Freq:                      DB      0FFh    
001A0B 01             24086     Eep_Pgm_Direction:                      DB      DEFAULT_PGM_DIRECTION                   
                               ; EEPROM copy of programmed rotation direction
001A0C FF             24087     _Eep_Pgm_Input_Pol:                     DB      0FFh
001A0D 55             24088     Eep_Initialized_L:                      DB      055h                                    
                                               ; EEPROM initialized signature low byte
001A0E AA             24089     Eep_Initialized_H:                      DB      0AAh                                    
                                               ; EEPROM initialized signature high byte
001A0F 01             24090     Eep_Enable_TX_Program:          DB      DEFAULT_PGM_ENABLE_TX_PROGRAM           ; EEPROM
                                TX programming enable
001A10 FF             24091     _Eep_Main_Rearm_Start:          DB      0FFh                                            
                                       
001A11 FF             24092     _Eep_Pgm_Gov_Setup_Target:      DB      0FFh                                            
                                       
001A12 FF             24093     _Eep_Pgm_Startup_Rpm:           DB      0FFh
001A13 FF             24094     _Eep_Pgm_Startup_Accel:         DB      0FFh
001A14 FF             24095     _Eep_Pgm_Volt_Comp:                     DB      0FFh    
001A15 03             24096     Eep_Pgm_Comm_Timing:            DB      DEFAULT_PGM_COMM_TIMING                 ; EEPROM
                                copy of programmed commutation timing
001A16 FF             24097     _Eep_Pgm_Damping_Force:         DB      0FFh
001A17 FF             24098     _Eep_Pgm_Gov_Range:                     DB      0FFh    
001A18 FF             24099     _Eep_Pgm_Startup_Method:                DB      0FFh
001A19 0A             24100     Eep_Pgm_Min_Throttle:           DB      DEFAULT_PGM_MIN_THROTTLE                        
                               ; EEPROM copy of programmed minimum throttle
001A1A F0             24101     Eep_Pgm_Max_Throttle:           DB      DEFAULT_PGM_MAX_THROTTLE                        
                               ; EEPROM copy of programmed minimum throttle
001A1B 5B             24102     Eep_Pgm_Beep_Strength:          DB      DEFAULT_PGM_BEEP_STRENGTH               ; EEPROM
                                copy of programmed beep strength
001A1C 50             24103     Eep_Pgm_Beacon_Strength:                DB      DEFAULT_PGM_BEACON_STRENGTH             
                               ; EEPROM copy of programmed beacon strength
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   393

001A1D 03             24104     Eep_Pgm_Beacon_Delay:           DB      DEFAULT_PGM_BEACON_DELAY                        
                               ; EEPROM copy of programmed beacon delay
001A1E FF             24105     _Eep_Pgm_Throttle_Rate:         DB      0FFh
001A1F 03             24106     Eep_Pgm_Demag_Comp:                     DB      DEFAULT_PGM_DEMAG_COMP                  
                               ; EEPROM copy of programmed demag compensation
001A20 FF             24107     _Eep_Pgm_BEC_Voltage_High:      DB      0FFh    
001A21 7D             24108     Eep_Pgm_Center_Throttle:                DB      DEFAULT_PGM_CENTER_THROTTLE             
                               ; EEPROM copy of programmed center throttle
001A22 FF             24109     _Eep_Pgm_Main_Spoolup_Time:     DB      0FFh
001A23 06             24110     Eep_Pgm_Temp_Prot_Enable:       DB      DEFAULT_PGM_ENABLE_TEMP_PROT            ; EEPROM
                                copy of programmed temperature protection enable
001A24 01             24111     Eep_Pgm_Enable_Power_Prot:      DB      DEFAULT_PGM_ENABLE_POWER_PROT           ; EEPROM
                                copy of programmed low rpm power protection enable
001A25 FF             24112     _Eep_Pgm_Enable_Pwm_Input:      DB      0FFh    
001A26 FF             24113     _Eep_Pgm_Pwm_Dither:            DB      0FFh    
001A27 01             24114     Eep_Pgm_Brake_On_Stop:          DB      DEFAULT_PGM_BRAKE_ON_STOP               ; EEPROM
                                copy of programmed braking when throttle is zero
001A28 01             24115     Eep_Pgm_LED_Control:            DB      DEFAULT_PGM_LED_CONTROL                 ; EEPROM
                                copy of programmed LED control
                      24116     
001A29 FF             24117     Eep_Dummy:                              DB      0FFh                                    
                                               ; EEPROM address for safety reason
                      24118     
001A60                24119     CSEG AT 1A60h
001A60 31362E36       24120     Eep_Name:                                       DB      "16.65_Tones     "              
                                               ; Name tag (16 Bytes)
001A64 355F546F                 
001A68 6E657320                 
001A6C 20202020                 
                      24121     
                      24122     ;**** **** **** **** ****
                      24123+1   Interrupt_Table_Definition              ; SiLabs interrupts
000080                24142     CSEG AT 80h                     ; Code segment after interrupt vectors 
                      24143     
                      24144     ;**** **** **** **** ****
                      24145     
                      24146     ; Table definitions
000080 0406080C       24147     STARTUP_POWER_TABLE:    DB      04h, 06h, 08h, 0Ch, 10h, 18h, 20h, 30h, 40h, 60h, 80h, 0
                               A0h, 0C0h
000084 10182030                 
000088 406080A0                 
00008C C0                       
                      24148     
                      24149     
                      24150     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24151     ;
                      24152     ; Timer 0 interrupt routine
                      24153     ;
                      24154     ; No assumptions
                      24155     ;
                      24156     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24157     IF 1 == 1
00008D                24158     t0_int:
00008D 0500       F   24159             inc     Timer0_X
00008F 32             24160             reti
                      24161     ENDIF
                      24162     
                      24163     
                      24164     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24165     ;
                      24166     ; Timer 1 interrupt routine
                      24167     ;
                      24168     ; No assumptions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   394

                      24169     ;
                      24170     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000090                24171     t1_int:
000090 C2AF           24172             clr     IE_EA
000092 C2A8           24173             clr     IE_EX0                  ; Disable int0 interrupts
000094 53E6EF         24174             anl     EIE1, #0EFh             ; Disable pca interrupts
000097 C28E           24175             clr     TCON_TR1                        ; Stop timer 1
000099 85008B     F   24176             mov     TL1, DShot_Timer_Preset ; Reset sync timer
00009C C0D0           24177             push    PSW
00009E D2D3           24178             setb    PSW.3                   ; Select register bank 1 for this interrupt
0000A0 C0E0           24179             push    ACC
0000A2 C0F0           24180             push    B                               ; Will be pop'ed by int0 exit
0000A4 C2CA           24181             clr     TMR2CN0_TR2             ; Timer 2 disabled
0000A6 A8CC           24182             mov     Temp1, TMR2L            ; Read timer value
0000A8 A9CD           24183             mov     Temp2, TMR2H
0000AA D2CA           24184             setb    TMR2CN0_TR2             ; Timer 2 enabled
0000AC D2AF           24185             setb    IE_EA
                      24186             ; Reset timer 1
0000AE 758A00         24187             mov     TL0, #0
                      24188             ; Check frame time length
0000B1 C3             24189             clr     C
0000B2 E8             24190             mov     A, Temp1
0000B3 9500       F   24191             subb    A, DShot_Frame_Start_L
0000B5 F8             24192             mov     Temp1, A
0000B6 E9             24193             mov     A, Temp2
0000B7 9500       F   24194             subb    A, DShot_Frame_Start_H
0000B9 F9             24195             mov     Temp2, A
                      24196             ; Divide by 2 (or 4 for 48MHz). Unit is then us
0000BA C3             24197             clr     C
0000BB E9             24198             mov     A, Temp2
0000BC 13             24199             rrc     A
0000BD F9             24200             mov     Temp2, A
0000BE E8             24201             mov     A, Temp1
0000BF 13             24202             rrc     A
0000C0 F8             24203             mov     Temp1, A
0000C1 E500       F   24204             mov     A, Clock_Set_At_48MHz
0000C3 6007           24205             jz      t1_int_frame_time_scaled
                      24206     
0000C5 C3             24207             clr     C
0000C6 E9             24208             mov     A, Temp2
0000C7 13             24209             rrc     A
0000C8 F9             24210             mov     Temp2, A
0000C9 E8             24211             mov     A, Temp1
0000CA 13             24212             rrc     A
0000CB F8             24213             mov     Temp1, A
                      24214     
0000CC                24215     t1_int_frame_time_scaled:
0000CC E9             24216             mov     A, Temp2
0000CD 7025           24217             jnz     t1_int_msb_fail ; Frame too long
0000CF E8             24218             mov     A, Temp1
0000D0 9500       F   24219             subb    A, DShot_Frame_Length_Thr
0000D2 4020           24220             jc      t1_int_msb_fail ; Frame too short
0000D4 9500       F   24221             subb    A, DShot_Frame_Length_Thr
0000D6 501C           24222             jnc     t1_int_msb_fail ; Frame too long
                      24223     
                      24224             ; Check that correct number of pulses is received
0000D8 E582           24225             mov     A, DPL                  ; Read current pointer
0000DA B41017         24226             cjne    A, #16, t1_int_msb_fail
                      24227     
                      24228             ; Decode transmitted data
0000DD 7C00           24229             mov     Temp5, #0                       ; Reset timestamp
0000DF 7B00           24230             mov     Temp4, #0                       ; High byte of receive buffer
0000E1 7A00           24231             mov     Temp3, #0                       ; Low byte of receive buffer
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   395

0000E3 7908           24232             mov     Temp2, #8                       ; Number of bits per byte
0000E5 900000         24233             mov     DPTR, #0                        ; Set pointer
0000E8 A800       F   24234             mov     Temp1, DShot_Pwm_Thr; DShot pulse width criteria
0000EA E500       F   24235             mov     A, Clock_Set_At_48MHz
0000EC 7004           24236             jnz     t1_int_decode
                      24237     
0000EE C3             24238             clr     C
0000EF E8             24239             mov     A, Temp1                        ; Scale pulse width criteria
0000F0 13             24240             rrc     A
0000F1 F8             24241             mov     Temp1, A
                      24242     
0000F2                24243     t1_int_decode:
0000F2 0100       F   24244             ajmp    t1_int_decode_msb
                      24245     
0000F4                24246     t1_int_msb_fail:
0000F4 900000         24247             mov     DPTR, #0                        ; Set pointer to start
0000F7 D2A8           24248             setb    IE_EX0                  ; Enable int0 interrupts
0000F9 D2AA           24249             setb    IE_EX1                  ; Enable int1 interrupts
0000FB 0100       F   24250             ajmp int0_int_outside_range
                      24251     
0000FD                24252     t1_int_decode_msb:
                      24253             ; Decode DShot data Msb. Use more code space to save time (by not usinng loop)
                      24254+1           Decode_DShot_2Msb
                      24281+1           Decode_DShot_2Msb
                      24308+1           Decode_DShot_2Msb
                      24335+1           Decode_DShot_2Msb
00016D 0100       F   24362             ajmp    t1_int_decode_lsb
                      24363     
00016F                24364     t1_int_lsb_fail:
00016F 900000         24365             mov     DPTR, #0                        ; Set pointer to start
000172 D2A8           24366             setb    IE_EX0                  ; Enable int0 interrupts
000174 D2AA           24367             setb    IE_EX1                  ; Enable int1 interrupts
000176 0100       F   24368             ajmp int0_int_outside_range
                      24369     
000178                24370     t1_int_decode_lsb:
                      24371             ; Decode DShot data Lsb
                      24372+1           Decode_DShot_2Lsb
                      24399+1           Decode_DShot_2Lsb
                      24426+1           Decode_DShot_2Lsb
                      24453+1           Decode_DShot_2Lsb
                      24480             ; XOR check (in inverted data, which is ok)
0001E8 EB             24481             mov     A, Temp4
0001E9 C4             24482             swap    A
0001EA 6B             24483             xrl     A, Temp4
0001EB 6A             24484             xrl     A, Temp3
0001EC 54F0           24485             anl     A, #0F0h
0001EE F9             24486             mov     Temp2, A
0001EF EA             24487             mov     A, Temp3
0001F0 C4             24488             swap    A
0001F1 54F0           24489             anl     A, #0F0h
0001F3 C3             24490             clr     C
0001F4 99             24491             subb    A, Temp2
0001F5 6009           24492             jz      t1_int_xor_ok           ; XOR check
                      24493     
0001F7 900000         24494             mov     DPTR, #0                        ; Set pointer to start
0001FA D2A8           24495             setb    IE_EX0                  ; Enable int0 interrupts
0001FC D2AA           24496             setb    IE_EX1                  ; Enable int1 interrupts
0001FE 0100       F   24497             ajmp int0_int_outside_range
                      24498     
000200                24499     t1_int_xor_ok:
                      24500             ; Swap to be LSB aligned to 12 bits (and invert)
000200 EB             24501             mov     A, Temp4
000201 F4             24502             cpl     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   396

000202 C4             24503             swap A
000203 54F0           24504             anl     A, #0F0h                        ; Low nibble of high byte
000205 F9             24505             mov     Temp2, A
000206 EA             24506             mov     A, Temp3
000207 F4             24507             cpl     A
000208 C4             24508             swap    A
000209 540E           24509             anl     A, #0Eh                 ; High nibble of low byte (ignore lsb)
00020B 49             24510             orl     A, Temp2
00020C FA             24511             mov     Temp3, A
00020D EB             24512             mov     A, Temp4                        ; High nibble of high byte
00020E F4             24513             cpl     A
00020F C4             24514             swap A
000210 540F           24515             anl     A, #0Fh
000212 FB             24516             mov     Temp4, A
                      24517             ; Subtract 96 (still 12 bits)
000213 C3             24518             clr     C
000214 EA             24519             mov     A, Temp3
000215 9460           24520             subb    A, #96
000217 FA             24521             mov     Temp3, A
000218 EB             24522             mov     A, Temp4
000219 9400           24523             subb    A, #0
00021B FB             24524             mov     Temp4, A
00021C 5006           24525             jnc     ($+8)
                      24526     
00021E 7B00           24527             mov     Temp4, #0
000220 7A00           24528             mov     Temp3, #0
000222 7900           24529             mov     Temp2, #0
                      24530     
                      24531             ; Check for bidirectional operation (0=stop, 96-2095->fwd, 2096-4095->rev)
000224 300027         24532             jnb     Flags3.PGM_BIDIR, t1_int_not_bidir      ; If not bidirectional operation
                                - branch
                      24533     
                      24534             ; Subtract 2000 (still 12 bits)
000227 C3             24535             clr     C
000228 EA             24536             mov     A, Temp3
000229 94D0           24537             subb    A, #0D0h
00022B F8             24538             mov     Temp1, A
00022C EB             24539             mov     A, Temp4
00022D 9407           24540             subb    A, #07h
00022F F9             24541             mov     Temp2, A
000230 400B           24542             jc      t1_int_bidir_fwd                                ; If result is negative 
                               - branch
                      24543     
000232 E8             24544             mov     A, Temp1
000233 FA             24545             mov     Temp3, A
000234 E9             24546             mov     A, Temp2
000235 FB             24547             mov     Temp4, A
000236 200009         24548             jb      Flags2.RCP_DIR_REV, t1_int_bidir_rev_chk        ; If same direction - br
                               anch
                      24549     
000239 D200       F   24550             setb    Flags2.RCP_DIR_REV
00023B 0100       F   24551             ajmp    t1_int_bidir_rev_chk
                      24552     
00023D                24553     t1_int_bidir_fwd:
00023D 300002         24554             jnb     Flags2.RCP_DIR_REV, t1_int_bidir_rev_chk        ; If same direction - br
                               anch
                      24555     
000240 C200       F   24556             clr     Flags2.RCP_DIR_REV
                      24557     
000242                24558     t1_int_bidir_rev_chk:
000242 200002         24559             jb      Flags3.PGM_BIDIR_REV, ($+5)
                      24560     
000245 B200       F   24561             cpl     Flags2.RCP_DIR_REV
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   397

                      24562     
000247 C3             24563             clr     C                                                       ; Multiply throt
                               tle value by 2
000248 EA             24564             mov     A, Temp3
000249 33             24565             rlc     A
00024A FA             24566             mov     Temp3, A
00024B EB             24567             mov     A, Temp4
00024C 33             24568             rlc     A
00024D FB             24569             mov     Temp4, A
00024E                24570     t1_int_not_bidir:
                      24571             ; Generate 4/256
00024E EB             24572             mov     A, Temp4
00024F 2B             24573             add     A, Temp4
000250 3B             24574             addc    A, Temp4
000251 3B             24575             addc    A, Temp4
000252 F9             24576             mov     Temp2, A
                      24577             ; Align to 11 bits
000253 C3             24578             clr     C
000254 EB             24579             mov     A, Temp4
000255 13             24580             rrc     A
000256 FB             24581             mov     Temp4, A
000257 EA             24582             mov     A, Temp3
000258 13             24583             rrc     A
000259 FA             24584             mov     Temp3, A
                      24585             ; Scale from 2000 to 2048
00025A EA             24586             mov     A, Temp3
00025B 29             24587             add     A, Temp2        ; Holds 4/128
00025C FA             24588             mov     Temp3, A
00025D EB             24589             mov     A, Temp4
00025E 3400           24590             addc    A, #0
000260 FB             24591             mov     Temp4, A
000261 30E304         24592             jnb     ACC.3, ($+7)
                      24593     
000264 7AFF           24594             mov     Temp3, #0FFh
000266 7BFF           24595             mov     Temp4, #0FFh
                      24596     
                      24597             ; Boost pwm during direct start
000268 E500       F   24598             mov     A, Flags1
00026A 5403           24599             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
00026C 601B           24600             jz      t1_int_startup_boosted
                      24601     
00026E 200018         24602             jb      Flags1.MOTOR_STARTED, t1_int_startup_boosted    ; Do not boost when chan
                               ging direction in bidirectional mode
                      24603     
000271 E500       F   24604             mov     A, Pwm_Limit_Beg                                ; Set 25% of max startup
                                power as minimum power
000273 33             24605             rlc     A
000274 F9             24606             mov     Temp2, A
000275 EB             24607             mov     A, Temp4
000276 7007           24608             jnz     t1_int_startup_boost_stall
                      24609     
000278 C3             24610             clr     C
000279 E9             24611             mov     A, Temp2
00027A 9A             24612             subb    A, Temp3
00027B 4002           24613             jc      t1_int_startup_boost_stall
                      24614     
00027D E9             24615             mov     A, Temp2
00027E FA             24616             mov     Temp3, A
                      24617     
00027F                24618     t1_int_startup_boost_stall:
00027F E500       F   24619             mov     A, Stall_Cnt                                    ; Add an extra power boo
                               st during start
000281 C4             24620             swap    A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   398

000282 33             24621             rlc     A
000283 2A             24622             add     A, Temp3
000284 FA             24623             mov     Temp3, A
000285 EB             24624             mov     A, Temp4
000286 3400           24625             addc    A, #0
000288 FB             24626             mov     Temp4, A
                      24627     
000289                24628     t1_int_startup_boosted:
                      24629             ; Set 8bit value
000289 C3             24630             clr     C
00028A EA             24631             mov     A, Temp3
00028B 33             24632             rlc     A
00028C C4             24633             swap    A
00028D 540F           24634             anl     A, #0Fh
00028F F8             24635             mov     Temp1, A
000290 EB             24636             mov     A, Temp4
000291 33             24637             rlc     A
000292 C4             24638             swap    A
000293 54F0           24639             anl     A, #0F0h
000295 48             24640             orl     A, Temp1
000296 F8             24641             mov     Temp1, A
000297 7005           24642             jnz     t1_int_zero_rcp_checked ; New_Rcp (Temp1) is only zero if all 11 bits ar
                               e zero
                      24643     
000299 EA             24644             mov     A, Temp3
00029A 6002           24645             jz      t1_int_zero_rcp_checked
                      24646     
00029C 7801           24647             mov     Temp1, #1
                      24648     
00029E                24649     t1_int_zero_rcp_checked:
                      24650             ; Align to 10 bits for 24MHz MCU
                      24651     IF 1 == 0
                                        clr     C
                                        mov     A, Temp4
                                        rrc     A
                                        mov     Temp4, A
                                        mov     A, Temp3
                                        rrc     A
                                        mov     Temp3, A
                                ENDIF
00029E 900000         24660             mov     DPTR, #0                                        ; Set pointer to start
0002A1 D2A8           24661             setb    IE_EX0                                  ; Enable int0 interrupts
0002A3 D2AA           24662             setb    IE_EX1                                  ; Enable int1 interrupts
                      24663             ; Decrement outside range counter
0002A5 E500       F   24664             mov     A, Rcp_Outside_Range_Cnt
0002A7 6002           24665             jz      ($+4)
                      24666     
0002A9 1500       F   24667             dec     Rcp_Outside_Range_Cnt
                      24668     
0002AB 0100       F   24669             ajmp    int0_int_pulse_ready
                      24670     
0002AD                24671     t1_int_frame_fail:
0002AD 900000         24672             mov     DPTR, #0                                        ; Set pointer to start
0002B0 D2A8           24673             setb    IE_EX0                                  ; Enable int0 interrupts
0002B2 D2AA           24674             setb    IE_EX1                                  ; Enable int1 interrupts
0002B4 0100       F   24675             ajmp int0_int_outside_range
                      24676     
                      24677     
                      24678     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24679     ;
                      24680     ; Timer 2 interrupt routine
                      24681     ;
                      24682     ; No assumptions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   399

                      24683     ; Requirements: Temp variables can NOT be used since PSW.x is not set
                      24684     ;
                      24685     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0002B6                24686     t2_int: ; Happens every 32ms
0002B6 C0D0           24687             push    PSW                     ; Preserve registers through interrupt
0002B8 C0E0           24688             push    ACC
0002BA C2CF           24689             clr     TMR2CN0_TF2H                            ; Clear interrupt flag
0002BC 0500       F   24690             inc     Timer2_X
                      24691     IF 1 == 1
0002BE E500       F   24692             mov     A, Clock_Set_At_48MHz
0002C0 6009           24693             jz      t2_int_start
                      24694     
                      24695             ; Check skip variable
0002C2 E500       F   24696             mov     A, Skip_T2_Int
0002C4 6005           24697             jz      t2_int_start                            ; Execute this interrupt
                      24698     
0002C6 750000     F   24699             mov     Skip_T2_Int, #0
0002C9 0100       F   24700             ajmp    t2_int_exit
                      24701     
0002CB                24702     t2_int_start:
0002CB 750001     F   24703             mov     Skip_T2_Int, #1                 ; Skip next interrupt
                      24704     ENDIF
                      24705             ; Update RC pulse timeout counter 
0002CE E500       F   24706             mov     A, Rcp_Timeout_Cntd     ; RC pulse timeout count zero?
0002D0 6002           24707             jz      ($+4)                                                           ; Yes - 
                               do not decrement
                      24708             
0002D2 1500       F   24709             dec     Rcp_Timeout_Cntd                ; No decrement          
                      24710             
                      24711             ; Check RC pulse against stop value
0002D4 C3             24712             clr     C
0002D5 E500       F   24713             mov     A, New_Rcp                                      ; Load new pulse value
0002D7 6005           24714             jz      t2_int_rcp_stop                 ; Check if pulse is below stop value
                      24715             
                      24716             ; RC pulse higher than stop value, reset stop counter
0002D9 750000     F   24717             mov     Rcp_Stop_Cnt, #0                ; Reset rcp stop counter
0002DC 0100       F   24718             ajmp    t2_int_exit
                      24719     
0002DE                24720     t2_int_rcp_stop:
                      24721             ; RC pulse less than stop value
0002DE E500       F   24722             mov     A, Rcp_Stop_Cnt                 ; Increment stop counter
0002E0 2401           24723             add     A, #1
0002E2 F500       F   24724             mov     Rcp_Stop_Cnt, A
0002E4 5003           24725             jnc     ($+5)                                                           ; Branch
                                if counter has not wrapped
                      24726     
0002E6 7500FF     F   24727             mov     Rcp_Stop_Cnt, #0FFh     ; Set stop counter to max
                      24728     
0002E9                24729     t2_int_exit:
0002E9 D0E0           24730             pop     ACC                                                                     
                               ; Restore preserved registers   
0002EB D0D0           24731             pop     PSW
0002ED 32             24732             reti
                      24733     
                      24734     
                      24735     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24736     ;
                      24737     ; Timer 3 interrupt routine
                      24738     ;
                      24739     ; No assumptions
                      24740     ; Requirements: Temp variables can NOT be used since PSW.x is not set
                      24741     ;               ACC can not be used, as it is not pushed to stack
                      24742     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   400

                      24743     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0002EE                24744     t3_int: ; Used for commutation timing
0002EE C2AF           24745             clr     IE_EA                   ; Disable all interrupts
0002F0 53E67F         24746             anl     EIE1, #7Fh              ; Disable timer 3 interrupts
0002F3 7592FA         24747             mov     TMR3RLL, #0FAh          ; Set a short delay before next interrupt
0002F6 7593FF         24748             mov     TMR3RLH, #0FFh
0002F9 C200       F   24749             clr     Flags0.T3_PENDING       ; Flag that timer has wrapped
0002FB 53917F         24750             anl     TMR3CN0, #07Fh          ; Timer 3 interrupt flag cleared
0002FE D2AF           24751             setb    IE_EA                   ; Enable all interrupts
000300 32             24752             reti
                      24753     
                      24754     
                      24755     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24756     ;
                      24757     ; Int0 interrupt routine
                      24758     ;
                      24759     ; No assumptions
                      24760     ;
                      24761     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000301                24762     int0_int:       ; Used for RC pulse timing
000301 C0E0           24763             push    ACC
000303 E58A           24764             mov     A, TL0                  ; Read pwm for DShot immediately
                      24765             ; Test for DShot
000305 300008         24766             jnb     Flags2.RCP_DSHOT, int0_int_not_dshot
                      24767     
000308 85008B     F   24768             mov     TL1, DShot_Timer_Preset ; Reset sync timer
00030B F0             24769             movx    @DPTR, A                        ; Store pwm
00030C A3             24770             inc     DPTR
00030D D0E0           24771             pop     ACC
00030F 32             24772             reti
                      24773     
                      24774             ; Not DShot
000310                24775     int0_int_not_dshot:
000310 D0E0           24776             pop     ACC
000312 C2AF           24777             clr     IE_EA
000314 53E6EF         24778             anl     EIE1, #0EFh             ; Disable pca interrupts
000317 C0D0           24779             push    PSW                             ; Preserve registers through interrupt
000319 C0E0           24780             push    ACC
00031B C0F0           24781             push    B
00031D D2D3           24782             setb    PSW.3                   ; Select register bank 1 for this interrupt 
00031F D2AF           24783             setb    IE_EA
                      24784             ; Get the counter values
                      24785+1           Get_Rcp_Capture_Values
                      24815             ; Scale down to 10 bits (for 24MHz, and 11 bits for 48MHz)
000348 30001F         24816             jnb     Flags2.RCP_MULTISHOT, int0_int_fall_not_multishot
                      24817     
                      24818             ; Multishot - Multiply by 2 and add 1/16 and 1/32
00034B E8             24819             mov     A, Temp1                ; Divide by 16
00034C C4             24820             swap A
00034D 540F           24821             anl     A, #0Fh
00034F FA             24822             mov     Temp3, A
000350 E9             24823             mov     A, Temp2
000351 C4             24824             swap    A
000352 54F0           24825             anl     A, #0F0h
000354 4A             24826             orl     A, Temp3
000355 FA             24827             mov     Temp3, A
000356 C3             24828             clr     C                       ; Make divided by 32
000357 13             24829             rrc     A
000358 2A             24830             add     A, Temp3                ; Add 1/16 to 1/32
000359 FA             24831             mov     Temp3, A
00035A C3             24832             clr     C                       ; Multiply by 2
00035B E8             24833             mov     A, Temp1
00035C 33             24834             rlc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   401

00035D F8             24835             mov     Temp1, A
00035E E9             24836             mov     A, Temp2
00035F 33             24837             rlc     A
000360 F9             24838             mov     Temp2, A
000361 E8             24839             mov     A, Temp1                ; Add 1/16 and 1/32
000362 2A             24840             add     A, Temp3
000363 FA             24841             mov     Temp3, A
000364 E9             24842             mov     A, Temp2
                      24843     IF 1 == 0
                                        addc    A, #03h         ; Add to low end, to make signal look like 20-40us
                                ELSE
000365 3406           24846             addc    A, #06h
                      24847     ENDIF
000367 FB             24848             mov     Temp4, A
000368 0100       F   24849             ajmp    int0_int_fall_gain_done
                      24850     
00036A                24851     int0_int_fall_not_multishot:
00036A 30000F         24852             jnb     Flags2.RCP_ONESHOT42, int0_int_fall_not_oneshot_42
                      24853     
                      24854             ; Oneshot42 - Add 2/256
00036D C3             24855             clr     C
00036E E8             24856             mov     A, Temp1
00036F 33             24857             rlc     A
000370 E9             24858             mov     A, Temp2
000371 33             24859             rlc     A
000372 FA             24860             mov     Temp3, A
000373 E8             24861             mov     A, Temp1
000374 2A             24862             add     A, Temp3
000375 FA             24863             mov     Temp3, A
000376 E9             24864             mov     A, Temp2
000377 3400           24865             addc    A, #0
000379 FB             24866             mov     Temp4, A
00037A 0100       F   24867             ajmp    int0_int_fall_gain_done
                      24868     
00037C                24869     int0_int_fall_not_oneshot_42:
00037C 300015         24870             jnb     Flags2.RCP_ONESHOT125, int0_int_fall_not_oneshot_125
                      24871     
                      24872             ; Oneshot125 - multiply by 86/256
00037F E8             24873             mov     A, Temp1                ; Multiply by 86 and divide by 256
000380 75F056         24874             mov     B, #56h
000383 A4             24875             mul     AB
000384 AAF0           24876             mov     Temp3, B
000386 E9             24877             mov     A, Temp2
000387 75F056         24878             mov     B, #56h
00038A A4             24879             mul     AB
00038B 2A             24880             add     A, Temp3
00038C FA             24881             mov     Temp3, A
00038D C5F0           24882             xch     A, B
00038F 3400           24883             addc    A, #0
000391 FB             24884             mov     Temp4, A
000392 0100       F   24885             ajmp    int0_int_fall_gain_done
                      24886     
000394                24887     int0_int_fall_not_oneshot_125:
                      24888             ; Regular signal - multiply by 43/1024
                      24889     IF 1 == 1
000394 C3             24890             clr     C
000395 EA             24891             mov     A, Temp3                ; Divide by 2
000396 13             24892             rrc     A
000397 FA             24893             mov     Temp3, A
000398 E9             24894             mov     A, Temp2
000399 13             24895             rrc     A
00039A F9             24896             mov     Temp2, A
00039B E8             24897             mov     A, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   402

00039C 13             24898             rrc     A
00039D F8             24899             mov     Temp1, A
                      24900     ENDIF
00039E E8             24901             mov     A, Temp1                ; Multiply by 43 and divide by 1024
                      24902     IF 1 == 0
                                        mov     B, #2Bh
                                ELSE
00039F 75F056         24905             mov     B, #56h         ; Multiply by 86
                      24906     ENDIF
0003A2 A4             24907             mul     AB
0003A3 AAF0           24908             mov     Temp3, B
0003A5 E9             24909             mov     A, Temp2
                      24910     IF 1 == 0
                                        mov     B, #2Bh
                                ELSE
0003A6 75F056         24913             mov     B, #56h         ; Multiply by 86
                      24914     ENDIF
0003A9 A4             24915             mul     AB
0003AA 2A             24916             add     A, Temp3
0003AB FA             24917             mov     Temp3, A
0003AC C5F0           24918             xch     A, B
0003AE 3400           24919             addc    A, #0
0003B0 C3             24920             clr     C       
0003B1 13             24921             rrc     A                       ; Divide by 2 for total 512
0003B2 FB             24922             mov     Temp4, A
0003B3 EA             24923             mov     A, Temp3
0003B4 13             24924             rrc     A
0003B5 FA             24925             mov     Temp3, A
0003B6 C3             24926             clr     C
0003B7 EB             24927             mov     A, Temp4                ; Divide by 2 for total 1024
0003B8 13             24928             rrc     A                                               
0003B9 FB             24929             mov     Temp4, A
0003BA EA             24930             mov     A, Temp3
0003BB 13             24931             rrc     A
0003BC FA             24932             mov     Temp3, A
                      24933     
0003BD                24934     int0_int_fall_gain_done:
                      24935             ; Check if 2235us or above (in order to ignore false pulses)
0003BD C3             24936             clr     C
0003BE EB             24937             mov     A, Temp4                                                ; Is pulse 2235u
                               s or higher?
                      24938     IF 1 == 0
                                        subb A, #09h
                                ELSE
0003BF 9412           24941             subb A, #12h
                      24942     ENDIF
0003C1 5009           24943             jnc     int0_int_outside_range                  ; Yes - ignore pulse
                      24944     
                      24945             ; Check if below 900us (in order to ignore false pulses)
0003C3 C3             24946             clr     C
0003C4 EA             24947             mov     A, Temp3
                      24948     IF 1 == 0
                                        subb A, #9Ah
                                ELSE
0003C5 9434           24951             subb A, #34h
                      24952     ENDIF
0003C7 EB             24953             mov     A, Temp4
                      24954     IF 1 == 0
                                        subb A, #03h
                                ELSE
0003C8 9407           24957             subb A, #07h
                      24958     ENDIF
0003CA 5016           24959             jnc     int0_int_check_full_range               ; No - proceed
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   403

                      24960     
0003CC                24961     int0_int_outside_range:
0003CC 0500       F   24962             inc     Rcp_Outside_Range_Cnt
0003CE E500       F   24963             mov     A, Rcp_Outside_Range_Cnt
0003D0 7002           24964             jnz     ($+4)
                      24965     
0003D2 1500       F   24966             dec     Rcp_Outside_Range_Cnt
                      24967     
0003D4 C3             24968             clr     C
0003D5 E500       F   24969             mov     A, Rcp_Outside_Range_Cnt
0003D7 9432           24970             subb    A, #50                                          ; Allow a given number o
                               f outside pulses
0003D9 5002           24971             jnc     ($+4)
0003DB 0100       F   24972             ajmp    int0_int_set_timeout                    ; If outside limits - ignore fir
                               st pulses
                      24973     
0003DD 750000     F   24974             mov     New_Rcp, #0                                     ; Set pulse length to ze
                               ro
0003E0 0100       F   24975             ajmp    int0_int_exit                                   ; Exit without reseting 
                               timeout
                      24976     
0003E2                24977     int0_int_check_full_range:
                      24978             ; Decrement outside range counter
0003E2 E500       F   24979             mov     A, Rcp_Outside_Range_Cnt
0003E4 6002           24980             jz      ($+4)
                      24981     
0003E6 1500       F   24982             dec     Rcp_Outside_Range_Cnt
                      24983     
                      24984             ; Calculate "1000us" plus throttle minimum
0003E8 300006         24985             jnb     Flags2.RCP_FULL_RANGE, int0_int_set_min ; Check if full range is chosen
                      24986     
0003EB 7C00           24987             mov     Temp5, #0                                               ; Set 1000us as 
                               default minimum
                      24988     IF 1 == 0
                                        mov     Temp6, #4
                                ELSE
0003ED 7D08           24991             mov     Temp6, #8
                      24992     ENDIF
0003EF 0100       F   24993             ajmp    int0_int_calculate
                      24994     
0003F1                24995     int0_int_set_min:
0003F1 AC00       F   24996             mov     Temp5, Min_Throttle_L                   ; Min throttle value scaled
0003F3 AD00       F   24997             mov     Temp6, Min_Throttle_H
0003F5 300004         24998             jnb     Flags3.PGM_BIDIR, ($+7)
                      24999     
0003F8 AC00       F   25000             mov     Temp5, Center_Throttle_L                        ; Center throttle value 
                               scaled
0003FA AD00       F   25001             mov     Temp6, Center_Throttle_H
                      25002     
0003FC                25003     int0_int_calculate:
0003FC C3             25004             clr     C
0003FD EA             25005             mov     A, Temp3                                                ; Subtract minim
                               um
0003FE 9C             25006             subb    A, Temp5
0003FF FA             25007             mov     Temp3, A
000400 EB             25008             mov     A, Temp4                                        
000401 9D             25009             subb    A, Temp6
000402 FB             25010             mov     Temp4, A
000403 9200       F   25011             mov     Bit_Access_Int.0, C
000405 AE00       F   25012             mov     Temp7, Throttle_Gain                            ; Load Temp7/Temp8 with 
                               throttle gain
000407 AF00       F   25013             mov     Temp8, Throttle_Gain_M
000409 300042         25014             jnb     Flags3.PGM_BIDIR, int0_int_not_bidir    ; If not bidirectional operation
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   404

                                - branch
                      25015     
00040C 5007           25016             jnc     int0_int_bidir_fwd                                      ; If result is p
                               ositive - branch
                      25017     
00040E 200009         25018             jb      Flags2.RCP_DIR_REV, int0_int_bidir_rev_chk      ; If same direction - br
                               anch
                      25019     
000411 D200       F   25020             setb    Flags2.RCP_DIR_REV
000413 0100       F   25021             ajmp    int0_int_bidir_rev_chk
                      25022     
000415                25023     int0_int_bidir_fwd:
000415 300002         25024             jnb     Flags2.RCP_DIR_REV, int0_int_bidir_rev_chk      ; If same direction - br
                               anch
                      25025     
000418 C200       F   25026             clr     Flags2.RCP_DIR_REV
                      25027     
00041A                25028     int0_int_bidir_rev_chk:
00041A 300004         25029             jnb     Flags2.RCP_DIR_REV, ($+7)
                      25030     
00041D AE00       F   25031             mov     Temp7, Throttle_Gain_BD_Rev             ; Load Temp7/Temp8 with throttle
                                gain for bidirectional reverse
00041F AF00       F   25032             mov     Temp8, Throttle_Gain_BD_Rev_M
                      25033     
000421 200002         25034             jb      Flags3.PGM_BIDIR_REV, ($+5)
                      25035     
000424 B200       F   25036             cpl     Flags2.RCP_DIR_REV
                      25037     
000426 C3             25038             clr     C                                                       ; Multiply throt
                               tle value by 2
000427 EA             25039             mov     A, Temp3
000428 33             25040             rlc     A
000429 FA             25041             mov     Temp3, A
00042A EB             25042             mov     A, Temp4
00042B 33             25043             rlc     A
00042C FB             25044             mov     Temp4, A
00042D A200       F   25045             mov     C, Bit_Access_Int.0
00042F 500A           25046             jnc     int0_int_bidir_do_deadband              ; If result is positive - branch
                      25047     
000431 EA             25048             mov     A, Temp3                                                ; Change sign
000432 F4             25049             cpl     A
000433 2401           25050             add     A, #1
000435 FA             25051             mov     Temp3, A
000436 EB             25052             mov     A, Temp4
000437 F4             25053             cpl     A
000438 3400           25054             addc    A, #0
00043A FB             25055             mov     Temp4, A
                      25056     
00043B                25057     int0_int_bidir_do_deadband:
00043B C3             25058             clr     C                                                       ; Subtract deadb
                               and
00043C EA             25059             mov     A, Temp3
                      25060     IF 1 == 0
                                        subb    A, #40
                                ELSE
00043D 9450           25063             subb    A, #80
                      25064     ENDIF
00043F FA             25065             mov     Temp3, A
000440 EB             25066             mov     A, Temp4
000441 9400           25067             subb    A, #0
000443 FB             25068             mov     Temp4, A
000444 5014           25069             jnc     int0_int_do_throttle_gain
                      25070     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   405

000446 7800           25071             mov     Temp1, #0
000448 7A00           25072             mov     Temp3, #0
00044A 7B00           25073             mov     Temp4, #0
00044C 0100       F   25074             ajmp    int0_int_do_throttle_gain
                      25075     
00044E                25076     int0_int_not_bidir:
00044E A200       F   25077             mov     C, Bit_Access_Int.0
000450 5008           25078             jnc     int0_int_do_throttle_gain               ; If result is positive - branch
                      25079     
000452                25080     int0_int_unidir_neg:
000452 7800           25081             mov     Temp1, #0                                               ; Yes - set to m
                               inimum
000454 7A00           25082             mov     Temp3, #0
000456 7B00           25083             mov     Temp4, #0
000458 0100       F   25084             ajmp    int0_int_pulse_ready
                      25085     
00045A                25086     int0_int_do_throttle_gain:
                      25087             ; Boost pwm during direct start
00045A E500       F   25088             mov     A, Flags1
00045C 5403           25089             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
00045E 601B           25090             jz      int0_int_startup_boosted
                      25091     
000460 200018         25092             jb      Flags1.MOTOR_STARTED, int0_int_startup_boosted  ; Do not boost when chan
                               ging direction in bidirectional mode
                      25093     
000463 E500       F   25094             mov     A, Pwm_Limit_Beg                                ; Set 25% of max startup
                                power as minimum power
                      25095     IF 1 == 1
000465 33             25096             rlc     A
                      25097     ENDIF
000466 F9             25098             mov     Temp2, A
000467 EB             25099             mov     A, Temp4
000468 7007           25100             jnz     int0_int_startup_boost_stall
                      25101     
00046A C3             25102             clr     C
00046B E9             25103             mov     A, Temp2
00046C 9A             25104             subb    A, Temp3
00046D 4002           25105             jc      int0_int_startup_boost_stall
                      25106     
00046F E9             25107             mov     A, Temp2
000470 FA             25108             mov     Temp3, A
                      25109     
000471                25110     int0_int_startup_boost_stall:
000471 E500       F   25111             mov     A, Stall_Cnt                                    ; Add an extra power boo
                               st during start
000473 C4             25112             swap    A
                      25113     IF 1 == 1
000474 33             25114             rlc     A
                      25115     ENDIF
000475 2A             25116             add     A, Temp3
000476 FA             25117             mov     Temp3, A
000477 EB             25118             mov     A, Temp4
000478 3400           25119             addc    A, #0
00047A FB             25120             mov     Temp4, A
                      25121     
00047B                25122     int0_int_startup_boosted:
00047B EA             25123             mov     A, Temp3                                                ; Multiply throt
                               tle value by throttle gain
00047C 8EF0           25124             mov     B, Temp7                                                ; Temp7 has Thro
                               ttle_Gain
00047E A4             25125             mul     AB
00047F F9             25126             mov     Temp2, A
000480 AAF0           25127             mov     Temp3, B
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   406

000482 EB             25128             mov     A, Temp4
000483 8EF0           25129             mov     B, Temp7                                                ; Temp7 has Thro
                               ttle_Gain
000485 A4             25130             mul     AB
000486 2A             25131             add     A, Temp3
000487 FA             25132             mov     Temp3, A
000488 C5F0           25133             xch     A, B
00048A 3400           25134             addc    A, #0
00048C FB             25135             mov     Temp4, A
00048D C3             25136             clr     C                                                       ; Generate 8bit 
                               number
00048E EB             25137             mov     A, Temp4
00048F 13             25138             rrc     A
000490 FD             25139             mov     Temp6, A
000491 EA             25140             mov     A, Temp3
000492 13             25141             rrc     A
000493 F8             25142             mov     Temp1, A
                      25143     IF 1 == 1
000494 C3             25144             clr     C
000495 ED             25145             mov     A, Temp6
000496 13             25146             rrc     A
000497 FD             25147             mov     Temp6, A
000498 E8             25148             mov     A, Temp1
000499 13             25149             rrc     A
00049A F8             25150             mov     Temp1, A
                      25151     ENDIF
00049B 0F             25152             inc     Temp8                                           ; Temp8 has Throttle_Gai
                               n_M
00049C                25153     int0_int_gain_loop:
00049C EF             25154             mov     A, Temp8
00049D 14             25155             dec     A
00049E 6004           25156             jz      int0_int_gain_rcp_done                  ; Skip one multiply by 2 of New_
                               Rcp
                      25157     
0004A0 C3             25158             clr     C
0004A1 E8             25159             mov     A, Temp1                                                ; Multiply New_R
                               cp by 2
0004A2 33             25160             rlc     A
0004A3 F8             25161             mov     Temp1, A
                      25162     
0004A4                25163     int0_int_gain_rcp_done:
0004A4 C3             25164             clr     C
0004A5 E9             25165             mov     A, Temp2                                                ; Multiply pwm b
                               y 2
0004A6 33             25166             rlc     A
0004A7 EA             25167             mov     A, Temp3
0004A8 33             25168             rlc     A
0004A9 FA             25169             mov     Temp3, A
0004AA EB             25170             mov     A, Temp4
0004AB 33             25171             rlc     A
0004AC FB             25172             mov     Temp4, A
0004AD DFED           25173             djnz    Temp8, int0_int_gain_loop
                      25174     
0004AF EB             25175             mov     A, Temp4
                      25176     IF 1 == 0
                                        jnb     ACC.2, int0_int_pulse_ready             ; Check that RC pulse is within 
                               legal range
                                ELSE
0004B0 30E306         25179             jnb     ACC.3, int0_int_pulse_ready
                      25180     ENDIF
                      25181     
0004B3 78FF           25182             mov     Temp1, #0FFh
0004B5 7AFF           25183             mov     Temp3, #0FFh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   407

                      25184     IF 1 == 0
                                        mov     Temp4, #3
                                ELSE
0004B7 7B07           25187             mov     Temp4, #7
                      25188     ENDIF
                      25189     
0004B9                25190     int0_int_pulse_ready:
0004B9 8800       F   25191             mov     New_Rcp, Temp1                                  ; Store new pulse length
0004BB D200       F   25192             setb    Flags2.RCP_UPDATED              ; Set updated flag
                      25193             ; Check if zero
0004BD E8             25194             mov     A, Temp1                                                                
                               ; Load new pulse value
                      25195             
0004BE 6003           25196             jz      ($+5)                                                                   
                                       ; Check if pulse is zero
                      25197             
0004C0 750000     F   25198             mov     Rcp_Stop_Cnt, #0                                ; Reset rcp stop counter
                      25199     
                      25200             ; Set pwm limit
0004C3 C3             25201             clr     C
0004C4 E500       F   25202             mov     A, Pwm_Limit                                    ; Limit to the smallest
0004C6 FC             25203             mov     Temp5, A                                                ; Store limit in
                                Temp5
0004C7 9500       F   25204             subb    A, Pwm_Limit_By_Rpm
0004C9 4002           25205             jc      ($+4)
                      25206     
0004CB AC00       F   25207             mov     Temp5, Pwm_Limit_By_Rpm                 
                      25208     
                      25209             ; Check against limit
0004CD C3             25210             clr     C
0004CE EC             25211             mov     A, Temp5
0004CF 9500       F   25212             subb    A, New_Rcp
0004D1 5008           25213             jnc     int0_int_set_pwm_registers
                      25214     
0004D3 EC             25215             mov     A, Temp5                                                ; Multiply limit
                                by 4 (8 for 48MHz MCUs)
                      25216     IF 1 == 0
                                        mov     B, #4
                                ELSE
0004D4 75F008         25219             mov     B, #8
                      25220     ENDIF
0004D7 A4             25221             mul     AB
0004D8 FA             25222             mov     Temp3, A
0004D9 ABF0           25223             mov     Temp4, B
                      25224     
0004DB                25225     int0_int_set_pwm_registers:
0004DB EA             25226             mov     A, Temp3
0004DC F4             25227             cpl     A
0004DD F8             25228             mov     Temp1, A
0004DE EB             25229             mov     A, Temp4
0004DF F4             25230             cpl     A
                      25231     IF 1 == 0
                                        anl     A, #3
                                ELSE
0004E0 5407           25234             anl     A, #7
                      25235     ENDIF
0004E2 F9             25236             mov     Temp2, A
                      25237     IF 90 != 0
0004E3 C3             25238             clr     C
0004E4 E8             25239             mov     A, Temp1                                                ; Skew damping f
                               et timing
                      25240     IF 1 == 0
                                        subb    A, #90
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   408

                                ELSE
0004E5 94B4           25243             subb    A, #(90 SHL 1)
                      25244     ENDIF
0004E7 FA             25245             mov     Temp3, A
0004E8 E9             25246             mov     A, Temp2
0004E9 9400           25247             subb    A, #0   
0004EB FB             25248             mov     Temp4, A
0004EC 5004           25249             jnc     int0_int_set_pwm_damp_set
                      25250     
0004EE 7A00           25251             mov     Temp3, #0
0004F0 7B00           25252             mov     Temp4, #0
                      25253     
0004F2                25254     int0_int_set_pwm_damp_set:
                      25255     ENDIF
0004F2 8800       F   25256             mov     Power_Pwm_Reg_L, Temp1
0004F4 8900       F   25257             mov     Power_Pwm_Reg_H, Temp2
                      25258     IF 90 != 0
0004F6 8A00       F   25259             mov     Damp_Pwm_Reg_L, Temp3
0004F8 8B00       F   25260             mov     Damp_Pwm_Reg_H, Temp4
                      25261     ENDIF
0004FA 75000A     F   25262             mov     Rcp_Timeout_Cntd, #10                   ; Set timeout count
                      25263     IF 90 != 0
0004FD D0F0           25264             pop     B                                                       ; Restore preser
                               ved registers
0004FF D0E0           25265             pop     ACC
000501 D0D0           25266             pop     PSW
                      25267+1           Clear_COVF_Interrupt
                      25269+1           Enable_COVF_Interrupt                           ; Generate a pca interrupt
000509 43E610         25271             orl     EIE1, #10h                                      ; Enable pca interrupts
00050C 32             25272             reti
                      25273     ELSE
                                        mov     A, Current_Power_Pwm_Reg_H
                                IF 1 == 0
                                        jnb     ACC.1, int0_int_set_pca_int_hi_pwm
                                ELSE
                                        jnb     ACC.2, int0_int_set_pca_int_hi_pwm
                                ENDIF
                                
                                        pop     B                                                       ; Restore preser
                               ved registers
                                        pop     ACC
                                        pop     PSW
                                        Clear_COVF_Interrupt
                                        Enable_COVF_Interrupt                           ; Generate a pca interrupt
                                        orl     EIE1, #10h                                      ; Enable pca interrupts
                                        reti
                                
                                int0_int_set_pca_int_hi_pwm:
                                        pop     B                                                       ; Restore preser
                               ved registers
                                        pop     ACC
                                        pop     PSW
                                        Clear_CCF_Interrupt
                                        Enable_CCF_Interrupt                            ; Generate pca interrupt
                                        orl     EIE1, #10h                                      ; Enable pca interrupts
                                        reti
                                ENDIF
                      25298     
00050D                25299     int0_int_set_timeout:
00050D 75000A     F   25300             mov     Rcp_Timeout_Cntd, #10                   ; Set timeout count
000510                25301     int0_int_exit:
000510 D0F0           25302             pop     B                                                       ; Restore preser
                               ved registers
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   409

000512 D0E0           25303             pop     ACC
000514 D0D0           25304             pop     PSW
000516 43E610         25305             orl     EIE1, #10h                                      ; Enable pca interrupts
000519 32             25306             reti
                      25307     
                      25308     
                      25309     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25310     ;
                      25311     ; Int1 interrupt routine
                      25312     ;
                      25313     ; No assumptions
                      25314     ;
                      25315     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00051A                25316     int1_int:       ; Used for RC pulse timing
00051A C2AA           25317             clr     IE_EX1                  ; Disable int1 interrupts
00051C D28E           25318             setb    TCON_TR1                        ; Start timer 1
00051E C2CA           25319             clr     TMR2CN0_TR2                             ; Timer 2 disabled
000520 85CC00     F   25320             mov     DShot_Frame_Start_L, TMR2L      ; Read timer value
000523 85CD00     F   25321             mov     DShot_Frame_Start_H, TMR2H
000526 D2CA           25322             setb    TMR2CN0_TR2                             ; Timer 2 enabled
000528 32             25323     reti
                      25324     
                      25325     
                      25326     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25327     ;
                      25328     ; PCA interrupt routine
                      25329     ;
                      25330     ; No assumptions
                      25331     ;
                      25332     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000529                25333     pca_int:        ; Used for setting pwm registers
000529 C2AF           25334             clr     IE_EA
00052B C0D0           25335             push    PSW                             ; Preserve registers through interrupt
00052D C0E0           25336             push    ACC
00052F D2D3           25337             setb    PSW.3                   ; Select register bank 1 for this interrupt
                      25338     
                      25339     IF 90 != 0                                      ; HI/LO enable style drivers
                      25340     
000531 A8F9           25341             mov     Temp1, PCA0L                            ; Read low byte, to transfer hig
                               h byte to holding register
000533 E500       F   25342             mov     A, Current_Power_Pwm_Reg_H
                      25343     IF 1 == 0
                                        jnb     ACC.1, pca_int_hi_pwm
                                ELSE
000535 30E20A         25346             jnb     ACC.2, pca_int_hi_pwm
                      25347     ENDIF
000538 E5FA           25348             mov     A, PCA0H
                      25349     IF 1 == 0
                                        jb      ACC.1, pca_int_exit                     ; Power below 50%, update pca in
                                the 0x00-0x0F range
                                        jb      ACC.0, pca_int_exit
                                ELSE
00053A 20E235         25353             jb      ACC.2, pca_int_exit
00053D 20E132         25354             jb      ACC.1, pca_int_exit
                      25355     ENDIF
000540 0100       F   25356             ajmp    pca_int_set_pwm
                      25357     
000542                25358     pca_int_hi_pwm:
000542 E5FA           25359             mov     A, PCA0H
                      25360     IF 1 == 0
                                        jnb     ACC.1, pca_int_exit                     ; Power above 50%, update pca in
                                the 0x20-0x2F range
                                        jb      ACC.0, pca_int_exit
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   410

                                ELSE
000544 30E22B         25364             jnb     ACC.2, pca_int_exit
000547 20E128         25365             jb      ACC.1, pca_int_exit
                      25366     ENDIF
                      25367     
00054A                25368     pca_int_set_pwm:
                      25369+1           Set_Power_Pwm_Regs
                      25383+1           Set_Damp_Pwm_Regs
000562 850000     F   25397             mov     Current_Power_Pwm_Reg_H, Power_Pwm_Reg_H
                      25398+1           Disable_COVF_Interrupt
                      25400     
                      25401     ELSE                                                            ; EN/PWM style drivers
                                        Set_Power_Pwm_Regs
                                        mov     Current_Power_Pwm_Reg_H, Power_Pwm_Reg_H
                                        Disable_COVF_Interrupt
                                        Disable_CCF_Interrupt
                                
                                ENDIF
                      25408     
                      25409             ; Pwm updated, enable/disable interrupts
000568 D2A8           25410             setb    IE_EX0                                  ; Enable int0 interrupts
00056A 300002         25411             jnb     Flags2.RCP_DSHOT, ($+5)
00056D D2AA           25412             setb    IE_EX1                                  ; Enable int1 interrupts (DShot 
                               only)
00056F 53E6EF         25413             anl     EIE1, #0EFh                             ; Disable pca interrupts
                      25414     
000572                25415     pca_int_exit:
                      25416+1           Clear_COVF_Interrupt
                      25418     IF 90 == 0
                                        Clear_CCF_Interrupt
                                ENDIF
000575 D0E0           25421             pop     ACC                                             ; Restore preserved regi
                               sters
000577 D0D0           25422             pop     PSW
000579 D2AF           25423             setb    IE_EA
00057B 32             25424             reti
                      25425     
                      25426     
                      25427     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25428     ;
                      25429     ; Wait xms ~(x*4*250)  (Different entry points) 
                      25430     ;
                      25431     ; No assumptions
                      25432     ;
                      25433     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00057C                25434     wait1ms:        
00057C 7901           25435             mov     Temp2, #1
00057E 8014           25436             jmp     waitxms_o
                      25437     
000580                25438     wait3ms:        
000580 7903           25439             mov     Temp2, #3
000582 8010           25440             jmp     waitxms_o
                      25441     
000584                25442     wait10ms:       
000584 790A           25443             mov     Temp2, #10
000586 800C           25444             jmp     waitxms_o
                      25445     
000588                25446     wait30ms:       
000588 791E           25447             mov     Temp2, #30
00058A 8008           25448             jmp     waitxms_o
                      25449     
00058C                25450     wait100ms:      
00058C 7964           25451             mov     Temp2, #100
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   411

00058E 8004           25452             jmp     waitxms_o
                      25453     
000590                25454     wait200ms:      
000590 79C8           25455             mov     Temp2, #200
000592 8000           25456             jmp     waitxms_o
                      25457     
000594                25458     waitxms_o:      ; Outer loop
000594 7817           25459             mov     Temp1, #23
000596                25460     waitxms_m:      ; Middle loop
000596 E4             25461             clr     A
000597 D5E0FD         25462             djnz    ACC, $  ; Inner loop (42.7us - 1024 cycles)
00059A D8FA           25463             djnz    Temp1, waitxms_m
00059C D9F6           25464             djnz    Temp2, waitxms_o
00059E 22             25465             ret
                      25466     
                      25467     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25468     ;
                      25469     ; Set pwm limit low rpm
                      25470     ;
                      25471     ; No assumptions
                      25472     ;
                      25473     ; Sets power limit for low rpms and disables demag for low rpms
                      25474     ;
                      25475     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00059F                25476     set_pwm_limit_low_rpm:
                      25477             ; Set pwm limit 
00059F 78FF           25478             mov     Temp1, #0FFh                                    ; Default full power
0005A1 200028         25479             jb      Flags1.STARTUP_PHASE, set_pwm_limit_low_rpm_exit        ; Exit if startu
                               p phase set
                      25480     
0005A4 7900       F   25481             mov     Temp2, #Pgm_Enable_Power_Prot           ; Check if low RPM power protect
                               ion is enabled
0005A6 E7             25482             mov     A, @Temp2
0005A7 6023           25483             jz      set_pwm_limit_low_rpm_exit              ; Exit if disabled
                      25484     
0005A9 E500       F   25485             mov     A, Comm_Period4x_H
0005AB 601F           25486             jz      set_pwm_limit_low_rpm_exit              ; Avoid divide by zero
                      25487     
0005AD 74FF           25488             mov     A, #255                                         ; Divide 255 by Comm_Per
                               iod4x_H
0005AF 8500F0     F   25489             mov     B, Comm_Period4x_H
0005B2 84             25490             div     AB
0005B3 8500F0     F   25491             mov     B, Low_Rpm_Pwr_Slope                    ; Multiply by slope
0005B6 300003         25492             jnb     Flags1.INITIAL_RUN_PHASE, ($+6) ; More protection for initial run phase 
0005B9 75F005         25493             mov     B, #5
0005BC A4             25494             mul     AB
0005BD F8             25495             mov     Temp1, A                                                ; Set new limit 
                                                       
0005BE C5F0           25496             xch     A, B
0005C0 6002           25497             jz      ($+4)                                           ; Limit to max
                      25498             
0005C2 78FF           25499             mov     Temp1, #0FFh                            
                      25500     
0005C4 C3             25501             clr     C
0005C5 E8             25502             mov     A, Temp1                                                ; Limit to min
0005C6 9500       F   25503             subb    A, Pwm_Limit_Beg
0005C8 5002           25504             jnc     set_pwm_limit_low_rpm_exit
                      25505     
0005CA A800       F   25506             mov     Temp1, Pwm_Limit_Beg
                      25507     
0005CC                25508     set_pwm_limit_low_rpm_exit:
0005CC 8800       F   25509             mov     Pwm_Limit_By_Rpm, Temp1                         
0005CE 22             25510             ret
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   412

                      25511             
                      25512     
                      25513     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25514     ;
                      25515     ; Set pwm limit high rpm
                      25516     ;
                      25517     ; No assumptions
                      25518     ;
                      25519     ; Sets power limit for high rpms
                      25520     ;
                      25521     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0005CF                25522     set_pwm_limit_high_rpm:
                      25523     IF 1 == 1
0005CF C3             25524             clr     C
0005D0 E500       F   25525             mov     A, Comm_Period4x_L
0005D2 94A0           25526             subb    A, #0A0h                                ; Limit Comm_Period to 160, whic
                               h is 500k erpm
0005D4 E500       F   25527             mov     A, Comm_Period4x_H
0005D6 9400           25528             subb    A, #00h
                      25529     ELSE
                                        clr     C
                                        mov     A, Comm_Period4x_L
                                        subb    A, #0E4h                                ; Limit Comm_Period to 228, whic
                               h is 350k erpm
                                        mov     A, Comm_Period4x_H
                                        subb    A, #00h
                                ENDIF
0005D8 E500       F   25536             mov     A, Pwm_Limit_By_Rpm
0005DA 5003           25537             jnc     set_pwm_limit_high_rpm_inc_limit
                      25538             
0005DC 14             25539             dec     A
0005DD 0100       F   25540             ajmp    set_pwm_limit_high_rpm_store
                      25541             
0005DF                25542     set_pwm_limit_high_rpm_inc_limit:
0005DF 04             25543             inc     A
0005E0                25544     set_pwm_limit_high_rpm_store:
0005E0 6002           25545             jz      ($+4)
                      25546     
0005E2 F500       F   25547             mov     Pwm_Limit_By_Rpm, A
                      25548     
0005E4 22             25549             ret
                      25550     
                      25551     
                      25552     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25553     ;
                      25554     ; Start ADC conversion
                      25555     ;
                      25556     ; No assumptions
                      25557     ;
                      25558     ; Start conversion used for measuring power supply voltage
                      25559     ;
                      25560     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0005E5                25561     start_adc_conversion:
                      25562             ; Start adc
                      25563+1           Start_Adc 
0005E8 22             25565             ret
                      25566     
                      25567     
                      25568     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25569     ;
                      25570     ; Check temperature, power supply voltage and limit power
                      25571     ;
                      25572     ; No assumptions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   413

                      25573     ;
                      25574     ; Used to limit main motor power in order to maintain the required voltage
                      25575     ;
                      25576     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0005E9                25577     check_temp_voltage_and_limit_power:
0005E9 0500       F   25578             inc     Adc_Conversion_Cnt                      ; Increment conversion counter
0005EB C3             25579             clr     C
0005EC E500       F   25580             mov     A, Adc_Conversion_Cnt           ; Is conversion count equal to temp rate
                               ?
0005EE 9408           25581             subb    A, #8
0005F0 4053           25582             jc      check_voltage_start                     ; No - check voltage
                      25583     
                      25584             ; Wait for ADC conversion to complete
0005F2 30EDF4         25585             jnb     ADC0CN0_ADINT, check_temp_voltage_and_limit_power
                      25586             ; Read ADC result
                      25587+1           Read_Adc_Result
                      25590             ; Stop ADC
                      25591+1           Stop_Adc
                      25592     
0005F9 750000     F   25593             mov     Adc_Conversion_Cnt, #0          ; Yes - temperature check. Reset counter
0005FC E9             25594             mov     A, Temp2                                        ; Move ADC MSB to Temp3
0005FD FA             25595             mov     Temp3, A
0005FE 7900       F   25596             mov     Temp2, #Pgm_Enable_Temp_Prot    ; Is temp protection enabled?
000600 E7             25597             mov     A, @Temp2
000601 6041           25598             jz      temp_check_exit                 ; No - branch
                      25599     
000603 EA             25600             mov     A, Temp3                                        ; Is temperature reading
                                below 256?
000604 7006           25601             jnz     temp_average_inc_dec            ; No - proceed
                      25602     
000606 E500       F   25603             mov     A, Current_Average_Temp         ; Yes -  decrement average
000608 6018           25604             jz      temp_average_updated            ; Already zero - no change
00060A 800C           25605             jmp     temp_average_dec                        ; Decrement 
                      25606     
00060C                25607     temp_average_inc_dec:
00060C C3             25608             clr     C
00060D E8             25609             mov     A, Temp1                                        ; Check if current tempe
                               rature is above or below average
00060E 9500       F   25610             subb    A, Current_Average_Temp
000610 600E           25611             jz      temp_average_updated_load_acc   ; Equal - no change
                      25612     
000612 E500       F   25613             mov     A, Current_Average_Temp         ; Above - increment average
000614 5005           25614             jnc     temp_average_inc                                
                      25615     
000616 600A           25616             jz      temp_average_updated            ; Below - decrement average if average i
                               s not already zero
000618                25617     temp_average_dec:
000618 14             25618             dec     A                                               ; Decrement average
000619 8007           25619             jmp     temp_average_updated
                      25620     
00061B                25621     temp_average_inc:
00061B 04             25622             inc     A                                               ; Increment average
00061C 60FA           25623             jz      temp_average_dec
00061E 8002           25624             jmp     temp_average_updated
                      25625     
000620                25626     temp_average_updated_load_acc:
000620 E500       F   25627             mov     A, Current_Average_Temp
000622                25628     temp_average_updated:
000622 F500       F   25629             mov     Current_Average_Temp, A
000624 C3             25630             clr     C
000625 9500       F   25631             subb    A, Temp_Prot_Limit                      ; Is temperature below first lim
                               it?
000627 401B           25632             jc      temp_check_exit                 ; Yes - exit
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   414

                      25633     
000629 7500C0     F   25634             mov  Pwm_Limit, #192                    ; No - limit pwm
                      25635     
00062C C3             25636             clr     C
00062D 9404           25637             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below second limit
00062F 4013           25638             jc      temp_check_exit                 ; Yes - exit
                      25639     
000631 750080     F   25640             mov  Pwm_Limit, #128                    ; No - limit pwm
                      25641     
000634 C3             25642             clr     C
000635 9404           25643             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below third limit
000637 400B           25644             jc      temp_check_exit                 ; Yes - exit
                      25645     
000639 750040     F   25646             mov  Pwm_Limit, #64                             ; No - limit pwm
                      25647     
00063C C3             25648             clr     C
00063D 9404           25649             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below final limit
00063F 4003           25650             jc      temp_check_exit                 ; Yes - exit
                      25651     
000641 750000     F   25652             mov  Pwm_Limit, #0                              ; No - limit pwm
                      25653     
000644                25654     temp_check_exit:
000644 22             25655             ret
                      25656     
000645                25657     check_voltage_start:
                      25658             ; Increase pwm limit
000645 E500       F   25659             mov  A, Pwm_Limit
000647 2410           25660             add     A, #16                  
000649 5002           25661             jnc     ($+4)                                   ; If not max - branch
                      25662     
00064B 74FF           25663             mov     A, #255
                      25664     
00064D F500       F   25665             mov     Pwm_Limit, A                            ; Increment limit 
00064F 22             25666             ret
                      25667     
                      25668     
                      25669     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25670     ;
                      25671     ; Set startup PWM routine
                      25672     ;
                      25673     ; Either the SETTLE_PHASE or the STEPPER_PHASE flag must be set
                      25674     ;
                      25675     ; Used for pwm control during startup
                      25676     ;
                      25677     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000650                25678     set_startup_pwm:        
                      25679             ; Adjust startup power
000650 7432           25680             mov     A, #50                                          ; Set power
000652 7900       F   25681             mov     Temp2, #Pgm_Startup_Pwr_Decoded
000654 87F0           25682             mov     B, @Temp2
000656 A4             25683             mul     AB
000657 C5F0           25684             xch     A, B
000659 A2F7           25685             mov     C, B.7                                          ; Multiply result by 2 (
                               unity gain is 128)
00065B 33             25686             rlc     A
00065C F8             25687             mov     Temp1, A                                                ; Transfer to Te
                               mp1
00065D C3             25688             clr     C
00065E E8             25689             mov     A, Temp1                                                ; Check against 
                               limit
00065F 9500       F   25690             subb    A, Pwm_Limit    
000661 4002           25691             jc      startup_pwm_set_pwm                             ; If pwm below limit - b
                               ranch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   415

                      25692     
000663 A800       F   25693             mov     Temp1, Pwm_Limit                                ; Limit pwm
                      25694     
000665                25695     startup_pwm_set_pwm:
000665 8800       F   25696             mov     Pwm_Limit_Beg, Temp1                    ; Set initial pwm limit
000667 22             25697             ret
                      25698     
                      25699     
                      25700     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25701     ;
                      25702     ; Initialize timing routine
                      25703     ;
                      25704     ; No assumptions
                      25705     ;
                      25706     ; Part of initialization before motor start
                      25707     ;
                      25708     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000668                25709     initialize_timing: 
000668 750000     F   25710             mov     Comm_Period4x_L, #00h                           ; Set commutation period
                                registers
00066B 7500F0     F   25711             mov     Comm_Period4x_H, #0F0h
00066E 22             25712             ret
                      25713     
                      25714     
                      25715     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25716     ;
                      25717     ; Calculate next commutation timing routine
                      25718     ;
                      25719     ; No assumptions
                      25720     ;
                      25721     ; Called immediately after each commutation
                      25722     ; Also sets up timer 3 to wait advance timing
                      25723     ; Two entry points are used
                      25724     ;
                      25725     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00066F                25726     calc_next_comm_timing:          ; Entry point for run phase
                      25727             ; Read commutation time
00066F C2AF           25728             clr     IE_EA
000671 C2CA           25729             clr     TMR2CN0_TR2             ; Timer 2 disabled
000673 A8CC           25730             mov     Temp1, TMR2L            ; Load timer value
000675 A9CD           25731             mov     Temp2, TMR2H    
000677 AA00       F   25732             mov     Temp3, Timer2_X
000679 30CF01         25733             jnb     TMR2CN0_TF2H, ($+4)     ; Check if interrupt is pending
00067C 0A             25734             inc     Temp3                   ; If it is pending, then timer has already wrapp
                               ed
00067D D2CA           25735             setb    TMR2CN0_TR2             ; Timer 2 enabled
00067F D2AF           25736             setb    IE_EA
                      25737     IF 1 == 1
000681 C3             25738             clr     C
000682 EA             25739             mov     A, Temp3
000683 13             25740             rrc     A
000684 FA             25741             mov     Temp3, A
000685 E9             25742             mov     A, Temp2
000686 13             25743             rrc     A
000687 F9             25744             mov     Temp2, A
000688 E8             25745             mov     A, Temp1
000689 13             25746             rrc     A
00068A F8             25747             mov     Temp1, A
                      25748     ENDIF
                      25749             ; Calculate this commutation time
00068B AB00       F   25750             mov     Temp4, Prev_Comm_L
00068D AC00       F   25751             mov     Temp5, Prev_Comm_H
00068F 8800       F   25752             mov     Prev_Comm_L, Temp1              ; Store timestamp as previous commutatio
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   416

                               n
000691 8900       F   25753             mov     Prev_Comm_H, Temp2
000693 C3             25754             clr     C
000694 E8             25755             mov     A, Temp1
000695 9B             25756             subb    A, Temp4                                ; Calculate the new commutation 
                               time
000696 F8             25757             mov     Temp1, A
000697 E9             25758             mov     A, Temp2
000698 9C             25759             subb    A, Temp5
000699 20000A         25760             jb      Flags1.STARTUP_PHASE, calc_next_comm_startup
                      25761     
                      25762     IF 1 == 1
00069C 547F           25763             anl     A, #7Fh
                      25764     ENDIF
00069E F9             25765             mov     Temp2, A
00069F 300002         25766             jnb     Flags1.HIGH_RPM, ($+5)  ; Branch if high rpm
0006A2 0100       F   25767             ajmp    calc_next_comm_timing_fast
                      25768     
0006A4 0100       F   25769             ajmp    calc_next_comm_normal
                      25770     
0006A6                25771     calc_next_comm_startup:
0006A6 AD00       F   25772             mov     Temp6, Prev_Comm_X
0006A8 8A00       F   25773             mov     Prev_Comm_X, Temp3              ; Store extended timestamp as previous c
                               ommutation
0006AA F9             25774             mov     Temp2, A
0006AB EA             25775             mov     A, Temp3
0006AC 9D             25776             subb    A, Temp6                                ; Calculate the new extended com
                               mutation time
                      25777     IF 1 == 1
0006AD 547F           25778             anl     A, #7Fh
                      25779     ENDIF
0006AF FA             25780             mov     Temp3, A
0006B0 6006           25781             jz      calc_next_comm_startup_no_X
                      25782     
0006B2 78FF           25783             mov     Temp1, #0FFh
0006B4 79FF           25784             mov     Temp2, #0FFh
0006B6 0100       F   25785             ajmp    calc_next_comm_startup_average
                      25786     
0006B8                25787     calc_next_comm_startup_no_X:
0006B8 AE00       F   25788             mov     Temp7, Prev_Prev_Comm_L
0006BA AF00       F   25789             mov     Temp8, Prev_Prev_Comm_H
0006BC 8B00       F   25790             mov     Prev_Prev_Comm_L, Temp4
0006BE 8C00       F   25791             mov     Prev_Prev_Comm_H, Temp5
0006C0 A800       F   25792             mov     Temp1, Prev_Comm_L              ; Reload this commutation time  
0006C2 A900       F   25793             mov     Temp2, Prev_Comm_H
0006C4 C3             25794             clr     C
0006C5 E8             25795             mov     A, Temp1
0006C6 9E             25796             subb    A, Temp7                                ; Calculate the new commutation 
                               time based upon the two last commutations (to reduce sensitivity to offset)
0006C7 F8             25797             mov     Temp1, A
0006C8 E9             25798             mov     A, Temp2
0006C9 9F             25799             subb    A, Temp8
0006CA F9             25800             mov     Temp2, A
                      25801     
0006CB                25802     calc_next_comm_startup_average:
0006CB C3             25803             clr     C
0006CC E500       F   25804             mov     A, Comm_Period4x_H              ; Average with previous and save
0006CE 13             25805             rrc     A
0006CF FB             25806             mov     Temp4, A
0006D0 E500       F   25807             mov     A, Comm_Period4x_L
0006D2 13             25808             rrc     A
0006D3 FA             25809             mov     Temp3, A
0006D4 E8             25810             mov     A, Temp1                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   417

0006D5 2A             25811             add     A, Temp3
0006D6 F500       F   25812             mov     Comm_Period4x_L, A
0006D8 E9             25813             mov     A, Temp2
0006D9 3B             25814             addc    A, Temp4
0006DA F500       F   25815             mov     Comm_Period4x_H, A
0006DC 5006           25816             jnc     ($+8)
                      25817     
0006DE 7500FF     F   25818             mov     Comm_Period4x_L, #0FFh
0006E1 7500FF     F   25819             mov     Comm_Period4x_H, #0FFh
                      25820     
0006E4 0100       F   25821             ajmp    calc_new_wait_times_setup
                      25822     
0006E6                25823     calc_next_comm_normal:
                      25824             ; Calculate new commutation time 
0006E6 AA00       F   25825             mov     Temp3, Comm_Period4x_L  ; Comm_Period4x(-l-h) holds the time of 4 commut
                               ations
0006E8 AB00       F   25826             mov     Temp4, Comm_Period4x_H
0006EA AC00       F   25827             mov     Temp5, Comm_Period4x_L  ; Copy variables
0006EC AD00       F   25828             mov     Temp6, Comm_Period4x_H
0006EE 7E04           25829             mov     Temp7, #4                               ; Divide Comm_Period4x 4 times a
                               s default
0006F0 7F02           25830             mov     Temp8, #2                               ; Divide new commutation time 2 
                               times as default
0006F2 C3             25831             clr     C
0006F3 EB             25832             mov     A, Temp4
0006F4 9404           25833             subb    A, #04h
0006F6 400D           25834             jc      calc_next_comm_avg_period_div
                      25835     
0006F8 1E             25836             dec     Temp7                           ; Reduce averaging time constant for low
                                speeds
0006F9 1F             25837             dec     Temp8
                      25838     
0006FA C3             25839             clr     C
0006FB EB             25840             mov     A, Temp4
0006FC 9408           25841             subb    A, #08h
0006FE 4005           25842             jc      calc_next_comm_avg_period_div
                      25843     
000700 200002         25844             jb      Flags1.INITIAL_RUN_PHASE, calc_next_comm_avg_period_div ; Do not average
                                very fast during initial run
                      25845     
000703 1E             25846             dec     Temp7                           ; Reduce averaging time constant more fo
                               r even lower speeds
000704 1F             25847             dec     Temp8
                      25848     
000705                25849     calc_next_comm_avg_period_div:
000705 C3             25850             clr     C
000706 ED             25851             mov     A, Temp6                                        
000707 13             25852             rrc     A                                       ; Divide by 2
000708 FD             25853             mov     Temp6, A        
000709 EC             25854             mov     A, Temp5                                
00070A 13             25855             rrc     A
00070B FC             25856             mov     Temp5, A
00070C DEF7           25857             djnz    Temp7, calc_next_comm_avg_period_div
                      25858     
00070E C3             25859             clr     C
00070F EA             25860             mov     A, Temp3
000710 9C             25861             subb    A, Temp5                                ; Subtract a fraction
000711 FA             25862             mov     Temp3, A
000712 EB             25863             mov     A, Temp4
000713 9D             25864             subb    A, Temp6
000714 FB             25865             mov     Temp4, A
000715 EF             25866             mov     A, Temp8                                ; Divide new time
000716 6009           25867             jz      calc_next_comm_new_period_div_done
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   418

                      25868     
000718                25869     calc_next_comm_new_period_div:
000718 C3             25870             clr     C
000719 E9             25871             mov     A, Temp2                                        
00071A 13             25872             rrc     A                                       ; Divide by 2
00071B F9             25873             mov     Temp2, A        
00071C E8             25874             mov     A, Temp1                                
00071D 13             25875             rrc     A
00071E F8             25876             mov     Temp1, A
00071F DFF7           25877             djnz    Temp8, calc_next_comm_new_period_div
                      25878     
000721                25879     calc_next_comm_new_period_div_done:
000721 EA             25880             mov     A, Temp3
000722 28             25881             add     A, Temp1                                ; Add the divided new time
000723 FA             25882             mov     Temp3, A
000724 EB             25883             mov     A, Temp4
000725 39             25884             addc    A, Temp2
000726 FB             25885             mov     Temp4, A
000727 8A00       F   25886             mov     Comm_Period4x_L, Temp3  ; Store Comm_Period4x_X
000729 8B00       F   25887             mov     Comm_Period4x_H, Temp4
00072B 5006           25888             jnc     calc_new_wait_times_setup; If period larger than 0xffff - go to slow cas
                               e
                      25889     
00072D 7BFF           25890             mov     Temp4, #0FFh
00072F 8B00       F   25891             mov     Comm_Period4x_L, Temp4  ; Set commutation period registers to very slow 
                               timing (0xffff)
000731 8B00       F   25892             mov     Comm_Period4x_H, Temp4
                      25893     
000733                25894     calc_new_wait_times_setup:      
                      25895             ; Set high rpm bit (if above 156k erpm)
000733 C3             25896             clr     C
000734 EB             25897             mov     A, Temp4
000735 9402           25898             subb    A, #2
000737 5002           25899             jnc     ($+4)
                      25900     
000739 D200       F   25901             setb    Flags1.HIGH_RPM                 ; Set high rpm bit
                      25902             
                      25903             ; Load programmed commutation timing
00073B 300004         25904             jnb     Flags1.STARTUP_PHASE, calc_new_wait_per_startup_done    ; Set dedicated 
                               timing during startup
                      25905     
00073E 7F03           25906             mov     Temp8, #3
000740 0100       F   25907             ajmp    calc_new_wait_per_demag_done
                      25908     
000742                25909     calc_new_wait_per_startup_done:
000742 7800       F   25910             mov     Temp1, #Pgm_Comm_Timing ; Load timing setting
000744 E6             25911             mov     A, @Temp1                               
000745 FF             25912             mov     Temp8, A                                ; Store in Temp8
000746 C3             25913             clr     C
000747 E500       F   25914             mov     A, Demag_Detected_Metric        ; Check demag metric
000749 9482           25915             subb    A, #130
00074B 4011           25916             jc      calc_new_wait_per_demag_done
                      25917     
00074D 0F             25918             inc     Temp8                           ; Increase timing
                      25919     
00074E C3             25920             clr     C
00074F E500       F   25921             mov     A, Demag_Detected_Metric
000751 94A0           25922             subb    A, #160
000753 4001           25923             jc      ($+3)
                      25924     
000755 0F             25925             inc     Temp8                           ; Increase timing again
                      25926     
000756 C3             25927             clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   419

000757 EF             25928             mov     A, Temp8                                ; Limit timing to max
000758 9406           25929             subb    A, #6
00075A 4002           25930             jc      ($+4)
                      25931     
00075C 7F05           25932             mov     Temp8, #5                               ; Set timing to max
                      25933     
00075E                25934     calc_new_wait_per_demag_done:
                      25935             ; Set timing reduction
00075E 7E02           25936             mov     Temp7, #2
                      25937             ; Load current commutation timing
000760 E500       F   25938             mov     A, Comm_Period4x_H              ; Divide 4 times
000762 C4             25939             swap    A
000763 540F           25940             anl     A, #00Fh
000765 F9             25941             mov     Temp2, A
000766 E500       F   25942             mov     A, Comm_Period4x_H
000768 C4             25943             swap    A
000769 54F0           25944             anl     A, #0F0h
00076B F8             25945             mov     Temp1, A
00076C E500       F   25946             mov     A, Comm_Period4x_L
00076E C4             25947             swap    A
00076F 540F           25948             anl     A, #00Fh
000771 28             25949             add     A, Temp1
000772 F8             25950             mov     Temp1, A
                      25951     
000773 C3             25952             clr     C
000774 E8             25953             mov     A, Temp1
000775 9E             25954             subb    A, Temp7
000776 FA             25955             mov     Temp3, A
000777 E9             25956             mov     A, Temp2                                
000778 9400           25957             subb    A, #0
00077A FB             25958             mov     Temp4, A
00077B 4009           25959             jc      load_min_time                   ; Check that result is still positive
                      25960     
00077D C3             25961             clr     C
00077E EA             25962             mov     A, Temp3
00077F 9401           25963             subb    A, #1
000781 EB             25964             mov     A, Temp4                        
000782 9400           25965             subb    A, #0
000784 5004           25966             jnc     calc_new_wait_times_exit        ; Check that result is still above minum
                               um
                      25967     
000786                25968     load_min_time:
000786 7A01           25969             mov     Temp3, #1
000788 E4             25970             clr     A
000789 FB             25971             mov     Temp4, A 
                      25972     
00078A                25973     calc_new_wait_times_exit:       
00078A 020000     F   25974             ljmp    wait_advance_timing
                      25975     
                      25976     
                      25977     ; Fast calculation (Comm_Period4x_H less than 2)
00078D                25978     calc_next_comm_timing_fast:                     
                      25979             ; Calculate new commutation time
00078D AA00       F   25980             mov     Temp3, Comm_Period4x_L  ; Comm_Period4x(-l-h) holds the time of 4 commut
                               ations
00078F AB00       F   25981             mov     Temp4, Comm_Period4x_H
000791 EB             25982             mov     A, Temp4                                ; Divide by 2 4 times
000792 C4             25983             swap    A
000793 FE             25984             mov     Temp7, A
000794 EA             25985             mov     A, Temp3
000795 C4             25986             swap A
000796 540F           25987             anl     A, #0Fh
000798 4E             25988             orl     A, Temp7
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   420

000799 FC             25989             mov     Temp5, A
00079A C3             25990             clr     C
00079B EA             25991             mov     A, Temp3                                ; Subtract a fraction
00079C 9C             25992             subb    A, Temp5
00079D FA             25993             mov     Temp3, A
00079E EB             25994             mov     A, Temp4                                
00079F 9400           25995             subb    A, #0
0007A1 FB             25996             mov     Temp4, A
0007A2 C3             25997             clr     C
0007A3 E8             25998             mov     A, Temp1
0007A4 13             25999             rrc     A                                       ; Divide by 2 2 times
0007A5 C3             26000             clr     C
0007A6 13             26001             rrc     A
0007A7 F8             26002             mov     Temp1, A
0007A8 EA             26003             mov     A, Temp3                                ; Add the divided new time
0007A9 28             26004             add     A, Temp1
0007AA FA             26005             mov     Temp3, A
0007AB EB             26006             mov     A, Temp4
0007AC 3400           26007             addc    A, #0
0007AE FB             26008             mov     Temp4, A
0007AF 8A00       F   26009             mov     Comm_Period4x_L, Temp3  ; Store Comm_Period4x_X
0007B1 8B00       F   26010             mov     Comm_Period4x_H, Temp4
0007B3 C3             26011             clr     C
0007B4 EB             26012             mov     A, Temp4                                ; If erpm below 156k - go to nor
                               mal case
0007B5 9402           26013             subb    A, #2
0007B7 4002           26014             jc      ($+4)
                      26015     
0007B9 C200       F   26016             clr     Flags1.HIGH_RPM                 ; Clear high rpm bit
                      26017     
                      26018             ; Set timing reduction
0007BB 7802           26019             mov     Temp1, #2
0007BD EB             26020             mov     A, Temp4                                ; Divide by 2 4 times
0007BE C4             26021             swap    A
0007BF FE             26022             mov     Temp7, A
0007C0 7B00           26023             mov     Temp4, #0
0007C2 EA             26024             mov     A, Temp3
0007C3 C4             26025             swap A
0007C4 540F           26026             anl     A, #0Fh
0007C6 4E             26027             orl     A, Temp7
0007C7 FA             26028             mov     Temp3, A
0007C8 C3             26029             clr     C
0007C9 EA             26030             mov     A, Temp3
0007CA 98             26031             subb    A, Temp1
0007CB FA             26032             mov     Temp3, A
0007CC 4005           26033             jc      load_min_time_fast              ; Check that result is still positive
                      26034     
0007CE C3             26035             clr     C
0007CF 9401           26036             subb    A, #1
0007D1 5002           26037             jnc     calc_new_wait_times_fast_done   ; Check that result is still above minum
                               um
                      26038     
0007D3                26039     load_min_time_fast:
0007D3 7A01           26040             mov     Temp3, #1
                      26041     
0007D5                26042     calc_new_wait_times_fast_done:  
0007D5 7800       F   26043             mov     Temp1, #Pgm_Comm_Timing ; Load timing setting
0007D7 E6             26044             mov     A, @Temp1                               
0007D8 FF             26045             mov     Temp8, A                                ; Store in Temp8
                      26046     
                      26047     
                      26048     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26049     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   421

                      26050     ; Wait advance timing routine
                      26051     ;
                      26052     ; No assumptions
                      26053     ; NOTE: Be VERY careful if using temp registers. They are passed over this routine
                      26054     ;
                      26055     ; Waits for the advance timing to elapse and sets up the next zero cross wait
                      26056     ;
                      26057     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0007D9                26058     wait_advance_timing:    
0007D9 300002         26059             jnb     Flags0.T3_PENDING, ($+5)
0007DC 0100       F   26060             ajmp    wait_advance_timing
                      26061     
                      26062             ; Setup next wait time
0007DE 850092     F   26063             mov     TMR3RLL, Wt_ZC_Tout_Start_L
0007E1 850093     F   26064             mov     TMR3RLH, Wt_ZC_Tout_Start_H
0007E4 D200       F   26065             setb    Flags0.T3_PENDING
0007E6 43E680         26066             orl     EIE1, #80h      ; Enable timer 3 interrupts
                      26067     
                      26068     
                      26069     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26070     ;
                      26071     ; Calculate new wait times routine
                      26072     ;
                      26073     ; No assumptions
                      26074     ;
                      26075     ; Calculates new wait times
                      26076     ;
                      26077     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0007E9                26078     calc_new_wait_times:    
0007E9 C3             26079             clr     C
0007EA E4             26080             clr     A
0007EB 9A             26081             subb    A, Temp3                                ; Negate
0007EC F8             26082             mov     Temp1, A        
0007ED E4             26083             clr     A
0007EE 9B             26084             subb    A, Temp4                                
0007EF F9             26085             mov     Temp2, A        
                      26086     IF 1 == 1
0007F0 C3             26087             clr     C
0007F1 E8             26088             mov     A, Temp1                                ; Multiply by 2
0007F2 33             26089             rlc     A
0007F3 F8             26090             mov     Temp1, A
0007F4 E9             26091             mov     A, Temp2
0007F5 33             26092             rlc     A
0007F6 F9             26093             mov     Temp2, A
                      26094     ENDIF
0007F7 300003         26095             jnb     Flags1.HIGH_RPM, ($+6)  ; Branch if high rpm
0007FA 020000     F   26096             ljmp    calc_new_wait_times_fast
                      26097     
0007FD E8             26098             mov     A, Temp1                                ; Copy values
0007FE FA             26099             mov     Temp3, A
0007FF E9             26100             mov     A, Temp2
000800 FB             26101             mov     Temp4, A
000801 D3             26102             setb    C                                       ; Negative numbers - set carry
000802 E9             26103             mov     A, Temp2                                
000803 13             26104             rrc     A                                       ; Divide by 2
000804 FD             26105             mov     Temp6, A
000805 E8             26106             mov     A, Temp1
000806 13             26107             rrc     A
000807 FC             26108             mov     Temp5, A
000808 8800       F   26109             mov     Wt_Zc_Tout_Start_L, Temp1; Set 15deg time for zero cross scan timeout
00080A 8900       F   26110             mov     Wt_Zc_Tout_Start_H, Temp2
00080C C3             26111             clr     C
00080D EF             26112             mov     A, Temp8                                ; (Temp8 has Pgm_Comm_Timing)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   422

00080E 9403           26113             subb    A, #3                           ; Is timing normal?
000810 6038           26114             jz      store_times_decrease    ; Yes - branch
                      26115     
000812 EF             26116             mov     A, Temp8                                
000813 20E00C         26117             jb      ACC.0, adjust_timing_two_steps  ; If an odd number - branch
                      26118     
000816 E8             26119             mov     A, Temp1                                ; Add 7.5deg and store in Temp1/
                               2
000817 2C             26120             add     A, Temp5
000818 F8             26121             mov     Temp1, A
000819 E9             26122             mov     A, Temp2
00081A 3D             26123             addc    A, Temp6
00081B F9             26124             mov     Temp2, A
00081C EC             26125             mov     A, Temp5                                ; Store 7.5deg in Temp3/4
00081D FA             26126             mov     Temp3, A
00081E ED             26127             mov     A, Temp6                        
00081F FB             26128             mov     Temp4, A
000820 8013           26129             jmp     store_times_up_or_down
                      26130     
000822                26131     adjust_timing_two_steps:
000822 E8             26132             mov     A, Temp1                                ; Add 15deg and store in Temp1/2
000823 28             26133             add     A, Temp1
000824 F8             26134             mov     Temp1, A
000825 E9             26135             mov     A, Temp2
000826 39             26136             addc    A, Temp2
000827 F9             26137             mov     Temp2, A
000828 C3             26138             clr     C
000829 E8             26139             mov     A, Temp1
00082A 2401           26140             add     A, #1
00082C F8             26141             mov     Temp1, A
00082D E9             26142             mov     A, Temp2
00082E 3400           26143             addc    A, #0
000830 F9             26144             mov     Temp2, A
000831 7AFF           26145             mov     Temp3, #-1                              ; Store minimum time in Temp3/4
000833 7BFF           26146             mov     Temp4, #0FFh
                      26147     
000835                26148     store_times_up_or_down:
000835 C3             26149             clr     C
000836 EF             26150             mov     A, Temp8                                
000837 9403           26151             subb    A, #3                                   ; Is timing higher than normal?
000839 400F           26152             jc      store_times_decrease            ; No - branch
                      26153     
00083B                26154     store_times_increase:
00083B 8A00       F   26155             mov     Wt_Comm_Start_L, Temp3          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
00083D 8B00       F   26156             mov     Wt_Comm_Start_H, Temp4
00083F 8800       F   26157             mov     Wt_Adv_Start_L, Temp1           ; New commutation advance time (~15deg n
                               ominal)
000841 8900       F   26158             mov     Wt_Adv_Start_H, Temp2
000843 8C00       F   26159             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
000845 8D00       F   26160             mov     Wt_Zc_Scan_Start_H, Temp6
000847 020000     F   26161             ljmp    wait_before_zc_scan
                      26162     
00084A                26163     store_times_decrease:
00084A 8800       F   26164             mov     Wt_Comm_Start_L, Temp1          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
00084C 8900       F   26165             mov     Wt_Comm_Start_H, Temp2
00084E 8A00       F   26166             mov     Wt_Adv_Start_L, Temp3           ; New commutation advance time (~15deg n
                               ominal)
000850 8B00       F   26167             mov     Wt_Adv_Start_H, Temp4
000852 8C00       F   26168             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   423

000854 8D00       F   26169             mov     Wt_Zc_Scan_Start_H, Temp6
000856 300012         26170             jnb     Flags1.STARTUP_PHASE, store_times_exit
                      26171     
000859 7500F0     F   26172             mov     Wt_Comm_Start_L, #0F0h          ; Set very short delays for all but adva
                               nce time during startup, in order to widen zero cross capture range
00085C 7500FF     F   26173             mov     Wt_Comm_Start_H, #0FFh
00085F 7500F0     F   26174             mov     Wt_Zc_Scan_Start_L, #0F0h
000862 7500FF     F   26175             mov     Wt_Zc_Scan_Start_H, #0FFh
000865 7500F0     F   26176             mov     Wt_Zc_Tout_Start_L, #0F0h
000868 7500FF     F   26177             mov     Wt_Zc_Tout_Start_H, #0FFh
                      26178     
00086B                26179     store_times_exit:
00086B 020000     F   26180             ljmp    wait_before_zc_scan
                      26181     
                      26182     
00086E                26183     calc_new_wait_times_fast:       
00086E E8             26184             mov     A, Temp1                                ; Copy values
00086F FA             26185             mov     Temp3, A
000870 D3             26186             setb    C                                       ; Negative numbers - set carry
000871 E8             26187             mov     A, Temp1                                ; Divide by 2
000872 13             26188             rrc     A
000873 FC             26189             mov     Temp5, A
000874 8800       F   26190             mov     Wt_Zc_Tout_Start_L, Temp1; Set 15deg time for zero cross scan timeout
000876 C3             26191             clr     C
000877 EF             26192             mov     A, Temp8                                ; (Temp8 has Pgm_Comm_Timing)
000878 9403           26193             subb    A, #3                           ; Is timing normal?
00087A 6021           26194             jz      store_times_decrease_fast; Yes - branch
                      26195     
00087C EF             26196             mov     A, Temp8                                
00087D 20E007         26197             jb      ACC.0, adjust_timing_two_steps_fast     ; If an odd number - branch
                      26198     
000880 E8             26199             mov     A, Temp1                                ; Add 7.5deg and store in Temp1
000881 2C             26200             add     A, Temp5
000882 F8             26201             mov     Temp1, A
000883 EC             26202             mov     A, Temp5                                ; Store 7.5deg in Temp3
000884 FA             26203             mov     Temp3, A
000885 0100       F   26204             ajmp    store_times_up_or_down_fast
                      26205     
000887                26206     adjust_timing_two_steps_fast:
000887 E8             26207             mov     A, Temp1                                ; Add 15deg and store in Temp1
000888 28             26208             add     A, Temp1
000889 2401           26209             add     A, #1
00088B F8             26210             mov     Temp1, A
00088C 7AFF           26211             mov     Temp3, #-1                      ; Store minimum time in Temp3
                      26212     
00088E                26213     store_times_up_or_down_fast:
00088E C3             26214             clr     C
00088F EF             26215             mov     A, Temp8                                
000890 9403           26216             subb    A, #3                           ; Is timing higher than normal?
000892 4009           26217             jc      store_times_decrease_fast; No - branch
                      26218     
000894                26219     store_times_increase_fast:
000894 8A00       F   26220             mov     Wt_Comm_Start_L, Temp3          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
000896 8800       F   26221             mov     Wt_Adv_Start_L, Temp1           ; New commutation advance time (~15deg n
                               ominal)
000898 8C00       F   26222             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
00089A 020000     F   26223             ljmp    wait_before_zc_scan
                      26224     
00089D                26225     store_times_decrease_fast:
00089D 8800       F   26226             mov     Wt_Comm_Start_L, Temp1          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   424

00089F 8A00       F   26227             mov     Wt_Adv_Start_L, Temp3           ; New commutation advance time (~15deg n
                               ominal)
0008A1 8C00       F   26228             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
                      26229     
                      26230     
                      26231     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26232     ;
                      26233     ; Wait before zero cross scan routine
                      26234     ;
                      26235     ; No assumptions
                      26236     ;
                      26237     ; Waits for the zero cross scan wait time to elapse
                      26238     ; Also sets up timer 3 for the zero cross scan timeout time
                      26239     ;
                      26240     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0008A3                26241     wait_before_zc_scan:    
0008A3 300002         26242             jnb     Flags0.T3_PENDING, ($+5)
0008A6 0100       F   26243             ajmp    wait_before_zc_scan
                      26244     
0008A8 750002     F   26245             mov     Startup_Zc_Timeout_Cntd, #2
0008AB                26246     setup_zc_scan_timeout:
0008AB D200       F   26247             setb    Flags0.T3_PENDING
0008AD 43E680         26248             orl     EIE1, #80h                      ; Enable timer 3 interrupts
0008B0 E500       F   26249             mov     A, Flags1
0008B2 5403           26250             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
0008B4 602D           26251             jz      wait_before_zc_scan_exit                
                      26252     
0008B6 A800       F   26253             mov     Temp1, Comm_Period4x_L  ; Set long timeout when starting
0008B8 A900       F   26254             mov     Temp2, Comm_Period4x_H
0008BA C3             26255             clr     C
0008BB E9             26256             mov     A, Temp2
0008BC 13             26257             rrc     A
0008BD F9             26258             mov     Temp2, A
0008BE E8             26259             mov     A, Temp1
0008BF 13             26260             rrc     A
0008C0 F8             26261             mov     Temp1, A
                      26262     IF 1 == 0
                                        clr     C
                                        mov     A, Temp2
                                        rrc     A
                                        mov     Temp2, A
                                        mov     A, Temp1
                                        rrc     A
                                        mov     Temp1, A
                                ENDIF
0008C1 300004         26271             jnb     Flags1.STARTUP_PHASE, setup_zc_scan_timeout_startup_done
                      26272     
0008C4 E9             26273             mov     A, Temp2
0008C5 2440           26274             add     A, #40h                         ; Increase timeout somewhat to avoid fal
                               se wind up
0008C7 F9             26275             mov     Temp2, A
                      26276     
0008C8                26277     setup_zc_scan_timeout_startup_done:
0008C8 C2AF           26278             clr     IE_EA
0008CA 53E67F         26279             anl     EIE1, #7Fh                      ; Disable timer 3 interrupts
0008CD 759100         26280             mov     TMR3CN0, #00h                   ; Timer 3 disabled and interrupt flag cl
                               eared
0008D0 C3             26281             clr     C
0008D1 E4             26282             clr     A
0008D2 98             26283             subb    A, Temp1                                ; Set timeout
0008D3 F594           26284             mov     TMR3L, A
0008D5 E4             26285             clr     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   425

0008D6 99             26286             subb    A, Temp2                
0008D7 F595           26287             mov     TMR3H, A
0008D9 759104         26288             mov     TMR3CN0, #04h                   ; Timer 3 enabled and interrupt flag cle
                               ared
0008DC D200       F   26289             setb    Flags0.T3_PENDING
0008DE 43E680         26290             orl     EIE1, #80h                      ; Enable timer 3 interrupts
0008E1 D2AF           26291             setb    IE_EA
                      26292     
0008E3                26293     wait_before_zc_scan_exit:          
0008E3 22             26294             ret
                      26295     
                      26296     
                      26297     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26298     ;
                      26299     ; Wait for comparator to go low/high routines
                      26300     ;
                      26301     ; No assumptions
                      26302     ;
                      26303     ; Waits for the zero cross scan wait time to elapse
                      26304     ; Then scans for comparator going low/high
                      26305     ;
                      26306     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0008E4                26307     wait_for_comp_out_low:
0008E4 D200       F   26308             setb    Flags0.DEMAG_DETECTED           ; Set demag detected flag as default
0008E6 750000     F   26309             mov     Comparator_Read_Cnt, #0         ; Reset number of comparator reads
0008E9 750000     F   26310             mov     Bit_Access, #00h                        ; Desired comparator output
0008EC 300003         26311             jnb     Flags1.DIR_CHANGE_BRAKE, ($+6)
0008EF 750040     F   26312             mov     Bit_Access, #40h                
0008F2 0100       F   26313             ajmp    wait_for_comp_out_start
                      26314     
0008F4                26315     wait_for_comp_out_high:
0008F4 D200       F   26316             setb    Flags0.DEMAG_DETECTED           ; Set demag detected flag as default
0008F6 750000     F   26317             mov     Comparator_Read_Cnt, #0         ; Reset number of comparator reads
0008F9 750040     F   26318             mov     Bit_Access, #40h                        ; Desired comparator output
0008FC 300003         26319             jnb     Flags1.DIR_CHANGE_BRAKE, ($+6)
0008FF 750000     F   26320             mov     Bit_Access, #00h                
                      26321     
000902                26322     wait_for_comp_out_start:
                      26323             ; Set number of comparator readings
000902 7801           26324             mov     Temp1, #1                                       ; Number of OK readings 
                               required
000904 7901           26325             mov     Temp2, #1                                       ; Max number of readings
                                required
000906 200020         26326             jb      Flags1.HIGH_RPM, comp_scale_samples     ; Branch if high rpm
                      26327     
000909 E500       F   26328             mov     A, Flags1                                       ; Clear demag detected f
                               lag if start phases
00090B 5403           26329             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
00090D 6002           26330             jz      ($+4)
                      26331                     
00090F C200       F   26332             clr     Flags0.DEMAG_DETECTED
                      26333     
000911 7914           26334             mov     Temp2, #20                              ; Too low value (~<15) causes ro
                               ugh running at pwm harmonics. Too high a value (~>35) causes the RCT4215 630 to run rough on full throttle
000913 E500       F   26335             mov     A, Comm_Period4x_H                      ; Set number of readings higher 
                               for lower speeds
000915 C3             26336             clr     C
000916 13             26337             rrc     A
000917 7001           26338             jnz     ($+3)
000919 04             26339             inc     A
00091A F8             26340             mov     Temp1, A
00091B C3             26341             clr     C                                               
00091C 9414           26342             subb    A, #20
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   426

00091E 4002           26343             jc      ($+4)
                      26344     
000920 7814           26345             mov     Temp1, #20
                      26346             
000922 300004         26347             jnb     Flags1.STARTUP_PHASE, comp_scale_samples
                      26348     
000925 781B           26349             mov     Temp1, #27                              ; Set many samples during startu
                               p, approximately one pwm period
000927 791B           26350             mov     Temp2, #27
                      26351     
000929                26352     comp_scale_samples:
                      26353     IF 1 == 1
000929 C3             26354             clr     C
00092A E8             26355             mov     A, Temp1
00092B 33             26356             rlc     A
00092C F8             26357             mov     Temp1, A
00092D C3             26358             clr     C
00092E E9             26359             mov     A, Temp2
00092F 33             26360             rlc     A
000930 F9             26361             mov     Temp2, A
                      26362     ENDIF
000931                26363     comp_check_timeout:
000931 200010         26364             jb      Flags0.T3_PENDING, comp_check_timeout_not_timed_out             ; Has ze
                               ro cross scan timeout elapsed?
                      26365     
000934 E500       F   26366             mov     A, Comparator_Read_Cnt                  ; Check that comparator has been
                                read
000936 600C           26367             jz      comp_check_timeout_not_timed_out        ; If not read - branch
                      26368     
000938 300003         26369             jnb     Flags1.STARTUP_PHASE, comp_check_timeout_timeout_extended       ; Extend
                                timeout during startup
                      26370     
00093B D50004         26371             djnz    Startup_Zc_Timeout_Cntd, comp_check_timeout_extend_timeout
                      26372     
00093E                26373     comp_check_timeout_timeout_extended:
00093E D200       F   26374             setb    Flags0.COMP_TIMED_OUT
000940 0100       F   26375             ajmp    setup_comm_wait
                      26376     
000942                26377     comp_check_timeout_extend_timeout:
000942 1100       F   26378             call    setup_zc_scan_timeout
000944                26379     comp_check_timeout_not_timed_out:
000944 0500       F   26380             inc     Comparator_Read_Cnt                     ; Increment comparator read coun
                               t
                      26381+1           Read_Comp_Out                                   ; Read comparator output
000948 5440           26383             anl     A, #40h
00094A B50002         26384             cjne    A, Bit_Access, comp_read_wrong
00094D 0100       F   26385             ajmp    comp_read_ok
                      26386             
00094F                26387     comp_read_wrong:
00094F 300009         26388             jnb     Flags1.STARTUP_PHASE, comp_read_wrong_not_startup
                      26389     
000952 08             26390             inc     Temp1                                   ; Increment number of OK reading
                               s required
000953 C3             26391             clr     C
000954 E8             26392             mov     A, Temp1
000955 99             26393             subb    A, Temp2                                        ; If above initial requi
                               rement - do not increment further
000956 4001           26394             jc      ($+3)
000958 18             26395             dec     Temp1
                      26396     
000959 0100       F   26397             ajmp    comp_check_timeout                      ; Continue to look for good ones
                      26398     
00095B                26399     comp_read_wrong_not_startup:
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   427

00095B 20000A         26400             jb      Flags0.DEMAG_DETECTED, comp_read_wrong_extend_timeout
                      26401     
00095E 08             26402             inc     Temp1                                   ; Increment number of OK reading
                               s required
00095F C3             26403             clr     C
000960 E8             26404             mov     A, Temp1
000961 99             26405             subb    A, Temp2                                        
000962 4002           26406             jc      ($+4)
000964 0100       F   26407             ajmp    wait_for_comp_out_start         ; If above initial requirement - go back
                                and restart
                      26408     
000966 0100       F   26409             ajmp    comp_check_timeout                      ; Otherwise - take another readi
                               ng
                      26410     
000968                26411     comp_read_wrong_extend_timeout:
000968 C200       F   26412             clr     Flags0.DEMAG_DETECTED           ; Clear demag detected flag
00096A 53E67F         26413             anl     EIE1, #7Fh                              ; Disable timer 3 interrupts
00096D 759100         26414             mov     TMR3CN0, #00h                           ; Timer 3 disabled and interrupt
                                flag cleared
000970 300011         26415             jnb     Flags1.HIGH_RPM, comp_read_wrong_low_rpm        ; Branch if not high rpm
                      26416     
000973 759400         26417             mov     TMR3L, #00h                             ; Set timeout to ~1ms
                      26418     IF 1 == 1
000976 7595F0         26419             mov     TMR3H, #0F0h
                      26420     ELSE
                                        mov     TMR3H, #0F8h
                                ENDIF
000979                26423     comp_read_wrong_timeout_set:
000979 759104         26424             mov     TMR3CN0, #04h                           ; Timer 3 enabled and interrupt 
                               flag cleared
00097C D200       F   26425             setb    Flags0.T3_PENDING
00097E 43E680         26426             orl     EIE1, #80h                              ; Enable timer 3 interrupts
000981 020000     F   26427             ljmp    wait_for_comp_out_start         ; If comparator output is not correct - 
                               go back and restart
                      26428     
000984                26429     comp_read_wrong_low_rpm:
000984 E500       F   26430             mov     A, Comm_Period4x_H                      ; Set timeout to ~4x comm period
                                4x value
000986 7EFF           26431             mov     Temp7, #0FFh                            ; Default to long
                      26432     IF 1 == 1
000988 C3             26433             clr     C
000989 33             26434             rlc     A
00098A 4009           26435             jc      comp_read_wrong_load_timeout
                      26436     
                      26437     ENDIF
00098C C3             26438             clr     C
00098D 33             26439             rlc     A
00098E 4005           26440             jc      comp_read_wrong_load_timeout
                      26441     
000990 C3             26442             clr     C
000991 33             26443             rlc     A
000992 4001           26444             jc      comp_read_wrong_load_timeout
                      26445     
000994 FE             26446             mov     Temp7, A
                      26447     
000995                26448     comp_read_wrong_load_timeout:
000995 C3             26449             clr     C
000996 E4             26450             clr     A
000997 9E             26451             subb    A, Temp7
000998 759400         26452             mov     TMR3L, #0
00099B F595           26453             mov     TMR3H, A
00099D 0100       F   26454             ajmp    comp_read_wrong_timeout_set
                      26455     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   428

00099F                26456     comp_read_ok:
00099F C3             26457             clr     C
0009A0 E500       F   26458             mov     A, Startup_Cnt                          ; Force a timeout for the first 
                               commutation
0009A2 9401           26459             subb    A, #1
0009A4 5002           26460             jnc     ($+4)
0009A6 0100       F   26461             ajmp    wait_for_comp_out_start
                      26462     
0009A8 300002         26463             jnb     Flags0.DEMAG_DETECTED, ($+5)    ; Do not accept correct comparator outpu
                               t if it is demag
0009AB 0100       F   26464             ajmp    wait_for_comp_out_start
                      26465     
0009AD D802           26466             djnz    Temp1, comp_read_ok_jmp         ; Decrement readings counter - repeat co
                               mparator reading if not zero
0009AF 0100       F   26467             ajmp    ($+4)
                      26468     
0009B1                26469     comp_read_ok_jmp:
0009B1 0100       F   26470             ajmp    comp_check_timeout
                      26471     
0009B3 C200       F   26472             clr     Flags0.COMP_TIMED_OUT
                      26473     
                      26474     
                      26475     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26476     ;
                      26477     ; Setup commutation timing routine
                      26478     ;
                      26479     ; No assumptions
                      26480     ;
                      26481     ; Sets up and starts wait from commutation to zero cross
                      26482     ;
                      26483     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0009B5                26484     setup_comm_wait:
0009B5 C2AF           26485             clr     IE_EA
0009B7 53E67F         26486             anl     EIE1, #7Fh              ; Disable timer 3 interrupts
0009BA 759100         26487             mov     TMR3CN0, #00h           ; Timer 3 disabled and interrupt flag cleared
0009BD 850094     F   26488             mov     TMR3L, Wt_Comm_Start_L
0009C0 850095     F   26489             mov     TMR3H, Wt_Comm_Start_H
0009C3 759104         26490             mov     TMR3CN0, #04h           ; Timer 3 enabled and interrupt flag cleared
                      26491             ; Setup next wait time
0009C6 850092     F   26492             mov     TMR3RLL, Wt_Adv_Start_L
0009C9 850093     F   26493             mov     TMR3RLH, Wt_Adv_Start_H
0009CC D200       F   26494             setb    Flags0.T3_PENDING
0009CE 43E680         26495             orl     EIE1, #80h              ; Enable timer 3 interrupts
0009D1 D2AF           26496             setb    IE_EA                   ; Enable interrupts again
                      26497     
                      26498     
                      26499     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26500     ;
                      26501     ; Evaluate comparator integrity
                      26502     ;
                      26503     ; No assumptions
                      26504     ;
                      26505     ; Checks comparator signal behaviour versus expected behaviour
                      26506     ;
                      26507     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0009D3                26508     evaluate_comparator_integrity:
0009D3 E500       F   26509             mov     A, Flags1
0009D5 5403           26510             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
0009D7 6007           26511             jz      eval_comp_check_timeout
                      26512     
0009D9 200002         26513             jb      Flags1.INITIAL_RUN_PHASE, ($+5) ; Do not increment beyond startup phase
0009DC 0500       F   26514             inc     Startup_Cnt                                     ; Increment counter
0009DE 8010           26515             jmp     eval_comp_exit
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   429

                      26516     
0009E0                26517     eval_comp_check_timeout:
0009E0 30000D         26518             jnb     Flags0.COMP_TIMED_OUT, eval_comp_exit   ; Has timeout elapsed?
0009E3 20000A         26519             jb      Flags1.DIR_CHANGE_BRAKE, eval_comp_exit ; Do not exit run mode if it is 
                               braking
0009E6 200007         26520             jb      Flags0.DEMAG_DETECTED, eval_comp_exit   ; Do not exit run mode if it is 
                               a demag situation
0009E9 1581           26521             dec     SP                                                              ; Routin
                               e exit without "ret" command
0009EB 1581           26522             dec     SP
0009ED 020000     F   26523             ljmp    run_to_wait_for_power_on_fail                   ; Yes - exit run mode
                      26524     
0009F0                26525     eval_comp_exit:
0009F0 22             26526             ret
                      26527     
                      26528     
                      26529     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26530     ;
                      26531     ; Wait for commutation routine
                      26532     ;
                      26533     ; No assumptions
                      26534     ;
                      26535     ; Waits from zero cross to commutation 
                      26536     ;
                      26537     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0009F1                26538     wait_for_comm: 
                      26539             ; Update demag metric
0009F1 7800           26540             mov     Temp1, #0
0009F3 300002         26541             jnb     Flags0.DEMAG_DETECTED, ($+5)
                      26542     
0009F6 7801           26543             mov     Temp1, #1
                      26544     
0009F8 E500       F   26545             mov     A, Demag_Detected_Metric        ; Sliding average of 8, 256 when demag a
                               nd 0 when not. Limited to minimum 120
0009FA 75F007         26546             mov     B, #7
0009FD A4             26547             mul     AB                                      ; Multiply by 7
0009FE F9             26548             mov     Temp2, A
0009FF E5F0           26549             mov     A, B                                    ; Add new value for current dema
                               g status
000A01 28             26550             add     A, Temp1                                
000A02 F5F0           26551             mov     B, A
000A04 E9             26552             mov     A, Temp2
000A05 A2F0           26553             mov     C, B.0                          ; Divide by 8
000A07 13             26554             rrc     A                                       
000A08 A2F1           26555             mov     C, B.1
000A0A 13             26556             rrc     A
000A0B A2F2           26557             mov     C, B.2
000A0D 13             26558             rrc     A
000A0E F500       F   26559             mov     Demag_Detected_Metric, A
000A10 C3             26560             clr     C
000A11 9478           26561             subb    A, #120                         ; Limit to minimum 120
000A13 5003           26562             jnc     ($+5)
                      26563     
000A15 750078     F   26564             mov     Demag_Detected_Metric, #120
                      26565     
000A18 C3             26566             clr     C
000A19 E500       F   26567             mov     A, Demag_Detected_Metric        ; Check demag metric
000A1B 9500       F   26568             subb    A, Demag_Pwr_Off_Thresh
000A1D 400B           26569             jc      wait_for_comm_wait              ; Cut power if many consecutive demags. 
                               This will help retain sync during hard accelerations
                      26570     
000A1F D200       F   26571             setb    Flags0.DEMAG_CUT_POWER  ; Set demag power cut flag
                      26572+1           All_pwmFETs_off
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   430

                      26582+1           Set_Pwms_Off
                      26584     
000A2A                26585     wait_for_comm_wait:
000A2A 300002         26586             jnb Flags0.T3_PENDING, ($+5)                    
000A2D 0100       F   26587             ajmp    wait_for_comm_wait
                      26588     
                      26589             ; Setup next wait time
000A2F 850092     F   26590             mov     TMR3RLL, Wt_Zc_Scan_Start_L
000A32 850093     F   26591             mov     TMR3RLH, Wt_Zc_Scan_Start_H
000A35 D200       F   26592             setb    Flags0.T3_PENDING
000A37 43E680         26593             orl     EIE1, #80h                      ; Enable timer 3 interrupts
000A3A 22             26594             ret
                      26595     
                      26596     
                      26597     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26598     ;
                      26599     ; Commutation routines
                      26600     ;
                      26601     ; No assumptions
                      26602     ;
                      26603     ; Performs commutation switching 
                      26604     ;
                      26605     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26606     ; Comm phase 1 to comm phase 2
000A3B                26607     comm1comm2:     
                      26608+1           Set_RPM_Out
000A3B 200010         26609             jb      Flags3.PGM_DIR_REV, comm12_rev
                      26610     
000A3E C2AF           26611             clr     IE_EA                           ; Disable all interrupts
                      26612+1           BcomFET_off                             ; Turn off comfet
                      26614+1           AcomFET_on                              ; Turn on comfet
                      26619+1           Set_Pwm_C                                       ; To reapply power after a demag
                                cut
000A47 D2AF           26626             setb    IE_EA
                      26627+1           Set_Comp_Phase_B                        ; Set comparator phase
000A4C 0100       F   26629             jmp     comm_exit
                      26630     
000A4E                26631     comm12_rev:     
000A4E C2AF           26632             clr     IE_EA                           ; Disable all interrupts
                      26633+1           BcomFET_off                             ; Turn off comfet
                      26635+1           CcomFET_on                              ; Turn on comfet (reverse)
                      26640+1           Set_Pwm_A                                       ; To reapply power after a demag
                                cut
000A57 D2AF           26647             setb    IE_EA
                      26648+1           Set_Comp_Phase_B                        ; Set comparator phase
000A5C 0100       F   26650             jmp     comm_exit
                      26651     
                      26652     
                      26653     ; Comm phase 2 to comm phase 3
000A5E                26654     comm2comm3:     
                      26655+1           Clear_RPM_Out
000A5E 200010         26656             jb      Flags3.PGM_DIR_REV, comm23_rev
                      26657     
000A61 C2AF           26658             clr     IE_EA                           ; Disable all interrupts
                      26659+1           CpwmFET_off                             ; Turn off pwmfet
                      26665+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
                      26672+1           AcomFET_on                              
000A6A D2AF           26677             setb    IE_EA
                      26678+1           Set_Comp_Phase_C                        ; Set comparator phase
000A6F 0100       F   26680             ajmp    comm_exit
                      26681     
000A71                26682     comm23_rev:
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   431

000A71 C2AF           26683             clr     IE_EA                           ; Disable all interrupts
                      26684+1           ApwmFET_off                             ; Turn off pwmfet (reverse)
                      26690+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
                      26697+1           CcomFET_on                              
000A7A D2AF           26702             setb    IE_EA
                      26703+1           Set_Comp_Phase_A                        ; Set comparator phase (reverse)
000A7F 0100       F   26705             ajmp    comm_exit
                      26706     
                      26707     
                      26708     ; Comm phase 3 to comm phase 4
000A81                26709     comm3comm4:     
                      26710+1           Set_RPM_Out
000A81 200010         26711             jb      Flags3.PGM_DIR_REV, comm34_rev
                      26712     
000A84 C2AF           26713             clr     IE_EA                           ; Disable all interrupts
                      26714+1           AcomFET_off                             ; Turn off comfet
                      26716+1           CcomFET_on                              ; Turn on comfet
                      26721+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
000A8D D2AF           26728             setb    IE_EA
                      26729+1           Set_Comp_Phase_A                        ; Set comparator phase
000A92 8077           26731             jmp     comm_exit
                      26732     
000A94                26733     comm34_rev:     
000A94 C2AF           26734             clr     IE_EA                           ; Disable all interrupts
                      26735+1           CcomFET_off                             ; Turn off comfet (reverse)
                      26737+1           AcomFET_on                              ; Turn on comfet (reverse)
                      26742+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
000A9D D2AF           26749             setb    IE_EA
                      26750+1           Set_Comp_Phase_C                        ; Set comparator phase (reverse)
000AA2 8067           26752             jmp     comm_exit
                      26753     
                      26754     
                      26755     ; Comm phase 4 to comm phase 5
000AA4                26756     comm4comm5:     
                      26757+1           Clear_RPM_Out
000AA4 200010         26758             jb      Flags3.PGM_DIR_REV, comm45_rev
                      26759     
000AA7 C2AF           26760             clr     IE_EA                           ; Disable all interrupts
                      26761+1           BpwmFET_off                             ; Turn off pwmfet
                      26767+1           Set_Pwm_A
                      26774+1           CcomFET_on                              ; To reapply power after a demag cut
000AB0 D2AF           26779             setb    IE_EA
                      26780+1           Set_Comp_Phase_B                        ; Set comparator phase
000AB5 8054           26782             jmp     comm_exit
                      26783     
000AB7                26784     comm45_rev:
000AB7 C2AF           26785             clr     IE_EA                           ; Disable all interrupts
                      26786+1           BpwmFET_off                             ; Turn off pwmfet
                      26792+1           Set_Pwm_C
                      26799+1           AcomFET_on                              ; To reapply power after a demag cut
000AC0 D2AF           26804             setb    IE_EA
                      26805+1           Set_Comp_Phase_B                        ; Set comparator phase
000AC5 8044           26807             jmp     comm_exit
                      26808     
                      26809     
                      26810     ; Comm phase 5 to comm phase 6
000AC7                26811     comm5comm6:     
                      26812+1           Set_RPM_Out
000AC7 200010         26813             jb      Flags3.PGM_DIR_REV, comm56_rev
                      26814     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   432

000ACA C2AF           26815             clr     IE_EA                           ; Disable all interrupts
                      26816+1           CcomFET_off                             ; Turn off comfet
                      26818+1           BcomFET_on                              ; Turn on comfet
                      26823+1           Set_Pwm_A                                       ; To reapply power after a demag
                                cut
000AD3 D2AF           26830             setb    IE_EA
                      26831+1           Set_Comp_Phase_C                        ; Set comparator phase
000AD8 8031           26833             jmp     comm_exit
                      26834     
000ADA                26835     comm56_rev:
000ADA C2AF           26836             clr     IE_EA                           ; Disable all interrupts
                      26837+1           AcomFET_off                             ; Turn off comfet (reverse)
                      26839+1           BcomFET_on                              ; Turn on comfet
                      26844+1           Set_Pwm_C                                       ; To reapply power after a demag
                                cut
000AE3 D2AF           26851             setb    IE_EA
                      26852+1           Set_Comp_Phase_A                        ; Set comparator phase (reverse)
000AE8 8021           26854             jmp     comm_exit
                      26855     
                      26856     
                      26857     ; Comm phase 6 to comm phase 1
000AEA                26858     comm6comm1:     
                      26859+1           Clear_RPM_Out
000AEA 200010         26860             jb      Flags3.PGM_DIR_REV, comm61_rev
                      26861     
000AED C2AF           26862             clr     IE_EA                           ; Disable all interrupts
                      26863+1           ApwmFET_off                             ; Turn off pwmfet
                      26869+1           Set_Pwm_C
                      26876+1           BcomFET_on                              ; To reapply power after a demag cut
000AF6 D2AF           26881             setb    IE_EA
                      26882+1           Set_Comp_Phase_A                        ; Set comparator phase
000AFB 800E           26884             jmp     comm_exit
                      26885     
000AFD                26886     comm61_rev:
000AFD C2AF           26887             clr     IE_EA                           ; Disable all interrupts
                      26888+1           CpwmFET_off                             ; Turn off pwmfet (reverse)
                      26894+1           Set_Pwm_A
                      26901+1           BcomFET_on                              ; To reapply power after a demag cut
000B06 D2AF           26906             setb    IE_EA
                      26907+1           Set_Comp_Phase_C                        ; Set comparator phase (reverse)
                      26909     
000B0B                26910     comm_exit:
000B0B C200       F   26911             clr     Flags0.DEMAG_CUT_POWER  ; Clear demag power cut flag
000B0D 22             26912             ret
                      26913     
                      26914     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
                      26915     ;               
                      26916     ; Beeper routines (4 different entry points)            
                      26917     ;               
                      26918     ; No assumptions                
                      26919     ;               
                      26920     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
000B0E                26921     beep_f1:        ; Entry point 1, load beeper frequency 1 settings               
000B0E 200068         26922             jb      Flags3.CZ_TONES, beep_cz1               
000B11 7A14           26923             mov     Temp3, #20      ; Off wait loop length          
000B13 7BC8           26924             mov     Temp4, #200     ; Number of beep pulses         
000B15 8019           26925             jmp     beep
                      26926                             
000B17                26927     beep_f2:        ; Entry point 2, load beeper frequency 2 settings               
000B17 200069         26928             jb      Flags3.CZ_TONES, beep_cz2               
000B1A 7A10           26929             mov     Temp3, #16              
000B1C 7B8C           26930             mov     Temp4, #140             
000B1E 8010           26931             jmp     beep    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   433

                      26932                     
000B20                26933     beep_f3:        ; Entry point 3, load beeper frequency 3 settings               
000B20 20006A         26934             jb      Flags3.CZ_TONES, beep_cz3               
000B23 7A0D           26935             mov     Temp3, #13              
000B25 7BB4           26936             mov     Temp4, #180             
000B27 8007           26937             jmp     beep
                      26938                             
000B29                26939     beep_f4:        ; Entry point 4, load beeper frequency 4 settings               
000B29 20006B         26940             jb      Flags3.CZ_TONES, beep_cz4               
000B2C 7A0B           26941             mov     Temp3, #11              
000B2E 7BC8           26942             mov     Temp4, #200             
                      26943                             
000B30                26944     beep:           ; Beep loop start               
000B30 300001         26945             jnb     Flags3.MUTE, beep_start
000B33 22             26946             ret     
000B34                26947     beep_start:             
000B34 7902           26948             mov     Temp2, #2               
000B36                26949     beep_onoff:             
000B36 E4             26950             clr     A               
                      26951+1           BcomFET_off             ; BcomFET off           
000B39 D5E0FD         26953             djnz    ACC, $          ; Allow some time after comfet is turned off            
                      26954+1           BpwmFET_on              ; BpwmFET on (in order to charge the driver of the BcomF
                               ET)             
000B3E D5E0FD         26959             djnz    ACC, $          ; Let the pwmfet be turned on a while           
                      26960+1           BpwmFET_off             ; BpwmFET off again             
000B43 D5E0FD         26966             djnz    ACC, $          ; Allow some time after pwmfet is turned off            
                      26967+1           BcomFET_on              ; BcomFET on            
000B48 D5E0FD         26972             djnz    ACC, $          ; Allow some time after comfet is turned on             
                      26973             ; Turn on pwmfet                
000B4B E9             26974             mov     A, Temp2                
000B4C 20E002         26975             jb      ACC.0, beep_apwmfet_on          
                      26976+1           ApwmFET_on              ; ApwmFET on            
000B51                26981     beep_apwmfet_on:                
000B51 30E002         26982             jnb     ACC.0, beep_cpwmfet_on          
                      26983+1           CpwmFET_on              ; CpwmFET on            
000B56                26988     beep_cpwmfet_on:                
000B56 E500       F   26989             mov     A, Beep_Strength                
000B58 D5E0FD         26990             djnz    ACC, $                          
                      26991             ; Turn off pwmfet               
000B5B E9             26992             mov     A, Temp2                
000B5C 20E002         26993             jb      ACC.0, beep_apwmfet_off         
                      26994+1           ApwmFET_off             ; ApwmFET off           
000B61                27000     beep_apwmfet_off:               
000B61 30E002         27001             jnb     ACC.0, beep_cpwmfet_off         
                      27002+1           CpwmFET_off             ; CpwmFET off           
000B66                27008     beep_cpwmfet_off:               
000B66 7496           27009             mov     A, #150         ; 25s off             
000B68 D5E0FD         27010             djnz    ACC, $                          
000B6B D9C9           27011             djnz    Temp2, beep_onoff               
                      27012             ; Copy variable         
000B6D EA             27013             mov     A, Temp3                
000B6E F8             27014             mov     Temp1, A                        
000B6F                27015     beep_off:               ; Fets off loop         
000B6F D5E0FD         27016             djnz    ACC, $          
000B72 D8FB           27017             djnz    Temp1,  beep_off                
000B74 DBBE           27018             djnz    Temp4,  beep_start              
                      27019+1           BcomFET_off             ; BcomFET off           
000B78 22             27021             ret             
                      27022     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
                      27023     ;               
                      27024     ; Tone Engine for Inc/Dec/Variable Tones                
                      27025     ;               
                      27026     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   434

000B79                27027     beep_cz1:                               
000B79 7A50           27028             mov     Temp3, #80              ; total tone play length                        
                                       
000B7B 7C50           27029             mov     Temp5, #80              ; number of delay loops to set starting frequenc
                               y, frequency will increase as count is decremented.                             
000B7D 7B05           27030             mov Temp4, #5                   ; number of times to repeat tone at each fequenc
                               y.                              
000B7F 7D14           27031             mov Temp6, #20                  ; size of base delay (highest frequency tone cei
                               ling)                                           
000B81 8040           27032             jmp mute_check          
                      27033                                             
000B83                27034     beep_cz2:                               
000B83 7A32           27035             mov     Temp3, #50                              
000B85 7C28           27036             mov     Temp5, #40                              
000B87 7B14           27037             mov Temp4, #20                          
000B89 7D28           27038             mov Temp6, #40                          
000B8B 8036           27039             jmp mute_check          
                      27040                                             
000B8D                27041     beep_cz3:                               
000B8D 7A3C           27042             mov     Temp3, #60                              
000B8F 7CB4           27043             mov     Temp5, #180                             
000B91 7B04           27044             mov Temp4, #4                           
000B93 7D0A           27045             mov Temp6, #10                                          
000B95 802C           27046             jmp mute_check          
                      27047                             
000B97                27048     beep_cz4:                               
000B97 7A96           27049             mov     Temp3, #150                             
000B99 7C32           27050             mov     Temp5, #50                              
000B9B 7B02           27051             mov Temp4, #2                           
000B9D 7D1E           27052             mov Temp6, #30                          
000B9F 8022           27053             jmp mute_check
                      27054                             
000BA1                27055     beep_beacon:            
000BA1 7A64           27056             mov Temp3, #100         ; number of itterations of the tone loop to run.        
                                                       
000BA3 7C28           27057             mov Temp5, #40          ; starting tone (in number of delay cycles) for decremen
                               ting delay (increasing frequency)               
000BA5 7B05           27058             mov Temp4, #5           ; number of times to repeat inner loop at each fequency 
                               before.                         
000BA7 7D0F           27059             mov Temp6, #15          ; base delay            
000BA9 8018           27060             jmp mute_check          
                      27061                             
000BAB                27062     startup_wave1:                          
000BAB 7800       F   27063             mov     Temp1, #Pgm_Direction                                   
000BAD E6             27064             mov     A, @Temp1                               
000BAE 14             27065             dec A                           
                      27066     ;       jnz startup_wave2                               
000BAF D200       F   27067             setb Flags3.TONE_WAVE                           
000BB1 7AC8           27068             mov     Temp3, #200             ; number of itterations of the tone loop to run.
                                               
000BB3 7C32           27069             mov     Temp5, #50              ; starting tone (in number of delay cycles) for 
                               decrementing delay (increasing frequency)                               
000BB5 7B03           27070             mov Temp4, #3           ; number of times to repeat inner loop at each fequency 
                               before.                         
000BB7 7D3C           27071             mov Temp6, #60          ; base delay                            
000BB9 8008           27072             jmp mute_check          
                      27073                                             
000BBB                27074     startup_wave2:                          
000BBB 7AC8           27075             mov     Temp3, #200             ; number of itterations of the tone loop to run.
                                                               
000BBD 7C50           27076             mov     Temp5, #80              ; starting tone (in number of delay cycles) for 
                               decrementing delay (increasing frequency)                               
000BBF 7B05           27077             mov Temp4, #5           ; number of times to repeat inner loop at each fequency 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   435

                               before.                         
000BC1 7D46           27078             mov Temp6, #70          ; base delay            
                      27079                             
000BC3                27080     mute_check:             
000BC3 300001         27081             jnb Flags3.MUTE, music_outer_loop               
000BC6 22             27082             ret                     
                      27083                             
000BC7                27084     music_outer_loop:                               
000BC7 EB             27085             mov A, Temp4                            
000BC8 F8             27086             mov Temp1, A                    ; load temp1 with temp4 value, work with temp1 p
                               reserve temp4.                          
000BC9 300015         27087             jnb Flags3.TONE_WAVE, no_wave                           
000BCC 200009         27088             jb Flags3.TONE_DIR, inc_tone                            
000BCF 1C             27089             dec Temp5                               
000BD0 EC             27090             mov A, Temp5                            
000BD1 B40112         27091             cjne A, #1, music_inner_loop                            
000BD4 B200       F   27092             cpl Flags3.TONE_DIR                             
000BD6 800E           27093             jmp music_inner_loop                            
                      27094                                             
000BD8                27095     inc_tone:                               
000BD8 0C             27096             inc Temp5                               
000BD9 EC             27097             mov A, Temp5                            
000BDA B43209         27098             cjne A, #50, music_inner_loop                           
000BDD B200       F   27099             cpl Flags3.TONE_DIR                             
000BDF 8005           27100             jmp music_inner_loop                            
                      27101                                             
000BE1                27102     no_wave:                                        
000BE1 1C             27103             dec Temp5                               ; decrement frequency delay loop count  
                                                               
000BE2 EC             27104             mov A, Temp5                            
000BE3 7001           27105             jnz music_inner_loop                            
000BE5 0C             27106             inc Temp5                               
                      27107                                             
000BE6                27108     music_inner_loop:                               
000BE6 EC             27109             Mov A, Temp5            ; push variables onto the stack to preserve them during 
                               fet on/off macro                                
000BE7 C0E0           27110             Push ACC                                
000BE9 E8             27111             Mov A, Temp1                            
000BEA C0E0           27112             Push ACC                                
000BEC ED             27113             Mov A, Temp6                            
000BED C0E0           27114             Push ACC                                
                      27115                             
000BEF 30000F         27116             jnb Flags3.FET_SWAP, tone_BC                            
                      27117+1           BcomFET_on              ; BcomFET on                            
                      27122+1           ApwmFET_on              ; ApwmFET on                            
000BF6 E500       F   27127             mov     A, Beep_Strength                                
000BF8 D5E0FD         27128             djnz    ACC, $                                          
                      27129+1           ApwmFET_off             ; ApwmFET off                           
                      27135+1           BcomFET_off             ; BcomFET off                           
000BFF 800D           27137             jmp tone_AB                                     
000C01                27138     tone_BC:                                        
                      27139+1           BcomFET_on              ; BcomFET on                            
                      27144+1           CpwmFET_on              ; CpwmFET on                            
000C05 E500       F   27149             mov     A, Beep_Strength                                
000C07 D5E0FD         27150             djnz    ACC, $                                          
                      27151+1           CpwmFET_off             ; CpwmFET off                           
                      27157+1           BcomFET_off             ; BcomFET off                           
000C0E                27159     tone_AB:                                
000C0E B200       F   27160             cpl Flags3.FET_SWAP                                     
000C10 D0E0           27161             Pop ACC                         
000C12 FD             27162             mov Temp6, A                            
000C13 FE             27163             mov Temp7, A                            
000C14 D0E0           27164             Pop ACC                         ; pop variables off the stack, and restore them.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   436

                                                               
000C16 F8             27165             Mov Temp1, A                            
000C17 D0E0           27166             Pop ACC                                                         
000C19 FC             27167             Mov Temp5, A                            
000C1A F9             27168             Mov Temp2, A            ; make copy of temp5 to work with.                      
                                       
                      27169                                                     ; run minimum delay loop to keep our ton
                               e within the frquency range we're after (~3khz-800hz ideally)                           
000C1B                27170     music_base_delay:                               
000C1B 7464           27171             mov     A, #100                                                                 
                               ;30us wait                              
000C1D D5E0FD         27172             djnz    ACC, $                                                                  
                               ; timing delay                          
000C20 DEF9           27173             djnz    Temp7, music_base_delay                         ; base delay loop run co
                               unt                             
000C22                27174     music_variable_delay:                                                           ; changi
                               ng delay (adjust tone frequency)                                
000C22 744B           27175             mov     A, #75                                                                  
                                       ; 17us wait                             
000C24 D5E0FD         27176             djnz    ACC, $                                          ; timing delay          
                                               
000C27 D9F9           27177             djnz    Temp2, music_variable_delay                     ; run this loop #Temp5 t
                               imes                            
000C29 2000BA         27178             jb              Flags3.FET_SWAP, music_inner_loop               
000C2C D8B8           27179             djnz    Temp1, music_inner_loop                                 ;               
000C2E DA01           27180             djnz    Temp3, dec_again                
000C30 22             27181             ret             
000C31                27182     dec_again:                      
000C31 DA94           27183             djnz    Temp3, music_outer_loop                             ; total length of to
                               ne                              
000C33 22             27184             ret                                     
                      27185                             
                      27186     
                      27187     
                      27188     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27189     ;
                      27190     ; Switch power off routine
                      27191     ;
                      27192     ; No assumptions
                      27193     ;
                      27194     ; Switches all fets off 
                      27195     ;
                      27196     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000C34                27197     switch_power_off:
                      27198+1           All_pwmFETs_Off         ; Turn off all pwm fets
                      27208+1           All_comFETs_Off         ; Turn off all commutation fets
                      27212+1           Set_Pwms_Off
000C43 22             27214             ret                     
                      27215     
                      27216     
                      27217     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27218     ;
                      27219     ; Set default parameters
                      27220     ;
                      27221     ; No assumptions
                      27222     ;
                      27223     ; Sets default programming parameters
                      27224     ;
                      27225     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000C44                27226     set_default_parameters:
000C44 7800       F   27227             mov     Temp1, #_Pgm_Gov_P_Gain
000C46 76FF           27228             mov     @Temp1, #0FFh   ; Governor P gain
000C48 08             27229             inc     Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   437

000C49 76FF           27230             mov     @Temp1, #0FFh   ; Governor I gain
000C4B 08             27231             inc     Temp1
000C4C 76FF           27232             mov     @Temp1, #0FFh   ; Governor mode
000C4E 08             27233             inc     Temp1
000C4F 76FF           27234             mov     @Temp1, #0FFh   ; Low voltage limit
000C51 08             27235             inc     Temp1
000C52 76FF           27236             mov     @Temp1, #0FFh   ; Multi gain
000C54 08             27237             inc     Temp1
000C55 76FF           27238             mov     @Temp1, #0FFh   
000C57 08             27239             inc     Temp1
000C58 7605           27240             mov     @Temp1, #DEFAULT_PGM_STARTUP_PWR
000C5A 08             27241             inc     Temp1
000C5B 76FF           27242             mov     @Temp1, #0FFh   ; Pwm freq
000C5D 08             27243             inc     Temp1
000C5E 7601           27244             mov     @Temp1, #DEFAULT_PGM_DIRECTION
                      27245     
000C60 7800       F   27246             mov     Temp1, #Pgm_Enable_TX_Program
000C62 7601           27247             mov     @Temp1, #DEFAULT_PGM_ENABLE_TX_PROGRAM
000C64 08             27248             inc     Temp1
000C65 76FF           27249             mov     @Temp1, #0FFh   ; Main rearm start
000C67 08             27250             inc     Temp1
000C68 76FF           27251             mov     @Temp1, #0FFh   ; Governor setup target
000C6A 08             27252             inc     Temp1
000C6B 76FF           27253             mov     @Temp1, #0FFh   ; Startup rpm   
000C6D 08             27254             inc     Temp1
000C6E 76FF           27255             mov     @Temp1, #0FFh   ; Startup accel
000C70 08             27256             inc     Temp1
000C71 76FF           27257             mov     @Temp1, #0FFh   ; Voltage comp
000C73 08             27258             inc     Temp1
000C74 7603           27259             mov     @Temp1, #DEFAULT_PGM_COMM_TIMING
000C76 08             27260             inc     Temp1
000C77 76FF           27261             mov     @Temp1, #0FFh   ; Damping force 
000C79 08             27262             inc     Temp1
000C7A 76FF           27263             mov     @Temp1, #0FFh   ; Governor range
000C7C 08             27264             inc     Temp1
000C7D 76FF           27265             mov     @Temp1, #0FFh   ; Startup method        
000C7F 08             27266             inc     Temp1
000C80 760A           27267             mov     @Temp1, #DEFAULT_PGM_MIN_THROTTLE
000C82 08             27268             inc     Temp1
000C83 76F0           27269             mov     @Temp1, #DEFAULT_PGM_MAX_THROTTLE
000C85 08             27270             inc     Temp1
000C86 765B           27271             mov     @Temp1, #DEFAULT_PGM_BEEP_STRENGTH
000C88 08             27272             inc     Temp1
000C89 7650           27273             mov     @Temp1, #DEFAULT_PGM_BEACON_STRENGTH
000C8B 08             27274             inc     Temp1
000C8C 7603           27275             mov     @Temp1, #DEFAULT_PGM_BEACON_DELAY
000C8E 08             27276             inc     Temp1
000C8F 76FF           27277             mov     @Temp1, #0FFh   ; Throttle rate 
000C91 08             27278             inc     Temp1
000C92 7603           27279             mov     @Temp1, #DEFAULT_PGM_DEMAG_COMP
000C94 08             27280             inc     Temp1
000C95 76FF           27281             mov     @Temp1, #0FFh   ; Bec voltage high
000C97 08             27282             inc     Temp1
000C98 767D           27283             mov     @Temp1, #DEFAULT_PGM_CENTER_THROTTLE
000C9A 08             27284             inc     Temp1
000C9B 76FF           27285             mov     @Temp1, #0FFh   
000C9D 08             27286             inc     Temp1
000C9E 7606           27287             mov     @Temp1, #DEFAULT_PGM_ENABLE_TEMP_PROT
000CA0 08             27288             inc     Temp1
000CA1 7601           27289             mov     @Temp1, #DEFAULT_PGM_ENABLE_POWER_PROT
000CA3 08             27290             inc     Temp1
000CA4 76FF           27291             mov     @Temp1, #0FFh   ; Enable pwm input
000CA6 08             27292             inc     Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   438

000CA7 76FF           27293             mov     @Temp1, #0FFh   ; Pwm dither
000CA9 08             27294             inc     Temp1
000CAA 7601           27295             mov     @Temp1, #DEFAULT_PGM_BRAKE_ON_STOP
000CAC 08             27296             inc     Temp1
000CAD 7601           27297             mov     @Temp1, #DEFAULT_PGM_LED_CONTROL
000CAF 22             27298             ret
                      27299     
                      27300     
                      27301     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27302     ;
                      27303     ; Scale throttle cal
                      27304     ;
                      27305     ; No assumptions
                      27306     ;
                      27307     ; Scales a throttle cal value
                      27308     ; Input is ACC, output is Temp2/Temp1
                      27309     ;
                      27310     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000CB0                27311     scale_throttle_cal:
000CB0 FA             27312             mov     Temp3, A
000CB1 75F00C         27313             mov     B, #0Ch                 ; Calculate "3%" (for going from 1000us to numer
                               ical 1024)
000CB4 A4             27314             mul     AB
000CB5 ABF0           27315             mov     Temp4, B
000CB7 EA             27316             mov     A, Temp3
000CB8 C3             27317             clr     C                               ; Shift to 9 bits
000CB9 33             27318             rlc     A
000CBA F8             27319             mov     Temp1, A
000CBB 7401           27320             mov     A, #1
000CBD 33             27321             rlc     A
000CBE F9             27322             mov     Temp2, A
000CBF E8             27323             mov     A, Temp1                        ; Shift to 10 bits
000CC0 C3             27324             clr     C
000CC1 33             27325             rlc     A
000CC2 F8             27326             mov     Temp1, A
000CC3 E9             27327             mov     A, Temp2
000CC4 33             27328             rlc     A
000CC5 F9             27329             mov     Temp2, A
000CC6 E8             27330             mov     A, Temp1                        ; Add "3%"
000CC7 C3             27331             clr     C
000CC8 2B             27332             add     A, Temp4
000CC9 F8             27333             mov     Temp1, A
000CCA E9             27334             mov     A, Temp2
000CCB 3400           27335             addc    A, #0
000CCD F9             27336             mov     Temp2, A
                      27337     IF 1 == 1
000CCE E8             27338             mov     A, Temp1                        ; Shift to 11 bits
000CCF C3             27339             clr     C
000CD0 33             27340             rlc     A
000CD1 F8             27341             mov     Temp1, A
000CD2 E9             27342             mov     A, Temp2
000CD3 33             27343             rlc     A
000CD4 F9             27344             mov     Temp2, A
                      27345     ENDIF
000CD5 22             27346     ret
                      27347     
                      27348     
                      27349     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27350     ;
                      27351     ; Decode settings
                      27352     ;
                      27353     ; No assumptions
                      27354     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   439

                      27355     ; Decodes various settings
                      27356     ;
                      27357     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000CD6                27358     decode_settings:
                      27359             ; Load programmed direction
000CD6 7800       F   27360             mov     Temp1, #Pgm_Direction   
000CD8 E6             27361             mov     A, @Temp1                               
000CD9 C3             27362             clr     C
000CDA 9403           27363             subb    A, #3
000CDC D200       F   27364             setb    Flags3.PGM_BIDIR
000CDE 5002           27365             jnc     ($+4)
                      27366     
000CE0 C200       F   27367             clr     Flags3.PGM_BIDIR
                      27368     
000CE2 C200       F   27369             clr     Flags3.PGM_DIR_REV
000CE4 E6             27370             mov     A, @Temp1                               
000CE5 30E102         27371             jnb     ACC.1, ($+5)
000CE8 D200       F   27372             setb    Flags3.PGM_DIR_REV
000CEA A200       F   27373             mov     C, Flags3.PGM_DIR_REV
000CEC 9200       F   27374             mov     Flags3.PGM_BIDIR_REV, C
                      27375             ; Decode startup power
000CEE 7800       F   27376             mov     Temp1, #Pgm_Startup_Pwr         
000CF0 E6             27377             mov     A, @Temp1                               
000CF1 14             27378             dec     A       
000CF2 900000     F   27379             mov     DPTR, #STARTUP_POWER_TABLE
000CF5 93             27380             movc A, @A+DPTR 
000CF6 7800       F   27381             mov     Temp1, #Pgm_Startup_Pwr_Decoded
000CF8 F6             27382             mov     @Temp1, A       
                      27383             ; Decode low rpm power slope
000CF9 7800       F   27384             mov     Temp1, #Pgm_Startup_Pwr
000CFB E6             27385             mov     A, @Temp1
000CFC F500       F   27386             mov     Low_Rpm_Pwr_Slope, A
000CFE C3             27387             clr     C
000CFF 9402           27388             subb    A, #2
000D01 5003           27389             jnc     ($+5)
000D03 750002     F   27390             mov     Low_Rpm_Pwr_Slope, #2
                      27391             ; Decode demag compensation
000D06 7800       F   27392             mov     Temp1, #Pgm_Demag_Comp          
000D08 E6             27393             mov     A, @Temp1                               
000D09 7500FF     F   27394             mov     Demag_Pwr_Off_Thresh, #255      ; Set default
                      27395     
000D0C B40203         27396             cjne    A, #2, decode_demag_high
                      27397     
000D0F 7500A0     F   27398             mov     Demag_Pwr_Off_Thresh, #160      ; Settings for demag comp low
                      27399     
000D12                27400     decode_demag_high:
000D12 B40303         27401             cjne    A, #3, decode_demag_done
                      27402     
000D15 750082     F   27403             mov     Demag_Pwr_Off_Thresh, #130      ; Settings for demag comp high
                      27404     
000D18                27405     decode_demag_done:
                      27406             ; Decode temperature protection limit
000D18 7800       F   27407             mov     Temp1, #Pgm_Enable_Temp_Prot
000D1A E6             27408             mov     A, @Temp1
000D1B F8             27409             mov     Temp1, A
000D1C 6006           27410             jz      decode_temp_done
                      27411     
000D1E 7428           27412             mov     A, #(TEMP_LIMIT-TEMP_LIMIT_STEP)
000D20                27413     decode_temp_step:
000D20 2409           27414             add     A, #TEMP_LIMIT_STEP
000D22 D8FC           27415             djnz    Temp1, decode_temp_step
                      27416     
000D24                27417     decode_temp_done:
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   440

000D24 F500       F   27418             mov     Temp_Prot_Limit, A
                      27419             ; Decode throttle cal
000D26 7800       F   27420             mov     Temp1, #Pgm_Min_Throttle                ; Throttle cal is in 4us units
000D28 E6             27421             mov     A, @Temp1
000D29 1100       F   27422             call    scale_throttle_cal
000D2B 8800       F   27423             mov     Min_Throttle_L, Temp1
000D2D 8900       F   27424             mov     Min_Throttle_H, Temp2
000D2F 7800       F   27425             mov     Temp1, #Pgm_Center_Throttle     ; Throttle cal is in 4us units
000D31 E6             27426             mov     A, @Temp1
000D32 1100       F   27427             call    scale_throttle_cal
000D34 8800       F   27428             mov     Center_Throttle_L, Temp1
000D36 8900       F   27429             mov     Center_Throttle_H, Temp2
000D38 7800       F   27430             mov     Temp1, #Pgm_Max_Throttle                ; Throttle cal is in 4us units
000D3A E6             27431             mov     A, @Temp1
000D3B 1100       F   27432             call    scale_throttle_cal
000D3D 8800       F   27433             mov     Max_Throttle_L, Temp1
000D3F 8900       F   27434             mov     Max_Throttle_H, Temp2
000D41 1100       F   27435             call    switch_power_off
000D43 22             27436             ret
                      27437     
                      27438     
                      27439     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27440     ;
                      27441     ; Find throttle gains
                      27442     ;
                      27443     ; No assumptions
                      27444     ;
                      27445     ; Finds throttle gains for both directions in bidirectional mode
                      27446     ;
                      27447     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000D44                27448     find_throttle_gains:
                      27449             ; Check if full range is chosen
000D44 300011         27450             jnb     Flags2.RCP_FULL_RANGE, find_throttle_gains_normal
                      27451     
000D47 7A00           27452             mov     Temp3, #0               ; Min throttle
000D49 7B00           27453             mov     Temp4, #0
000D4B 7CFF           27454             mov     Temp5, #255     ; Max throttle
000D4D 7D00           27455             mov     Temp6, #0
000D4F 7E00           27456             mov     Temp7, #0               ; Deadband
000D51 1100       F   27457             call    find_throttle_gain
000D53 8B00       F   27458             mov     Throttle_Gain_M, Temp4
000D55 8A00       F   27459             mov     Throttle_Gain, Temp3
000D57 22             27460             ret
                      27461     
000D58                27462     find_throttle_gains_normal:
                      27463             ; Check if bidirectional operation
000D58 300022         27464             jnb     Flags3.PGM_BIDIR, find_throttle_gains_bidir_done
                      27465     
000D5B 7800       F   27466             mov     Temp1, #Pgm_Min_Throttle
000D5D E6             27467             mov     A, @Temp1
000D5E FA             27468             mov     Temp3, A
000D5F 7B00           27469             mov     Temp4, #0
000D61 7800       F   27470             mov     Temp1, #Pgm_Center_Throttle
000D63 E6             27471             mov     A, @Temp1
000D64 FC             27472             mov     Temp5, A
000D65 7D00           27473             mov     Temp6, #0
000D67 C3             27474             clr     C
000D68 EA             27475             mov     A, Temp3                        ; Scale gains in bidirectional
000D69 33             27476             rlc     A
000D6A FA             27477             mov     Temp3, A
000D6B EB             27478             mov     A, Temp4
000D6C 33             27479             rlc     A
000D6D FB             27480             mov     Temp4, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   441

000D6E C3             27481             clr     C
000D6F EC             27482             mov     A, Temp5
000D70 33             27483             rlc     A
000D71 FC             27484             mov     Temp5, A
000D72 ED             27485             mov     A, Temp6
000D73 33             27486             rlc     A
000D74 FD             27487             mov     Temp6, A
000D75 7E0A           27488             mov     Temp7, #10              ; Compensate for deadband in bidirectional
000D77 1100       F   27489             call    find_throttle_gain
000D79 8B00       F   27490             mov     Throttle_Gain_BD_Rev_M, Temp4
000D7B 8A00       F   27491             mov     Throttle_Gain_BD_Rev, Temp3
                      27492     
000D7D                27493     find_throttle_gains_bidir_done:
000D7D 7800       F   27494             mov     Temp1, #Pgm_Min_Throttle
000D7F 300002         27495             jnb     Flags3.PGM_BIDIR, ($+5)
                      27496     
000D82 7800       F   27497             mov     Temp1, #Pgm_Center_Throttle
                      27498     
000D84 E6             27499             mov     A, @Temp1
000D85 FA             27500             mov     Temp3, A
000D86 7B00           27501             mov     Temp4, #0
000D88 7800       F   27502             mov     Temp1, #Pgm_Max_Throttle
000D8A E6             27503             mov     A, @Temp1
000D8B FC             27504             mov     Temp5, A
000D8C 7D00           27505             mov     Temp6, #0
000D8E 7E00           27506             mov     Temp7, #0                       ; No deadband
000D90 300010         27507             jnb     Flags3.PGM_BIDIR, find_throttle_gain_fwd
                      27508     
000D93 C3             27509             clr     C
000D94 EA             27510             mov     A, Temp3                        ; Scale gains in bidirectional
000D95 33             27511             rlc     A
000D96 FA             27512             mov     Temp3, A
000D97 EB             27513             mov     A, Temp4
000D98 33             27514             rlc     A
000D99 FB             27515             mov     Temp4, A
000D9A C3             27516             clr     C
000D9B EC             27517             mov     A, Temp5
000D9C 33             27518             rlc     A
000D9D FC             27519             mov     Temp5, A
000D9E ED             27520             mov     A, Temp6
000D9F 33             27521             rlc     A
000DA0 FD             27522             mov     Temp6, A
000DA1 7E0A           27523             mov     Temp7, #10              ; Compensate for deadband in bidirectional
                      27524     
000DA3                27525     find_throttle_gain_fwd:
000DA3 1100       F   27526             call    find_throttle_gain
000DA5 8B00       F   27527             mov     Throttle_Gain_M, Temp4
000DA7 8A00       F   27528             mov     Throttle_Gain, Temp3
000DA9 22             27529             ret
                      27530     
                      27531     
                      27532     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27533     ;
                      27534     ; Find throttle gain
                      27535     ;
                      27536     ; The difference between max and min throttle must be more than 140us (a Pgm_xxx_Throttl
                               e difference of 35)
                      27537     ; Temp4/3 holds min throttle, Temp6/5 holds max throttle, Temp7 holds deadband, Temp4/Te
                               mp3 gives resulting gain
                      27538     ;
                      27539     ; Finds throttle gain from throttle calibration values
                      27540     ;
                      27541     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   442

000DAA                27542     find_throttle_gain:
                      27543             ; Subtract deadband from max
000DAA C3             27544             clr     C
000DAB EC             27545             mov     A, Temp5
000DAC 9E             27546             subb    A, Temp7
000DAD FC             27547             mov     Temp5, A
000DAE ED             27548             mov     A, Temp6
000DAF 9400           27549             subb    A, #0
000DB1 FD             27550             mov     Temp6, A
                      27551             ; Calculate difference
000DB2 C3             27552             clr     C
000DB3 EC             27553             mov     A, Temp5
000DB4 9A             27554             subb    A, Temp3
000DB5 FC             27555             mov     Temp5, A
000DB6 ED             27556             mov     A, Temp6
000DB7 9B             27557             subb    A, Temp4
000DB8 FD             27558             mov     Temp6, A
                      27559             ; Check that difference is minimum 35
000DB9 C3             27560             clr     C
000DBA EC             27561             mov     A, Temp5
000DBB 9423           27562             subb    A, #35
000DBD ED             27563             mov     A, Temp6
000DBE 9400           27564             subb    A, #0
000DC0 5004           27565             jnc     ($+6)
                      27566     
000DC2 7C23           27567             mov     Temp5, #35
000DC4 7D00           27568             mov     Temp6, #0
                      27569     
                      27570             ; Check that difference is maximum 511
000DC6 C3             27571             clr     C
000DC7 EC             27572             mov     A, Temp5
000DC8 94FF           27573             subb    A, #255
000DCA ED             27574             mov     A, Temp6
000DCB 9401           27575             subb    A, #1
000DCD 4004           27576             jc      ($+6)
                      27577     
000DCF 7CFF           27578             mov     Temp5, #255
000DD1 7D01           27579             mov     Temp6, #1
                      27580     
                      27581             ; Find gain
000DD3 7BFF           27582             mov     Temp4, #0FFh
000DD5                27583     find_throttle_gain_loop:
000DD5 0B             27584             inc     Temp4
000DD6 7A00           27585             mov     Temp3, #0
000DD8                27586     test_throttle_gain:
000DD8 0A             27587             inc     Temp3
000DD9 EA             27588             mov     A, Temp3
000DDA 7009           27589             jnz     test_throttle_gain_mult
                      27590     
000DDC C3             27591             clr     C
000DDD EC             27592             mov     A, Temp5                        ; Set multiplier x2 and range /2
000DDE 33             27593             rlc     A
000DDF FC             27594             mov     Temp5, A
000DE0 ED             27595             mov     A, Temp6
000DE1 33             27596             rlc     A
000DE2 FD             27597             mov     Temp6, A
000DE3 0100       F   27598             ajmp    find_throttle_gain_loop
                      27599     
000DE5                27600     test_throttle_gain_mult:
000DE5 EC             27601             mov     A, Temp5                        ; A has difference, B has gain
000DE6 8AF0           27602             mov     B, Temp3
000DE8 A4             27603             mul     AB
000DE9 AEF0           27604             mov     Temp7, B
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   443

000DEB ED             27605             mov     A, Temp6
000DEC 8AF0           27606             mov     B, Temp3
000DEE A4             27607             mul     AB
000DEF 2E             27608             add     A, Temp7
000DF0 947C           27609             subb    A, #124
000DF2 40E4           27610             jc      test_throttle_gain
                      27611     
000DF4 EA             27612             mov     A, Temp3
000DF5 F4             27613             cpl     A
000DF6 60DD           27614             jz      find_throttle_gain_loop
                      27615     
000DF8 22             27616             ret
                      27617     
                      27618     
                      27619     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27620     ;
                      27621     ; Average throttle 
                      27622     ;
                      27623     ; Outputs result in Temp8
                      27624     ;
                      27625     ; Averages throttle calibration readings
                      27626     ;
                      27627     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000DF9                27628     average_throttle:
000DF9 D200       F   27629             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
000DFB 1100       F   27630             call    find_throttle_gains     ; Set throttle gains
000DFD 120000     F   27631             call wait30ms           
000E00 120000     F   27632             call wait30ms
000E03 7A00           27633             mov     Temp3, #0
000E05 7B00           27634             mov     Temp4, #0
000E07 7C10           27635             mov     Temp5, #16              ; Average 16 measurments
000E09                27636     average_throttle_meas:
000E09 120000     F   27637             call    wait3ms                 ; Wait for new RC pulse value
000E0C E500       F   27638             mov     A, New_Rcp              ; Get new RC pulse value
000E0E 2A             27639             add     A, Temp3
000E0F FA             27640             mov     Temp3, A
000E10 7400           27641             mov     A, #0
000E12 3B             27642             addc A, Temp4
000E13 FB             27643             mov     Temp4, A
000E14 DCF3           27644             djnz    Temp5, average_throttle_meas
                      27645     
000E16 7C04           27646             mov     Temp5, #4                       ; Shift 4 times
000E18                27647     average_throttle_div:
000E18 C3             27648             clr     C
000E19 EB             27649             mov     A, Temp4                ; Shift right 
000E1A 13             27650             rrc     A      
000E1B FB             27651             mov     Temp4, A   
000E1C EA             27652             mov     A, Temp3   
000E1D 13             27653             rrc     A      
000E1E FA             27654             mov     Temp3, A   
000E1F DCF7           27655             djnz    Temp5, average_throttle_div
                      27656     
000E21 FF             27657             mov     Temp8, A                ; Copy to Temp8
000E22 EB             27658             mov     A, Temp4
000E23 6002           27659             jz      ($+4)
                      27660     
000E25 7FFF           27661             mov     Temp8, #0FFh
                      27662     
000E27 C200       F   27663             clr     Flags2.RCP_FULL_RANGE
000E29 1100       F   27664             call    find_throttle_gains     ; Set throttle gains
000E2B 22             27665             ret
                      27666     
                      27667     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   444

                      27668     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27669     ;
                      27670     ; LED control
                      27671     ;
                      27672     ; No assumptions
                      27673     ;
                      27674     ; Controls LEDs
                      27675     ;
                      27676     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000E2C                27677     led_control:
000E2C 7800       F   27678             mov     Temp1, #Pgm_LED_Control
000E2E E6             27679             mov     A, @Temp1
000E2F F9             27680             mov     Temp2, A
000E30 5403           27681             anl     A, #03h
                      27682+1           Set_LED_0
000E32 7000           27683             jnz     led_0_done
                      27684+1           Clear_LED_0
000E34                27685     led_0_done:
000E34 E9             27686             mov     A, Temp2
000E35 540C           27687             anl     A, #0Ch
                      27688+1           Set_LED_1
000E37 7000           27689             jnz     led_1_done
                      27690+1           Clear_LED_1
000E39                27691     led_1_done:
000E39 E9             27692             mov     A, Temp2
000E3A 5430           27693             anl     A, #030h
                      27694+1           Set_LED_2
000E3C 7000           27695             jnz     led_2_done
                      27696+1           Clear_LED_2
000E3E                27697     led_2_done:
000E3E E9             27698             mov     A, Temp2
000E3F 54C0           27699             anl     A, #0C0h
                      27700+1           Set_LED_3
000E41 7000           27701             jnz     led_3_done
                      27702+1           Clear_LED_3
000E43                27703     led_3_done:
000E43 22             27704             ret
                      27705     
                      27706     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27707     ;               
                      27708     ;               Music Routines          
                      27709     ;               
                      27710     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
000E44                27711     music_a4:               
000E44 7ADC           27712             mov     Temp3, #220 ;55         ;length of tone         
000E46 7B36           27713             mov Temp4, #54                  ;number of delay loop1 cycles (tone frequency)  
                                       
000E48 7C02           27714             mov Temp5, #2                   ;number of delay loop2 cycles (octave range?/lar
                               ge step?)               
000E4A 0100       F   27715             jmp music
                      27716             
000E4C                27717     music_a4_sht:
000E4C 7A64           27718         mov Temp3, #100
000E4E 7B36           27719             mov Temp4, #54
000E50 7C02           27720             mov Temp5, #2
000E52 0100       F   27721             jmp music
                      27722                             
000E54                27723     music_as4:              
000E54 7A3A           27724             mov     Temp3, #58                              
000E56 7B1D           27725             mov Temp4, #29          
000E58 7C02           27726             mov Temp5, #2           
000E5A 0100       F   27727             jmp music       
                      27728     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   445

000E5C                27729     music_as4_lng:          
000E5C 7A5F           27730             mov     Temp3, #95                              
000E5E 7B1D           27731             mov Temp4, #29          
000E60 7C02           27732             mov Temp5, #2           
000E62 0100       F   27733             jmp music               
                      27734                             
000E64                27735     music_b4:               
000E64 7A3E           27736             mov     Temp3, #62                              
000E66 7B04           27737             mov Temp4, #4           
000E68 7C02           27738             mov Temp5, #2           
000E6A 806E           27739             jmp music               
                      27740                             
000E6C                27741     music_e4:               
000E6C 7AA4           27742             mov     Temp3, #164 ;41                                 
000E6E 7B06           27743             mov Temp4, #6           
000E70 7C03           27744             mov Temp5, #3           
000E72 8066           27745             jmp music               
                      27746                             
000E74                27747     music_f1:               
000E74 7ADE           27748             mov     Temp3, #222                                                             
                               ;length of tone         
000E76 7B6E           27749             mov Temp4, #110         
000E78 7C02           27750             mov Temp5, #2                                                                   
                               ;one ms ;frequency of tone 1=500, 2=1000, 3=1500                
000E7A 805E           27751             jmp music               
                      27752                             
000E7C                27753     music_f2:               
000E7C 7A84           27754             mov     Temp3, #132                                                             
                               ;length of tone         
000E7E 7B2B           27755             mov Temp4, #43          
000E80 7C03           27756             mov Temp5, #3                                                                   
                               ;one ms ;frequency of tone 1=500, 2=1000, 3=1500                
000E82 8056           27757             jmp music               
                      27758                             
000E84                27759     music_f3:               
000E84 7A84           27760             mov     Temp3, #132                                                             
                               ;length of tone         
000E86 7B1D           27761             mov Temp4, #29          
000E88 7C02           27762             mov Temp5, #2                                                                   
                               ;one ms ;frequency of tone 1=500, 2=1000, 3=1500                
000E8A 804E           27763             jmp music               
                      27764                             
000E8C                27765     music_f4:               
000E8C 7A58           27766             mov     Temp3, #88 ;44                          
000E8E 7BAC           27767             mov Temp4, #172         
000E90 7C02           27768             mov Temp5, #2           
000E92 8046           27769             jmp music               
                      27770                             
000E94                27771     music_g4:               
000E94 7A62           27772             mov     Temp3, #98 ;49                          
000E96 7B6E           27773             mov Temp4, #110         
000E98 7C02           27774             mov Temp5, #2           
000E9A 803E           27775             jmp music               
                      27776                             
000E9C                27777     music_c:                
000E9C 7A41           27778             mov     Temp3, #65                              
000E9E 7BB6           27779             mov Temp4, #182         
000EA0 7C01           27780             mov Temp5, #1           
000EA2 8036           27781             jmp music               
                      27782                             
000EA4                27783     music_d:                
000EA4 7A49           27784             mov     Temp3, #73                              
000EA6 7B8C           27785             mov Temp4, #140         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   446

000EA8 7C01           27786             mov Temp5, #1           
000EAA 802E           27787             jmp music               
000EAC                27788     music_d2:               
000EAC 7A92           27789             mov     Temp3, #146 ;73                                 
000EAE 7B8C           27790             mov Temp4, #140         
000EB0 7C01           27791             mov Temp5, #1           
000EB2 8026           27792             jmp music                       
                      27793                             
000EB4                27794     music_ds:               
000EB4 7A4E           27795             mov     Temp3, #78                              
000EB6 7B79           27796             mov Temp4, #121         
000EB8 7C01           27797             mov Temp5, #1           
000EBA 801E           27798             jmp music               
                      27799     
000EBC                27800     music_e:                
000EBC 7A52           27801             mov     Temp3, #82                              
000EBE 7B67           27802             mov Temp4, #103         
000EC0 7C01           27803             mov Temp5, #1           
000EC2 8016           27804             jmp music               
                      27805     
000EC4                27806     music_e2:               
000EC4 7AA4           27807             mov     Temp3, #164                             
000EC6 7B67           27808             mov Temp4, #103         
000EC8 7C01           27809             mov Temp5, #1           
000ECA 800E           27810             jmp music               
                      27811                             
000ECC                27812     music_f:                
000ECC 7A57           27813             mov     Temp3, #87                              
000ECE 7B56           27814             mov Temp4, #86          
000ED0 7C01           27815             mov Temp5, #1           
000ED2 8006           27816             jmp music               
                      27817                             
000ED4                27818     music_g:                
000ED4 7AC4           27819             mov     Temp3, #196 ;98                                 
000ED6 7B37           27820             mov Temp4, #55          
000ED8 7C01           27821             mov Temp5, #1
                      27822             
000EDA                27823     music:          
000EDA EC             27824             mov A, Temp5            
000EDB C0E0           27825             push ACC                
                      27826                             
                      27827+1           BcomFET_on                                                                      
                                       ; BcomFET on                            
                      27832+1           ApwmFET_on                                                                      
                                       ; ApwmFET on                            
000EE1 E500       F   27837             mov     A, Beep_Strength                                
000EE3 D5E0FD         27838             djnz    ACC, $                                          
                      27839+1           ApwmFET_off                                                                     
                                       ; ApwmFET off                           
                      27845+1           BcomFET_off                                                                     
                                       ; BcomFET off                           
000EEA D0E0           27847             pop ACC         
000EEC FC             27848             mov Temp5, A            
000EED F9             27849             mov Temp2, A                                                                    
                               ; Make copy of Temp5 to work with (Temp2)               
000EEE EB             27850             mov A, Temp4            
000EEF FD             27851             mov Temp6, A            
000EF0                27852     music_O_loop:                                                                           
                               ; Outer loop            
000EF0 7817           27853             mov     Temp1, #23                                                              
                                       ; Number of times to repeat inner delay loop            
000EF2                27854     music_M_loop:                                                                           
                               ; Middle loop           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   447

000EF2 E4             27855             clr     A               
000EF3 D5E0FD         27856             djnz    ACC, $                                                                  
                               ; Inner loop (42.7us - 1024 cycles)             
000EF6 D8FA           27857             djnz    Temp1, music_M_loop             
000EF8 D9F6           27858             djnz    Temp2, music_O_loop             
                      27859                             
000EFA                27860     wait_150us:             
000EFA 741E           27861             mov             A, #30                                                          
                                       ;5us wait               
000EFC D5E0FD         27862             djnz    ACC, $          
000EFF DDF9           27863             djnz    Temp6, wait_150us                       
000F01 DAD7           27864             djnz    Temp3, music                                                    ; length
                                of tone                
                      27865             
000F03 22             27866     ret
                      27867     
000F04                27868     Protocol_ID:
                      27869+1           Clear_LED_0
000F04 120000     F   27870             call wait30ms
                      27871+1           Set_LED_1
000F07 7402           27872             mov A, #02
000F09 20000E         27873             jb      Flags2.RCP_ONESHOT125, IDbeep_loop
000F0C 04             27874             inc A
000F0D 20000A         27875             jb      Flags2.RCP_ONESHOT42, IDbeep_loop
000F10 04             27876             inc A
000F11 200006         27877             jb      Flags2.RCP_MULTISHOT, IDbeep_loop
000F14 04             27878             inc A
000F15 200002         27879             jb      Flags2.RCP_DSHOT, IDbeep_loop
000F18 7401           27880             mov A, #01
                      27881             
000F1A                27882     IDbeep_loop:
000F1A C0E0           27883             push ACC
000F1C 1100       F   27884             call beep_f1
000F1E 120000     F   27885             call wait100ms
000F21 D0E0           27886             pop ACC
000F23 D5E0F4         27887             djnz    ACC, IDbeep_loop
000F26 22             27888     ret
                      27889     
000F27                27890     Arm_beep:
000F27 30001E         27891     jnb Flags2.RCP_DSHOT, Armed_Beep
000F2A E500       F   27892     mov     A, DShot_Frame_Length_Thr   ; 20=Dshot600 40=Dshot300 80=Dshot150
000F2C C3             27893     clr C
000F2D 941E           27894     subb A, #30
000F2F 400C           27895     jc ID_Dshot600
000F31 941E           27896     subb A, #30
000F33 4002           27897     jc ID_Dshot300
000F35 8011           27898     jmp Armed_Beep
                      27899     
000F37                27900     ID_Dshot300:
000F37 1100       F   27901     call beep_f3
000F39 1100       F   27902     call beep_f3
000F3B 800B           27903     jmp Armed_Beep
                      27904     
000F3D                27905     ID_Dshot600:
000F3D 1100       F   27906     call beep_f2
000F3F 1100       F   27907     call beep_f2
000F41 120000     F   27908     call wait100ms
000F44 1100       F   27909     call beep_f3
000F46 1100       F   27910     call beep_f3
000F48                27911     Armed_Beep:
000F48 120000     F   27912     call wait100ms
000F4B 1100       F   27913     call beep_f4
000F4D 1100       F   27914     call beep_f4
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   448

000F4F 22             27915     ret
                      27916     
                      27917     
                      27918     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27919     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27920     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27921     ;
                      27922     ; Main program start
                      27923     ;
                      27924     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27925     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27926     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27927     
000F50                27928     pgm_start:
                      27929             ; Initialize flash keys to invalid values
000F50 750000     F   27930             mov     Flash_Key_1, #0
000F53 750000     F   27931             mov     Flash_Key_2, #0
                      27932             ; Disable the WDT.
000F56 7597DE         27933             mov     WDTCN, #0DEh            ; Disable watchdog
000F59 7597AD         27934             mov     WDTCN, #0ADh            
                      27935             ; Initialize stack
000F5C 7581C0         27936             mov     SP, #0c0h                       ; Stack = 64 upper bytes of RAM
                      27937             ; Initialize VDD monitor
000F5F 43FF80         27938             orl     VDM0CN, #080h           ; Enable the VDD monitor
                      27939             
000F62 75EF06         27940             mov     RSTSRC, #06h    ; Set missing clock and VDD monitor as a reset source if
                                not 1S capable
                      27941     
                      27942             ; Set clock frequency
000F65 75A900         27943             mov     CLKSEL, #00h            ; Set clock divider to 1
                      27944             ; Switch power off
000F68 1100       F   27945             call    switch_power_off
                      27946             ; Ports initialization
000F6A 7580FF         27947             mov     P0, #P0_INIT
000F6D 75F1F0         27948             mov     P0MDIN, #P0_DIGITAL
000F70 75A400         27949             mov     P0MDOUT, #P0_PUSHPULL
000F73 7580FF         27950             mov     P0, #P0_INIT
000F76 75D4FF         27951             mov     P0SKIP, #P0_SKIP                                
000F79 759000         27952             mov     P1, #P1_INIT
000F7C 75F23F         27953             mov     P1MDIN, #P1_DIGITAL
000F7F 75A53F         27954             mov     P1MDOUT, #P1_PUSHPULL
000F82 759000         27955             mov     P1, #P1_INIT
000F85 75D53F         27956             mov     P1SKIP, #P1_SKIP                                
000F88 75A601         27957             mov     P2MDOUT, #P2_PUSHPULL                           
                      27958             ; Initialize the XBAR and related functionality
                      27959+1           Initialize_Xbar
                      27962             ; Switch power off again, after initializing ports
000F91 1100       F   27963             call    switch_power_off
                      27964             ; Clear RAM
000F93 E4             27965             clr     A                               ; Clear accumulator
000F94 F8             27966             mov     Temp1, A                        ; Clear Temp1
000F95                27967             clear_ram:      
000F95 F6             27968             mov     @Temp1, A                       ; Clear RAM
000F96 D8FD           27969             djnz Temp1, clear_ram   ; Is A not zero? - jump
                      27970             ; Set default programmed parameters
000F98 1100       F   27971             call    set_default_parameters
                      27972             ; Read all programmed parameters
000F9A 120000     F   27973             call read_all_eeprom_parameters
                      27974             ; Set beep strength
000F9D 7800       F   27975             mov     Temp1, #Pgm_Beep_Strength
000F9F 8600       F   27976             mov     Beep_Strength, @Temp1
                      27977             ; Set initial arm variable
000FA1 750001     F   27978             mov     Initial_Arm, #1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   449

                      27979             ; Initializing beep
000FA4 C2AF           27980             clr     IE_EA                   ; Disable interrupts explicitly
000FA6 120000     F   27981             call wait200ms  
000FA9 1100       F   27982             call led_control
000FAB 120000     F   27983             call wait200ms
000FAE 120000     F   27984             call wait200ms
                      27985             
                      27986     ; ESC startup tone              
                      27987     ;-------------------------------------------------------                
                      27988     ;                       Tone Decision Logic             
                      27989     ;               
                      27990     ; Choose Music Routine based on Beacon Delay Setting            
                      27991     ; --------------------          
                      27992     ; 1) OEM Tones          
                      27993     ; 2) CZ Tones           
                      27994     ; 3) Game of Thrones Startup Tone               
                      27995     ; 4) Imperial March Startup Tone                
                      27996     ; 5) Harrison Gale              
                      27997             
000FB1 E500       F   27998             mov     A, Beep_Strength                                                
000FB3 14             27999             dec A           
000FB4 7005           28000             jnz     Tone_Selection
000FB6 D200       F   28001             setb Flags3.MUTE                
000FB8 020000     F   28002             ljmp startup_end                
                      28003                             
000FBB                28004     Tone_Selection:
                      28005+1           Set_LED_0
000FBB C200       F   28006             clr Flags3.MUTE
000FBD 9459           28007             subb A, #89
000FBF 14             28008             dec A           
000FC0 6026           28009             jz Startup_IM           
000FC2 14             28010             dec A           
000FC3 6018           28011             jz Startup_CZ                                                           
000FC5 14             28012             dec A           
000FC6 604A           28013             jz Startup_GoT                                                                  
                                       
000FC8 14             28014             dec A           
000FC9 6009           28015             jz HG_Bounce
000FCB 14             28016         dec A
000FCC 6009           28017             jz MHLL_Bounce
000FCE 14             28018             dec A
000FCF 6009           28019             jz Lego_Bounce
000FD1 020000     F   28020             ljmp OEM_Tones
                      28021     
000FD4                28022     HG_Bounce:
000FD4 020000     F   28023             ljmp Startup_HG 
                      28024             
000FD7                28025     MHLL_Bounce:
000FD7 020000     F   28026         ljmp Startup_MHLL
                      28027             
000FDA                28028     Lego_Bounce:
000FDA 020000     F   28029             ljmp Startup_Lego
                      28030                                                                                             
                                       
000FDD                28031     Startup_CZ:             
000FDD D200       F   28032             setb Flags3.CZ_TONES            
000FDF 1100       F   28033             call startup_wave1              
000FE1 1100       F   28034             call startup_wave1              
000FE3 1100       F   28035             call startup_wave1              
000FE5 020000     F   28036             jmp startup_end                         
                      28037                             
000FE8                28038     Startup_IM:             
000FE8 120000     F   28039             call wait200ms          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   450

000FEB 1100       F   28040             call music_f1           
000FED 120000     F   28041             call wait100ms          
000FF0 1100       F   28042             call music_f1           
000FF2 120000     F   28043             call wait100ms          
000FF5 1100       F   28044             call music_f1           
000FF7 120000     F   28045             call wait100ms          
000FFA 1100       F   28046             call music_f2           
000FFC 1100       F   28047             call music_f3           
000FFE 120000     F   28048             call music_f1           
001001 120000     F   28049             call wait100ms          
001004 120000     F   28050             call music_f2           
001007 120000     F   28051             call music_f3           
00100A 120000     F   28052             call music_f1           
00100D 120000     F   28053             call music_f1           
001010 0100       F   28054             jmp startup_end
                      28055                             
001012                28056     Startup_GoT:            
001012 120000     F   28057             call wait200ms                  
001015 120000     F   28058             call music_g            
001018 120000     F   28059             call wait10ms           
00101B 120000     F   28060             call music_c            
00101E 120000     F   28061             call music_c            
001021 120000     F   28062             call wait10ms           
001024 120000     F   28063             call music_ds           
001027 120000     F   28064             call wait10ms           
00102A 120000     F   28065             call music_f            
00102D 120000     F   28066             call wait10ms           
001030 120000     F   28067             call music_g            
001033 120000     F   28068             call wait10ms           
001036 120000     F   28069             call music_c            
001039 120000     F   28070             call music_c            
00103C 120000     F   28071             call wait10ms           
00103F 120000     F   28072             call music_ds           
001042 120000     F   28073             call wait10ms           
001045 120000     F   28074             call music_f            
001048 120000     F   28075             call wait10ms           
00104B 120000     F   28076             call music_g            
00104E 120000     F   28077             call wait10ms           
001051 120000     F   28078             call music_c            
001054 120000     F   28079             call music_c            
001057 120000     F   28080             call wait10ms           
00105A 120000     F   28081             call music_ds           
00105D 120000     F   28082             call wait10ms           
001060 120000     F   28083             call music_f            
001063 120000     F   28084             call wait10ms           
001066 120000     F   28085             call music_g            
001069 120000     F   28086             call wait10ms           
00106C 120000     F   28087             call music_c            
00106F 120000     F   28088             call music_c            
001072 120000     F   28089             call wait10ms           
001075 120000     F   28090             call music_ds           
001078 120000     F   28091             call wait10ms           
00107B 120000     F   28092             call music_f            
00107E 120000     F   28093             call wait10ms           
001081 120000     F   28094             call music_d2           
001084 120000     F   28095             call wait10ms           
001087 120000     F   28096             call music_g4           
00108A 120000     F   28097             call wait10ms           
00108D 120000     F   28098             call music_as4          
001090 120000     F   28099             call wait10ms           
001093 120000     F   28100             call music_c            
001096 120000     F   28101             call wait10ms           
001099 120000     F   28102             call music_d2           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   451

00109C 120000     F   28103             call wait10ms           
00109F 120000     F   28104             call music_g4           
0010A2 120000     F   28105             call wait10ms           
0010A5 120000     F   28106             call music_as4          
0010A8 120000     F   28107             call wait10ms           
0010AB 120000     F   28108             call music_c            
0010AE 120000     F   28109             call wait10ms           
0010B1 120000     F   28110             call music_d2           
0010B4 120000     F   28111             call wait10ms           
0010B7 120000     F   28112             call music_g4           
0010BA 120000     F   28113             call wait10ms           
0010BD 120000     F   28114             call music_as4          
0010C0 120000     F   28115             call wait10ms           
0010C3 120000     F   28116             call music_c            
0010C6 120000     F   28117             call wait10ms           
0010C9 120000     F   28118             call music_d2           
0010CC 120000     F   28119             call wait10ms           
0010CF 120000     F   28120             call music_g4           
0010D2 120000     F   28121             call wait10ms           
0010D5 120000     F   28122             call music_as4          
0010D8 120000     F   28123             call wait10ms           
0010DB 120000     F   28124             call music_c            
0010DE 120000     F   28125             call wait10ms           
0010E1 120000     F   28126             call music_f            
0010E4 120000     F   28127             call music_f            
0010E7 120000     F   28128             call wait10ms           
0010EA 120000     F   28129             call music_f4                   
0010ED 0100       F   28130             jmp startup_end
                      28131                             
0010EF                28132     Startup_HG:                     
0010EF 120000     F   28133             call music_a4           
0010F2 120000     F   28134             call wait10ms           
0010F5 120000     F   28135             call music_a4           
0010F8 120000     F   28136             call wait10ms           
0010FB 120000     F   28137             call wait10ms           
0010FE 120000     F   28138             call music_e            
001101 120000     F   28139             call wait3ms            
001104 120000     F   28140             call music_e            
001107 120000     F   28141             call wait3ms            
00110A 120000     F   28142             call music_e            
00110D 120000     F   28143             call wait3ms            
001110 120000     F   28144             call music_e            
001113 120000     F   28145             call wait10ms           
001116 120000     F   28146             call wait10ms           
001119 120000     F   28147             call music_g4           
00111C 120000     F   28148             call music_g4           
00111F 120000     F   28149             call wait10ms           
001122 120000     F   28150             call music_g4           
001125 120000     F   28151             call music_g4           
001128 120000     F   28152             call wait10ms           
00112B 120000     F   28153             call wait10ms           
00112E 120000     F   28154             call music_d            
001131 120000     F   28155             call wait3ms            
001134 120000     F   28156             call music_d            
001137 120000     F   28157             call wait3ms            
00113A 120000     F   28158             call music_d            
00113D 120000     F   28159             call wait3ms            
001140 120000     F   28160             call music_d            
001143 120000     F   28161             call wait10ms           
001146 120000     F   28162             call wait10ms           
001149 120000     F   28163             call music_f4           
00114C 120000     F   28164             call music_f4           
00114F 120000     F   28165             call wait10ms           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   452

001152 120000     F   28166             call music_f4           
001155 120000     F   28167             call music_f4           
001158 120000     F   28168             call wait10ms           
00115B 120000     F   28169             call wait10ms           
00115E 120000     F   28170             call music_c            
001161 120000     F   28171             call wait3ms            
001164 120000     F   28172             call music_c            
001167 120000     F   28173             call wait3ms            
00116A 120000     F   28174             call music_c            
00116D 120000     F   28175             call wait3ms            
001170 120000     F   28176             call music_c            
001173 120000     F   28177             call wait10ms           
001176 120000     F   28178             call wait10ms           
001179 120000     F   28179             call music_e4           
00117C 120000     F   28180             call wait10ms           
00117F 120000     F   28181             call music_e4           
001182 120000     F   28182             call wait10ms           
001185 120000     F   28183             call wait10ms           
001188 120000     F   28184             call music_b4           
00118B 120000     F   28185             call wait3ms            
00118E 120000     F   28186             call music_b4           
001191 120000     F   28187             call wait3ms            
001194 120000     F   28188             call music_b4           
001197 120000     F   28189             call wait3ms            
00119A 120000     F   28190             call music_b4           
00119D 120000     F   28191             call wait10ms           
0011A0 120000     F   28192             call wait10ms           
0011A3 120000     F   28193             call music_a4           
0011A6 120000     F   28194             call music_a4           
0011A9 120000     F   28195             call wait10ms           
0011AC 120000     F   28196             call wait10ms           
0011AF 120000     F   28197             call music_g4           
0011B2 120000     F   28198             call music_g4           
0011B5 120000     F   28199             call music_g4           
0011B8 120000     F   28200             call music_g4           
0011BB 120000     F   28201             call wait10ms           
0011BE 120000     F   28202             call wait10ms           
0011C1 120000     F   28203             call music_f4           
0011C4 120000     F   28204             call music_f4           
0011C7 120000     F   28205             call music_f4           
0011CA 120000     F   28206             call music_f4           
0011CD 120000     F   28207             call wait10ms           
0011D0 120000     F   28208             call wait10ms           
0011D3 120000     F   28209             call music_e4           
0011D6 120000     F   28210             call music_e4
0011D9 0100       F   28211             jmp startup_end
                      28212     
0011DB                28213     Startup_MHLL:                   
0011DB 120000     F   28214             call music_e
0011DE 120000     F   28215             call music_e
0011E1 120000     F   28216             call wait10ms
0011E4 120000     F   28217             call music_d
0011E7 120000     F   28218             call music_d
0011EA 120000     F   28219             call wait10ms
0011ED 120000     F   28220             call music_c
0011F0 120000     F   28221             call music_c
0011F3 120000     F   28222             call wait10ms
0011F6 120000     F   28223             call music_d
0011F9 120000     F   28224             call music_d
0011FC 120000     F   28225             call wait10ms
0011FF 120000     F   28226             call music_e
001202 120000     F   28227             call music_e
001205 120000     F   28228             call wait10ms
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   453

001208 120000     F   28229             call music_e
00120B 120000     F   28230             call music_e
00120E 120000     F   28231             call wait10ms
001211 120000     F   28232             call music_e
001214 120000     F   28233             call music_e
001217 120000     F   28234             call wait200ms
00121A 120000     F   28235             call music_d
00121D 120000     F   28236             call music_d
001220 120000     F   28237             call wait10ms
001223 120000     F   28238             call music_d
001226 120000     F   28239             call music_d
001229 120000     F   28240             call wait10ms
00122C 120000     F   28241             call music_d
00122F 120000     F   28242             call music_d
001232 120000     F   28243             call wait200ms
001235 120000     F   28244             call music_e
001238 120000     F   28245             call music_e
00123B 120000     F   28246             call wait10ms
00123E 120000     F   28247             call music_g
001241 120000     F   28248             call wait30ms
001244 120000     F   28249             call music_g
001247 120000     F   28250             call wait200ms
00124A 120000     F   28251             call music_e
00124D 120000     F   28252             call music_e
001250 120000     F   28253             call wait10ms
001253 120000     F   28254             call music_d
001256 120000     F   28255             call music_d
001259 120000     F   28256             call wait10ms
00125C 120000     F   28257             call music_c
00125F 120000     F   28258             call music_c
001262 120000     F   28259             call wait10ms
001265 120000     F   28260             call music_d
001268 120000     F   28261             call music_d
00126B 120000     F   28262             call wait10ms
00126E 120000     F   28263             call music_e
001271 120000     F   28264             call music_e
001274 120000     F   28265             call wait10ms
001277 120000     F   28266             call music_e
00127A 120000     F   28267             call music_e
00127D 120000     F   28268             call wait10ms
001280 120000     F   28269             call music_e
001283 120000     F   28270             call music_e
001286 120000     F   28271             call wait10ms
001289 120000     F   28272             call music_e
00128C 120000     F   28273             call music_e
00128F 120000     F   28274             call wait10ms
001292 120000     F   28275             call music_d
001295 120000     F   28276             call music_d
001298 120000     F   28277             call wait10ms
00129B 120000     F   28278             call music_d
00129E 120000     F   28279             call music_d
0012A1 120000     F   28280             call wait10ms
0012A4 120000     F   28281             call music_e
0012A7 120000     F   28282             call music_e
0012AA 120000     F   28283             call wait10ms
0012AD 120000     F   28284             call music_d
0012B0 120000     F   28285             call music_d
0012B3 120000     F   28286             call wait10ms
0012B6 120000     F   28287             call music_c
0012B9 120000     F   28288             call music_c
0012BC 120000     F   28289             call wait10ms
0012BF 0100       F   28290             jmp startup_end
                      28291     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   454

0012C1                28292     Startup_Lego:
                      28293             ;everything is awesome
0012C1 120000     F   28294             call music_as4_lng
0012C4 120000     F   28295             call wait10ms
0012C7 120000     F   28296             call music_as4_lng
0012CA 120000     F   28297             call wait10ms
0012CD 120000     F   28298             call music_as4_lng
0012D0 120000     F   28299             call wait10ms
0012D3 120000     F   28300             call music_as4_lng
0012D6 120000     F   28301             call wait10ms
0012D9 120000     F   28302             call music_as4_lng
0012DC 120000     F   28303             call wait10ms
0012DF 120000     F   28304             call music_a4
0012E2 120000     F   28305             call music_a4
0012E5 120000     F   28306             call music_a4
                      28307             ;everything is cool when you're part of a team
0012E8 120000     F   28308             call music_as4_lng
0012EB 120000     F   28309             call wait10ms
0012EE 120000     F   28310             call music_as4_lng
0012F1 120000     F   28311             call wait10ms
0012F4 120000     F   28312             call music_as4_lng
0012F7 120000     F   28313             call wait10ms
0012FA 120000     F   28314             call music_as4_lng
0012FD 120000     F   28315             call wait10ms
001300 120000     F   28316             call music_as4_lng
001303 120000     F   28317             call wait10ms
001306 120000     F   28318             call music_a4_sht
001309 120000     F   28319             call wait10ms
00130C 120000     F   28320             call music_g4
00130F 120000     F   28321             call wait10ms
001312 120000     F   28322             call music_f4
001315 120000     F   28323             call wait10ms
001318 120000     F   28324             call music_g4
00131B 120000     F   28325             call wait10ms
00131E 120000     F   28326             call music_a4_sht
001321 120000     F   28327             call wait10ms
001324 120000     F   28328             call music_g4
001327 120000     F   28329             call music_g4
                      28330             ;everything is awesome
00132A 120000     F   28331             call music_as4_lng
00132D 120000     F   28332             call wait10ms
001330 120000     F   28333             call music_as4_lng
001333 120000     F   28334             call wait10ms
001336 120000     F   28335             call music_as4_lng
001339 120000     F   28336             call wait10ms
00133C 120000     F   28337             call music_as4_lng
00133F 120000     F   28338             call wait10ms
001342 120000     F   28339             call music_as4_lng
001345 120000     F   28340             call wait10ms
001348 120000     F   28341             call music_c
00134B 120000     F   28342             call music_c
00134E 120000     F   28343             call music_c
001351 120000     F   28344             call music_c
001354 120000     F   28345             call music_c
001357 120000     F   28346             call music_c
00135A 120000     F   28347         call wait30ms
                      28348             ;when you're living in a dream
00135D 120000     F   28349             call music_c
001360 120000     F   28350             call music_c
001363 120000     F   28351             call wait10ms
001366 120000     F   28352             call music_c
001369 120000     F   28353             call music_c
00136C 120000     F   28354             call wait10ms
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   455

00136F 120000     F   28355             call music_a4
001372 120000     F   28356             call wait10ms
001375 120000     F   28357             call music_g4
001378 120000     F   28358             call wait10ms
00137B 120000     F   28359             call music_g4
00137E 120000     F   28360             call wait10ms
001381 120000     F   28361             call music_f4
001384 120000     F   28362             call wait10ms
001387 120000     F   28363             call music_f4
00138A 120000     F   28364             call music_f4
00138D 120000     F   28365             call wait10ms
001390 800F           28366             jmp startup_end
                      28367     
001392                28368     OEM_Tones:              
001392 120000     F   28369             call beep_f1
001395 120000     F   28370             call wait30ms           
001398 120000     F   28371             call beep_f2                            
00139B 120000     F   28372             call wait30ms
00139E 120000     F   28373             call beep_f3            
                      28374     
0013A1                28375     startup_end:                    ; end esc startup tone          
0013A1 120000     F   28376             call wait30ms                           
                      28377     
                      28378     
                      28379     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28380     ;
                      28381     ; No signal entry point
                      28382     ;
                      28383     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0013A4                28384     init_no_signal:
                      28385             ; Disable interrupts explicitly
0013A4 C2AF           28386             clr     IE_EA
                      28387             ; Initialize flash keys to invalid values
0013A6 750000     F   28388             mov     Flash_Key_1, #0
0013A9 750000     F   28389             mov     Flash_Key_2, #0
                      28390             ; Check if input signal is high for more than 15ms
0013AC 78FA           28391             mov     Temp1, #250
0013AE                28392     input_high_check_1:
0013AE 79FA           28393             mov     Temp2, #250
0013B0                28394     input_high_check_2:
0013B0 308507         28395             jnb     RTX_PORT.RTX_PIN, bootloader_done       ; Look for low
0013B3 D9FB           28396             djnz    Temp2, input_high_check_2
0013B5 D8F7           28397             djnz    Temp1, input_high_check_1
                      28398     
0013B7 021C00         28399             ljmp    1C00h                   ; Jump to bootloader
                      28400     
0013BA                28401     bootloader_done:
                      28402             ; Decode settings
0013BA 120000     F   28403             call    decode_settings
                      28404             ; Find throttle gain from stored min and max settings
0013BD 120000     F   28405             call    find_throttle_gains
                      28406             ; Set beep strength
0013C0 7800       F   28407             mov     Temp1, #Pgm_Beep_Strength
0013C2 8600       F   28408             mov     Beep_Strength, @Temp1
                      28409             ; Switch power off
0013C4 120000     F   28410             call    switch_power_off
                      28411             ; Set clock frequency
                      28412     IF 1 == 1
                      28413+1           Set_MCU_Clk_24MHz
                      28419     ENDIF
                      28420             ; Setup timers for pwm input
0013D6 75E405         28421             mov     IT01CF, #RTX_PIN        ; Route RCP input to INT0
0013D9 758811         28422             mov     TCON, #11h              ; Timer 0 run and INT0 edge triggered
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   456

0013DC 758E04         28423             mov     CKCON0, #04h            ; Timer 0 clock is system clock
0013DF 758909         28424             mov     TMOD, #09h              ; Timer 0 set to 16bits and gated by INT0
0013E2 75C804         28425             mov     TMR2CN0, #04h           ; Timer 2 enabled
0013E5 759104         28426             mov     TMR3CN0, #04h           ; Timer 3 enabled
                      28427+1           Initialize_PCA                  ; Initialize PCA
                      28445+1           Set_Pwm_Polarity                ; Set pwm polarity
                      28447+1           Enable_Power_Pwm_Module ; Enable power pwm module
                      28453+1           Enable_Damp_Pwm_Module  ; Enable damping pwm module
                      28459             ; Enable interrupts
                      28460     IF 1 == 0
                                        mov     IE, #21h                        ; Enable timer 2 interrupts and INT0 int
                               errupts
                                ELSE
0013FD 75A823         28463             mov     IE, #23h                        ; Enable timer 0, timer 2 interrupts and
                                INT0 interrupts
                      28464     ENDIF
001400 75E690         28465             mov     EIE1, #90h              ; Enable timer 3 and PCA0 interrupts
001403 75B801         28466             mov     IP, #01h                        ; High priority to INT0 interrupts
                      28467             ; Initialize comparator
                      28468+1           Initialize_Comparator   ; Initialize comparator
                      28471             ; Initialize ADC
                      28472+1           Initialize_Adc                  ; Initialize ADC operation
00141B 120000     F   28482             call    wait1ms
00141E D2AF           28483             setb    IE_EA                   ; Enable all interrupts
                      28484             ; Reset stall count
001420 750000     F   28485             mov     Stall_Cnt, #0
                      28486             ; Initialize RC pulse
001423 C200       F   28487             clr     Flags2.RCP_UPDATED                      ; Clear updated flag
001425 120000     F   28488             call wait200ms
                      28489             ; Clear all shot flags
001428 C200       F   28490             clr     Flags2.RCP_ONESHOT125                   ; Clear OneShot125 flag
00142A C200       F   28491             clr     Flags2.RCP_ONESHOT42                    ; Clear OneShot42 flag
00142C C200       F   28492             clr     Flags2.RCP_MULTISHOT                    ; Clear Multishot flag
00142E C200       F   28493             clr     Flags2.RCP_DSHOT                                ; Clear DShot flag
                      28494             ; Test whether signal is regular pwm
001430 750000     F   28495             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
001433 120000     F   28496             call wait100ms                                          ; Wait for new RC pulse
001436 C3             28497             clr     C
001437 E500       F   28498             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
001439 940A           28499             subb    A, #10                                          
00143B 5002           28500             jnc     ($+4)
00143D 0100       F   28501             ajmp    validate_rcp_start
                      28502     
                      28503             ; Test whether signal is OneShot125
00143F D200       F   28504             setb    Flags2.RCP_ONESHOT125                   ; Set OneShot125 flag
001441 750000     F   28505             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
001444 120000     F   28506             call wait100ms                                          ; Wait for new RC pulse
001447 C3             28507             clr     C
001448 E500       F   28508             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
00144A 940A           28509             subb    A, #10
00144C 5002           28510             jnc     ($+4)
00144E 0100       F   28511             ajmp    validate_rcp_start
                      28512     
                      28513             ; Test whether signal is OneShot42
001450 C200       F   28514             clr     Flags2.RCP_ONESHOT125
001452 D200       F   28515             setb    Flags2.RCP_ONESHOT42                    ; Set OneShot42 flag
001454 750000     F   28516             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
001457 120000     F   28517             call wait100ms                                          ; Wait for new RC pulse
00145A C3             28518             clr     C
00145B E500       F   28519             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   457

00145D 940A           28520             subb    A, #10
00145F 5002           28521             jnc     ($+4)
001461 0100       F   28522             ajmp    validate_rcp_start
                      28523     
                      28524             ; Setup timers for DShot
001463 75E4D5         28525             mov     IT01CF, #(80h+(RTX_PIN SHL 4)+(RTX_PIN))        ; Route RCP input to INT
                               0/1, with INT1 inverted
001466 758851         28526             mov     TCON, #51h              ; Timer 0/1 run and INT0 edge triggered
001469 758E01         28527             mov     CKCON0, #01h            ; Timer 0/1 clock is system clock divided by 4 (
                               for DShot150)
00146C 7589AA         28528             mov     TMOD, #0AAh             ; Timer 0/1 set to 8bits auto reload and gated b
                               y INT0
00146F 758C00         28529             mov     TH0, #0                 ; Auto reload value zero
001472 758D00         28530             mov     TH1, #0
                      28531             ; Setup interrupts for DShot
001475 C2A9           28532             clr     IE_ET0                  ; Disable timer 0 interrupts
001477 D2AB           28533             setb    IE_ET1                  ; Enable timer 1 interrupts
001479 D2AA           28534             setb    IE_EX1                  ; Enable int1 interrupts
                      28535             ; Setup variables for DSshot150
                      28536     IF 1 == 1
00147B 750080     F   28537             mov     DShot_Timer_Preset, #128                        ; Load DShot sync timer 
                               preset (for DShot150)
                      28538     ELSE
                                        mov     DShot_Timer_Preset, #192
                                ENDIF
00147E 750014     F   28541             mov     DShot_Pwm_Thr, #20                              ; Load DShot qualificati
                               on pwm threshold (for DShot150)
001481 750050     F   28542             mov     DShot_Frame_Length_Thr, #80             ; Load DShot frame length criter
                               ia
                      28543             ; Test whether signal is DShot150
001484 C200       F   28544             clr     Flags2.RCP_ONESHOT42
001486 D200       F   28545             setb    Flags2.RCP_DSHOT
001488 75000A     F   28546             mov     Rcp_Outside_Range_Cnt, #10              ; set out of range counter
00148B 120000     F   28547             call wait100ms                                          ; Wait for new RC pulse
00148E 750010     F   28548             mov     DShot_Pwm_Thr, #16                              ; Load DShot regular pwm
                                threshold
001491 C3             28549             clr     C
001492 E500       F   28550             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were a
                               ccepted
001494 940A           28551             subb    A, #10
001496 405D           28552             jc      validate_rcp_start
                      28553     
                      28554             ; Setup variables for DShot300
001498 758E0C         28555             mov     CKCON0, #0Ch                                    ; Timer 0/1 clock is sys
                               tem clock (for DShot300)
                      28556     IF 1 == 1
00149B 750000     F   28557             mov     DShot_Timer_Preset, #0                  ; Load DShot sync timer preset (
                               for DShot300)
                      28558     ELSE
                                        mov     DShot_Timer_Preset, #128
                                ENDIF
00149E 750028     F   28561             mov     DShot_Pwm_Thr, #40                              ; Load DShot qualificati
                               on pwm threshold (for DShot300)
0014A1 750028     F   28562             mov     DShot_Frame_Length_Thr, #40             ; Load DShot frame length criter
                               ia
                      28563             ; Test whether signal is DShot300
0014A4 75000A     F   28564             mov     Rcp_Outside_Range_Cnt, #10              ; set out of range counter
0014A7 120000     F   28565             call wait100ms                                          ; Wait for new RC pulse
0014AA 750020     F   28566             mov     DShot_Pwm_Thr, #32                              ; Load DShot regular pwm
                                threshold
0014AD C3             28567             clr     C
0014AE E500       F   28568             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were a
                               ccepted
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   458

0014B0 940A           28569             subb    A, #10
0014B2 4041           28570             jc      validate_rcp_start
                      28571     
                      28572             ; Setup variables for DShot600
0014B4 758E0C         28573             mov     CKCON0, #0Ch                                    ; Timer 0/1 clock is sys
                               tem clock (for DShot600)
                      28574     IF 1 == 1
0014B7 750080     F   28575             mov     DShot_Timer_Preset, #128                        ; Load DShot sync timer 
                               preset (for DShot600)
                      28576     ELSE
                                        mov     DShot_Timer_Preset, #192
                                ENDIF
0014BA 750014     F   28579             mov     DShot_Pwm_Thr, #20                              ; Load DShot qualificati
                               on pwm threshold (for DShot600)
0014BD 750014     F   28580             mov     DShot_Frame_Length_Thr, #20             ; Load DShot frame length criter
                               ia
                      28581             ; Test whether signal is DShot600
0014C0 75000A     F   28582             mov     Rcp_Outside_Range_Cnt, #10              ; set out of range counter
0014C3 120000     F   28583             call wait100ms                                          ; Wait for new RC pulse
0014C6 750010     F   28584             mov     DShot_Pwm_Thr, #16                              ; Load DShot regular pwm
                                threshold
0014C9 C3             28585             clr     C
0014CA E500       F   28586             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were a
                               ccepted
0014CC 940A           28587             subb    A, #10
0014CE 4025           28588             jc      validate_rcp_start
                      28589     
                      28590             ; Setup timers for Multishot
0014D0 75E405         28591             mov     IT01CF, #RTX_PIN        ; Route RCP input to INT0
0014D3 758811         28592             mov     TCON, #11h              ; Timer 0 run and INT0 edge triggered
0014D6 758E04         28593             mov     CKCON0, #04h            ; Timer 0 clock is system clock
0014D9 758909         28594             mov     TMOD, #09h              ; Timer 0 set to 16bits and gated by INT0
                      28595             ; Setup interrupts for Multishot
0014DC D2A9           28596             setb    IE_ET0                  ; Enable timer 0 interrupts
0014DE C2AB           28597             clr     IE_ET1                  ; Disable timer 1 interrupts
0014E0 C2AA           28598             clr     IE_EX1                  ; Disable int1 interrupts
                      28599             ; Test whether signal is Multishot
0014E2 C200       F   28600             clr     Flags2.RCP_DSHOT
0014E4 D200       F   28601             setb    Flags2.RCP_MULTISHOT                    ; Set Multishot flag
0014E6 750000     F   28602             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
0014E9 120000     F   28603             call wait100ms                                          ; Wait for new RC pulse
0014EC C3             28604             clr     C
0014ED E500       F   28605             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
0014EF 940A           28606             subb    A, #10
0014F1 4002           28607             jc      validate_rcp_start
                      28608     
0014F3 0100       F   28609             ajmp    init_no_signal
                      28610     
0014F5                28611     validate_rcp_start:
                      28612             ; Validate RC pulse
0014F5 120000     F   28613             call wait3ms                                            ; Wait for new RC pulse
0014F8 200003         28614             jb      Flags2.RCP_UPDATED, ($+6)               ; Is there an updated RC pulse a
                               vailable - proceed
0014FB 020000     F   28615             ljmp    init_no_signal                                  ; Go back to detect inpu
                               t signal
                      28616     
                      28617             ; Beep arm sequence start signal
0014FE C2AF           28618             clr     IE_EA                                           ; Disable all interrupts
001500 120000     F   28619             call Protocol_ID
                      28620     ;       call beep_f1                                            ; Signal that RC pulse i
                               s ready
                      28621     ;       call beep_f1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   459

                      28622     ;       call beep_f1
001503 D2AF           28623             setb    IE_EA                                           ; Enable all interrupts
001505 120000     F   28624             call wait200ms  
                      28625     
                      28626             ; Arming sequence start
001508                28627     arming_start:
001508 200003         28628             jb      Flags2.RCP_DSHOT, ($+6) ; Disable tx programming for DShot
00150B 300003         28629             jnb     Flags3.PGM_BIDIR, ($+6)
                      28630     
00150E 020000     F   28631             ljmp    program_by_tx_checked   ; Disable tx programming if bidirectional operat
                               ion
                      28632     
001511 120000     F   28633             call wait3ms
001514 7800       F   28634             mov     Temp1, #Pgm_Enable_TX_Program; Start programming mode entry if enabled
001516 E6             28635             mov     A, @Temp1                               
001517 C3             28636             clr     C
001518 9401           28637             subb    A, #1                           ; Is TX programming enabled?
00151A 5002           28638             jnc     arming_initial_arm_check        ; Yes - proceed
                      28639     
00151C 0100       F   28640             jmp     program_by_tx_checked   ; No - branch
                      28641     
00151E                28642     arming_initial_arm_check:
00151E E500       F   28643             mov     A, Initial_Arm                  ; Yes - check if it is initial arm seque
                               nce
001520 C3             28644             clr     C
001521 9401           28645             subb    A, #1                           ; Is it the initial arm sequence?
001523 5002           28646             jnc     arming_check                    ; Yes - proceed
                      28647     
001525 0100       F   28648             jmp     program_by_tx_checked   ; No - branch
                      28649     
001527                28650     arming_check:
                      28651             ; Initialize flash keys to valid values
001527 7500A5     F   28652             mov     Flash_Key_1, #0A5h
00152A 7500F1     F   28653             mov     Flash_Key_2, #0F1h
                      28654             ; Throttle calibration and tx program entry
00152D 7F02           28655             mov     Temp8, #2                               ; Set 1 seconds wait time
00152F                28656     throttle_high_cal:                      
00152F D200       F   28657             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
001531 120000     F   28658             call    find_throttle_gains             ; Set throttle gains
001534 120000     F   28659             call wait100ms                          ; Wait for new throttle value
001537 C2AF           28660             clr     IE_EA                           ; Disable interrupts (freeze New_Rcp val
                               ue)
001539 C200       F   28661             clr     Flags2.RCP_FULL_RANGE   ; Set programmed range
00153B 120000     F   28662             call    find_throttle_gains             ; Set throttle gains
00153E C3             28663             clr     C
00153F E500       F   28664             mov     A, New_Rcp                      ; Load new RC pulse value
001541 947F           28665             subb    A, #(255/2)                     ; Is RC pulse above midstick?
001543 D2AF           28666             setb    IE_EA                           ; Enable interrupts
001545 4073           28667             jc      program_by_tx_checked   ; No - branch
                      28668     
001547 120000     F   28669             call wait1ms            
00154A C2AF           28670             clr     IE_EA                           ; Disable all interrupts
00154C 120000     F   28671             call beep_f4
00154F D2AF           28672             setb    IE_EA                           ; Enable all interrupts
001551 DFDC           28673             djnz    Temp8, throttle_high_cal        ; Continue to wait
                      28674     
001553 120000     F   28675             call    average_throttle
001556 C3             28676             clr     C
001557 EF             28677             mov     A, Temp8
001558 7800       F   28678             mov     Temp1, #Pgm_Max_Throttle        ; Store
00155A F6             28679             mov     @Temp1, A                       
00155B 120000     F   28680             call wait200ms                          
00155E 120000     F   28681             call    success_beep
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   460

                      28682     
001561                28683     throttle_low_cal_start:
001561 7F0A           28684             mov     Temp8, #10                      ; Set 3 seconds wait time
001563                28685     throttle_low_cal:                       
001563 D200       F   28686             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
001565 120000     F   28687             call    find_throttle_gains             ; Set throttle gains
001568 120000     F   28688             call wait100ms
00156B C2AF           28689             clr     IE_EA                           ; Disable interrupts (freeze New_Rcp val
                               ue)
00156D C200       F   28690             clr     Flags2.RCP_FULL_RANGE   ; Set programmed range
00156F 120000     F   28691             call    find_throttle_gains             ; Set throttle gains
001572 C3             28692             clr     C
001573 E500       F   28693             mov     A, New_Rcp                      ; Load new RC pulse value
001575 947F           28694             subb    A, #(255/2)                     ; Below midstick?
001577 D2AF           28695             setb    IE_EA                           ; Enable interrupts
001579 50E6           28696             jnc     throttle_low_cal_start  ; No - start over
                      28697     
00157B 120000     F   28698             call wait1ms            
00157E C2AF           28699             clr     IE_EA                           ; Disable all interrupts
001580 120000     F   28700             call beep_f1
001583 120000     F   28701             call wait10ms
001586 120000     F   28702             call beep_f1
001589 D2AF           28703             setb    IE_EA                           ; Enable all interrupts
00158B DFD6           28704             djnz    Temp8, throttle_low_cal ; Continue to wait
                      28705     
00158D 120000     F   28706             call    average_throttle
001590 EF             28707             mov     A, Temp8
001591 2403           28708             add     A, #3                           ; Add about 1%
001593 7800       F   28709             mov     Temp1, #Pgm_Min_Throttle        ; Store
001595 F6             28710             mov     @Temp1, A                       
001596 F8             28711             mov     Temp1, A                                ; Min throttle in Temp1
001597 7900       F   28712             mov     Temp2, #Pgm_Max_Throttle
001599 E7             28713             mov     A, @Temp2
00159A C3             28714             clr     C
00159B 9423           28715             subb    A, #35                          ; Subtract 35 (140us) from max throttle
00159D 4003           28716             jc      program_by_tx_entry_limit
00159F 98             28717             subb    A, Temp1                                ; Subtract min from max
0015A0 5006           28718             jnc     program_by_tx_entry_store
                      28719     
0015A2                28720     program_by_tx_entry_limit:
0015A2 E8             28721             mov     A, Temp1                                ; Load min
0015A3 2423           28722             add     A, #35                          ; Make max 140us higher than min
0015A5 7800       F   28723             mov     Temp1, #Pgm_Max_Throttle        ; Store new max
0015A7 F6             28724             mov     @Temp1, A
                      28725     
0015A8                28726     program_by_tx_entry_store:
0015A8 120000     F   28727             call wait200ms                          
0015AB 120000     F   28728             call erase_and_store_all_in_eeprom      
0015AE 120000     F   28729             call    success_beep_inverted
                      28730     
0015B1                28731     program_by_tx_entry_wait:
0015B1 120000     F   28732             call wait100ms
0015B4 120000     F   28733             call    find_throttle_gains             ; Set throttle gains
0015B7 020000     F   28734             ljmp    init_no_signal                  ; Go back
                      28735     
0015BA                28736     program_by_tx_checked:
                      28737             ; Initialize flash keys to invalid values
0015BA 750000     F   28738             mov     Flash_Key_1, #0
0015BD 750000     F   28739             mov     Flash_Key_2, #0
0015C0 120000     F   28740             call wait100ms                          ; Wait for new throttle value
0015C3 C3             28741             clr     C
0015C4 E500       F   28742             mov     A, New_Rcp                      ; Load new RC pulse value
0015C6 9401           28743             subb    A, #1                           ; Below stop?
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   461

0015C8 4002           28744             jc      arm_end_beep                    ; Yes - proceed
                      28745     
0015CA 0100       F   28746             jmp     arming_start                    ; No - start over
                      28747     
0015CC                28748     arm_end_beep:
                      28749             ; Beep arm sequence end signal
0015CC C2AF           28750             clr     IE_EA                           ; Disable all interrupts
                      28751+1           Clear_LED_1
0015CE 120000     F   28752             call wait100ms  
0015D1 120000     F   28753             call Arm_beep
                      28754     ;       call beep_f4                            ; Signal that rcpulse is ready
                      28755     ;       call beep_f4
                      28756+1           Set_LED_2
0015D4 D2AF           28757             setb    IE_EA                           ; Enable all interrupts
0015D6 120000     F   28758             call wait200ms
                      28759     
                      28760             ; Clear initial arm variable
0015D9 750000     F   28761             mov     Initial_Arm, #0
                      28762     
                      28763             ; Armed and waiting for power on
0015DC                28764     wait_for_power_on:
0015DC E4             28765             clr     A
0015DD F500       F   28766             mov     Power_On_Wait_Cnt_L, A  ; Clear wait counter
0015DF F500       F   28767             mov     Power_On_Wait_Cnt_H, A  
0015E1                28768     wait_for_power_on_loop:
0015E1 0500       F   28769             inc     Power_On_Wait_Cnt_L             ; Increment low wait counter
0015E3 E500       F   28770             mov     A, Power_On_Wait_Cnt_L
0015E5 F4             28771             cpl     A
0015E6 703F           28772             jnz     wait_for_power_on_no_beep; Counter wrapping (about 3 sec)
                      28773     
0015E8 0500       F   28774             inc     Power_On_Wait_Cnt_H             ; Increment high wait counter
0015EA 7800       F   28775             mov     Temp1, #Pgm_Beacon_Delay
0015EC E6             28776             mov     A, @Temp1
0015ED 7819           28777             mov     Temp1, #25              ; Approximately 1 min
0015EF 14             28778             dec     A
0015F0 6012           28779             jz      beep_delay_set
                      28780     
0015F2 7832           28781             mov     Temp1, #50              ; Approximately 2 min
0015F4 14             28782             dec     A
0015F5 600D           28783             jz      beep_delay_set
                      28784     
0015F7 787D           28785             mov     Temp1, #125             ; Approximately 5 min
0015F9 14             28786             dec     A
0015FA 6008           28787             jz      beep_delay_set
                      28788     
0015FC 78FA           28789             mov     Temp1, #250             ; Approximately 10 min
0015FE 14             28790             dec     A
0015FF 6003           28791             jz      beep_delay_set
                      28792     
001601 750000     F   28793             mov     Power_On_Wait_Cnt_H, #0         ; Reset counter for infinite delay
                      28794     
001604                28795     beep_delay_set:
001604 C3             28796             clr     C
001605 E500       F   28797             mov     A, Power_On_Wait_Cnt_H
001607 98             28798             subb    A, Temp1                                ; Check against chosen delay
001608 401D           28799             jc      wait_for_power_on_no_beep; Has delay elapsed?
                      28800     
00160A 120000     F   28801             call    switch_power_off                ; Switch power off in case braking is se
                               t
00160D 120000     F   28802             call    wait1ms
001610 1500       F   28803             dec     Power_On_Wait_Cnt_H             ; Decrement high wait counter
001612 750000     F   28804             mov     Power_On_Wait_Cnt_L, #0 ; Set low wait counter
001615 7800       F   28805             mov     Temp1, #Pgm_Beacon_Strength
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   462

001617 8600       F   28806             mov     Beep_Strength, @Temp1
001619 C2AF           28807             clr     IE_EA                           ; Disable all interrupts
00161B 120000     F   28808             call beep_beacon        ; Signal that there is no signal
00161E D2AF           28809             setb    IE_EA                           ; Enable all interrupts
001620 7800       F   28810             mov     Temp1, #Pgm_Beep_Strength
001622 8600       F   28811             mov     Beep_Strength, @Temp1
001624 120000     F   28812             call wait100ms                          ; Wait for new RC pulse to be measured
                      28813     
001627                28814     wait_for_power_on_no_beep:
001627 120000     F   28815             call wait10ms
00162A E500       F   28816             mov     A, Rcp_Timeout_Cntd                     ; Load RC pulse timeout counter 
                               value
00162C 7002           28817             jnz     wait_for_power_on_not_missing   ; If it is not zero - proceed
                      28818     
00162E 0100       F   28819             jmp     init_no_signal                          ; If pulses missing - go back to
                                detect input signal
                      28820     
001630                28821     wait_for_power_on_not_missing:
001630 C3             28822             clr     C
001631 E500       F   28823             mov     A, New_Rcp                      ; Load new RC pulse value
001633 9401           28824             subb    A, #1                           ; Higher than stop
001635 40AA           28825             jc      wait_for_power_on_loop  ; No - start over
                      28826     
001637 120000     F   28827             lcall wait100ms                 ; Wait to see if start pulse was only a glitch
00163A E500       F   28828             mov     A, Rcp_Timeout_Cntd             ; Load RC pulse timeout counter value
00163C 7003           28829             jnz     ($+5)                           ; If it is not zero - proceed
                      28830     
00163E 020000     F   28831             ljmp    init_no_signal                  ; If it is zero (pulses missing) - go ba
                               ck to detect input signal
                      28832     
                      28833     
                      28834     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28835     ;
                      28836     ; Start entry point
                      28837     ;
                      28838     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001641                28839     init_start:
001641 C2AF           28840             clr     IE_EA
001643 120000     F   28841             call switch_power_off
001646 E4             28842             clr     A
001647 D2AF           28843             setb    IE_EA
001649 E4             28844             clr     A
00164A F500       F   28845             mov     Adc_Conversion_Cnt, A
00164C F500       F   28846             mov     Flags0, A                               ; Clear flags0
00164E F500       F   28847             mov     Flags1, A                               ; Clear flags1
001650 F500       F   28848             mov     Demag_Detected_Metric, A        ; Clear demag metric
                      28849             ;**** **** **** **** ****
                      28850             ; Motor start beginning
                      28851             ;**** **** **** **** **** 
001652 750008     F   28852             mov     Adc_Conversion_Cnt, #8                          ; Make sure a temp readi
                               ng is done
001655 120000     F   28853             call wait1ms
001658 120000     F   28854             call start_adc_conversion
00165B                28855     read_initial_temp:
00165B 30EDFD         28856             jnb     ADC0CN0_ADINT, read_initial_temp
                      28857+1           Read_Adc_Result                                         ; Read initial temperatu
                               re
001662 E9             28860             mov     A, Temp2
001663 7001           28861             jnz     ($+3)                                                   ; Is reading bel
                               ow 256?
                      28862     
001665 F8             28863             mov     Temp1, A                                                        ; Yes - 
                               set average temperature value to zero
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   463

                      28864     
001666 8800       F   28865             mov     Current_Average_Temp, Temp1                     ; Set initial average te
                               mperature
001668 120000     F   28866             call check_temp_voltage_and_limit_power
00166B 750008     F   28867             mov     Adc_Conversion_Cnt, #8                          ; Make sure a temp readi
                               ng is done next time
                      28868             ; Set up start operating conditions
00166E C2AF           28869             clr     IE_EA                           ; Disable interrupts
001670 7500FF     F   28870             mov     Pwm_Limit, #0FFh                ; Set pwm limit to max
001673 120000     F   28871             call set_startup_pwm
001676 850000     F   28872             mov     Pwm_Limit, Pwm_Limit_Beg
001679 850000     F   28873             mov     Pwm_Limit_By_Rpm, Pwm_Limit_Beg
00167C D2AF           28874             setb    IE_EA
                      28875             ; Begin startup sequence
                      28876     IF 1 == 1
                      28877+1           Set_MCU_Clk_48MHz
                      28883     ENDIF
00168D 300007         28884             jnb     Flags3.PGM_BIDIR, init_start_bidir_done ; Check if bidirectional operati
                               on
                      28885     
001690 C200       F   28886             clr     Flags3.PGM_DIR_REV                      ; Set spinning direction. Defaul
                               t fwd
001692 300002         28887             jnb     Flags2.RCP_DIR_REV, ($+5)       ; Check force direction
001695 D200       F   28888             setb    Flags3.PGM_DIR_REV                      ; Set spinning direction
                      28889     
001697                28890     init_start_bidir_done:
001697 D200       F   28891             setb    Flags1.STARTUP_PHASE            ; Set startup phase flag
001699 750000     F   28892             mov     Startup_Cnt, #0                 ; Reset counter
00169C 120000     F   28893             call comm5comm6                         ; Initialize commutation
00169F 120000     F   28894             call comm6comm1                         
0016A2 120000     F   28895             call initialize_timing                  ; Initialize timing
0016A5 120000     F   28896             call    calc_next_comm_timing           ; Set virtual commutation point
0016A8 120000     F   28897             call initialize_timing                  ; Initialize timing
0016AB 120000     F   28898             call    calc_next_comm_timing           
0016AE 120000     F   28899             call    initialize_timing                       ; Initialize timing
                      28900     
                      28901     
                      28902     
                      28903     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28904     ;
                      28905     ; Run entry point
                      28906     ;
                      28907     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28908     
                      28909     ; Run 1 = B(p-on) + C(n-pwm) - comparator A evaluated
                      28910     ; Out_cA changes from low to high
0016B1                28911     run1:
0016B1 120000     F   28912             call wait_for_comp_out_high     ; Wait for high
                      28913     ;               setup_comm_wait         ; Setup wait time from zero cross to commutation
                      28914     ;               evaluate_comparator_integrity   ; Check whether comparator reading has b
                               een normal
0016B4 120000     F   28915             call wait_for_comm                      ; Wait from zero cross to commutation
0016B7 120000     F   28916             call comm1comm2                 ; Commutate
0016BA 120000     F   28917             call calc_next_comm_timing      ; Calculate next timing and wait advance timing 
                               wait
                      28918     ;               wait_advance_timing             ; Wait advance timing and start zero cro
                               ss wait
                      28919     ;               calc_new_wait_times
                      28920     ;               wait_before_zc_scan             ; Wait zero cross wait and start zero cr
                               oss timeout
                      28921     
                      28922     ; Run 2 = A(p-on) + C(n-pwm) - comparator B evaluated
                      28923     ; Out_cB changes from high to low
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   464

0016BD                28924     run2:
0016BD 120000     F   28925             call wait_for_comp_out_low
                      28926     ;               setup_comm_wait
                      28927     ;               evaluate_comparator_integrity
0016C0 200003         28928             jb      Flags1.HIGH_RPM, ($+6)  ; Skip if high rpm
0016C3 120000     F   28929             lcall set_pwm_limit_low_rpm
0016C6 300003         28930             jnb     Flags1.HIGH_RPM, ($+6)  ; Do if high rpm
0016C9 120000     F   28931             lcall set_pwm_limit_high_rpm
0016CC 120000     F   28932             call wait_for_comm
0016CF 120000     F   28933             call comm2comm3
0016D2 120000     F   28934             call calc_next_comm_timing
                      28935     ;               wait_advance_timing
                      28936     ;               calc_new_wait_times
                      28937     ;               wait_before_zc_scan
                      28938     
                      28939     ; Run 3 = A(p-on) + B(n-pwm) - comparator C evaluated
                      28940     ; Out_cC changes from low to high
0016D5                28941     run3:
0016D5 120000     F   28942             call wait_for_comp_out_high
                      28943     ;               setup_comm_wait
                      28944     ;               evaluate_comparator_integrity
0016D8 120000     F   28945             call wait_for_comm
0016DB 120000     F   28946             call comm3comm4
0016DE 120000     F   28947             call calc_next_comm_timing
                      28948     ;               wait_advance_timing
                      28949     ;               calc_new_wait_times
                      28950     ;               wait_before_zc_scan
                      28951     
                      28952     ; Run 4 = C(p-on) + B(n-pwm) - comparator A evaluated
                      28953     ; Out_cA changes from high to low
0016E1                28954     run4:
0016E1 120000     F   28955             call wait_for_comp_out_low
                      28956     ;               setup_comm_wait
                      28957     ;               evaluate_comparator_integrity
0016E4 120000     F   28958             call wait_for_comm
0016E7 120000     F   28959             call comm4comm5
0016EA 120000     F   28960             call calc_next_comm_timing
                      28961     ;               wait_advance_timing
                      28962     ;               calc_new_wait_times
                      28963     ;               wait_before_zc_scan
                      28964     
                      28965     ; Run 5 = C(p-on) + A(n-pwm) - comparator B evaluated
                      28966     ; Out_cB changes from low to high
0016ED                28967     run5:
0016ED 120000     F   28968             call wait_for_comp_out_high
                      28969     ;               setup_comm_wait
                      28970     ;               evaluate_comparator_integrity
0016F0 120000     F   28971             call wait_for_comm
0016F3 120000     F   28972             call comm5comm6
0016F6 120000     F   28973             call calc_next_comm_timing
                      28974     ;               wait_advance_timing
                      28975     ;               calc_new_wait_times
                      28976     ;               wait_before_zc_scan
                      28977     
                      28978     ; Run 6 = B(p-on) + A(n-pwm) - comparator C evaluated
                      28979     ; Out_cC changes from high to low
0016F9                28980     run6:
0016F9 120000     F   28981             call start_adc_conversion
0016FC 120000     F   28982             call wait_for_comp_out_low
                      28983     ;               setup_comm_wait
                      28984     ;               evaluate_comparator_integrity
0016FF 120000     F   28985             call wait_for_comm
001702 120000     F   28986             call comm6comm1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   465

001705 120000     F   28987             call check_temp_voltage_and_limit_power
001708 120000     F   28988             call calc_next_comm_timing
                      28989     ;               wait_advance_timing
                      28990     ;               calc_new_wait_times
                      28991     ;               wait_before_zc_scan
                      28992     
                      28993             ; Check if it is direct startup
00170B 300027         28994             jnb     Flags1.STARTUP_PHASE, normal_run_checks
                      28995     
                      28996             ; Set spoolup power variables
00170E 850000     F   28997             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set initial max power
                      28998             ; Check startup counter
001711 7918           28999             mov     Temp2, #24                              ; Set nominal startup parameters
001713 7A0C           29000             mov     Temp3, #12
001715 C3             29001             clr     C
001716 E500       F   29002             mov     A, Startup_Cnt                          ; Load counter
001718 99             29003             subb    A, Temp2                                        ; Is counter above requi
                               rement?
001719 400E           29004             jc      direct_start_check_rcp          ; No - proceed
                      29005     
00171B C200       F   29006             clr     Flags1.STARTUP_PHASE            ; Clear startup phase flag
00171D D200       F   29007             setb    Flags1.INITIAL_RUN_PHASE                ; Set initial run phase flag
00171F 8A00       F   29008             mov     Initial_Run_Rot_Cntd, Temp3     ; Set initial run rotation count
001721 850000     F   29009             mov     Pwm_Limit, Pwm_Limit_Beg
001724 850000     F   29010             mov     Pwm_Limit_By_Rpm, Pwm_Limit_Beg
001727 800C           29011             jmp     normal_run_checks
                      29012     
001729                29013     direct_start_check_rcp:
001729 C3             29014             clr     C
00172A E500       F   29015             mov     A, New_Rcp                              ; Load new pulse value
00172C 9401           29016             subb    A, #1                                   ; Check if pulse is below stop v
                               alue
00172E 4003           29017             jc      ($+5)
                      29018     
001730 020000     F   29019             ljmp    run1                                            ; Continue to run 
                      29020     
001733 0100       F   29021             jmp     run_to_wait_for_power_on
                      29022     
                      29023     
001735                29024     normal_run_checks:
                      29025             ; Check if it is initial run phase
001735 30001F         29026             jnb     Flags1.INITIAL_RUN_PHASE, initial_run_phase_done        ; If not initial
                                run phase - branch
001738 20001C         29027             jb      Flags1.DIR_CHANGE_BRAKE, initial_run_phase_done ; If a direction change 
                               - branch
                      29028     
                      29029             ; Decrement startup rotaton count
00173B E500       F   29030             mov     A, Initial_Run_Rot_Cntd
00173D 14             29031             dec     A
                      29032             ; Check number of initial rotations
00173E 7006           29033             jnz     normal_run_check_startup_rot    ; Branch if counter is not zero
                      29034     
001740 C200       F   29035             clr     Flags1.INITIAL_RUN_PHASE                ; Clear initial run phase flag
001742 D200       F   29036             setb    Flags1.MOTOR_STARTED            ; Set motor started
001744 0100       F   29037             jmp run1                                                ; Continue with normal r
                               un
                      29038     
001746                29039     normal_run_check_startup_rot:
001746 F500       F   29040             mov     Initial_Run_Rot_Cntd, A         ; Not zero - store counter
                      29041     
001748 C3             29042             clr     C
001749 E500       F   29043             mov     A, New_Rcp                              ; Load new pulse value
00174B 9401           29044             subb    A, #1                                   ; Check if pulse is below stop v
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   466

                               alue
00174D 4003           29045             jc      ($+5)
                      29046     
00174F 020000     F   29047             ljmp    run1                                            ; Continue to run 
001752 200002         29048             jb      Flags3.PGM_BIDIR, initial_run_phase_done        ; Check if bidirectional
                                operation
001755 8061           29049             jmp     run_to_wait_for_power_on
                      29050     
001757                29051     initial_run_phase_done:
                      29052             ; Reset stall count
001757 750000     F   29053             mov     Stall_Cnt, #0
                      29054             ; Exit run loop after a given time
00175A 78FA           29055             mov     Temp1, #250
00175C 7900       F   29056             mov     Temp2, #Pgm_Brake_On_Stop
00175E E7             29057             mov     A, @Temp2
00175F 6002           29058             jz      ($+4)
                      29059     
001761 7803           29060             mov     Temp1, #3                                       ; About 100ms before sto
                               pping when brake is set
                      29061     
001763 C3             29062             clr     C
001764 E500       F   29063             mov     A, Rcp_Stop_Cnt                 ; Load stop RC pulse counter low byte va
                               lue
001766 98             29064             subb    A, Temp1                                        ; Is number of stop RC p
                               ulses above limit?
001767 504F           29065             jnc     run_to_wait_for_power_on                ; Yes, go back to wait for power
                               on
                      29066     
001769 E500       F   29067             mov     A, Rcp_Timeout_Cntd                     ; Load RC pulse timeout counter 
                               value
00176B 604B           29068             jz      run_to_wait_for_power_on                ; If it is zero - go back to wai
                               t for poweron
                      29069     
00176D                29070     run6_check_dir:
00176D 300017         29071             jnb     Flags3.PGM_BIDIR, run6_check_speed              ; Check if bidirectional
                                operation
                      29072     
001770 200005         29073             jb      Flags3.PGM_DIR_REV, run6_check_dir_rev          ; Check if actual rotati
                               on direction
001773 200007         29074             jb      Flags2.RCP_DIR_REV, run6_check_dir_change       ; Matches force directio
                               n
001776 800F           29075             jmp     run6_check_speed
                      29076     
001778                29077     run6_check_dir_rev:
001778 300002         29078             jnb     Flags2.RCP_DIR_REV, run6_check_dir_change
00177B 800A           29079             jmp     run6_check_speed
                      29080     
00177D                29081     run6_check_dir_change:
00177D 200007         29082             jb      Flags1.DIR_CHANGE_BRAKE, run6_check_speed
                      29083     
001780 D200       F   29084             setb    Flags1.DIR_CHANGE_BRAKE         ; Set brake flag
001782 850000     F   29085             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set max power while braking
001785 0100       F   29086             jmp     run4                                            ; Go back to run 4, ther
                               eby changing force direction
                      29087     
001787                29088     run6_check_speed:
001787 78F0           29089             mov     Temp1, #0F0h                            ; Default minimum speed
001789 300005         29090             jnb     Flags1.DIR_CHANGE_BRAKE, run6_brake_done; Is it a direction change?
                      29091     
00178C 850000     F   29092             mov     Pwm_Limit, Pwm_Limit_Beg        ; Set max power while braking
00178F 7820           29093             mov     Temp1, #20h                             ; Bidirectional braking terminat
                               ion speed
                      29094     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   467

001791                29095     run6_brake_done:
001791 C3             29096             clr     C
001792 E500       F   29097             mov     A, Comm_Period4x_H                      ; Is Comm_Period4x more than 32m
                               s (~1220 eRPM)?
001794 98             29098             subb    A, Temp1
001795 5003           29099             jnc     ($+5)                                   ; Yes - stop or turn direction 
001797 020000     F   29100             ljmp    run1                                            ; No - go back to run 1
                      29101     
00179A 30001B         29102             jnb     Flags1.DIR_CHANGE_BRAKE, run_to_wait_for_power_on       ; If it is not a
                                direction change - stop
                      29103     
00179D C200       F   29104             clr     Flags1.DIR_CHANGE_BRAKE         ; Clear brake flag
00179F C200       F   29105             clr     Flags3.PGM_DIR_REV                      ; Set spinning direction. Defaul
                               t fwd
0017A1 300002         29106             jnb     Flags2.RCP_DIR_REV, ($+5)       ; Check force direction
0017A4 D200       F   29107             setb    Flags3.PGM_DIR_REV                      ; Set spinning direction
0017A6 D200       F   29108             setb    Flags1.INITIAL_RUN_PHASE
0017A8 750012     F   29109             mov     Initial_Run_Rot_Cntd, #18
0017AB 850000     F   29110             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set initial max power
0017AE 0100       F   29111             jmp     run1                                            ; Go back to run 1 
                      29112     
0017B0                29113     run_to_wait_for_power_on_fail:  
0017B0 0500       F   29114             inc     Stall_Cnt                                       ; Increment stall count
0017B2 E500       F   29115             mov     A, New_Rcp                              ; Check if RCP is zero, then it 
                               is a normal stop                        
0017B4 6002           29116             jz      run_to_wait_for_power_on
0017B6 0100       F   29117             ajmp    run_to_wait_for_power_on_stall_done
                      29118     
0017B8                29119     run_to_wait_for_power_on:       
0017B8 750000     F   29120             mov     Stall_Cnt, #0
                      29121     
0017BB                29122     run_to_wait_for_power_on_stall_done:
0017BB C2AF           29123             clr     IE_EA
0017BD 120000     F   29124             call switch_power_off
0017C0 750000     F   29125             mov     Flags0, #0                              ; Clear flags0
0017C3 750000     F   29126             mov     Flags1, #0                              ; Clear flags1
                      29127     IF 1 == 1
                      29128+1           Set_MCU_Clk_24MHz
                      29134     ENDIF
0017D5 D2AF           29135             setb    IE_EA
0017D7 120000     F   29136             call    wait100ms                                       ; Wait for pwm to be sto
                               pped
0017DA 120000     F   29137             call switch_power_off
0017DD 7800       F   29138             mov     Temp1, #Pgm_Brake_On_Stop
0017DF E6             29139             mov     A, @Temp1
0017E0 6006           29140             jz      run_to_wait_for_power_on_brake_done
                      29141     
                      29142+1           AcomFET_on
                      29147+1           BcomFET_on
                      29152+1           CcomFET_on
                      29157     
0017E8                29158     run_to_wait_for_power_on_brake_done:
0017E8 C3             29159             clr     C
0017E9 E500       F   29160             mov     A, Stall_Cnt
0017EB 9404           29161             subb    A, #4
0017ED 4002           29162             jc      jmp_wait_for_power_on
0017EF 0100       F   29163             jmp     init_no_signal
                      29164     
0017F1                29165     jmp_wait_for_power_on:
0017F1 0100       F   29166             jmp     wait_for_power_on                       ; Go back to wait for power on
                      29167     
                      29168     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      29169     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   468

                      29170     ;$include (BLHeliPgm.inc) ; Include source code for programming the ESC
                    +129171     ;**** **** **** **** ****
                    +129172     ;
                    +129173     ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +129174     ;
                    +129175     ; Copyright 2011, 2012 Steffen Skaug
                    +129176     ; This program is distributed under the terms of the GNU General Public License
                    +129177     ;
                    +129178     ; This file is part of BLHeli.
                    +129179     ;
                    +129180     ; BLHeli is free software: you can redistribute it and/or modify
                    +129181     ; it under the terms of the GNU General Public License as published by
                    +129182     ; the Free Software Foundation, either version 3 of the License, or
                    +129183     ; (at your option) any later version.
                    +129184     ;
                    +129185     ; BLHeli is distributed in the hope that it will be useful,
                    +129186     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +129187     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +129188     ; GNU General Public License for more details.
                    +129189     ;
                    +129190     ; You should have received a copy of the GNU General Public License
                    +129191     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +129192     ;
                    +129193     ;**** **** **** **** ****
                    +129194     ;
                    +129195     ; BLHeliTxPgm SiLabs                                      
                    +129196     ;                                                         
                    +129197     ; EEPROM is not available in SiLabs MCUs                  
                    +129198     ; Therefore a segment of the flash is used as "EEPROM"    
                    +129199     ;                                                         
                    +129200     ;**** **** **** **** ****
                    +129201     
                    +129202     
                    +129203     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129204     ;
                    +129205     ; Read all eeprom parameters routine
                    +129206     ;
                    +129207     ; No assumptions
                    +129208     ;
                    +129209     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0017F3              +129210     read_all_eeprom_parameters:     
                    +129211             ; Check initialized signature
0017F3 900000     F +129212             mov     DPTR, #Eep_Initialized_L
0017F6 7800       F +129213             mov     Temp1, #Bit_Access
0017F8 120000     F +129214             call read_eeprom_byte
0017FB E500       F +129215             mov     A, Bit_Access
0017FD B4550A       +129216             cjne    A, #055h, read_eeprom_store_defaults
001800 A3           +129217             inc     DPTR                            ; Now Eep_Initialized_H
001801 1100       F +129218             call read_eeprom_byte
001803 E500       F +129219             mov     A, Bit_Access
001805 B4AA02       +129220             cjne    A, #0AAh, read_eeprom_store_defaults
001808 8013         +129221             jmp     read_eeprom_read
                    +129222     
                    +129223     
00180A              +129224     read_eeprom_store_defaults:
00180A 7500A5     F +129225             mov     Flash_Key_1, #0A5h
00180D 7500F1     F +129226             mov     Flash_Key_2, #0F1h
001810 120000     F +129227             call set_default_parameters     
001813 1100       F +129228             call erase_and_store_all_in_eeprom      
001815 750000     F +129229             mov     Flash_Key_1, #0
001818 750000     F +129230             mov     Flash_Key_2, #0
00181B 801D         +129231             jmp     read_eeprom_exit
                    +129232     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   469

00181D              +129233     read_eeprom_read:
                    +129234             ; Read eeprom
00181D 900000     F +129235             mov     DPTR, #_Eep_Pgm_Gov_P_Gain
001820 7800       F +129236             mov     Temp1, #_Pgm_Gov_P_Gain 
001822 7B0A         +129237             mov     Temp4, #10
001824              +129238     read_eeprom_block1:
001824 1100       F +129239             call read_eeprom_byte
001826 A3           +129240             inc     DPTR                            
001827 08           +129241             inc     Temp1                   
001828 DBFA         +129242             djnz    Temp4, read_eeprom_block1
                    +129243     
00182A 900000     F +129244             mov     DPTR, #Eep_Enable_TX_Program
00182D 7800       F +129245             mov     Temp1, #Pgm_Enable_TX_Program   
00182F 7B1A         +129246             mov     Temp4, #26      ; 26 parameters
001831              +129247     read_eeprom_block2:
001831 1100       F +129248             call read_eeprom_byte
001833 A3           +129249             inc     DPTR                            
001834 08           +129250             inc     Temp1           
001835 DBFA         +129251             djnz    Temp4, read_eeprom_block2
                    +129252     
001837 900000     F +129253             mov     DPTR, #Eep_Dummy                        ; Set pointer to uncritical area
                    +129254     
00183A              +129255     read_eeprom_exit:
00183A 22           +129256             ret
                    +129257     
                    +129258     
                    +129259     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129260     ;
                    +129261     ; Erase flash and store all parameter value in EEPROM routine
                    +129262     ;
                    +129263     ; No assumptions
                    +129264     ;
                    +129265     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00183B              +129266     erase_and_store_all_in_eeprom:
00183B C2AF         +129267             clr     IE_EA                                   ; Disable interrupts
00183D 1100       F +129268             call    read_tags
00183F 1100       F +129269             call    erase_flash                             ; Erase flash
                    +129270     
001841 900000     F +129271             mov     DPTR, #Eep_FW_Main_Revision     ; Store firmware main revision
001844 7410         +129272             mov     A, #EEPROM_FW_MAIN_REVISION
001846 1100       F +129273             call write_eeprom_byte_from_acc
                    +129274     
001848 A3           +129275             inc     DPTR                                            ; Now firmware sub revis
                               ion
001849 7441         +129276             mov     A, #EEPROM_FW_SUB_REVISION
00184B 1100       F +129277             call write_eeprom_byte_from_acc
                    +129278     
00184D A3           +129279             inc     DPTR                                            ; Now layout revision
00184E 7421         +129280             mov     A, #EEPROM_LAYOUT_REVISION
001850 1100       F +129281             call write_eeprom_byte_from_acc
                    +129282     
                    +129283             ; Write eeprom
001852 900000     F +129284             mov     DPTR, #_Eep_Pgm_Gov_P_Gain
001855 7800       F +129285             mov     Temp1, #_Pgm_Gov_P_Gain
001857 7B0A         +129286             mov     Temp4, #10
001859              +129287     write_eeprom_block1:
001859 1100       F +129288             call write_eeprom_byte
00185B A3           +129289             inc     DPTR                                            
00185C 08           +129290             inc     Temp1                                   
00185D DBFA         +129291             djnz    Temp4, write_eeprom_block1
                    +129292     
00185F 900000     F +129293             mov     DPTR, #Eep_Enable_TX_Program
001862 7800       F +129294             mov     Temp1, #Pgm_Enable_TX_Program   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   470

001864 7B1A         +129295             mov     Temp4, #26      ; 26 parameters
001866              +129296     write_eeprom_block2:
001866 1100       F +129297             call write_eeprom_byte
001868 A3           +129298             inc     DPTR                                            
001869 08           +129299             inc     Temp1                                   
00186A DBFA         +129300             djnz    Temp4, write_eeprom_block2
                    +129301     
00186C 1100       F +129302             call    write_tags
00186E 1100       F +129303             call write_eeprom_signature
001870 900000     F +129304             mov     DPTR, #Eep_Dummy                        ; Set pointer to uncritical area
001873 22           +129305             ret     
                    +129306     
                    +129307     
                    +129308     
                    +129309     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129310     ;
                    +129311     ; Read eeprom byte routine
                    +129312     ;
                    +129313     ; Gives data in A and in address given by Temp1. Assumes address in DPTR 
                    +129314     ; Also assumes address high byte to be zero
                    +129315     ;
                    +129316     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001874              +129317     read_eeprom_byte:
001874 E4           +129318             clr     A
001875 93           +129319             movc    A, @A+DPTR                      ; Read from flash
001876 F6           +129320             mov     @Temp1, A
001877 22           +129321             ret
                    +129322     
                    +129323     
                    +129324     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129325     ;
                    +129326     ; Write eeprom byte routine
                    +129327     ;
                    +129328     ; Assumes data in address given by Temp1, or in accumulator. Assumes address in DPTR 
                    +129329     ; Also assumes address high byte to be zero
                    +129330     ;
                    +129331     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001878              +129332     write_eeprom_byte:
001878 E6           +129333             mov     A, @Temp1
001879              +129334     write_eeprom_byte_from_acc:
001879 438F01       +129335             orl     PSCTL, #01h                     ; Set the PSWE bit
00187C 538FFD       +129336             anl     PSCTL, #0FDh                    ; Clear the PSEE bit
00187F FF           +129337             mov     Temp8, A
001880 C3           +129338             clr     C
001881 E583         +129339             mov     A, DPH                          ; Check that address is not in bootloade
                               r area
001883 941C         +129340             subb    A, #1Ch
001885 4001         +129341             jc      ($+3)
                    +129342     
001887 22           +129343             ret
                    +129344     
001888 EF           +129345             mov     A, Temp8
001889 8500B7     F +129346             mov     FLKEY, Flash_Key_1              ; First key code
00188C 8500B7     F +129347             mov     FLKEY, Flash_Key_2              ; Second key code
00188F F0           +129348             movx    @DPTR, A                                ; Write to flash
001890 538FFE       +129349             anl     PSCTL, #0FEh                    ; Clear the PSWE bit
001893 22           +129350             ret
                    +129351     
                    +129352     
                    +129353     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129354     ;
                    +129355     ; Erase flash routine (erases the flash segment used for "eeprom" variables)
                    +129356     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   471

                    +129357     ; No assumptions
                    +129358     ;
                    +129359     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001894              +129360     erase_flash:    
001894 438F02       +129361             orl     PSCTL, #02h                     ; Set the PSEE bit
001897 438F01       +129362             orl     PSCTL, #01h                     ; Set the PSWE bit
00189A 8500B7     F +129363             mov     FLKEY, Flash_Key_1              ; First key code
00189D 8500B7     F +129364             mov     FLKEY, Flash_Key_2              ; Second key code
0018A0 900000     F +129365             mov     DPTR, #Eep_Initialized_L        
0018A3 F0           +129366             movx    @DPTR, A
0018A4 538FFC       +129367             anl     PSCTL, #0FCh                    ; Clear the PSEE and PSWE bits
0018A7 22           +129368             ret
                    +129369     
                    +129370     
                    +129371     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129372     ;
                    +129373     ; Write eeprom signature routine
                    +129374     ;
                    +129375     ; No assumptions
                    +129376     ;
                    +129377     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0018A8              +129378     write_eeprom_signature: 
0018A8 900000     F +129379             mov     DPTR, #Eep_Initialized_L
0018AB 7455         +129380             mov     A, #055h
0018AD 1100       F +129381             call write_eeprom_byte_from_acc
                    +129382     
0018AF 900000     F +129383             mov     DPTR, #Eep_Initialized_H
0018B2 74AA         +129384             mov     A, #0AAh
0018B4 1100       F +129385             call write_eeprom_byte_from_acc
0018B6 22           +129386             ret
                    +129387     
                    +129388     
                    +129389     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129390     ;
                    +129391     ; Read all tags from flash and store in temporary storage
                    +129392     ;
                    +129393     ; No assumptions
                    +129394     ;
                    +129395     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0018B7              +129396     read_tags:
0018B7 7A30         +129397             mov     Temp3, #48                              ; Number of tags
0018B9 7900       F +129398             mov     Temp2, #Temp_Storage            ; Set RAM address
0018BB 7800       F +129399             mov     Temp1, #Bit_Access
0018BD 900000     F +129400             mov     DPTR, #Eep_ESC_Layout           ; Set flash address
0018C0              +129401     read_tag:       
0018C0 1100       F +129402             call read_eeprom_byte
0018C2 E500       F +129403             mov     A, Bit_Access
0018C4 F7           +129404             mov     @Temp2, A                       ; Write to RAM
0018C5 09           +129405             inc     Temp2
0018C6 A3           +129406             inc     DPTR
0018C7 DAF7         +129407             djnz Temp3, read_tag    
0018C9 22           +129408             ret
                    +129409     
                    +129410     
                    +129411     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129412     ;
                    +129413     ; Write all tags from temporary storage and store in flash
                    +129414     ;
                    +129415     ; No assumptions
                    +129416     ;
                    +129417     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0018CA              +129418     write_tags:
0018CA 7A30         +129419             mov     Temp3, #48                              ; Number of tags
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   472

0018CC 7900       F +129420             mov     Temp2, #Temp_Storage            ; Set RAM address
0018CE 900000     F +129421             mov     DPTR, #Eep_ESC_Layout           ; Set flash address
0018D1              +129422     write_tag:      
0018D1 E7           +129423             mov     A, @Temp2                       ; Read from RAM
0018D2 1100       F +129424             call write_eeprom_byte_from_acc
0018D4 09           +129425             inc     Temp2
0018D5 A3           +129426             inc     DPTR
0018D6 DAF9         +129427             djnz Temp3, write_tag   
0018D8 22           +129428             ret
                    +129429     
                    +129430     
                    +129431     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129432     ;
                    +129433     ; Wait 1 second routine
                    +129434     ;
                    +129435     ; No assumptions
                    +129436     ;
                    +129437     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0018D9              +129438     wait1s:
0018D9 7C05         +129439             mov     Temp5, #5
0018DB              +129440     wait1s_loop:
0018DB 120000     F +129441             call wait200ms
0018DE DCFB         +129442             djnz    Temp5, wait1s_loop
0018E0 22           +129443             ret
                    +129444     
                    +129445     
                    +129446     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129447     ;
                    +129448     ; Success beep routine
                    +129449     ;
                    +129450     ; No assumptions
                    +129451     ;
                    +129452     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0018E1              +129453     success_beep:
0018E1 C2AF         +129454             clr     IE_EA                           ; Disable all interrupts
0018E3 120000     F +129455             call beep_f1
0018E6 120000     F +129456             call beep_f2
0018E9 120000     F +129457             call beep_f3
0018EC 120000     F +129458             call beep_f4
0018EF 120000     F +129459             call wait10ms
0018F2 120000     F +129460             call beep_f1
0018F5 120000     F +129461             call beep_f2
0018F8 120000     F +129462             call beep_f3
0018FB 120000     F +129463             call beep_f4
0018FE 120000     F +129464             call wait10ms
001901 120000     F +129465             call beep_f1
001904 120000     F +129466             call beep_f2
001907 120000     F +129467             call beep_f3
00190A 120000     F +129468             call beep_f4
00190D D2AF         +129469             setb    IE_EA                           ; Enable all interrupts
00190F 22           +129470             ret
                    +129471     
                    +129472     
                    +129473     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129474     ;
                    +129475     ; Success beep inverted routine
                    +129476     ;
                    +129477     ; No assumptions
                    +129478     ;
                    +129479     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001910              +129480     success_beep_inverted:
001910 C2AF         +129481             clr     IE_EA                           ; Disable all interrupts
001912 120000     F +129482             call beep_f4
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   473

001915 120000     F +129483             call beep_f3
001918 120000     F +129484             call beep_f2
00191B 120000     F +129485             call beep_f1
00191E 120000     F +129486             call wait10ms
001921 120000     F +129487             call beep_f4
001924 120000     F +129488             call beep_f3
001927 120000     F +129489             call beep_f2
00192A 120000     F +129490             call beep_f1
00192D 120000     F +129491             call wait10ms
001930 120000     F +129492             call beep_f4
001933 120000     F +129493             call beep_f3
001936 120000     F +129494             call beep_f2
001939 120000     F +129495             call beep_f1
00193C D2AF         +129496             setb    IE_EA                           ; Enable all interrupts
00193E 22           +129497             ret
                    +129498     
                    +129499     
                      29500     ;$include (BLHeliBootLoad.inc) ; Include source code for bootloader
                    +129501     ; BLHeli bootloader for SiLabs MCUs. Based upon AVRootloader (copyright HR)
                    +129502     
 017D7840           +129503     XTAL                                    EQU     25000000        
                    +129504     
 1C00               +129505     BOOT_START                      EQU     1C00h   ; Bootloader segment address
 005F5E10           +129506     BOOT_DELAY                      EQU     XTAL/4  ; About 250ms (don't set to fast to avoi
                               d connection problems)
 4B00               +129507     BOOT_BAUDRATE                   EQU     19200   ; Only used if no baudrate detection act
                               ivated, XTAL is than important
 0006               +129508     BOOT_VERSION                    EQU     6               ; Version 6 (must be not changed
                               )
 0001               +129509     BOOT_PAGES                      EQU     1               ; Number of flash segments for b
                               ootloader
                    +129510     
 001A               +129511     UART_LOOP                               EQU     26              ; Depends upon timing of
                                putc, getc 
 0198               +129512     BAUDTIME                                EQU     ((XTAL/BOOT_BAUDRATE)/3)-UART_LOOP
                    +129513     
 0030               +129514     SUCCESS                         EQU     030h
 00C0               +129515     ERRORVERIFY                     EQU     0C0h
 00C1               +129516     ERRORCOMMAND                    EQU     0C1h
 00C2               +129517     ERRORCRC                                EQU     0C2h
 00C5               +129518     ERRORPROG                               EQU     0C5h
                    +129519     
 A001               +129520     POLYNOM                         EQU     0A001h          ; CRC Polynom
                    +129521     
  REG               +129522     Xl                                      EQU     R0                      ; Temporary X
  REG               +129523     Xh                                      EQU     R1
  REG               +129524     Paral                           EQU     R2                      ; Params for UART
  REG               +129525     Parah                           EQU     R3      
  REG               +129526     Cmdl                                    EQU     R4                      ; Commands
  REG               +129527     Cmdh                                    EQU     R5      
  REG               +129528     Cntl                                    EQU     R6                      ; Baudtime
  REG               +129529     Cnth                                    EQU     R7
                    +129530     
000020              +129531     DSEG AT 20h                                     
000020              +129532     Bit_Reg:                                DS      1                       ; Bit storage re
                               gister
000021              +129533     Byte_Reg:                               DS      1                       ; Byte storage r
                               egister
000022              +129534     Crcl:                           DS      1                       ; CRC 16Bit
000023              +129535     Crch:                           DS      1
000024              +129536     Baudl:                          DS      1                       ; Baudtime
000025              +129537     Baudh:                          DS      1
000026              +129538     Bit_Cnt:                                DS      1                       ; Counter in UAR
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   474

                               T loops
000027              +129539     Byte_Cntl:                      DS      1                       ; Generic counter
000028              +129540     Byte_Cnth:                      DS      1                       
000029              +129541     BL_Flash_Key_1:         DS      1                       ; Flash keys
00002A              +129542     BL_Flash_Key_2:         DS      1
                    +129543     
001C00              +129544     CSEG AT BOOT_START              ; Bootloader start
001C00 C2AF         +129545     init:clr        IE_EA
                    +129546             ; Select register bank 0 for main program routines
001C02 C2D3         +129547             clr     PSW.3                           ; Select register bank 0 for main progra
                               m routines      
                    +129548             ; Disable the WDT.
001C04 7597DE       +129549             mov     WDTCN, #0DEh                    ; Disable watchdog
001C07 7597AD       +129550             mov     WDTCN, #0ADh            
                    +129551             ; Initialize stack
001C0A 7581C0       +129552             mov     SP, #0c0h                               ; Stack = 64 upper bytes of RAM
                    +129553             ; Initialize clock
001C0D 75A900       +129554             mov     CLKSEL, #00h                    ; Set clock divider to 1
                    +129555             ; Initialize VDD monitor
001C10 43FF80       +129556             orl     VDM0CN, #080h                   ; Enable the VDD monitor
001C13 750038     F +129557             mov     Baudl, #38h                     ; Wait 100us
001C16 750003     F +129558             mov     Baudh, #03h
001C19 1100       F +129559             acall waitf
                    +129560             ; Initialize flash keys
001C1B 7500A5     F +129561             mov     BL_Flash_Key_1, #0A5h   ; First key code
001C1E 7500F1     F +129562             mov     BL_Flash_Key_2, #0F1h   ; Second key code
                    +129563             ; Initialize ports
001C21 43F120       +129564             orl     RTX_MDIN, #(1 SHL RTX_PIN)              ; Set digital
001C24 53A4DF       +129565             anl     RTX_MDOUT, #NOT(1 SHL RTX_PIN)  ; Disable pushpull
001C27 D285         +129566             setb    RTX_PORT.RTX_PIN                                ; Set data high
001C29 75D4FF       +129567             mov     RTX_SKIP, #0FFh
001C2C 75E340       +129568             mov     XBR2, #40h;                                     ; Enable crossbar
                    +129569             ; Set number of connect attempts before exiting bootloader
001C2F 7DFA         +129570             mov     Cmdh, #250
                    +129571     
                    +129572             ; Identifier scanning
001C31 7803         +129573     abd:    mov     Xl, #(low(BOOT_DELAY / 6)+1)
001C33 79E6         +129574             mov     Xh, #(high(BOOT_DELAY / 6)+1)
001C35 7C10         +129575             mov     Cmdl, #(high((BOOT_DELAY / 6) SHR 8)+1)
001C37 750000     F +129576             mov     Crcl, #0
001C3A 750000     F +129577             mov     Crch, #0
001C3D 900000     F +129578             mov     DPTR, #BOOT_SIGN
001C40 7B06         +129579             mov     Parah, #(BOOT_MSG - BOOT_SIGN)
001C42 750098     F +129580             mov     Baudl, #low(BAUDTIME)
001C45 750001     F +129581             mov     Baudh, #high(BAUDTIME)
                    +129582     
001C48              +129583     wait_for_low:
001C48 308502       +129584             jnb     RTX_PORT.RTX_PIN, ($+5)
001C4B 0100       F +129585             ajmp wait_for_low
                    +129586     
                    +129587             ; Identifier (BOOT_SIGN) scanning with timeout and checksum
001C4D 208508       +129588     id1:    jb      RTX_PORT.RTX_PIN, id3   ; Look for high
001C50 D8FB         +129589             djnz    Xl, id1                         ; Subtract 1 from X (BOOT_DELAY)
001C52 D9F9         +129590             djnz    Xh, id1
001C54 DCF7         +129591             djnz    Cmdl, id1 
                    +129592     
001C56 0100       F +129593             ajmp    exit
                    +129594     
001C58 308508       +129595     id3:    jnb     RTX_PORT.RTX_PIN, id4   ; Look for low
001C5B D8FB         +129596             djnz    Xl, id3                         ; Subtract 1 from X (BOOT_DELAY)
001C5D D9F9         +129597             djnz    Xh, id3
001C5F DCF7         +129598             djnz    Cmdl, id3
                    +129599     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   475

001C61 0100       F +129600             ajmp    exit
                    +129601     
001C63 1100       F +129602     id4:    acall getx                              ; Read character
001C65 E4           +129603             clr     A                       
001C66 93           +129604             movc A, @A+DPTR                 ; Load BOOT_SIGN character
001C67 A3           +129605             inc     DPTR
001C68 C3           +129606             clr     C
001C69 9A           +129607             subb    A, Paral                                ; Compare with read character
001C6A 6004         +129608             jz      id5
001C6C DDC3         +129609             djnz    Cmdh, abd                               ; Retry if not last connect atte
                               mpt
001C6E 0100       F +129610             ajmp    exit
                    +129611     
001C70              +129612     id5:
001C70 DBDB         +129613             djnz    Parah, id1
                    +129614     
001C72 1100       F +129615             acall getw                              ; Read CRC
001C74 6002         +129616             jz      ($+4)                           ; Check CRC
001C76 0100       F +129617             ajmp    abd
                    +129618             
                    +129619             ; Send info about chip/bootloader (BOOT_MSG + BOOT_INFO)
001C78 7B08         +129620             mov     Parah, #((BOOT_INFO - BOOT_MSG) + 4)
001C7A E4           +129621     in1:    clr     A                       
001C7B 93           +129622             movc A, @A+DPTR                 ; Load character
001C7C FA           +129623             mov     Paral, A
001C7D A3           +129624             inc     DPTR
001C7E 1100       F +129625             acall putc
001C80 DBF8         +129626             djnz    Parah, in1
                    +129627     
                    +129628     
                    +129629             ; Main commandloop
                    +129630             ; 0=Run/restart 
                    +129631             ; 1=Program flash, 2=Erase flash, 3=Read flash
                    +129632             ; 0xFF=Set address, 0xFE=Set buffer, 0xFD=Keep alive 
001C82 7A30         +129633     main:mov        Paral, #SUCCESS
001C84 1100       F +129634     mai1:acall putc
001C86 750000     F +129635             mov     Crcl, #0                                ; Reset CRC
001C89 750000     F +129636             mov     Crch, #0
001C8C 1100       F +129637             acall getw                              ; Get command
001C8E EA           +129638             mov     A, Paral
001C8F FC           +129639             mov     Cmdl, A
001C90 EB           +129640             mov     A, Parah
001C91 FD           +129641             mov     Cmdh, A
001C92 C3           +129642             clr     C
001C93 ED           +129643             mov     A, Cmdh
001C94 94FE         +129644             subb    A, #0FEh
001C96 400E         +129645             jc      mai2                                    ; Jump if not set address or set
                                buffer 
                    +129646     
001C98 1100       F +129647             acall getw                              ; Address or number of bytes
001C9A 8A00       F +129648             mov     Byte_Cntl, Paral                ; Store number of bytes for set buffer
001C9C 8B00       F +129649             mov     Byte_Cnth, Parah        
001C9E ED           +129650             mov     A, Cmdh
001C9F 30E004       +129651             jnb     ACC.0, mai2                     ; Jump if set buffer
                    +129652     
001CA2 8A82         +129653             mov     DPL, Paral                      ; Store flash address (for set address)
001CA4 8B83         +129654             mov     DPH, Parah
                    +129655     
001CA6 1100       F +129656     mai2:acall getw                         ; Get CRC
001CA8 7AC2         +129657             mov     Paral, #ERRORCRC
001CAA 70D8         +129658             jnz     mai1
001CAC C3           +129659             clr     C
001CAD ED           +129660             mov     A, Cmdh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   476

001CAE 94FE         +129661             subb    A, #0FEh
001CB0 6019         +129662             jz      setbuf                          ; If command is set buffer, receive data
001CB2 50CE         +129663             jnc     main
                    +129664     
001CB4 BD0029       +129665             cjne    Cmdh, #0, mai4                  ; Jump if command != 0 (and not set buff
                               er)
                    +129666     
                    +129667             ; Run application/restart bootloader
001CB7 EC           +129668             mov     A, Cmdl
001CB8 600F         +129669             jz      rst
001CBA 750000     F +129670     exit:mov        Bit_Access, #0                  ; Clear variable used by flash lock dete
                               ct
001CBD 7500FF     F +129671             mov     Bit_Access_Int, #0FFh   ; Set variable to indicate that program executio
                               n came from bootloader
001CC0 750000     F +129672             mov     BL_Flash_Key_1, #0              ; Set flash keys to invalid values
001CC3 750000     F +129673             mov     BL_Flash_Key_2, #0
001CC6 020000       +129674             ljmp    0000h
001CC9 0100       F +129675     rst:    ajmp    init
                    +129676     
                    +129677             ; Set buffer
001CCB A800       F +129678     setbuf:mov Xl, Byte_Cntl                        ; Set number of bytes 
001CCD A900       F +129679             mov     Xh, Byte_Cnth
001CCF 08           +129680             inc     Xl      
001CD0 09           +129681             inc     Xh      
001CD1 D804         +129682     set4:djnz       Xl, set5
001CD3 D902         +129683             djnz    Xh, set5
001CD5 0100       F +129684             ajmp    set6
                    +129685     
001CD7 1100       F +129686     set5:acall getc                         ; Receive data
001CD9 EA           +129687             mov     A, Paral
001CDA F2           +129688             movx    @Xl, A                          ; Store data in XRAM
001CDB 0100       F +129689             ajmp    set4
                    +129690     
001CDD 0D           +129691     set6:inc        Cmdh    
001CDE 0100       F +129692             ajmp    mai2
                    +129693     
001CE0 C3           +129694     mai4:clr        C
001CE1 ED           +129695             mov     A, Cmdh
001CE2 9403         +129696             subb    A, #3
001CE4 5051         +129697             jnc     mai5                                    ; Jump if command >= 3
                    +129698     
                    +129699             ; Program/erase
001CE6 ED           +129700             mov     A, Cmdh
001CE7 A2E0         +129701             mov     C, ACC.0
001CE9 9200       F +129702             mov     Bit_Reg.0, C    
001CEB 7AC5         +129703             mov     Paral, #ERRORPROG
001CED C3           +129704             clr     C
001CEE E582         +129705             mov     A, DPL
001CF0 9400         +129706             subb    A, #low(BOOT_START)
001CF2 E583         +129707             mov     A, DPH
001CF4 941C         +129708             subb    A, #high(BOOT_START)
001CF6 508C         +129709             jnc     mai1                                    ; Jump if in bootloader segment
001CF8 200010       +129710             jb      Bit_Reg.0, pro3         ; Jump if program command
                    +129711     
                    +129712             ; Erase flash
001CFB 438F02       +129713             orl     PSCTL, #02h                     ; Set the PSEE bit
001CFE 438F01       +129714             orl     PSCTL, #01h                     ; Set the PSWE bit
001D01 8500B7     F +129715             mov     FLKEY, BL_Flash_Key_1   ; First key code
001D04 8500B7     F +129716             mov     FLKEY, BL_Flash_Key_2   ; Second key code
001D07 F0           +129717             movx    @DPTR, A
001D08 300027       +129718             jnb     Bit_Reg.0, pro6         ; Jump if erase command
                    +129719     
                    +129720             ; Program flash
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   477

001D0B A800       F +129721     pro3:mov        Xl, Byte_Cntl                   ; Set number of bytes 
001D0D A900       F +129722             mov     Xh, Byte_Cnth
001D0F 08           +129723             inc     Xl      
001D10 09           +129724             inc     Xh      
001D11 438F01       +129725             orl     PSCTL, #01h                     ; Set the PSWE bit
001D14 538FFD       +129726             anl     PSCTL, #0FDh                    ; Clear the PSEE bit
001D17 D804         +129727     pro4:djnz       Xl, pro5
001D19 D902         +129728             djnz    Xh, pro5
001D1B 0100       F +129729             ajmp    pro6
                    +129730     
001D1D              +129731     pro5:
001D1D C3           +129732             clr     C
001D1E E583         +129733             mov     A, DPH                          ; Check that address is not in bootloade
                               r area
001D20 941C         +129734             subb    A, #1Ch
001D22 4003         +129735             jc      ($+5)
                    +129736     
001D24 A3           +129737             inc     DPTR                                    ; Increment flash address
001D25 0100       F +129738             ajmp    pro4
                    +129739     
001D27 E2           +129740             movx    A, @Xl                          ; Read from XRAM                
001D28 8500B7     F +129741             mov     FLKEY, BL_Flash_Key_1   ; First key code
001D2B 8500B7     F +129742             mov     FLKEY, BL_Flash_Key_2   ; Second key code
001D2E F0           +129743             movx    @DPTR, A                                ; Write to flash
001D2F A3           +129744             inc     DPTR                                    ; Increment flash address
001D30 0100       F +129745             ajmp    pro4
                    +129746     
001D32 538FFC       +129747     pro6:anl        PSCTL, #0FCh                    ; Clear the PSEE and PSWE bits
001D35 0100       F +129748             ajmp    main                                    ; Successfully done erase or pro
                               gram
                    +129749     
                    +129750             ; Read flash
001D37 7AC1         +129751     mai5:mov        Paral, #ERRORCOMMAND    ; Illegal command
001D39 BD030C       +129752             cjne    Cmdh, #3, mai6                  ; Jump if not read flash command
                    +129753     
001D3C E4           +129754     rd1:    clr     A
001D3D 93           +129755             movc    A, @A+DPTR                      ; Read from flash
001D3E A3           +129756             inc     DPTR                                    ; Increment flash address
001D3F FA           +129757             mov     Paral, A
001D40 1100       F +129758             acall putp
001D42 DCF8         +129759             djnz    Cmdl, rd1                       ; Decrement bytes to read       
                    +129760     
001D44 1100       F +129761             acall putw                              ; CRC
001D46 0100       F +129762             ajmp    main
                    +129763     
001D48 0100       F +129764     mai6:ajmp       mai1
                    +129765     
                    +129766     
                    +129767     
                    +129768     
                    +129769             ; Send char with crc
001D4A AA00       F +129770     putw:mov        Paral, Crcl
001D4C AB00       F +129771             mov     Parah, Crch
001D4E 1100       F +129772             acall putc
001D50 EB           +129773             mov     A, Parah
001D51 FA           +129774             mov     Paral, A
001D52 EA           +129775     putp:mov        A, Paral
001D53 6200       F +129776             xrl     Crcl, A
001D55 750008     F +129777             mov     Bit_Cnt, #8
001D58 C3           +129778     put1:clr        C
001D59 E500       F +129779             mov     A, Crch
001D5B 13           +129780             rrc     A
001D5C F500       F +129781             mov     Crch, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   478

001D5E E500       F +129782             mov     A, Crcl
001D60 13           +129783             rrc     A
001D61 F500       F +129784             mov     Crcl, A
001D63 5006         +129785             jnc     put2
                    +129786     
001D65 6300A0     F +129787             xrl     Crch, #high(POLYNOM)
001D68 630001     F +129788             xrl     Crcl, #low(POLYNOM)
                    +129789     
001D6B D500EA       +129790     put2:djnz       Bit_Cnt, put1
                    +129791     
                    +129792     
                    +129793             ; Send char
001D6E 1100       F +129794     putc:acall waitf
001D70 1100       F +129795             acall waitf
001D72 75000A     F +129796             mov     Bit_Cnt, #10
001D75 EA           +129797             mov     A, Paral
001D76 F4           +129798             cpl     A
001D77 200002       +129799     put3:jb Bit_Reg.1, ($+5)
001D7A D285         +129800             setb    RTX_PORT.RTX_PIN                ; Set pin high
001D7C 300002       +129801             jnb     Bit_Reg.1, ($+5)
001D7F C285         +129802             clr     RTX_PORT.RTX_PIN                ; Set pin low
001D81 1100       F +129803             acall waitf                                                     
001D83 C3           +129804             clr     C
001D84 13           +129805             rrc     A
001D85 4002         +129806             jc      put4            
                    +129807                                                     
001D87 C200       F +129808             clr     Bit_Reg.1
                    +129809     
001D89 D500EB       +129810     put4:djnz       Bit_Cnt, put3
                    +129811     
001D8C 22           +129812             ret
                    +129813     
                    +129814     
                    +129815             ; Receive char/word
001D8D 1100       F +129816     getw:acall getc
001D8F EA           +129817             mov     A, Paral
001D90 FB           +129818             mov     Parah, A
001D91 208502       +129819     getc:jb RTX_PORT.RTX_PIN, ($+5) ; Wait for high
001D94 0100       F +129820             ajmp    getc
                    +129821     
001D96 308502       +129822     get1:jnb        RTX_PORT.RTX_PIN, ($+5) ; Wait for low
001D99 0100       F +129823             ajmp    get1
                    +129824     
001D9B 750008     F +129825     getx:mov        Bit_Cnt, #8
001D9E AE00       F +129826             mov     Cntl, Baudl
001DA0 AF00       F +129827             mov     Cnth, Baudh
001DA2 C3           +129828             clr     C
001DA3 EF           +129829             mov     A, Cnth                         ; Wait half a baud
001DA4 13           +129830             rrc     A
001DA5 FF           +129831             mov     Cnth, A
001DA6 EE           +129832             mov     A, Cntl
001DA7 13           +129833             rrc     A
001DA8 FE           +129834             mov     Cntl, A
001DA9 1100       F +129835             acall waith
001DAB 1100       F +129836     get2:acall waitf                                ; Wait one baud                         
                                                       
001DAD C3           +129837             clr     C
001DAE EA           +129838             mov     A, Paral
001DAF 13           +129839             rrc     A
001DB0 308502       +129840             jnb     RTX_PORT.RTX_PIN, ($+5)                 
001DB3 4480         +129841             orl     A, #080h
                    +129842     
001DB5 FA           +129843             mov     Paral, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   479

001DB6 30E703       +129844             jnb     ACC.7, ($+6) 
001DB9 630001     F +129845             xrl     Crcl, #low(POLYNOM)
                    +129846     
001DBC C3           +129847             clr     C
001DBD E500       F +129848             mov     A, Crch
001DBF 13           +129849             rrc     A
001DC0 F500       F +129850             mov     Crch, A
001DC2 E500       F +129851             mov     A, Crcl
001DC4 13           +129852             rrc     A
001DC5 F500       F +129853             mov     Crcl, A
001DC7 5006         +129854             jnc     get3                            
                    +129855     
001DC9 6300A0     F +129856             xrl     Crch, #high(POLYNOM)
001DCC 630001     F +129857             xrl     Crcl, #low(POLYNOM)
                    +129858     
001DCF D500D9       +129859     get3:djnz       Bit_Cnt, get2
                    +129860     
001DD2 E500       F +129861             mov     A, Crcl 
001DD4 6500       F +129862             xrl     A, Crch 
001DD6 6500       F +129863             xrl     A, Crch 
001DD8 F500       F +129864             mov     Crcl, A
001DDA 22           +129865             ret
                    +129866     
                    +129867     
                    +129868             ; UART delays                                                                   
                                       
001DDB AE00       F +129869     waitf:mov       Cntl, Baudl     
001DDD AF00       F +129870             mov     Cnth, Baudh
001DDF 0E           +129871     waith:inc Cntl
001DE0 0F           +129872             inc     Cnth
001DE1 DEFE         +129873     wait1:djnz Cntl, wait1
001DE3 DFFC         +129874             djnz Cnth, wait1
                    +129875     
001DE5 D200       F +129876             setb    Bit_Reg.1
001DE7 22           +129877             ret                                                                     
                    +129878     
                    +129879     
001DE8 424C4865     +129880     BOOT_SIGN:      DB      "BLHeli"        
001DEC 6C69                     
                    +129881     
001DEE 34373164     +129882     BOOT_MSG:               DB      "471d"          ; Interface-MCU_BootlaoderRevision
                    +129883     
001DF2 E8B20601     +129884     BOOT_INFO:      DB      SIGNATURE_001, SIGNATURE_002, BOOT_VERSION, BOOT_PAGES
                    +129885     
                      29886     
                      29887     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      29888     
                      29889     
                      29890     
0019FD                29891     CSEG AT 19FDh
0019FD                29892     reset:
0019FD 020000     F   29893     ljmp    pgm_start
                      29894     
                      29895     
                      29896     
                      29897     END
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   480

SYMBOL TABLE LISTING
------ ----- -------


N A M E                              T Y P E  V A L U E     ATTRIBUTES

_EEP_MAIN_REARM_START . . . . . . .  C  ADDR  1A10H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_BEC_VOLTAGE_HIGH . . . . .  C  ADDR  1A20H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_DAMPING_FORCE. . . . . . .  C  ADDR  1A16H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_ENABLE_PWM_INPUT . . . . .  C  ADDR  1A25H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_I_GAIN . . . . . . . .  C  ADDR  1A04H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_MODE . . . . . . . . .  C  ADDR  1A05H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_P_GAIN . . . . . . . .  C  ADDR  1A03H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_RANGE. . . . . . . . .  C  ADDR  1A17H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_SETUP_TARGET . . . . .  C  ADDR  1A11H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_INPUT_POL. . . . . . . . .  C  ADDR  1A0CH     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_LOW_VOLTAGE_LIM. . . . . .  C  ADDR  1A06H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_MAIN_SPOOLUP_TIME. . . . .  C  ADDR  1A22H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_MOTOR_GAIN . . . . . . . .  C  ADDR  1A07H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_MOTOR_IDLE . . . . . . . .  C  ADDR  1A08H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_PWM_DITHER . . . . . . . .  C  ADDR  1A26H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_PWM_FREQ . . . . . . . . .  C  ADDR  1A0AH     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_STARTUP_ACCEL. . . . . . .  C  ADDR  1A13H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_STARTUP_METHOD . . . . . .  C  ADDR  1A18H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_STARTUP_RPM. . . . . . . .  C  ADDR  1A12H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_THROTTLE_RATE. . . . . . .  C  ADDR  1A1EH     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_VOLT_COMP. . . . . . . . .  C  ADDR  1A14H     R   SEG=?CO?BLHELI_S?7
_PGM_BEC_VOLTAGE_HIGH . . . . . . .  I  ADDR  009DH     R   SEG=?ID?BLHELI_S?5
_PGM_DAMPING_FORCE. . . . . . . . .  I  ADDR  0093H     R   SEG=?ID?BLHELI_S?5
_PGM_ENABLE_PWM_INPUT . . . . . . .  I  ADDR  00A2H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_I_GAIN . . . . . . . . . .  I  ADDR  0081H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_MODE . . . . . . . . . . .  I  ADDR  0082H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_P_GAIN . . . . . . . . . .  I  ADDR  0080H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_RANGE. . . . . . . . . . .  I  ADDR  0094H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_SETUP_TARGET . . . . . . .  I  ADDR  008EH     R   SEG=?ID?BLHELI_S?5
_PGM_LOW_VOLTAGE_LIM. . . . . . . .  I  ADDR  0083H     R   SEG=?ID?BLHELI_S?5
_PGM_MAIN_REARM_START . . . . . . .  I  ADDR  008DH     R   SEG=?ID?BLHELI_S?5
_PGM_MAIN_SPOOLUP_TIME. . . . . . .  I  ADDR  009FH     R   SEG=?ID?BLHELI_S?5
_PGM_MOTOR_GAIN . . . . . . . . . .  I  ADDR  0084H     R   SEG=?ID?BLHELI_S?5
_PGM_MOTOR_IDLE . . . . . . . . . .  I  ADDR  0085H     R   SEG=?ID?BLHELI_S?5
_PGM_PWM_DITHER . . . . . . . . . .  I  ADDR  00A3H     R   SEG=?ID?BLHELI_S?5
_PGM_PWM_FREQ . . . . . . . . . . .  I  ADDR  0087H     R   SEG=?ID?BLHELI_S?5
_PGM_STARTUP_ACCEL. . . . . . . . .  I  ADDR  0090H     R   SEG=?ID?BLHELI_S?5
_PGM_STARTUP_METHOD . . . . . . . .  I  ADDR  0095H     R   SEG=?ID?BLHELI_S?5
_PGM_STARTUP_RPM. . . . . . . . . .  I  ADDR  008FH     R   SEG=?ID?BLHELI_S?5
_PGM_THROTTLE_RATE. . . . . . . . .  I  ADDR  009BH     R   SEG=?ID?BLHELI_S?5
_PGM_VOLT_COMP. . . . . . . . . . .  I  ADDR  0091H     R   SEG=?ID?BLHELI_S?5
A_. . . . . . . . . . . . . . . . .  N  NUMB  0001H     A   
ABD . . . . . . . . . . . . . . . .  C  ADDR  1C31H     R   SEG=?CO?BLHELI_S?19
ACC . . . . . . . . . . . . . . . .  D  ADDR  00E0H     A   
ACC_ACC0. . . . . . . . . . . . . .  B  ADDR  00E0H.0   A   
ACC_ACC1. . . . . . . . . . . . . .  B  ADDR  00E0H.1   A   
ACC_ACC2. . . . . . . . . . . . . .  B  ADDR  00E0H.2   A   
ACC_ACC3. . . . . . . . . . . . . .  B  ADDR  00E0H.3   A   
ACC_ACC4. . . . . . . . . . . . . .  B  ADDR  00E0H.4   A   
ACC_ACC5. . . . . . . . . . . . . .  B  ADDR  00E0H.5   A   
ACC_ACC6. . . . . . . . . . . . . .  B  ADDR  00E0H.6   A   
ACC_ACC7. . . . . . . . . . . . . .  B  ADDR  00E0H.7   A   
ACOMFET . . . . . . . . . . . . . .  N  NUMB  0005H     A   
ADC0. . . . . . . . . . . . . . . .  D  ADDR  00BDH     A   
ADC0AC. . . . . . . . . . . . . . .  D  ADDR  00B3H     A   
ADC0CF. . . . . . . . . . . . . . .  D  ADDR  00BCH     A   
ADC0CN0 . . . . . . . . . . . . . .  D  ADDR  00E8H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   481

ADC0CN0_ADBMEN. . . . . . . . . . .  B  ADDR  00E8H.6   A   
ADC0CN0_ADBUSY. . . . . . . . . . .  B  ADDR  00E8H.4   A   
ADC0CN0_ADCM0 . . . . . . . . . . .  B  ADDR  00E8H.0   A   
ADC0CN0_ADCM1 . . . . . . . . . . .  B  ADDR  00E8H.1   A   
ADC0CN0_ADCM2 . . . . . . . . . . .  B  ADDR  00E8H.2   A   
ADC0CN0_ADEN. . . . . . . . . . . .  B  ADDR  00E8H.7   A   
ADC0CN0_ADINT . . . . . . . . . . .  B  ADDR  00E8H.5   A   
ADC0CN0_ADWINT. . . . . . . . . . .  B  ADDR  00E8H.3   A   
ADC0CN1 . . . . . . . . . . . . . .  D  ADDR  00B2H     A   
ADC0EOC_IRQN. . . . . . . . . . . .  N  NUMB  000AH     A   
ADC0GT. . . . . . . . . . . . . . .  D  ADDR  00C3H     A   
ADC0GTH . . . . . . . . . . . . . .  D  ADDR  00C4H     A   
ADC0GTL . . . . . . . . . . . . . .  D  ADDR  00C3H     A   
ADC0H . . . . . . . . . . . . . . .  D  ADDR  00BEH     A   
ADC0L . . . . . . . . . . . . . . .  D  ADDR  00BDH     A   
ADC0LT. . . . . . . . . . . . . . .  D  ADDR  00C5H     A   
ADC0LTH . . . . . . . . . . . . . .  D  ADDR  00C6H     A   
ADC0LTL . . . . . . . . . . . . . .  D  ADDR  00C5H     A   
ADC0MX. . . . . . . . . . . . . . .  D  ADDR  00BBH     A   
ADC0PWR . . . . . . . . . . . . . .  D  ADDR  00DFH     A   
ADC0TK. . . . . . . . . . . . . . .  D  ADDR  00B9H     A   
ADC0WC_IRQN . . . . . . . . . . . .  N  NUMB  0009H     A   
ADC_CONVERSION_CNT. . . . . . . . .  D  ADDR  005CH     R   SEG=?DT?BLHELI_S?4
ADJUST_TIMING_TWO_STEPS . . . . . .  C  ADDR  0822H     R   SEG=?CO?BLHELI_S?17
ADJUST_TIMING_TWO_STEPS_FAST. . . .  C  ADDR  0887H     R   SEG=?CO?BLHELI_S?17
APWMFET . . . . . . . . . . . . . .  N  NUMB  0002H     A   
ARM_BEEP. . . . . . . . . . . . . .  C  ADDR  0F27H     R   SEG=?CO?BLHELI_S?17
ARM_END_BEEP. . . . . . . . . . . .  C  ADDR  15CCH     R   SEG=?CO?BLHELI_S?17
ARMED_BEEP. . . . . . . . . . . . .  C  ADDR  0F48H     R   SEG=?CO?BLHELI_S?17
ARMING_CHECK. . . . . . . . . . . .  C  ADDR  1527H     R   SEG=?CO?BLHELI_S?17
ARMING_INITIAL_ARM_CHECK. . . . . .  C  ADDR  151EH     R   SEG=?CO?BLHELI_S?17
ARMING_START. . . . . . . . . . . .  C  ADDR  1508H     R   SEG=?CO?BLHELI_S?17
AVERAGE_THROTTLE. . . . . . . . . .  C  ADDR  0DF9H     R   SEG=?CO?BLHELI_S?17
AVERAGE_THROTTLE_DIV. . . . . . . .  C  ADDR  0E18H     R   SEG=?CO?BLHELI_S?17
AVERAGE_THROTTLE_MEAS . . . . . . .  C  ADDR  0E09H     R   SEG=?CO?BLHELI_S?17
B . . . . . . . . . . . . . . . . .  D  ADDR  00F0H     A   
B_. . . . . . . . . . . . . . . . .  N  NUMB  0002H     A   
B_B0. . . . . . . . . . . . . . . .  B  ADDR  00F0H.0   A   
B_B1. . . . . . . . . . . . . . . .  B  ADDR  00F0H.1   A   
B_B2. . . . . . . . . . . . . . . .  B  ADDR  00F0H.2   A   
B_B3. . . . . . . . . . . . . . . .  B  ADDR  00F0H.3   A   
B_B4. . . . . . . . . . . . . . . .  B  ADDR  00F0H.4   A   
B_B5. . . . . . . . . . . . . . . .  B  ADDR  00F0H.5   A   
B_B6. . . . . . . . . . . . . . . .  B  ADDR  00F0H.6   A   
B_B7. . . . . . . . . . . . . . . .  B  ADDR  00F0H.7   A   
BAUDH . . . . . . . . . . . . . . .  D  ADDR  0025H     R   SEG=?DT?BLHELI_S?18
BAUDL . . . . . . . . . . . . . . .  D  ADDR  0024H     R   SEG=?DT?BLHELI_S?18
BAUDTIME. . . . . . . . . . . . . .  N  NUMB  0198H     A   
BCOMFET . . . . . . . . . . . . . .  N  NUMB  0004H     A   
BEEP. . . . . . . . . . . . . . . .  C  ADDR  0B30H     R   SEG=?CO?BLHELI_S?17
BEEP_APWMFET_OFF. . . . . . . . . .  C  ADDR  0B61H     R   SEG=?CO?BLHELI_S?17
BEEP_APWMFET_ON . . . . . . . . . .  C  ADDR  0B51H     R   SEG=?CO?BLHELI_S?17
BEEP_BEACON . . . . . . . . . . . .  C  ADDR  0BA1H     R   SEG=?CO?BLHELI_S?17
BEEP_CPWMFET_OFF. . . . . . . . . .  C  ADDR  0B66H     R   SEG=?CO?BLHELI_S?17
BEEP_CPWMFET_ON . . . . . . . . . .  C  ADDR  0B56H     R   SEG=?CO?BLHELI_S?17
BEEP_CZ1. . . . . . . . . . . . . .  C  ADDR  0B79H     R   SEG=?CO?BLHELI_S?17
BEEP_CZ2. . . . . . . . . . . . . .  C  ADDR  0B83H     R   SEG=?CO?BLHELI_S?17
BEEP_CZ3. . . . . . . . . . . . . .  C  ADDR  0B8DH     R   SEG=?CO?BLHELI_S?17
BEEP_CZ4. . . . . . . . . . . . . .  C  ADDR  0B97H     R   SEG=?CO?BLHELI_S?17
BEEP_DELAY_SET. . . . . . . . . . .  C  ADDR  1604H     R   SEG=?CO?BLHELI_S?17
BEEP_F1 . . . . . . . . . . . . . .  C  ADDR  0B0EH     R   SEG=?CO?BLHELI_S?17
BEEP_F2 . . . . . . . . . . . . . .  C  ADDR  0B17H     R   SEG=?CO?BLHELI_S?17
BEEP_F3 . . . . . . . . . . . . . .  C  ADDR  0B20H     R   SEG=?CO?BLHELI_S?17
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   482

BEEP_F4 . . . . . . . . . . . . . .  C  ADDR  0B29H     R   SEG=?CO?BLHELI_S?17
BEEP_OFF. . . . . . . . . . . . . .  C  ADDR  0B6FH     R   SEG=?CO?BLHELI_S?17
BEEP_ONOFF. . . . . . . . . . . . .  C  ADDR  0B36H     R   SEG=?CO?BLHELI_S?17
BEEP_START. . . . . . . . . . . . .  C  ADDR  0B34H     R   SEG=?CO?BLHELI_S?17
BEEP_STRENGTH . . . . . . . . . . .  D  ADDR  0062H     R   SEG=?DT?BLHELI_S?4
BIT_ACCESS. . . . . . . . . . . . .  D  ADDR  0020H     R   SEG=?DT?BLHELI_S?3
BIT_ACCESS_INT. . . . . . . . . . .  D  ADDR  0021H     R   SEG=?DT?BLHELI_S?3
BIT_CNT . . . . . . . . . . . . . .  D  ADDR  0026H     R   SEG=?DT?BLHELI_S?18
BIT_REG . . . . . . . . . . . . . .  D  ADDR  0020H     R   SEG=?DT?BLHELI_S?18
BL_FLASH_KEY_1. . . . . . . . . . .  D  ADDR  0029H     R   SEG=?DT?BLHELI_S?18
BL_FLASH_KEY_2. . . . . . . . . . .  D  ADDR  002AH     R   SEG=?DT?BLHELI_S?18
BOOT_BAUDRATE . . . . . . . . . . .  N  NUMB  4B00H     A   
BOOT_DELAY. . . . . . . . . . . . .  N  NUMB  005F5E10H A   
BOOT_INFO . . . . . . . . . . . . .  C  ADDR  1DF2H     R   SEG=?CO?BLHELI_S?19
BOOT_MSG. . . . . . . . . . . . . .  C  ADDR  1DEEH     R   SEG=?CO?BLHELI_S?19
BOOT_PAGES. . . . . . . . . . . . .  N  NUMB  0001H     A   
BOOT_SIGN . . . . . . . . . . . . .  C  ADDR  1DE8H     R   SEG=?CO?BLHELI_S?19
BOOT_START. . . . . . . . . . . . .  N  NUMB  1C00H     A   
BOOT_VERSION. . . . . . . . . . . .  N  NUMB  0006H     A   
BOOTLOADER_DONE . . . . . . . . . .  C  ADDR  13BAH     R   SEG=?CO?BLHELI_S?17
BPWMFET . . . . . . . . . . . . . .  N  NUMB  0001H     A   
BYTE_CNTH . . . . . . . . . . . . .  D  ADDR  0028H     R   SEG=?DT?BLHELI_S?18
BYTE_CNTL . . . . . . . . . . . . .  D  ADDR  0027H     R   SEG=?DT?BLHELI_S?18
BYTE_REG. . . . . . . . . . . . . .  D  ADDR  0021H     R   SEG=?DT?BLHELI_S?18
C_. . . . . . . . . . . . . . . . .  N  NUMB  0003H     A   
CALC_NEW_WAIT_PER_DEMAG_DONE. . . .  C  ADDR  075EH     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_PER_STARTUP_DONE. . .  C  ADDR  0742H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES . . . . . . . .  C  ADDR  07E9H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_EXIT. . . . . .  C  ADDR  078AH     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_FAST. . . . . .  C  ADDR  086EH     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_FAST_DONE . . .  C  ADDR  07D5H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_SETUP . . . . .  C  ADDR  0733H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_AVG_PERIOD_DIV . . .  C  ADDR  0705H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_NEW_PERIOD_DIV . . .  C  ADDR  0718H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_NEW_PERIOD_DIV_DONE.  C  ADDR  0721H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_NORMAL . . . . . . .  C  ADDR  06E6H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_STARTUP. . . . . . .  C  ADDR  06A6H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_STARTUP_AVERAGE. . .  C  ADDR  06CBH     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_STARTUP_NO_X . . . .  C  ADDR  06B8H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_TIMING . . . . . . .  C  ADDR  066FH     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_TIMING_FAST. . . . .  C  ADDR  078DH     R   SEG=?CO?BLHELI_S?17
CCOMFET . . . . . . . . . . . . . .  N  NUMB  0003H     A   
CENTER_THROTTLE_H . . . . . . . . .  D  ADDR  0034H     R   SEG=?DT?BLHELI_S?4
CENTER_THROTTLE_L . . . . . . . . .  D  ADDR  0033H     R   SEG=?DT?BLHELI_S?4
CHECK_TEMP_VOLTAGE_AND_LIMIT_POWER.  C  ADDR  05E9H     R   SEG=?CO?BLHELI_S?17
CHECK_VOLTAGE_START . . . . . . . .  C  ADDR  0645H     R   SEG=?CO?BLHELI_S?17
CKCON0. . . . . . . . . . . . . . .  D  ADDR  008EH     A   
CKCON1. . . . . . . . . . . . . . .  D  ADDR  00A6H     A   
CLEAR_RAM . . . . . . . . . . . . .  C  ADDR  0F95H     R   SEG=?CO?BLHELI_S?17
CLKSEL. . . . . . . . . . . . . . .  D  ADDR  00A9H     A   
CLOCK_SET_AT_48MHZ. . . . . . . . .  D  ADDR  0064H     R   SEG=?DT?BLHELI_S?4
CMDH. . . . . . . . . . . . . . . .     REG   R            
CMDL. . . . . . . . . . . . . . . .     REG   R            
CMP0_IRQN . . . . . . . . . . . . .  N  NUMB  000CH     A   
CMP0CN0 . . . . . . . . . . . . . .  D  ADDR  009BH     A   
CMP0CN1 . . . . . . . . . . . . . .  D  ADDR  0099H     A   
CMP0MD. . . . . . . . . . . . . . .  D  ADDR  009DH     A   
CMP0MX. . . . . . . . . . . . . . .  D  ADDR  009FH     A   
CMP1_IRQN . . . . . . . . . . . . .  N  NUMB  000DH     A   
CMP1CN0 . . . . . . . . . . . . . .  D  ADDR  00BFH     A   
CMP1CN1 . . . . . . . . . . . . . .  D  ADDR  00ACH     A   
CMP1MD. . . . . . . . . . . . . . .  D  ADDR  00ABH     A   
CMP1MX. . . . . . . . . . . . . . .  D  ADDR  00AAH     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   483

CNTH. . . . . . . . . . . . . . . .     REG   R            
CNTL. . . . . . . . . . . . . . . .     REG   R            
COMM12_REV. . . . . . . . . . . . .  C  ADDR  0A4EH     R   SEG=?CO?BLHELI_S?17
COMM1COMM2. . . . . . . . . . . . .  C  ADDR  0A3BH     R   SEG=?CO?BLHELI_S?17
COMM23_REV. . . . . . . . . . . . .  C  ADDR  0A71H     R   SEG=?CO?BLHELI_S?17
COMM2COMM3. . . . . . . . . . . . .  C  ADDR  0A5EH     R   SEG=?CO?BLHELI_S?17
COMM34_REV. . . . . . . . . . . . .  C  ADDR  0A94H     R   SEG=?CO?BLHELI_S?17
COMM3COMM4. . . . . . . . . . . . .  C  ADDR  0A81H     R   SEG=?CO?BLHELI_S?17
COMM45_REV. . . . . . . . . . . . .  C  ADDR  0AB7H     R   SEG=?CO?BLHELI_S?17
COMM4COMM5. . . . . . . . . . . . .  C  ADDR  0AA4H     R   SEG=?CO?BLHELI_S?17
COMM56_REV. . . . . . . . . . . . .  C  ADDR  0ADAH     R   SEG=?CO?BLHELI_S?17
COMM5COMM6. . . . . . . . . . . . .  C  ADDR  0AC7H     R   SEG=?CO?BLHELI_S?17
COMM61_REV. . . . . . . . . . . . .  C  ADDR  0AFDH     R   SEG=?CO?BLHELI_S?17
COMM6COMM1. . . . . . . . . . . . .  C  ADDR  0AEAH     R   SEG=?CO?BLHELI_S?17
COMM_EXIT . . . . . . . . . . . . .  C  ADDR  0B0BH     R   SEG=?CO?BLHELI_S?17
COMM_PERIOD4X_H . . . . . . . . . .  D  ADDR  0048H     R   SEG=?DT?BLHELI_S?4
COMM_PERIOD4X_L . . . . . . . . . .  D  ADDR  0047H     R   SEG=?DT?BLHELI_S?4
COMP_CHECK_TIMEOUT. . . . . . . . .  C  ADDR  0931H     R   SEG=?CO?BLHELI_S?17
COMP_CHECK_TIMEOUT_EXTEND_TIMEOUT .  C  ADDR  0942H     R   SEG=?CO?BLHELI_S?17
COMP_CHECK_TIMEOUT_NOT_TIMED_OUT. .  C  ADDR  0944H     R   SEG=?CO?BLHELI_S?17
COMP_CHECK_TIMEOUT_TIMEOUT_EXTENDED  C  ADDR  093EH     R   SEG=?CO?BLHELI_S?17
COMP_COM. . . . . . . . . . . . . .  N  NUMB  0000H     A   
COMP_READ_OK. . . . . . . . . . . .  C  ADDR  099FH     R   SEG=?CO?BLHELI_S?17
COMP_READ_OK_JMP. . . . . . . . . .  C  ADDR  09B1H     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG . . . . . . . . . .  C  ADDR  094FH     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_EXTEND_TIMEOUT. . .  C  ADDR  0968H     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_LOAD_TIMEOUT. . . .  C  ADDR  0995H     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_LOW_RPM . . . . . .  C  ADDR  0984H     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_NOT_STARTUP . . . .  C  ADDR  095BH     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_TIMEOUT_SET . . . .  C  ADDR  0979H     R   SEG=?CO?BLHELI_S?17
COMP_SCALE_SAMPLES. . . . . . . . .  C  ADDR  0929H     R   SEG=?CO?BLHELI_S?17
COMP_TIMED_OUT. . . . . . . . . . .  N  NUMB  0003H     A   
COMPARATOR_READ_CNT . . . . . . . .  D  ADDR  0049H     R   SEG=?DT?BLHELI_S?4
CPWMFET . . . . . . . . . . . . . .  N  NUMB  0000H     A   
CRC0_PAGE . . . . . . . . . . . . .  N  NUMB  0000H     A   
CRC0CN0 . . . . . . . . . . . . . .  D  ADDR  00CEH     A   
CRC0CN1 . . . . . . . . . . . . . .  D  ADDR  0086H     A   
CRC0CNT . . . . . . . . . . . . . .  D  ADDR  00D3H     A   
CRC0DAT . . . . . . . . . . . . . .  D  ADDR  00DEH     A   
CRC0FLIP. . . . . . . . . . . . . .  D  ADDR  00CFH     A   
CRC0IN. . . . . . . . . . . . . . .  D  ADDR  00DDH     A   
CRC0ST. . . . . . . . . . . . . . .  D  ADDR  00D2H     A   
CRCH. . . . . . . . . . . . . . . .  D  ADDR  0023H     R   SEG=?DT?BLHELI_S?18
CRCL. . . . . . . . . . . . . . . .  D  ADDR  0022H     R   SEG=?DT?BLHELI_S?18
CURRENT_AVERAGE_TEMP. . . . . . . .  D  ADDR  005DH     R   SEG=?DT?BLHELI_S?4
CURRENT_POWER_PWM_REG_H . . . . . .  D  ADDR  0058H     R   SEG=?DT?BLHELI_S?4
CZ_TONES. . . . . . . . . . . . . .  N  NUMB  0006H     A   
D_. . . . . . . . . . . . . . . . .  N  NUMB  0004H     A   
DAMP_PWM_REG_H. . . . . . . . . . .  D  ADDR  0057H     R   SEG=?DT?BLHELI_S?4
DAMP_PWM_REG_L. . . . . . . . . . .  D  ADDR  0056H     R   SEG=?DT?BLHELI_S?4
DEBUGPIN. . . . . . . . . . . . . .  N  NUMB  0000H     A   
DEC_AGAIN . . . . . . . . . . . . .  C  ADDR  0C31H     R   SEG=?CO?BLHELI_S?17
DECODE_DEMAG_DONE . . . . . . . . .  C  ADDR  0D18H     R   SEG=?CO?BLHELI_S?17
DECODE_DEMAG_HIGH . . . . . . . . .  C  ADDR  0D12H     R   SEG=?CO?BLHELI_S?17
DECODE_SETTINGS . . . . . . . . . .  C  ADDR  0CD6H     R   SEG=?CO?BLHELI_S?17
DECODE_TEMP_DONE. . . . . . . . . .  C  ADDR  0D24H     R   SEG=?CO?BLHELI_S?17
DECODE_TEMP_STEP. . . . . . . . . .  C  ADDR  0D20H     R   SEG=?CO?BLHELI_S?17
DEFAULT_PGM_BEACON_DELAY. . . . . .  N  NUMB  0003H     A   
DEFAULT_PGM_BEACON_STRENGTH . . . .  N  NUMB  0050H     A   
DEFAULT_PGM_BEEP_STRENGTH . . . . .  N  NUMB  005BH     A   
DEFAULT_PGM_BRAKE_ON_STOP . . . . .  N  NUMB  0001H     A   
DEFAULT_PGM_CENTER_THROTTLE . . . .  N  NUMB  007DH     A   
DEFAULT_PGM_COMM_TIMING . . . . . .  N  NUMB  0003H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   484

DEFAULT_PGM_DEMAG_COMP. . . . . . .  N  NUMB  0003H     A   
DEFAULT_PGM_DIRECTION . . . . . . .  N  NUMB  0001H     A   
DEFAULT_PGM_ENABLE_POWER_PROT . . .  N  NUMB  0001H     A   
DEFAULT_PGM_ENABLE_TEMP_PROT. . . .  N  NUMB  0006H     A   
DEFAULT_PGM_ENABLE_TX_PROGRAM . . .  N  NUMB  0001H     A   
DEFAULT_PGM_LED_CONTROL . . . . . .  N  NUMB  0001H     A   
DEFAULT_PGM_MAX_THROTTLE. . . . . .  N  NUMB  00F0H     A   
DEFAULT_PGM_MIN_THROTTLE. . . . . .  N  NUMB  000AH     A   
DEFAULT_PGM_STARTUP_PWR . . . . . .  N  NUMB  0005H     A   
DEMAG_CUT_POWER . . . . . . . . . .  N  NUMB  0002H     A   
DEMAG_DETECTED. . . . . . . . . . .  N  NUMB  0001H     A   
DEMAG_DETECTED_METRIC . . . . . . .  D  ADDR  003DH     R   SEG=?DT?BLHELI_S?4
DEMAG_PWR_OFF_THRESH. . . . . . . .  D  ADDR  003EH     R   SEG=?DT?BLHELI_S?4
DERIVID . . . . . . . . . . . . . .  D  ADDR  00ADH     A   
DEVICEID. . . . . . . . . . . . . .  D  ADDR  00B5H     A   
DIR_CHANGE_BRAKE. . . . . . . . . .  N  NUMB  0003H     A   
DIRECT_START_CHECK_RCP. . . . . . .  C  ADDR  1729H     R   SEG=?CO?BLHELI_S?17
DP. . . . . . . . . . . . . . . . .  D  ADDR  0082H     A   
DPH . . . . . . . . . . . . . . . .  D  ADDR  0083H     A   
DPL . . . . . . . . . . . . . . . .  D  ADDR  0082H     A   
DSHOT_FRAME_LENGTH_THR. . . . . . .  D  ADDR  006CH     R   SEG=?DT?BLHELI_S?4
DSHOT_FRAME_START_H . . . . . . . .  D  ADDR  006BH     R   SEG=?DT?BLHELI_S?4
DSHOT_FRAME_START_L . . . . . . . .  D  ADDR  006AH     R   SEG=?DT?BLHELI_S?4
DSHOT_PWM_THR . . . . . . . . . . .  D  ADDR  0068H     R   SEG=?DT?BLHELI_S?4
DSHOT_TIMER_PRESET. . . . . . . . .  D  ADDR  0069H     R   SEG=?DT?BLHELI_S?4
E_. . . . . . . . . . . . . . . . .  N  NUMB  0005H     A   
EEP_DUMMY . . . . . . . . . . . . .  C  ADDR  1A29H     R   SEG=?CO?BLHELI_S?7
EEP_ENABLE_TX_PROGRAM . . . . . . .  C  ADDR  1A0FH     R   SEG=?CO?BLHELI_S?7
EEP_ESC_LAYOUT. . . . . . . . . . .  C  ADDR  1A40H     R   SEG=?CO?BLHELI_S?1
EEP_ESC_MCU . . . . . . . . . . . .  C  ADDR  1A50H     R   SEG=?CO?BLHELI_S?2
EEP_FW_MAIN_REVISION. . . . . . . .  C  ADDR  1A00H     R   SEG=?CO?BLHELI_S?7
EEP_FW_SUB_REVISION . . . . . . . .  C  ADDR  1A01H     R   SEG=?CO?BLHELI_S?7
EEP_INITIALIZED_H . . . . . . . . .  C  ADDR  1A0EH     R   SEG=?CO?BLHELI_S?7
EEP_INITIALIZED_L . . . . . . . . .  C  ADDR  1A0DH     R   SEG=?CO?BLHELI_S?7
EEP_LAYOUT_REVISION . . . . . . . .  C  ADDR  1A02H     R   SEG=?CO?BLHELI_S?7
EEP_NAME. . . . . . . . . . . . . .  C  ADDR  1A60H     R   SEG=?CO?BLHELI_S?8
EEP_PGM_BEACON_DELAY. . . . . . . .  C  ADDR  1A1DH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_BEACON_STRENGTH . . . . . .  C  ADDR  1A1CH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_BEEP_STRENGTH . . . . . . .  C  ADDR  1A1BH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_BRAKE_ON_STOP . . . . . . .  C  ADDR  1A27H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_CENTER_THROTTLE . . . . . .  C  ADDR  1A21H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_COMM_TIMING . . . . . . . .  C  ADDR  1A15H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_DEMAG_COMP. . . . . . . . .  C  ADDR  1A1FH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_DIRECTION . . . . . . . . .  C  ADDR  1A0BH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_ENABLE_POWER_PROT . . . . .  C  ADDR  1A24H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_LED_CONTROL . . . . . . . .  C  ADDR  1A28H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_MAX_THROTTLE. . . . . . . .  C  ADDR  1A1AH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_MIN_THROTTLE. . . . . . . .  C  ADDR  1A19H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_STARTUP_PWR . . . . . . . .  C  ADDR  1A09H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_TEMP_PROT_ENABLE. . . . . .  C  ADDR  1A23H     R   SEG=?CO?BLHELI_S?7
EEPROM_FW_MAIN_REVISION . . . . . .  N  NUMB  0010H     A   
EEPROM_FW_SUB_REVISION. . . . . . .  N  NUMB  0041H     A   
EEPROM_LAYOUT_REVISION. . . . . . .  N  NUMB  0021H     A   
EIE1. . . . . . . . . . . . . . . .  D  ADDR  00E6H     A   
EIE2. . . . . . . . . . . . . . . .  D  ADDR  00CEH     A   
EIP1. . . . . . . . . . . . . . . .  D  ADDR  00F3H     A   
EIP1H . . . . . . . . . . . . . . .  D  ADDR  00F5H     A   
EIP2. . . . . . . . . . . . . . . .  D  ADDR  00F4H     A   
EIP2H . . . . . . . . . . . . . . .  D  ADDR  00F6H     A   
EMI0CN. . . . . . . . . . . . . . .  D  ADDR  00E7H     A   
ERASE_AND_STORE_ALL_IN_EEPROM . . .  C  ADDR  183BH     R   SEG=?CO?BLHELI_S?17
ERASE_FLASH . . . . . . . . . . . .  C  ADDR  1894H     R   SEG=?CO?BLHELI_S?17
ERRORCOMMAND. . . . . . . . . . . .  N  NUMB  00C1H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   485

ERRORCRC. . . . . . . . . . . . . .  N  NUMB  00C2H     A   
ERRORPROG . . . . . . . . . . . . .  N  NUMB  00C5H     A   
ERRORVERIFY . . . . . . . . . . . .  N  NUMB  00C0H     A   
EVAL_COMP_CHECK_TIMEOUT . . . . . .  C  ADDR  09E0H     R   SEG=?CO?BLHELI_S?17
EVAL_COMP_EXIT. . . . . . . . . . .  C  ADDR  09F0H     R   SEG=?CO?BLHELI_S?17
EVALUATE_COMPARATOR_INTEGRITY . . .  C  ADDR  09D3H     R   SEG=?CO?BLHELI_S?17
EXIT. . . . . . . . . . . . . . . .  C  ADDR  1CBAH     R   SEG=?CO?BLHELI_S?19
F_. . . . . . . . . . . . . . . . .  N  NUMB  0006H     A   
FET_SWAP. . . . . . . . . . . . . .  N  NUMB  0003H     A   
FIND_THROTTLE_GAIN. . . . . . . . .  C  ADDR  0DAAH     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAIN_FWD. . . . . . .  C  ADDR  0DA3H     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAIN_LOOP . . . . . .  C  ADDR  0DD5H     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAINS . . . . . . . .  C  ADDR  0D44H     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAINS_BIDIR_DONE. . .  C  ADDR  0D7DH     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAINS_NORMAL. . . . .  C  ADDR  0D58H     R   SEG=?CO?BLHELI_S?17
FLAGS0. . . . . . . . . . . . . . .  D  ADDR  0024H     R   SEG=?DT?BLHELI_S?3
FLAGS1. . . . . . . . . . . . . . .  D  ADDR  0025H     R   SEG=?DT?BLHELI_S?3
FLAGS2. . . . . . . . . . . . . . .  D  ADDR  0026H     R   SEG=?DT?BLHELI_S?3
FLAGS3. . . . . . . . . . . . . . .  D  ADDR  0027H     R   SEG=?DT?BLHELI_S?3
FLASH_KEY_1 . . . . . . . . . . . .  D  ADDR  0065H     R   SEG=?DT?BLHELI_S?4
FLASH_KEY_2 . . . . . . . . . . . .  D  ADDR  0066H     R   SEG=?DT?BLHELI_S?4
FLKEY . . . . . . . . . . . . . . .  D  ADDR  00B7H     A   
G_. . . . . . . . . . . . . . . . .  N  NUMB  0007H     A   
GET1. . . . . . . . . . . . . . . .  C  ADDR  1D96H     R   SEG=?CO?BLHELI_S?19
GET2. . . . . . . . . . . . . . . .  C  ADDR  1DABH     R   SEG=?CO?BLHELI_S?19
GET3. . . . . . . . . . . . . . . .  C  ADDR  1DCFH     R   SEG=?CO?BLHELI_S?19
GET_RCP_END . . . . . . . . . . . .  C  ADDR  0348H     R   SEG=?CO?BLHELI_S?17
GETC. . . . . . . . . . . . . . . .  C  ADDR  1D91H     R   SEG=?CO?BLHELI_S?19
GETW. . . . . . . . . . . . . . . .  C  ADDR  1D8DH     R   SEG=?CO?BLHELI_S?19
GETX. . . . . . . . . . . . . . . .  C  ADDR  1D9BH     R   SEG=?CO?BLHELI_S?19
H_. . . . . . . . . . . . . . . . .  N  NUMB  0008H     A   
HFO0CAL . . . . . . . . . . . . . .  D  ADDR  00C7H     A   
HFO1CAL . . . . . . . . . . . . . .  D  ADDR  00D6H     A   
HFOCN . . . . . . . . . . . . . . .  D  ADDR  00EFH     A   
HG_BOUNCE . . . . . . . . . . . . .  C  ADDR  0FD4H     R   SEG=?CO?BLHELI_S?17
HIGH_RPM. . . . . . . . . . . . . .  N  NUMB  0004H     A   
I2C0_IRQN . . . . . . . . . . . . .  N  NUMB  0012H     A   
I2C0CN0 . . . . . . . . . . . . . .  D  ADDR  00BAH     A   
I2C0DIN . . . . . . . . . . . . . .  D  ADDR  00BCH     A   
I2C0DOUT. . . . . . . . . . . . . .  D  ADDR  00BBH     A   
I2C0FCN0. . . . . . . . . . . . . .  D  ADDR  00ADH     A   
I2C0FCN1. . . . . . . . . . . . . .  D  ADDR  00ABH     A   
I2C0FCT . . . . . . . . . . . . . .  D  ADDR  00F5H     A   
I2C0SLAD. . . . . . . . . . . . . .  D  ADDR  00BDH     A   
I2C0STAT. . . . . . . . . . . . . .  D  ADDR  00B9H     A   
I2CSLAVE0_PAGE. . . . . . . . . . .  N  NUMB  0020H     A   
I_. . . . . . . . . . . . . . . . .  N  NUMB  0009H     A   
ID1 . . . . . . . . . . . . . . . .  C  ADDR  1C4DH     R   SEG=?CO?BLHELI_S?19
ID3 . . . . . . . . . . . . . . . .  C  ADDR  1C58H     R   SEG=?CO?BLHELI_S?19
ID4 . . . . . . . . . . . . . . . .  C  ADDR  1C63H     R   SEG=?CO?BLHELI_S?19
ID5 . . . . . . . . . . . . . . . .  C  ADDR  1C70H     R   SEG=?CO?BLHELI_S?19
ID_DSHOT300 . . . . . . . . . . . .  C  ADDR  0F37H     R   SEG=?CO?BLHELI_S?17
ID_DSHOT600 . . . . . . . . . . . .  C  ADDR  0F3DH     R   SEG=?CO?BLHELI_S?17
IDBEEP_LOOP . . . . . . . . . . . .  C  ADDR  0F1AH     R   SEG=?CO?BLHELI_S?17
IE. . . . . . . . . . . . . . . . .  D  ADDR  00A8H     A   
IE_EA . . . . . . . . . . . . . . .  B  ADDR  00A8H.7   A   
IE_ES0. . . . . . . . . . . . . . .  B  ADDR  00A8H.4   A   
IE_ESPI0. . . . . . . . . . . . . .  B  ADDR  00A8H.6   A   
IE_ET0. . . . . . . . . . . . . . .  B  ADDR  00A8H.1   A   
IE_ET1. . . . . . . . . . . . . . .  B  ADDR  00A8H.3   A   
IE_ET2. . . . . . . . . . . . . . .  B  ADDR  00A8H.5   A   
IE_EX0. . . . . . . . . . . . . . .  B  ADDR  00A8H.0   A   
IE_EX1. . . . . . . . . . . . . . .  B  ADDR  00A8H.2   A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   486

IN1 . . . . . . . . . . . . . . . .  C  ADDR  1C7AH     R   SEG=?CO?BLHELI_S?19
INC_TONE. . . . . . . . . . . . . .  C  ADDR  0BD8H     R   SEG=?CO?BLHELI_S?17
INIT. . . . . . . . . . . . . . . .  C  ADDR  1C00H     R   SEG=?CO?BLHELI_S?19
INIT_NO_SIGNAL. . . . . . . . . . .  C  ADDR  13A4H     R   SEG=?CO?BLHELI_S?17
INIT_START. . . . . . . . . . . . .  C  ADDR  1641H     R   SEG=?CO?BLHELI_S?17
INIT_START_BIDIR_DONE . . . . . . .  C  ADDR  1697H     R   SEG=?CO?BLHELI_S?17
INITIAL_ARM . . . . . . . . . . . .  D  ADDR  0030H     R   SEG=?DT?BLHELI_S?4
INITIAL_RUN_PHASE . . . . . . . . .  N  NUMB  0001H     A   
INITIAL_RUN_PHASE_DONE. . . . . . .  C  ADDR  1757H     R   SEG=?CO?BLHELI_S?17
INITIAL_RUN_ROT_CNTD. . . . . . . .  D  ADDR  003BH     R   SEG=?DT?BLHELI_S?4
INITIALIZE_TIMING . . . . . . . . .  C  ADDR  0668H     R   SEG=?CO?BLHELI_S?17
INITIALIZED_H_DUMMY . . . . . . . .  I  ADDR  008BH     R   SEG=?ID?BLHELI_S?5
INITIALIZED_L_DUMMY . . . . . . . .  I  ADDR  008AH     R   SEG=?ID?BLHELI_S?5
INPUT_HIGH_CHECK_1. . . . . . . . .  C  ADDR  13AEH     R   SEG=?CO?BLHELI_S?17
INPUT_HIGH_CHECK_2. . . . . . . . .  C  ADDR  13B0H     R   SEG=?CO?BLHELI_S?17
INT0_INT. . . . . . . . . . . . . .  C  ADDR  0301H     R   SEG=?CO?BLHELI_S?17
INT0_INT_BIDIR_DO_DEADBAND. . . . .  C  ADDR  043BH     R   SEG=?CO?BLHELI_S?17
INT0_INT_BIDIR_FWD. . . . . . . . .  C  ADDR  0415H     R   SEG=?CO?BLHELI_S?17
INT0_INT_BIDIR_REV_CHK. . . . . . .  C  ADDR  041AH     R   SEG=?CO?BLHELI_S?17
INT0_INT_CALCULATE. . . . . . . . .  C  ADDR  03FCH     R   SEG=?CO?BLHELI_S?17
INT0_INT_CHECK_FULL_RANGE . . . . .  C  ADDR  03E2H     R   SEG=?CO?BLHELI_S?17
INT0_INT_DO_THROTTLE_GAIN . . . . .  C  ADDR  045AH     R   SEG=?CO?BLHELI_S?17
INT0_INT_EXIT . . . . . . . . . . .  C  ADDR  0510H     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_GAIN_DONE . . . . . .  C  ADDR  03BDH     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_NOT_MULTISHOT . . . .  C  ADDR  036AH     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_NOT_ONESHOT_125 . . .  C  ADDR  0394H     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_NOT_ONESHOT_42. . . .  C  ADDR  037CH     R   SEG=?CO?BLHELI_S?17
INT0_INT_GAIN_LOOP. . . . . . . . .  C  ADDR  049CH     R   SEG=?CO?BLHELI_S?17
INT0_INT_GAIN_RCP_DONE. . . . . . .  C  ADDR  04A4H     R   SEG=?CO?BLHELI_S?17
INT0_INT_NOT_BIDIR. . . . . . . . .  C  ADDR  044EH     R   SEG=?CO?BLHELI_S?17
INT0_INT_NOT_DSHOT. . . . . . . . .  C  ADDR  0310H     R   SEG=?CO?BLHELI_S?17
INT0_INT_OUTSIDE_RANGE. . . . . . .  C  ADDR  03CCH     R   SEG=?CO?BLHELI_S?17
INT0_INT_PULSE_READY. . . . . . . .  C  ADDR  04B9H     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_MIN. . . . . . . . . .  C  ADDR  03F1H     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_PWM_DAMP_SET . . . . .  C  ADDR  04F2H     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_PWM_REGISTERS. . . . .  C  ADDR  04DBH     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_TIMEOUT. . . . . . . .  C  ADDR  050DH     R   SEG=?CO?BLHELI_S?17
INT0_INT_STARTUP_BOOST_STALL. . . .  C  ADDR  0471H     R   SEG=?CO?BLHELI_S?17
INT0_INT_STARTUP_BOOSTED. . . . . .  C  ADDR  047BH     R   SEG=?CO?BLHELI_S?17
INT0_INT_UNIDIR_NEG . . . . . . . .  C  ADDR  0452H     R   SEG=?CO?BLHELI_S?17
INT0_IRQN . . . . . . . . . . . . .  N  NUMB  0000H     A   
INT1_INT. . . . . . . . . . . . . .  C  ADDR  051AH     R   SEG=?CO?BLHELI_S?17
INT1_IRQN . . . . . . . . . . . . .  N  NUMB  0002H     A   
IP. . . . . . . . . . . . . . . . .  D  ADDR  00B8H     A   
IP_PS0. . . . . . . . . . . . . . .  B  ADDR  00B8H.4   A   
IP_PSPI0. . . . . . . . . . . . . .  B  ADDR  00B8H.6   A   
IP_PT0. . . . . . . . . . . . . . .  B  ADDR  00B8H.1   A   
IP_PT1. . . . . . . . . . . . . . .  B  ADDR  00B8H.3   A   
IP_PT2. . . . . . . . . . . . . . .  B  ADDR  00B8H.5   A   
IP_PX0. . . . . . . . . . . . . . .  B  ADDR  00B8H.0   A   
IP_PX1. . . . . . . . . . . . . . .  B  ADDR  00B8H.2   A   
IPH . . . . . . . . . . . . . . . .  D  ADDR  00F2H     A   
IT01CF. . . . . . . . . . . . . . .  D  ADDR  00E4H     A   
J_. . . . . . . . . . . . . . . . .  N  NUMB  000AH     A   
JMP_WAIT_FOR_POWER_ON . . . . . . .  C  ADDR  17F1H     R   SEG=?CO?BLHELI_S?17
K_. . . . . . . . . . . . . . . . .  N  NUMB  000BH     A   
L_. . . . . . . . . . . . . . . . .  N  NUMB  000CH     A   
LED_0_DONE. . . . . . . . . . . . .  C  ADDR  0E34H     R   SEG=?CO?BLHELI_S?17
LED_1_DONE. . . . . . . . . . . . .  C  ADDR  0E39H     R   SEG=?CO?BLHELI_S?17
LED_2_DONE. . . . . . . . . . . . .  C  ADDR  0E3EH     R   SEG=?CO?BLHELI_S?17
LED_3_DONE. . . . . . . . . . . . .  C  ADDR  0E43H     R   SEG=?CO?BLHELI_S?17
LED_CONTROL . . . . . . . . . . . .  C  ADDR  0E2CH     R   SEG=?CO?BLHELI_S?17
LEGACY_PAGE . . . . . . . . . . . .  N  NUMB  0000H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   487

LEGO_BOUNCE . . . . . . . . . . . .  C  ADDR  0FDAH     R   SEG=?CO?BLHELI_S?17
LFO0CN. . . . . . . . . . . . . . .  D  ADDR  00B1H     A   
LOAD_MIN_TIME . . . . . . . . . . .  C  ADDR  0786H     R   SEG=?CO?BLHELI_S?17
LOAD_MIN_TIME_FAST. . . . . . . . .  C  ADDR  07D3H     R   SEG=?CO?BLHELI_S?17
LOW_RPM_PWR_SLOPE . . . . . . . . .  D  ADDR  003FH     R   SEG=?DT?BLHELI_S?4
M_. . . . . . . . . . . . . . . . .  N  NUMB  000DH     A   
MAI1. . . . . . . . . . . . . . . .  C  ADDR  1C84H     R   SEG=?CO?BLHELI_S?19
MAI2. . . . . . . . . . . . . . . .  C  ADDR  1CA6H     R   SEG=?CO?BLHELI_S?19
MAI4. . . . . . . . . . . . . . . .  C  ADDR  1CE0H     R   SEG=?CO?BLHELI_S?19
MAI5. . . . . . . . . . . . . . . .  C  ADDR  1D37H     R   SEG=?CO?BLHELI_S?19
MAI6. . . . . . . . . . . . . . . .  C  ADDR  1D48H     R   SEG=?CO?BLHELI_S?19
MAIN. . . . . . . . . . . . . . . .  C  ADDR  1C82H     R   SEG=?CO?BLHELI_S?19
MAX_THROTTLE_H. . . . . . . . . . .  D  ADDR  0036H     R   SEG=?DT?BLHELI_S?4
MAX_THROTTLE_L. . . . . . . . . . .  D  ADDR  0035H     R   SEG=?DT?BLHELI_S?4
MHLL_BOUNCE . . . . . . . . . . . .  C  ADDR  0FD7H     R   SEG=?CO?BLHELI_S?17
MIN_THROTTLE_H. . . . . . . . . . .  D  ADDR  0032H     R   SEG=?DT?BLHELI_S?4
MIN_THROTTLE_L. . . . . . . . . . .  D  ADDR  0031H     R   SEG=?DT?BLHELI_S?4
MOTOR_STARTED . . . . . . . . . . .  N  NUMB  0002H     A   
MUSIC . . . . . . . . . . . . . . .  C  ADDR  0EDAH     R   SEG=?CO?BLHELI_S?17
MUSIC_A4. . . . . . . . . . . . . .  C  ADDR  0E44H     R   SEG=?CO?BLHELI_S?17
MUSIC_A4_SHT. . . . . . . . . . . .  C  ADDR  0E4CH     R   SEG=?CO?BLHELI_S?17
MUSIC_AS4 . . . . . . . . . . . . .  C  ADDR  0E54H     R   SEG=?CO?BLHELI_S?17
MUSIC_AS4_LNG . . . . . . . . . . .  C  ADDR  0E5CH     R   SEG=?CO?BLHELI_S?17
MUSIC_B4. . . . . . . . . . . . . .  C  ADDR  0E64H     R   SEG=?CO?BLHELI_S?17
MUSIC_BASE_DELAY. . . . . . . . . .  C  ADDR  0C1BH     R   SEG=?CO?BLHELI_S?17
MUSIC_C . . . . . . . . . . . . . .  C  ADDR  0E9CH     R   SEG=?CO?BLHELI_S?17
MUSIC_D . . . . . . . . . . . . . .  C  ADDR  0EA4H     R   SEG=?CO?BLHELI_S?17
MUSIC_D2. . . . . . . . . . . . . .  C  ADDR  0EACH     R   SEG=?CO?BLHELI_S?17
MUSIC_DS. . . . . . . . . . . . . .  C  ADDR  0EB4H     R   SEG=?CO?BLHELI_S?17
MUSIC_E . . . . . . . . . . . . . .  C  ADDR  0EBCH     R   SEG=?CO?BLHELI_S?17
MUSIC_E2. . . . . . . . . . . . . .  C  ADDR  0EC4H     R   SEG=?CO?BLHELI_S?17
MUSIC_E4. . . . . . . . . . . . . .  C  ADDR  0E6CH     R   SEG=?CO?BLHELI_S?17
MUSIC_F . . . . . . . . . . . . . .  C  ADDR  0ECCH     R   SEG=?CO?BLHELI_S?17
MUSIC_F1. . . . . . . . . . . . . .  C  ADDR  0E74H     R   SEG=?CO?BLHELI_S?17
MUSIC_F2. . . . . . . . . . . . . .  C  ADDR  0E7CH     R   SEG=?CO?BLHELI_S?17
MUSIC_F3. . . . . . . . . . . . . .  C  ADDR  0E84H     R   SEG=?CO?BLHELI_S?17
MUSIC_F4. . . . . . . . . . . . . .  C  ADDR  0E8CH     R   SEG=?CO?BLHELI_S?17
MUSIC_G . . . . . . . . . . . . . .  C  ADDR  0ED4H     R   SEG=?CO?BLHELI_S?17
MUSIC_G4. . . . . . . . . . . . . .  C  ADDR  0E94H     R   SEG=?CO?BLHELI_S?17
MUSIC_INNER_LOOP. . . . . . . . . .  C  ADDR  0BE6H     R   SEG=?CO?BLHELI_S?17
MUSIC_M_LOOP. . . . . . . . . . . .  C  ADDR  0EF2H     R   SEG=?CO?BLHELI_S?17
MUSIC_O_LOOP. . . . . . . . . . . .  C  ADDR  0EF0H     R   SEG=?CO?BLHELI_S?17
MUSIC_OUTER_LOOP. . . . . . . . . .  C  ADDR  0BC7H     R   SEG=?CO?BLHELI_S?17
MUSIC_VARIABLE_DELAY. . . . . . . .  C  ADDR  0C22H     R   SEG=?CO?BLHELI_S?17
MUTE. . . . . . . . . . . . . . . .  N  NUMB  0007H     A   
MUTE_CHECK. . . . . . . . . . . . .  C  ADDR  0BC3H     R   SEG=?CO?BLHELI_S?17
MUX_A . . . . . . . . . . . . . . .  N  NUMB  0001H     A   
MUX_B . . . . . . . . . . . . . . .  N  NUMB  0002H     A   
MUX_C . . . . . . . . . . . . . . .  N  NUMB  0003H     A   
N_. . . . . . . . . . . . . . . . .  N  NUMB  000EH     A   
NEW_RCP . . . . . . . . . . . . . .  D  ADDR  0052H     R   SEG=?DT?BLHELI_S?4
NO_WAVE . . . . . . . . . . . . . .  C  ADDR  0BE1H     R   SEG=?CO?BLHELI_S?17
NORMAL_RUN_CHECK_STARTUP_ROT. . . .  C  ADDR  1746H     R   SEG=?CO?BLHELI_S?17
NORMAL_RUN_CHECKS . . . . . . . . .  C  ADDR  1735H     R   SEG=?CO?BLHELI_S?17
O_. . . . . . . . . . . . . . . . .  N  NUMB  000FH     A   
OEM_TONES . . . . . . . . . . . . .  C  ADDR  1392H     R   SEG=?CO?BLHELI_S?17
P0. . . . . . . . . . . . . . . . .  D  ADDR  0080H     A   
P0_B0 . . . . . . . . . . . . . . .  B  ADDR  0080H.0   A   
P0_B1 . . . . . . . . . . . . . . .  B  ADDR  0080H.1   A   
P0_B2 . . . . . . . . . . . . . . .  B  ADDR  0080H.2   A   
P0_B3 . . . . . . . . . . . . . . .  B  ADDR  0080H.3   A   
P0_B4 . . . . . . . . . . . . . . .  B  ADDR  0080H.4   A   
P0_B5 . . . . . . . . . . . . . . .  B  ADDR  0080H.5   A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   488

P0_B6 . . . . . . . . . . . . . . .  B  ADDR  0080H.6   A   
P0_B7 . . . . . . . . . . . . . . .  B  ADDR  0080H.7   A   
P0_DIGITAL. . . . . . . . . . . . .  N  NUMB  FFF0H     A   
P0_INIT . . . . . . . . . . . . . .  N  NUMB  00FFH     A   
P0_PUSHPULL . . . . . . . . . . . .  N  NUMB  0000H     A   
P0_SKIP . . . . . . . . . . . . . .  N  NUMB  00FFH     A   
P0MASK. . . . . . . . . . . . . . .  D  ADDR  00FEH     A   
P0MAT . . . . . . . . . . . . . . .  D  ADDR  00FDH     A   
P0MDIN. . . . . . . . . . . . . . .  D  ADDR  00F1H     A   
P0MDOUT . . . . . . . . . . . . . .  D  ADDR  00A4H     A   
P0SKIP. . . . . . . . . . . . . . .  D  ADDR  00D4H     A   
P1. . . . . . . . . . . . . . . . .  D  ADDR  0090H     A   
P1_B0 . . . . . . . . . . . . . . .  B  ADDR  0090H.0   A   
P1_B1 . . . . . . . . . . . . . . .  B  ADDR  0090H.1   A   
P1_B2 . . . . . . . . . . . . . . .  B  ADDR  0090H.2   A   
P1_B3 . . . . . . . . . . . . . . .  B  ADDR  0090H.3   A   
P1_B4 . . . . . . . . . . . . . . .  B  ADDR  0090H.4   A   
P1_B5 . . . . . . . . . . . . . . .  B  ADDR  0090H.5   A   
P1_B6 . . . . . . . . . . . . . . .  B  ADDR  0090H.6   A   
P1_B7 . . . . . . . . . . . . . . .  B  ADDR  0090H.7   A   
P1_DIGITAL. . . . . . . . . . . . .  N  NUMB  003FH     A   
P1_INIT . . . . . . . . . . . . . .  N  NUMB  0000H     A   
P1_PUSHPULL . . . . . . . . . . . .  N  NUMB  003FH     A   
P1_SKIP . . . . . . . . . . . . . .  N  NUMB  003FH     A   
P1MASK. . . . . . . . . . . . . . .  D  ADDR  00EEH     A   
P1MAT . . . . . . . . . . . . . . .  D  ADDR  00EDH     A   
P1MDIN. . . . . . . . . . . . . . .  D  ADDR  00F2H     A   
P1MDOUT . . . . . . . . . . . . . .  D  ADDR  00A5H     A   
P1SKIP. . . . . . . . . . . . . . .  D  ADDR  00D5H     A   
P2. . . . . . . . . . . . . . . . .  D  ADDR  00A0H     A   
P2_B0 . . . . . . . . . . . . . . .  B  ADDR  00A0H.0   A   
P2_B1 . . . . . . . . . . . . . . .  B  ADDR  00A0H.1   A   
P2_B2 . . . . . . . . . . . . . . .  B  ADDR  00A0H.2   A   
P2_B3 . . . . . . . . . . . . . . .  B  ADDR  00A0H.3   A   
P2_PUSHPULL . . . . . . . . . . . .  N  NUMB  0001H     A   
P2MASK. . . . . . . . . . . . . . .  D  ADDR  00FCH     A   
P2MAT . . . . . . . . . . . . . . .  D  ADDR  00FBH     A   
P2MDIN. . . . . . . . . . . . . . .  D  ADDR  00F3H     A   
P2MDOUT . . . . . . . . . . . . . .  D  ADDR  00A6H     A   
P2SKIP. . . . . . . . . . . . . . .  D  ADDR  00CCH     A   
P3. . . . . . . . . . . . . . . . .  D  ADDR  00B0H     A   
P3_B0 . . . . . . . . . . . . . . .  B  ADDR  00B0H.0   A   
P3_B1 . . . . . . . . . . . . . . .  B  ADDR  00B0H.1   A   
P3MDIN. . . . . . . . . . . . . . .  D  ADDR  00F4H     A   
P3MDOUT . . . . . . . . . . . . . .  D  ADDR  009CH     A   
P_. . . . . . . . . . . . . . . . .  N  NUMB  0010H     A   
PARAH . . . . . . . . . . . . . . .     REG   R            
PARAL . . . . . . . . . . . . . . .     REG   R            
PCA0. . . . . . . . . . . . . . . .  D  ADDR  00F9H     A   
PCA0_IRQN . . . . . . . . . . . . .  N  NUMB  000BH     A   
PCA0_PAGE . . . . . . . . . . . . .  N  NUMB  0000H     A   
PCA0CENT. . . . . . . . . . . . . .  D  ADDR  009EH     A   
PCA0CLR . . . . . . . . . . . . . .  D  ADDR  009CH     A   
PCA0CN0 . . . . . . . . . . . . . .  D  ADDR  00D8H     A   
PCA0CN0_CCF0. . . . . . . . . . . .  B  ADDR  00D8H.0   A   
PCA0CN0_CCF1. . . . . . . . . . . .  B  ADDR  00D8H.1   A   
PCA0CN0_CCF2. . . . . . . . . . . .  B  ADDR  00D8H.2   A   
PCA0CN0_CF. . . . . . . . . . . . .  B  ADDR  00D8H.7   A   
PCA0CN0_CR. . . . . . . . . . . . .  B  ADDR  00D8H.6   A   
PCA0CP0 . . . . . . . . . . . . . .  D  ADDR  00FBH     A   
PCA0CP1 . . . . . . . . . . . . . .  D  ADDR  00E9H     A   
PCA0CP2 . . . . . . . . . . . . . .  D  ADDR  00EBH     A   
PCA0CPH0. . . . . . . . . . . . . .  D  ADDR  00FCH     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   489

PCA0CPH1. . . . . . . . . . . . . .  D  ADDR  00EAH     A   
PCA0CPH2. . . . . . . . . . . . . .  D  ADDR  00ECH     A   
PCA0CPL0. . . . . . . . . . . . . .  D  ADDR  00FBH     A   
PCA0CPL1. . . . . . . . . . . . . .  D  ADDR  00E9H     A   
PCA0CPL2. . . . . . . . . . . . . .  D  ADDR  00EBH     A   
PCA0CPM0. . . . . . . . . . . . . .  D  ADDR  00DAH     A   
PCA0CPM1. . . . . . . . . . . . . .  D  ADDR  00DBH     A   
PCA0CPM2. . . . . . . . . . . . . .  D  ADDR  00DCH     A   
PCA0H . . . . . . . . . . . . . . .  D  ADDR  00FAH     A   
PCA0L . . . . . . . . . . . . . . .  D  ADDR  00F9H     A   
PCA0MD. . . . . . . . . . . . . . .  D  ADDR  00D9H     A   
PCA0POL . . . . . . . . . . . . . .  D  ADDR  0096H     A   
PCA0PWM . . . . . . . . . . . . . .  D  ADDR  00F7H     A   
PCA_INT . . . . . . . . . . . . . .  C  ADDR  0529H     R   SEG=?CO?BLHELI_S?17
PCA_INT_EXIT. . . . . . . . . . . .  C  ADDR  0572H     R   SEG=?CO?BLHELI_S?17
PCA_INT_HI_PWM. . . . . . . . . . .  C  ADDR  0542H     R   SEG=?CO?BLHELI_S?17
PCA_INT_SET_PWM . . . . . . . . . .  C  ADDR  054AH     R   SEG=?CO?BLHELI_S?17
PCON0 . . . . . . . . . . . . . . .  D  ADDR  0087H     A   
PCON1 . . . . . . . . . . . . . . .  D  ADDR  009AH     A   
PFE0CN. . . . . . . . . . . . . . .  D  ADDR  00C1H     A   
PG2_PAGE. . . . . . . . . . . . . .  N  NUMB  0010H     A   
PG3_PAGE. . . . . . . . . . . . . .  N  NUMB  0020H     A   
PGM_BEACON_DELAY. . . . . . . . . .  I  ADDR  009AH     R   SEG=?ID?BLHELI_S?5
PGM_BEACON_STRENGTH . . . . . . . .  I  ADDR  0099H     R   SEG=?ID?BLHELI_S?5
PGM_BEEP_STRENGTH . . . . . . . . .  I  ADDR  0098H     R   SEG=?ID?BLHELI_S?5
PGM_BIDIR . . . . . . . . . . . . .  N  NUMB  0002H     A   
PGM_BIDIR_REV . . . . . . . . . . .  N  NUMB  0001H     A   
PGM_BRAKE_ON_STOP . . . . . . . . .  I  ADDR  00A4H     R   SEG=?ID?BLHELI_S?5
PGM_CENTER_THROTTLE . . . . . . . .  I  ADDR  009EH     R   SEG=?ID?BLHELI_S?5
PGM_COMM_TIMING . . . . . . . . . .  I  ADDR  0092H     R   SEG=?ID?BLHELI_S?5
PGM_DEMAG_COMP. . . . . . . . . . .  I  ADDR  009CH     R   SEG=?ID?BLHELI_S?5
PGM_DIR_REV . . . . . . . . . . . .  N  NUMB  0000H     A   
PGM_DIRECTION . . . . . . . . . . .  I  ADDR  0088H     R   SEG=?ID?BLHELI_S?5
PGM_ENABLE_POWER_PROT . . . . . . .  I  ADDR  00A1H     R   SEG=?ID?BLHELI_S?5
PGM_ENABLE_TEMP_PROT. . . . . . . .  I  ADDR  00A0H     R   SEG=?ID?BLHELI_S?5
PGM_ENABLE_TX_PROGRAM . . . . . . .  I  ADDR  008CH     R   SEG=?ID?BLHELI_S?5
PGM_INPUT_POL . . . . . . . . . . .  I  ADDR  0089H     R   SEG=?ID?BLHELI_S?5
PGM_LED_CONTROL . . . . . . . . . .  I  ADDR  00A5H     R   SEG=?ID?BLHELI_S?5
PGM_MAX_THROTTLE. . . . . . . . . .  I  ADDR  0097H     R   SEG=?ID?BLHELI_S?5
PGM_MIN_THROTTLE. . . . . . . . . .  I  ADDR  0096H     R   SEG=?ID?BLHELI_S?5
PGM_START . . . . . . . . . . . . .  C  ADDR  0F50H     R   SEG=?CO?BLHELI_S?17
PGM_STARTUP_PWR . . . . . . . . . .  I  ADDR  0086H     R   SEG=?ID?BLHELI_S?5
PGM_STARTUP_PWR_DECODED . . . . . .  I  ADDR  00A6H     R   SEG=?ID?BLHELI_S?5
PMATCH_IRQN . . . . . . . . . . . .  N  NUMB  0008H     A   
POLYNOM . . . . . . . . . . . . . .  N  NUMB  A001H     A   
POWER_ON_WAIT_CNT_H . . . . . . . .  D  ADDR  0038H     R   SEG=?DT?BLHELI_S?4
POWER_ON_WAIT_CNT_L . . . . . . . .  D  ADDR  0037H     R   SEG=?DT?BLHELI_S?4
POWER_PWM_REG_H . . . . . . . . . .  D  ADDR  0055H     R   SEG=?DT?BLHELI_S?4
POWER_PWM_REG_L . . . . . . . . . .  D  ADDR  0054H     R   SEG=?DT?BLHELI_S?4
PREV_COMM_H . . . . . . . . . . . .  D  ADDR  0043H     R   SEG=?DT?BLHELI_S?4
PREV_COMM_L . . . . . . . . . . . .  D  ADDR  0042H     R   SEG=?DT?BLHELI_S?4
PREV_COMM_X . . . . . . . . . . . .  D  ADDR  0044H     R   SEG=?DT?BLHELI_S?4
PREV_PREV_COMM_H. . . . . . . . . .  D  ADDR  0046H     R   SEG=?DT?BLHELI_S?4
PREV_PREV_COMM_L. . . . . . . . . .  D  ADDR  0045H     R   SEG=?DT?BLHELI_S?4
PRO3. . . . . . . . . . . . . . . .  C  ADDR  1D0BH     R   SEG=?CO?BLHELI_S?19
PRO4. . . . . . . . . . . . . . . .  C  ADDR  1D17H     R   SEG=?CO?BLHELI_S?19
PRO5. . . . . . . . . . . . . . . .  C  ADDR  1D1DH     R   SEG=?CO?BLHELI_S?19
PRO6. . . . . . . . . . . . . . . .  C  ADDR  1D32H     R   SEG=?CO?BLHELI_S?19
PROGRAM_BY_TX_CHECKED . . . . . . .  C  ADDR  15BAH     R   SEG=?CO?BLHELI_S?17
PROGRAM_BY_TX_ENTRY_LIMIT . . . . .  C  ADDR  15A2H     R   SEG=?CO?BLHELI_S?17
PROGRAM_BY_TX_ENTRY_STORE . . . . .  C  ADDR  15A8H     R   SEG=?CO?BLHELI_S?17
PROGRAM_BY_TX_ENTRY_WAIT. . . . . .  C  ADDR  15B1H     R   SEG=?CO?BLHELI_S?17
PROTOCOL_ID . . . . . . . . . . . .  C  ADDR  0F04H     R   SEG=?CO?BLHELI_S?17
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   490

PRTDRV. . . . . . . . . . . . . . .  D  ADDR  00F6H     A   
PSCTL . . . . . . . . . . . . . . .  D  ADDR  008FH     A   
PSW . . . . . . . . . . . . . . . .  D  ADDR  00D0H     A   
PSW_AC. . . . . . . . . . . . . . .  B  ADDR  00D0H.6   A   
PSW_CY. . . . . . . . . . . . . . .  B  ADDR  00D0H.7   A   
PSW_F0. . . . . . . . . . . . . . .  B  ADDR  00D0H.5   A   
PSW_F1. . . . . . . . . . . . . . .  B  ADDR  00D0H.1   A   
PSW_OV. . . . . . . . . . . . . . .  B  ADDR  00D0H.2   A   
PSW_PARITY. . . . . . . . . . . . .  B  ADDR  00D0H.0   A   
PSW_RS0 . . . . . . . . . . . . . .  B  ADDR  00D0H.3   A   
PSW_RS1 . . . . . . . . . . . . . .  B  ADDR  00D0H.4   A   
PUT1. . . . . . . . . . . . . . . .  C  ADDR  1D58H     R   SEG=?CO?BLHELI_S?19
PUT2. . . . . . . . . . . . . . . .  C  ADDR  1D6BH     R   SEG=?CO?BLHELI_S?19
PUT3. . . . . . . . . . . . . . . .  C  ADDR  1D77H     R   SEG=?CO?BLHELI_S?19
PUT4. . . . . . . . . . . . . . . .  C  ADDR  1D89H     R   SEG=?CO?BLHELI_S?19
PUTC. . . . . . . . . . . . . . . .  C  ADDR  1D6EH     R   SEG=?CO?BLHELI_S?19
PUTP. . . . . . . . . . . . . . . .  C  ADDR  1D52H     R   SEG=?CO?BLHELI_S?19
PUTW. . . . . . . . . . . . . . . .  C  ADDR  1D4AH     R   SEG=?CO?BLHELI_S?19
PWM_LIMIT . . . . . . . . . . . . .  D  ADDR  0059H     R   SEG=?DT?BLHELI_S?4
PWM_LIMIT_BEG . . . . . . . . . . .  D  ADDR  005BH     R   SEG=?DT?BLHELI_S?4
PWM_LIMIT_BY_RPM. . . . . . . . . .  D  ADDR  005AH     R   SEG=?DT?BLHELI_S?4
Q_. . . . . . . . . . . . . . . . .  N  NUMB  0011H     A   
R_. . . . . . . . . . . . . . . . .  N  NUMB  0012H     A   
RCP_DIR_REV . . . . . . . . . . . .  N  NUMB  0005H     A   
RCP_DSHOT . . . . . . . . . . . . .  N  NUMB  0004H     A   
RCP_FULL_RANGE. . . . . . . . . . .  N  NUMB  0006H     A   
RCP_IN. . . . . . . . . . . . . . .  N  NUMB  0005H     A   
RCP_MULTISHOT . . . . . . . . . . .  N  NUMB  0003H     A   
RCP_ONESHOT125. . . . . . . . . . .  N  NUMB  0001H     A   
RCP_ONESHOT42 . . . . . . . . . . .  N  NUMB  0002H     A   
RCP_OUTSIDE_RANGE_CNT . . . . . . .  D  ADDR  0022H     R   SEG=?DT?BLHELI_S?3
RCP_STOP_CNT. . . . . . . . . . . .  D  ADDR  0053H     R   SEG=?DT?BLHELI_S?4
RCP_TIMEOUT_CNTD. . . . . . . . . .  D  ADDR  0023H     R   SEG=?DT?BLHELI_S?3
RCP_UPDATED . . . . . . . . . . . .  N  NUMB  0000H     A   
RD1 . . . . . . . . . . . . . . . .  C  ADDR  1D3CH     R   SEG=?CO?BLHELI_S?19
READ_ALL_EEPROM_PARAMETERS. . . . .  C  ADDR  17F3H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_BLOCK1. . . . . . . . .  C  ADDR  1824H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_BLOCK2. . . . . . . . .  C  ADDR  1831H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_BYTE. . . . . . . . . .  C  ADDR  1874H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_EXIT. . . . . . . . . .  C  ADDR  183AH     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_READ. . . . . . . . . .  C  ADDR  181DH     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_STORE_DEFAULTS. . . . .  C  ADDR  180AH     R   SEG=?CO?BLHELI_S?17
READ_INITIAL_TEMP . . . . . . . . .  C  ADDR  165BH     R   SEG=?CO?BLHELI_S?17
READ_TAG. . . . . . . . . . . . . .  C  ADDR  18C0H     R   SEG=?CO?BLHELI_S?17
READ_TAGS . . . . . . . . . . . . .  C  ADDR  18B7H     R   SEG=?CO?BLHELI_S?17
REF0CN. . . . . . . . . . . . . . .  D  ADDR  00D1H     A   
REG0CN. . . . . . . . . . . . . . .  D  ADDR  00C9H     A   
REG1CN. . . . . . . . . . . . . . .  D  ADDR  00C6H     A   
RESET . . . . . . . . . . . . . . .  C  ADDR  19FDH     R   SEG=?CO?BLHELI_S?20
REVID . . . . . . . . . . . . . . .  D  ADDR  00B6H     A   
RST . . . . . . . . . . . . . . . .  C  ADDR  1CC9H     R   SEG=?CO?BLHELI_S?19
RSTSRC. . . . . . . . . . . . . . .  D  ADDR  00EFH     A   
RTX_MDIN. . . . . . . . . . . . . .  D  ADDR  00F1H     A   
RTX_MDOUT . . . . . . . . . . . . .  D  ADDR  00A4H     A   
RTX_PIN . . . . . . . . . . . . . .  N  NUMB  0005H     A   
RTX_PORT. . . . . . . . . . . . . .  D  ADDR  0080H     A   
RTX_SKIP. . . . . . . . . . . . . .  D  ADDR  00D4H     A   
RUN1. . . . . . . . . . . . . . . .  C  ADDR  16B1H     R   SEG=?CO?BLHELI_S?17
RUN2. . . . . . . . . . . . . . . .  C  ADDR  16BDH     R   SEG=?CO?BLHELI_S?17
RUN3. . . . . . . . . . . . . . . .  C  ADDR  16D5H     R   SEG=?CO?BLHELI_S?17
RUN4. . . . . . . . . . . . . . . .  C  ADDR  16E1H     R   SEG=?CO?BLHELI_S?17
RUN5. . . . . . . . . . . . . . . .  C  ADDR  16EDH     R   SEG=?CO?BLHELI_S?17
RUN6. . . . . . . . . . . . . . . .  C  ADDR  16F9H     R   SEG=?CO?BLHELI_S?17
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   491

RUN6_BRAKE_DONE . . . . . . . . . .  C  ADDR  1791H     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_DIR. . . . . . . . . . .  C  ADDR  176DH     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_DIR_CHANGE . . . . . . .  C  ADDR  177DH     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_DIR_REV. . . . . . . . .  C  ADDR  1778H     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_SPEED. . . . . . . . . .  C  ADDR  1787H     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON. . . . . .  C  ADDR  17B8H     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON_BRAKE_DONE  C  ADDR  17E8H     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON_FAIL . . .  C  ADDR  17B0H     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON_STALL_DONE  C  ADDR  17BBH     R   SEG=?CO?BLHELI_S?17
SBCON1. . . . . . . . . . . . . . .  D  ADDR  0094H     A   
SBRL1 . . . . . . . . . . . . . . .  D  ADDR  0095H     A   
SBRLH1. . . . . . . . . . . . . . .  D  ADDR  0096H     A   
SBRLL1. . . . . . . . . . . . . . .  D  ADDR  0095H     A   
SBUF0 . . . . . . . . . . . . . . .  D  ADDR  0099H     A   
SBUF1 . . . . . . . . . . . . . . .  D  ADDR  0092H     A   
SCALE_THROTTLE_CAL. . . . . . . . .  C  ADDR  0CB0H     R   SEG=?CO?BLHELI_S?17
SCON0 . . . . . . . . . . . . . . .  D  ADDR  0098H     A   
SCON0_MCE . . . . . . . . . . . . .  B  ADDR  0098H.5   A   
SCON0_RB8 . . . . . . . . . . . . .  B  ADDR  0098H.2   A   
SCON0_REN . . . . . . . . . . . . .  B  ADDR  0098H.4   A   
SCON0_RI. . . . . . . . . . . . . .  B  ADDR  0098H.0   A   
SCON0_SMODE . . . . . . . . . . . .  B  ADDR  0098H.7   A   
SCON0_TB8 . . . . . . . . . . . . .  B  ADDR  0098H.3   A   
SCON0_TI. . . . . . . . . . . . . .  B  ADDR  0098H.1   A   
SCON1 . . . . . . . . . . . . . . .  D  ADDR  00C8H     A   
SCON1_OVR . . . . . . . . . . . . .  B  ADDR  00C8H.7   A   
SCON1_PERR. . . . . . . . . . . . .  B  ADDR  00C8H.6   A   
SCON1_RBX . . . . . . . . . . . . .  B  ADDR  00C8H.2   A   
SCON1_REN . . . . . . . . . . . . .  B  ADDR  00C8H.4   A   
SCON1_RI. . . . . . . . . . . . . .  B  ADDR  00C8H.0   A   
SCON1_TBX . . . . . . . . . . . . .  B  ADDR  00C8H.3   A   
SCON1_TI. . . . . . . . . . . . . .  B  ADDR  00C8H.1   A   
SET4. . . . . . . . . . . . . . . .  C  ADDR  1CD1H     R   SEG=?CO?BLHELI_S?19
SET5. . . . . . . . . . . . . . . .  C  ADDR  1CD7H     R   SEG=?CO?BLHELI_S?19
SET6. . . . . . . . . . . . . . . .  C  ADDR  1CDDH     R   SEG=?CO?BLHELI_S?19
SET_DEFAULT_PARAMETERS. . . . . . .  C  ADDR  0C44H     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_HIGH_RPM. . . . . . .  C  ADDR  05CFH     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_HIGH_RPM_INC_LIMIT. .  C  ADDR  05DFH     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_HIGH_RPM_STORE. . . .  C  ADDR  05E0H     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_LOW_RPM . . . . . . .  C  ADDR  059FH     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_LOW_RPM_EXIT. . . . .  C  ADDR  05CCH     R   SEG=?CO?BLHELI_S?17
SET_STARTUP_PWM . . . . . . . . . .  C  ADDR  0650H     R   SEG=?CO?BLHELI_S?17
SETBUF. . . . . . . . . . . . . . .  C  ADDR  1CCBH     R   SEG=?CO?BLHELI_S?19
SETUP_COMM_WAIT . . . . . . . . . .  C  ADDR  09B5H     R   SEG=?CO?BLHELI_S?17
SETUP_ZC_SCAN_TIMEOUT . . . . . . .  C  ADDR  08ABH     R   SEG=?CO?BLHELI_S?17
SETUP_ZC_SCAN_TIMEOUT_STARTUP_DONE.  C  ADDR  08C8H     R   SEG=?CO?BLHELI_S?17
SFRPAGE . . . . . . . . . . . . . .  D  ADDR  00A7H     A   
SFRPGCN . . . . . . . . . . . . . .  D  ADDR  00CFH     A   
SFRSTACK. . . . . . . . . . . . . .  D  ADDR  00D7H     A   
SIGNATURE_001 . . . . . . . . . . .  N  NUMB  00E8H     A   
SIGNATURE_002 . . . . . . . . . . .  N  NUMB  00B2H     A   
SKIP_T2_INT . . . . . . . . . . . .  D  ADDR  0063H     R   SEG=?DT?BLHELI_S?4
SMB0_PAGE . . . . . . . . . . . . .  N  NUMB  0020H     A   
SMB0ADM . . . . . . . . . . . . . .  D  ADDR  00D6H     A   
SMB0ADR . . . . . . . . . . . . . .  D  ADDR  00D7H     A   
SMB0CF. . . . . . . . . . . . . . .  D  ADDR  00C1H     A   
SMB0CN0 . . . . . . . . . . . . . .  D  ADDR  00C0H     A   
SMB0CN0_ACK . . . . . . . . . . . .  B  ADDR  00C0H.1   A   
SMB0CN0_ACKRQ . . . . . . . . . . .  B  ADDR  00C0H.3   A   
SMB0CN0_ARBLOST . . . . . . . . . .  B  ADDR  00C0H.2   A   
SMB0CN0_MASTER. . . . . . . . . . .  B  ADDR  00C0H.7   A   
SMB0CN0_SI. . . . . . . . . . . . .  B  ADDR  00C0H.0   A   
SMB0CN0_STA . . . . . . . . . . . .  B  ADDR  00C0H.5   A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   492

SMB0CN0_STO . . . . . . . . . . . .  B  ADDR  00C0H.4   A   
SMB0CN0_TXMODE. . . . . . . . . . .  B  ADDR  00C0H.6   A   
SMB0DAT . . . . . . . . . . . . . .  D  ADDR  00C2H     A   
SMB0FCN0. . . . . . . . . . . . . .  D  ADDR  00C3H     A   
SMB0FCN1. . . . . . . . . . . . . .  D  ADDR  00C4H     A   
SMB0FCT . . . . . . . . . . . . . .  D  ADDR  00EFH     A   
SMB0RXLN. . . . . . . . . . . . . .  D  ADDR  00C5H     A   
SMB0TC. . . . . . . . . . . . . . .  D  ADDR  00ACH     A   
SMBUS0_IRQN . . . . . . . . . . . .  N  NUMB  0007H     A   
SMOD1 . . . . . . . . . . . . . . .  D  ADDR  0093H     A   
SP. . . . . . . . . . . . . . . . .  D  ADDR  0081H     A   
SPI0_IRQN . . . . . . . . . . . . .  N  NUMB  0006H     A   
SPI0_PAGE . . . . . . . . . . . . .  N  NUMB  0020H     A   
SPI0CFG . . . . . . . . . . . . . .  D  ADDR  00A1H     A   
SPI0CKR . . . . . . . . . . . . . .  D  ADDR  00A2H     A   
SPI0CN0 . . . . . . . . . . . . . .  D  ADDR  00F8H     A   
SPI0CN0_MODF. . . . . . . . . . . .  B  ADDR  00F8H.5   A   
SPI0CN0_NSSMD0. . . . . . . . . . .  B  ADDR  00F8H.2   A   
SPI0CN0_NSSMD1. . . . . . . . . . .  B  ADDR  00F8H.3   A   
SPI0CN0_RXOVRN. . . . . . . . . . .  B  ADDR  00F8H.4   A   
SPI0CN0_SPIEN . . . . . . . . . . .  B  ADDR  00F8H.0   A   
SPI0CN0_SPIF. . . . . . . . . . . .  B  ADDR  00F8H.7   A   
SPI0CN0_TXNF. . . . . . . . . . . .  B  ADDR  00F8H.1   A   
SPI0CN0_WCOL. . . . . . . . . . . .  B  ADDR  00F8H.6   A   
SPI0DAT . . . . . . . . . . . . . .  D  ADDR  00A3H     A   
SPI0FCN0. . . . . . . . . . . . . .  D  ADDR  009AH     A   
SPI0FCN1. . . . . . . . . . . . . .  D  ADDR  009BH     A   
SPI0FCT . . . . . . . . . . . . . .  D  ADDR  00F7H     A   
STALL_CNT . . . . . . . . . . . . .  D  ADDR  003CH     R   SEG=?DT?BLHELI_S?4
START_ADC_CONVERSION. . . . . . . .  C  ADDR  05E5H     R   SEG=?CO?BLHELI_S?17
STARTUP_CNT . . . . . . . . . . . .  D  ADDR  0039H     R   SEG=?DT?BLHELI_S?4
STARTUP_CZ. . . . . . . . . . . . .  C  ADDR  0FDDH     R   SEG=?CO?BLHELI_S?17
STARTUP_END . . . . . . . . . . . .  C  ADDR  13A1H     R   SEG=?CO?BLHELI_S?17
STARTUP_GOT . . . . . . . . . . . .  C  ADDR  1012H     R   SEG=?CO?BLHELI_S?17
STARTUP_HG. . . . . . . . . . . . .  C  ADDR  10EFH     R   SEG=?CO?BLHELI_S?17
STARTUP_IM. . . . . . . . . . . . .  C  ADDR  0FE8H     R   SEG=?CO?BLHELI_S?17
STARTUP_LEGO. . . . . . . . . . . .  C  ADDR  12C1H     R   SEG=?CO?BLHELI_S?17
STARTUP_MHLL. . . . . . . . . . . .  C  ADDR  11DBH     R   SEG=?CO?BLHELI_S?17
STARTUP_PHASE . . . . . . . . . . .  N  NUMB  0000H     A   
STARTUP_POWER_TABLE . . . . . . . .  C  ADDR  0080H     R   SEG=?CO?BLHELI_S?17
STARTUP_PWM_SET_PWM . . . . . . . .  C  ADDR  0665H     R   SEG=?CO?BLHELI_S?17
STARTUP_WAVE1 . . . . . . . . . . .  C  ADDR  0BABH     R   SEG=?CO?BLHELI_S?17
STARTUP_WAVE2 . . . . . . . . . . .  C  ADDR  0BBBH     R   SEG=?CO?BLHELI_S?17
STARTUP_ZC_TIMEOUT_CNTD . . . . . .  D  ADDR  003AH     R   SEG=?DT?BLHELI_S?4
STORE_TIMES_DECREASE. . . . . . . .  C  ADDR  084AH     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_DECREASE_FAST . . . . .  C  ADDR  089DH     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_EXIT. . . . . . . . . .  C  ADDR  086BH     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_INCREASE. . . . . . . .  C  ADDR  083BH     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_INCREASE_FAST . . . . .  C  ADDR  0894H     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_UP_OR_DOWN. . . . . . .  C  ADDR  0835H     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_UP_OR_DOWN_FAST . . . .  C  ADDR  088EH     R   SEG=?CO?BLHELI_S?17
SUCCESS . . . . . . . . . . . . . .  N  NUMB  0030H     A   
SUCCESS_BEEP. . . . . . . . . . . .  C  ADDR  18E1H     R   SEG=?CO?BLHELI_S?17
SUCCESS_BEEP_INVERTED . . . . . . .  C  ADDR  1910H     R   SEG=?CO?BLHELI_S?17
SWITCH_POWER_OFF. . . . . . . . . .  C  ADDR  0C34H     R   SEG=?CO?BLHELI_S?17
T0_INT. . . . . . . . . . . . . . .  C  ADDR  008DH     R   SEG=?CO?BLHELI_S?17
T1_INT. . . . . . . . . . . . . . .  C  ADDR  0090H     R   SEG=?CO?BLHELI_S?17
T1_INT_BIDIR_FWD. . . . . . . . . .  C  ADDR  023DH     R   SEG=?CO?BLHELI_S?17
T1_INT_BIDIR_REV_CHK. . . . . . . .  C  ADDR  0242H     R   SEG=?CO?BLHELI_S?17
T1_INT_DECODE . . . . . . . . . . .  C  ADDR  00F2H     R   SEG=?CO?BLHELI_S?17
T1_INT_DECODE_LSB . . . . . . . . .  C  ADDR  0178H     R   SEG=?CO?BLHELI_S?17
T1_INT_DECODE_MSB . . . . . . . . .  C  ADDR  00FDH     R   SEG=?CO?BLHELI_S?17
T1_INT_FRAME_FAIL . . . . . . . . .  C  ADDR  02ADH     R   SEG=?CO?BLHELI_S?17
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   493

T1_INT_FRAME_TIME_SCALED. . . . . .  C  ADDR  00CCH     R   SEG=?CO?BLHELI_S?17
T1_INT_LSB_FAIL . . . . . . . . . .  C  ADDR  016FH     R   SEG=?CO?BLHELI_S?17
T1_INT_MSB_FAIL . . . . . . . . . .  C  ADDR  00F4H     R   SEG=?CO?BLHELI_S?17
T1_INT_NOT_BIDIR. . . . . . . . . .  C  ADDR  024EH     R   SEG=?CO?BLHELI_S?17
T1_INT_STARTUP_BOOST_STALL. . . . .  C  ADDR  027FH     R   SEG=?CO?BLHELI_S?17
T1_INT_STARTUP_BOOSTED. . . . . . .  C  ADDR  0289H     R   SEG=?CO?BLHELI_S?17
T1_INT_XOR_OK . . . . . . . . . . .  C  ADDR  0200H     R   SEG=?CO?BLHELI_S?17
T1_INT_ZERO_RCP_CHECKED . . . . . .  C  ADDR  029EH     R   SEG=?CO?BLHELI_S?17
T2_INT. . . . . . . . . . . . . . .  C  ADDR  02B6H     R   SEG=?CO?BLHELI_S?17
T2_INT_EXIT . . . . . . . . . . . .  C  ADDR  02E9H     R   SEG=?CO?BLHELI_S?17
T2_INT_RCP_STOP . . . . . . . . . .  C  ADDR  02DEH     R   SEG=?CO?BLHELI_S?17
T2_INT_START. . . . . . . . . . . .  C  ADDR  02CBH     R   SEG=?CO?BLHELI_S?17
T3_INT. . . . . . . . . . . . . . .  C  ADDR  02EEH     R   SEG=?CO?BLHELI_S?17
T3_PENDING. . . . . . . . . . . . .  N  NUMB  0000H     A   
TCON. . . . . . . . . . . . . . . .  D  ADDR  0088H     A   
TCON_IE0. . . . . . . . . . . . . .  B  ADDR  0088H.1   A   
TCON_IE1. . . . . . . . . . . . . .  B  ADDR  0088H.3   A   
TCON_IT0. . . . . . . . . . . . . .  B  ADDR  0088H.0   A   
TCON_IT1. . . . . . . . . . . . . .  B  ADDR  0088H.2   A   
TCON_TF0. . . . . . . . . . . . . .  B  ADDR  0088H.5   A   
TCON_TF1. . . . . . . . . . . . . .  B  ADDR  0088H.7   A   
TCON_TR0. . . . . . . . . . . . . .  B  ADDR  0088H.4   A   
TCON_TR1. . . . . . . . . . . . . .  B  ADDR  0088H.6   A   
TEMP1 . . . . . . . . . . . . . . .     REG   R            
TEMP2 . . . . . . . . . . . . . . .     REG   R            
TEMP3 . . . . . . . . . . . . . . .     REG   R            
TEMP4 . . . . . . . . . . . . . . .     REG   R            
TEMP5 . . . . . . . . . . . . . . .     REG   R            
TEMP6 . . . . . . . . . . . . . . .     REG   R            
TEMP7 . . . . . . . . . . . . . . .     REG   R            
TEMP8 . . . . . . . . . . . . . . .     REG   R            
TEMP_AVERAGE_DEC. . . . . . . . . .  C  ADDR  0618H     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_INC. . . . . . . . . .  C  ADDR  061BH     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_INC_DEC. . . . . . . .  C  ADDR  060CH     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_UPDATED. . . . . . . .  C  ADDR  0622H     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_UPDATED_LOAD_ACC . . .  C  ADDR  0620H     R   SEG=?CO?BLHELI_S?17
TEMP_CHECK_EXIT . . . . . . . . . .  C  ADDR  0644H     R   SEG=?CO?BLHELI_S?17
TEMP_LIMIT. . . . . . . . . . . . .  N  NUMB  0031H     A   
TEMP_LIMIT_STEP . . . . . . . . . .  N  NUMB  0009H     A   
TEMP_PROT_LIMIT . . . . . . . . . .  D  ADDR  0067H     R   SEG=?DT?BLHELI_S?4
TEMP_STORAGE. . . . . . . . . . . .  I  ADDR  00D0H     R   SEG=?ID?BLHELI_S?6
TEST_THROTTLE_GAIN. . . . . . . . .  C  ADDR  0DD8H     R   SEG=?CO?BLHELI_S?17
TEST_THROTTLE_GAIN_MULT . . . . . .  C  ADDR  0DE5H     R   SEG=?CO?BLHELI_S?17
TH0 . . . . . . . . . . . . . . . .  D  ADDR  008CH     A   
TH1 . . . . . . . . . . . . . . . .  D  ADDR  008DH     A   
THROTTLE_GAIN . . . . . . . . . . .  D  ADDR  005EH     R   SEG=?DT?BLHELI_S?4
THROTTLE_GAIN_BD_REV. . . . . . . .  D  ADDR  0060H     R   SEG=?DT?BLHELI_S?4
THROTTLE_GAIN_BD_REV_M. . . . . . .  D  ADDR  0061H     R   SEG=?DT?BLHELI_S?4
THROTTLE_GAIN_M . . . . . . . . . .  D  ADDR  005FH     R   SEG=?DT?BLHELI_S?4
THROTTLE_HIGH_CAL . . . . . . . . .  C  ADDR  152FH     R   SEG=?CO?BLHELI_S?17
THROTTLE_LOW_CAL. . . . . . . . . .  C  ADDR  1563H     R   SEG=?CO?BLHELI_S?17
THROTTLE_LOW_CAL_START. . . . . . .  C  ADDR  1561H     R   SEG=?CO?BLHELI_S?17
TIMER0_IRQN . . . . . . . . . . . .  N  NUMB  0001H     A   
TIMER0_X. . . . . . . . . . . . . .  D  ADDR  0040H     R   SEG=?DT?BLHELI_S?4
TIMER1_IRQN . . . . . . . . . . . .  N  NUMB  0003H     A   
TIMER2_IRQN . . . . . . . . . . . .  N  NUMB  0005H     A   
TIMER2_PAGE . . . . . . . . . . . .  N  NUMB  0010H     A   
TIMER2_X. . . . . . . . . . . . . .  D  ADDR  0041H     R   SEG=?DT?BLHELI_S?4
TIMER3_IRQN . . . . . . . . . . . .  N  NUMB  000EH     A   
TIMER3_PAGE . . . . . . . . . . . .  N  NUMB  0010H     A   
TIMER4_IRQN . . . . . . . . . . . .  N  NUMB  0013H     A   
TIMER4_PAGE . . . . . . . . . . . .  N  NUMB  0010H     A   
TL0 . . . . . . . . . . . . . . . .  D  ADDR  008AH     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   494

TL1 . . . . . . . . . . . . . . . .  D  ADDR  008BH     A   
TMOD. . . . . . . . . . . . . . . .  D  ADDR  0089H     A   
TMR2. . . . . . . . . . . . . . . .  D  ADDR  00CCH     A   
TMR2CN0 . . . . . . . . . . . . . .  D  ADDR  00C8H     A   
TMR2CN0_T2SPLIT . . . . . . . . . .  B  ADDR  00C8H.3   A   
TMR2CN0_T2XCLK0 . . . . . . . . . .  B  ADDR  00C8H.0   A   
TMR2CN0_T2XCLK1 . . . . . . . . . .  B  ADDR  00C8H.1   A   
TMR2CN0_TF2CEN. . . . . . . . . . .  B  ADDR  00C8H.4   A   
TMR2CN0_TF2H. . . . . . . . . . . .  B  ADDR  00C8H.7   A   
TMR2CN0_TF2L. . . . . . . . . . . .  B  ADDR  00C8H.6   A   
TMR2CN0_TF2LEN. . . . . . . . . . .  B  ADDR  00C8H.5   A   
TMR2CN0_TR2 . . . . . . . . . . . .  B  ADDR  00C8H.2   A   
TMR2CN1 . . . . . . . . . . . . . .  D  ADDR  00FDH     A   
TMR2H . . . . . . . . . . . . . . .  D  ADDR  00CDH     A   
TMR2L . . . . . . . . . . . . . . .  D  ADDR  00CCH     A   
TMR2RL. . . . . . . . . . . . . . .  D  ADDR  00CAH     A   
TMR2RLH . . . . . . . . . . . . . .  D  ADDR  00CBH     A   
TMR2RLL . . . . . . . . . . . . . .  D  ADDR  00CAH     A   
TMR3. . . . . . . . . . . . . . . .  D  ADDR  0094H     A   
TMR3CN0 . . . . . . . . . . . . . .  D  ADDR  0091H     A   
TMR3CN1 . . . . . . . . . . . . . .  D  ADDR  00FEH     A   
TMR3H . . . . . . . . . . . . . . .  D  ADDR  0095H     A   
TMR3L . . . . . . . . . . . . . . .  D  ADDR  0094H     A   
TMR3RL. . . . . . . . . . . . . . .  D  ADDR  0092H     A   
TMR3RLH . . . . . . . . . . . . . .  D  ADDR  0093H     A   
TMR3RLL . . . . . . . . . . . . . .  D  ADDR  0092H     A   
TMR4. . . . . . . . . . . . . . . .  D  ADDR  00A4H     A   
TMR4CN0 . . . . . . . . . . . . . .  D  ADDR  0098H     A   
TMR4CN0_T4SPLIT . . . . . . . . . .  B  ADDR  0098H.3   A   
TMR4CN0_T4XCLK0 . . . . . . . . . .  B  ADDR  0098H.0   A   
TMR4CN0_T4XCLK1 . . . . . . . . . .  B  ADDR  0098H.1   A   
TMR4CN0_TF4CEN. . . . . . . . . . .  B  ADDR  0098H.4   A   
TMR4CN0_TF4H. . . . . . . . . . . .  B  ADDR  0098H.7   A   
TMR4CN0_TF4L. . . . . . . . . . . .  B  ADDR  0098H.6   A   
TMR4CN0_TF4LEN. . . . . . . . . . .  B  ADDR  0098H.5   A   
TMR4CN0_TR4 . . . . . . . . . . . .  B  ADDR  0098H.2   A   
TMR4CN1 . . . . . . . . . . . . . .  D  ADDR  00FFH     A   
TMR4H . . . . . . . . . . . . . . .  D  ADDR  00A5H     A   
TMR4L . . . . . . . . . . . . . . .  D  ADDR  00A4H     A   
TMR4RL. . . . . . . . . . . . . . .  D  ADDR  00A2H     A   
TMR4RLH . . . . . . . . . . . . . .  D  ADDR  00A3H     A   
TMR4RLL . . . . . . . . . . . . . .  D  ADDR  00A2H     A   
TONE_AB . . . . . . . . . . . . . .  C  ADDR  0C0EH     R   SEG=?CO?BLHELI_S?17
TONE_BC . . . . . . . . . . . . . .  C  ADDR  0C01H     R   SEG=?CO?BLHELI_S?17
TONE_DIR. . . . . . . . . . . . . .  N  NUMB  0005H     A   
TONE_SELECTION. . . . . . . . . . .  C  ADDR  0FBBH     R   SEG=?CO?BLHELI_S?17
TONE_WAVE . . . . . . . . . . . . .  N  NUMB  0004H     A   
UART0_IRQN. . . . . . . . . . . . .  N  NUMB  0004H     A   
UART0_PAGE. . . . . . . . . . . . .  N  NUMB  0020H     A   
UART1_IRQN. . . . . . . . . . . . .  N  NUMB  0011H     A   
UART1_PAGE. . . . . . . . . . . . .  N  NUMB  0020H     A   
UART1FCN0 . . . . . . . . . . . . .  D  ADDR  009DH     A   
UART1FCN1 . . . . . . . . . . . . .  D  ADDR  00D8H     A   
UART1FCN1_RFRQ. . . . . . . . . . .  B  ADDR  00D8H.3   A   
UART1FCN1_RIE . . . . . . . . . . .  B  ADDR  00D8H.0   A   
UART1FCN1_RXTO0 . . . . . . . . . .  B  ADDR  00D8H.1   A   
UART1FCN1_RXTO1 . . . . . . . . . .  B  ADDR  00D8H.2   A   
UART1FCN1_TFRQ. . . . . . . . . . .  B  ADDR  00D8H.7   A   
UART1FCN1_TIE . . . . . . . . . . .  B  ADDR  00D8H.4   A   
UART1FCN1_TXHOLD. . . . . . . . . .  B  ADDR  00D8H.5   A   
UART1FCN1_TXNF. . . . . . . . . . .  B  ADDR  00D8H.6   A   
UART1FCT. . . . . . . . . . . . . .  D  ADDR  00FAH     A   
UART1LIN. . . . . . . . . . . . . .  D  ADDR  009EH     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              02/01/17 09:12:15 PAGE   495

UART_LOOP . . . . . . . . . . . . .  N  NUMB  001AH     A   
VALIDATE_RCP_START. . . . . . . . .  C  ADDR  14F5H     R   SEG=?CO?BLHELI_S?17
VDM0CN. . . . . . . . . . . . . . .  D  ADDR  00FFH     A   
WAIT1 . . . . . . . . . . . . . . .  C  ADDR  1DE1H     R   SEG=?CO?BLHELI_S?19
WAIT100MS . . . . . . . . . . . . .  C  ADDR  058CH     R   SEG=?CO?BLHELI_S?17
WAIT10MS. . . . . . . . . . . . . .  C  ADDR  0584H     R   SEG=?CO?BLHELI_S?17
WAIT1MS . . . . . . . . . . . . . .  C  ADDR  057CH     R   SEG=?CO?BLHELI_S?17
WAIT1S. . . . . . . . . . . . . . .  C  ADDR  18D9H     R   SEG=?CO?BLHELI_S?17
WAIT1S_LOOP . . . . . . . . . . . .  C  ADDR  18DBH     R   SEG=?CO?BLHELI_S?17
WAIT200MS . . . . . . . . . . . . .  C  ADDR  0590H     R   SEG=?CO?BLHELI_S?17
WAIT30MS. . . . . . . . . . . . . .  C  ADDR  0588H     R   SEG=?CO?BLHELI_S?17
WAIT3MS . . . . . . . . . . . . . .  C  ADDR  0580H     R   SEG=?CO?BLHELI_S?17
WAIT_150US. . . . . . . . . . . . .  C  ADDR  0EFAH     R   SEG=?CO?BLHELI_S?17
WAIT_ADVANCE_TIMING . . . . . . . .  C  ADDR  07D9H     R   SEG=?CO?BLHELI_S?17
WAIT_BEFORE_ZC_SCAN . . . . . . . .  C  ADDR  08A3H     R   SEG=?CO?BLHELI_S?17
WAIT_BEFORE_ZC_SCAN_EXIT. . . . . .  C  ADDR  08E3H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMM . . . . . . . . . . .  C  ADDR  09F1H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMM_WAIT. . . . . . . . .  C  ADDR  0A2AH     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMP_OUT_HIGH. . . . . . .  C  ADDR  08F4H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMP_OUT_LOW . . . . . . .  C  ADDR  08E4H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMP_OUT_START . . . . . .  C  ADDR  0902H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_LOW. . . . . . . . . . . .  C  ADDR  1C48H     R   SEG=?CO?BLHELI_S?19
WAIT_FOR_POWER_ON . . . . . . . . .  C  ADDR  15DCH     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_POWER_ON_LOOP. . . . . . .  C  ADDR  15E1H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_POWER_ON_NO_BEEP . . . . .  C  ADDR  1627H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_POWER_ON_NOT_MISSING . . .  C  ADDR  1630H     R   SEG=?CO?BLHELI_S?17
WAITF . . . . . . . . . . . . . . .  C  ADDR  1DDBH     R   SEG=?CO?BLHELI_S?19
WAITH . . . . . . . . . . . . . . .  C  ADDR  1DDFH     R   SEG=?CO?BLHELI_S?19
WAITXMS_M . . . . . . . . . . . . .  C  ADDR  0596H     R   SEG=?CO?BLHELI_S?17
WAITXMS_O . . . . . . . . . . . . .  C  ADDR  0594H     R   SEG=?CO?BLHELI_S?17
WDTCN . . . . . . . . . . . . . . .  D  ADDR  0097H     A   
WRITE_EEPROM_BLOCK1 . . . . . . . .  C  ADDR  1859H     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_BLOCK2 . . . . . . . .  C  ADDR  1866H     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_BYTE . . . . . . . . .  C  ADDR  1878H     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_BYTE_FROM_ACC. . . . .  C  ADDR  1879H     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_SIGNATURE. . . . . . .  C  ADDR  18A8H     R   SEG=?CO?BLHELI_S?17
WRITE_TAG . . . . . . . . . . . . .  C  ADDR  18D1H     R   SEG=?CO?BLHELI_S?17
WRITE_TAGS. . . . . . . . . . . . .  C  ADDR  18CAH     R   SEG=?CO?BLHELI_S?17
WT_ADV_START_H. . . . . . . . . . .  D  ADDR  004BH     R   SEG=?DT?BLHELI_S?4
WT_ADV_START_L. . . . . . . . . . .  D  ADDR  004AH     R   SEG=?DT?BLHELI_S?4
WT_COMM_START_H . . . . . . . . . .  D  ADDR  0051H     R   SEG=?DT?BLHELI_S?4
WT_COMM_START_L . . . . . . . . . .  D  ADDR  0050H     R   SEG=?DT?BLHELI_S?4
WT_ZC_SCAN_START_H. . . . . . . . .  D  ADDR  004DH     R   SEG=?DT?BLHELI_S?4
WT_ZC_SCAN_START_L. . . . . . . . .  D  ADDR  004CH     R   SEG=?DT?BLHELI_S?4
WT_ZC_TOUT_START_H. . . . . . . . .  D  ADDR  004FH     R   SEG=?DT?BLHELI_S?4
WT_ZC_TOUT_START_L. . . . . . . . .  D  ADDR  004EH     R   SEG=?DT?BLHELI_S?4
XBR0. . . . . . . . . . . . . . . .  D  ADDR  00E1H     A   
XBR1. . . . . . . . . . . . . . . .  D  ADDR  00E2H     A   
XBR2. . . . . . . . . . . . . . . .  D  ADDR  00E3H     A   
XH. . . . . . . . . . . . . . . . .     REG   R            
XL. . . . . . . . . . . . . . . . .     REG   R            
XTAL. . . . . . . . . . . . . . . .  N  NUMB  017D7840H A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S).
